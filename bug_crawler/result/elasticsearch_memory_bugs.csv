,number,title,body,user,state,labels,url,created_at,comments,repository_url,html_url,application_resoure
0,136918,[CI] FieldExtractorIT testTextFieldWithKeywordSubfield {STORED} failing,"**Build Scans:**
- [elasticsearch-periodic #11333 / 9.0.8_bwc](https://gradle-enterprise.elastic.co/s/osfoutiuvlc3a)
- [elasticsearch-pull-request #99733 / 9.1.6_part_3_bwc-snapshots](https://gradle-enterprise.elastic.co/s/othacs6cn4x4c)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:esql:qa:server:mixed-cluster:v9.0.8#javaRestTest"" -Dtests.class=""org.elasticsearch.xpack.esql.qa.mixed.FieldExtractorIT"" -Dtests.method=""testTextFieldWithIpSubfieldMalformed {STORED}"" -Dtests.seed=954A4C3E7A260572 -Dtests.bwc=true -Dtests.locale=mfe-MU -Dtests.timezone=Europe/Samara -Druntime.java=25
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.qa.mixed.FieldExtractorIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testTextFieldWithKeywordSubfield%20%7BSTORED%7D'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:35855], URI [/_features/_reset], status line [HTTP/1.1 500 Internal Server Error]
{""error"":{""root_cause"":[{""type"":""timeout_exception"",""reason"":""Unknown error occurred while updating cluster state"",""timed_out"":true}],""type"":""status_exception"",""reason"":""Failed to set [reset_mode] to [false] after a successful feature reset. To allow transforms to run, please call the feature reset API again"",""caused_by"":{""type"":""timeout_exception"",""reason"":""Unknown error occurred while updating cluster state"",""timed_out"":true}},""status"":500}
```

**Issue Reasons:**
- [main] 2 failures in test testTextFieldWithKeywordSubfield {STORED} (0.2% fail rate in 838 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Mapping']",https://github.com/elastic/elasticsearch/issues/136918,2025-10-21T21:42:27Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/136918,"{
  ""application_resource"": ""yes""
}"
1,136850,[CI] GenerativeIT test failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #11317 / rocky-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/av4i4i6k6t5bq)
- [elasticsearch-periodic-platform-support #11309 / ubuntu-2404-aarch64_checkpart3_platform-support-arm](https://gradle-enterprise.elastic.co/s/etqllrkoctepm)
- [elasticsearch-pull-request #99933 / part-3](https://gradle-enterprise.elastic.co/s/n6oz6ahbwhh6i)
- [elasticsearch-periodic-platform-support #11300 / rocky-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/eaghbuhv5gkes)
- [elasticsearch-periodic-platform-support #11300 / windows-2025_checkpart3_platform-support-windows](https://gradle-enterprise.elastic.co/s/cntg6emulk23o)
- [elasticsearch-pull-request #99800 / part-3](https://gradle-enterprise.elastic.co/s/aztpmtyflanhy)
- [elasticsearch-pull-request #99109 / part-3](https://gradle-enterprise.elastic.co/s/x7ie2rxljuw7o)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:esql:qa:server:multi-node:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.qa.multi_node.GenerativeIT.test"" -Dtests.seed=43878489066290DB -Dtests.locale=fr-CA -Dtests.timezone=Europe/Tallinn -Druntime.java=25
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.qa.multi_node.GenerativeIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('test'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.OutOfMemoryError: Java heap space
```

**Issue Reasons:**
- [main] 7 failures in test test (0.7% fail rate in 1000 executions)
- [main] 3 failures in step part-3 (0.7% fail rate in 411 executions)
- [main] 3 failures in pipeline elasticsearch-periodic-platform-support (14.3% fail rate in 21 executions)
- [main] 3 failures in pipeline elasticsearch-pull-request (0.7% fail rate in 411 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'low-risk']",https://github.com/elastic/elasticsearch/issues/136850,2025-10-21T07:02:16Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/136850,"{
  ""application_resource"": ""yes""
}"
2,136332,[CI] NodeJoiningIT testNodeTriesToJoinClusterAndThenSameMasterIsElected failing,"**Build Scans:**
- [elasticsearch-periodic #11127 / openjdk23_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/wjp544o6pulvm)
- [elasticsearch-pull-request #98325 / part-1](https://gradle-enterprise.elastic.co/s/tyqszjr3qyzvq)
- [elasticsearch-intake #29957 / part1](https://gradle-enterprise.elastic.co/s/i644gduogi7ds)
- [elasticsearch-pull-request #98336 / part-1](https://gradle-enterprise.elastic.co/s/lffuthpwc2tue)
- [elasticsearch-pull-request #98325 / part-1](https://gradle-enterprise.elastic.co/s/te2jyvrvztnfs)
- [elasticsearch-pull-request #98280 / part-1](https://gradle-enterprise.elastic.co/s/32piww5n4zsio)
- [elasticsearch-pull-request #98280 / part-1](https://gradle-enterprise.elastic.co/s/6kpvdu3zeuhsa)
- [elasticsearch-pull-request #98260 / part-1](https://gradle-enterprise.elastic.co/s/momzbd4re3a32)
- [elasticsearch-pull-request #98020 / part-1](https://gradle-enterprise.elastic.co/s/5tvxu3vmvwqk6)
- [elasticsearch-pull-request #98008 / part-1](https://gradle-enterprise.elastic.co/s/ieqplg4sjm6m6)

**Reproduction Line:**
```
./gradlew "":server:internalClusterTest"" --tests ""org.elasticsearch.cluster.coordination.NodeJoiningIT.testNodeTriesToJoinClusterAndThenSameMasterIsElected"" -Dtests.seed=B5AE27478725F672 -Dtests.locale=am-Ethi-ET -Dtests.timezone=Asia/Nicosia -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.cluster.coordination.NodeJoiningIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testNodeTriesToJoinClusterAndThenSameMasterIsElected'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: expected not to see warn message with troubleshooting link but did
Expected: <1L>
     but: was <0L>
```

**Issue Reasons:**
- [main] 3 consecutive failures in test testNodeTriesToJoinClusterAndThenSameMasterIsElected
- [main] 15 failures in test testNodeTriesToJoinClusterAndThenSameMasterIsElected (16.9% fail rate in 89 executions)
- [main] 11 failures in step part-1 (22.4% fail rate in 49 executions)
- [main] 2 failures in step part1 (12.5% fail rate in 16 executions)
- [main] 8 failures in pipeline elasticsearch-pull-request (17.8% fail rate in 45 executions)
- [main] 2 failures in pipeline elasticsearch-intake (12.5% fail rate in 16 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':Distributed Coordination/Cluster Coordination', 'low-risk', 'Team:Distributed Coordination']",https://github.com/elastic/elasticsearch/issues/136332,2025-10-09T21:31:13Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/136332,"{
  ""application_resource"": ""unsure""
}"
3,135340,Possible performance regression in 9.1.x (TSDS),"Hi, guys!

On a multi-node cluster, indexing of TSDS (otel-format metrics) is stable on 9.0.x.
After upgrading to 9.1.4, the indexing rate drops and the write queue grows, making the cluster unstable.

Profiling shows significant time spent in dv.writeField (see pic. 1)
Disabling the new 9.1.x optimization with:

```ini
-Dorg.elasticsearch.index.codec.tsdb.es819.ES819TSDBDocValuesConsumer.enableOptimizedMerge=false
```

restores normal performance.

<img width=""1879"" height=""916"" alt=""Image"" src=""https://github.com/user-attachments/assets/0d519768-cc86-4113-83c9-9e7b6a253a2e"" />

<img width=""890"" height=""517"" alt=""Image"" src=""https://github.com/user-attachments/assets/5aecaa33-fc2b-4d70-bc54-20f9b2ea08c5"" />
<img width=""922"" height=""294"" alt=""Image"" src=""https://github.com/user-attachments/assets/13c028f7-84ee-4ba9-b519-b8e945775432"" />


Can you help figure out the root cause?

(using java 21)",sherman,closed,"['>bug', 'Team:StorageEngine', 'priority:high', ':StorageEngine/Codec']",https://github.com/elastic/elasticsearch/issues/135340,2025-09-24T10:46:49Z,11,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/135340,"{
  ""application_resource"": ""yes""
}"
4,134467,[ML] Datafeed preview request rejects job configuration containing unknown `job_type` field,"### Elasticsearch Version

Latest

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Darwin Konrad-elastics-MacBook-Pro 24.6.0 Darwin Kernel Version 24.6.0: Mon Jul 14 11:30:40 PDT 2025; root:xnu-11417.140.69~1/RELEASE_ARM64_T6041 arm64

### Problem Description

I initially created an [issue in Kibana](https://github.com/elastic/kibana/issues/234148) which describes what is happening. Upon further investigation it looks like it might be an elasticsearch problem with schemas and expected fields.

Fields that are causing issues:

```
job_type,
job_version,
create_time,
finished_time,
model_snapshot_id
```

### Steps to Reproduce

1. Run this API call in Dev Tools:

```
GET _ml/datafeeds/_preview
{
  ""job_config"":{
    ""job_id"": """",
    ""description"": """",
    ""job_type"": ""anomaly_detector"",
    ""groups"": [],
    ""analysis_config"": {
      ""bucket_span"": ""15m"",
      ""detectors"": [
        {
          ""function"": ""count""
        }
      ],
      ""influencers"": []
    },
    ""data_description"": {
      ""time_field"": ""@timestamp""
    },
    ""custom_settings"": {
      ""created_by"": ""advanced-wizard""
    },
    ""analysis_limits"": {
      ""model_memory_limit"": ""11MB""
    }
  },
  ""datafeed_config"":{
    ""datafeed_id"": """",
    ""job_id"": """",
    ""indices"": [
      ""fq""
    ],
    ""query"": {
      ""bool"": {
        ""must"": [
          {
            ""match_all"": {}
          }
        ]
      }
    },
    ""runtime_mappings"": {}
  }
}
```

2. Observe the error

### Logs (if relevant)

```
{
  ""error"": {
    ""root_cause"": [
      {
        ""type"": ""x_content_parse_exception"",
        ""reason"": ""[1:61] [job_details] unknown field [job_type]""
      }
    ],
    ""type"": ""x_content_parse_exception"",
    ""reason"": ""[1:73] [preview_datafeed_action] failed to parse field [job_config]"",
    ""caused_by"": {
      ""type"": ""x_content_parse_exception"",
      ""reason"": ""[1:61] [job_details] unknown field [job_type]""
    }
  },
  ""status"": 400
}
```",KodeRad,closed,"['>bug', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/134467,2025-09-10T16:06:10Z,10,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/134467,"{
  ""application_resource"": ""no""
}"
5,134073,Total doc_count_error_upper_bound could be too low,"In some cases, I think the actual count error in a terms aggregation may be _larger_ than what's given by doc_count_error_upper_bound. Feels like a bug based on the ""upper bound"" in the name.

I find this stuff to be a bit brain-twisting, but here's the simplest example I could think of:
(in IT form: https://github.com/elastic/elasticsearch/compare/main...benchaplin:elasticsearch:doc_count_error_upper_bound_bug?expand=1)

Shard 1
| term | doc count |
|------|-----------|
| A    | 100       |
| B    | 20        |
| C    | 20        |
| X    | 20        |
| Y    | 20        |

Shard 2
| term | doc count |
|------|-----------|
| A    | 50        |
| X    | 40        |
| D    | 30        |
| Y    | 30        |

Shard 3
| term | doc count |
|------|-----------|
| A    | 50        |
| Y    | 40        |
| E    | 30        |
| X    | 30        |

This request:
```
{
  ""aggregations"" : {
    ""terms"" : {
      ""terms"" : {
        ""field"" : ""s_value"",
        ""size"" : 3,
        ""shard_size"" : 3,
        ""show_term_doc_count_error"" : true,
        ""order"" : [ {
          ""_count"" : ""desc""
        }, {
          ""_key"" : ""asc""
        } ]
      }
    }
  }
}
```

Gives the response:
```
""aggregations"" : {
    ""terms"" : {
      ""doc_count_error_upper_bound"" : 80,
      ""sum_other_doc_count"" : 200,
      ""buckets"" : [ {
        ""key"" : ""A"",
        ""doc_count"" : 200,
        ""doc_count_error_upper_bound"" : 0
      }, {
        ""key"" : ""X"",
        ""doc_count"" : 40,
        ""doc_count_error_upper_bound"" : 50
      }, {
        ""key"" : ""Y"",
        ""doc_count"" : 40,
        ""doc_count_error_upper_bound"" : 50
      } ]
    }
  }
```

The bug (?) lies in the top-level `""doc_count_error_upper_bound"" : 80` - if we look at the number of Xs and Ys that aren't included in the bucket doc counts, it's actually larger:

20 (uncounted Xs on Shard 1) + 20 (uncounted Ys on Shard 1) + 30 (uncounted Ys on Shard 2) + 30 (uncounted Xs on Shard 3) = 100.

I took a quick look at the code and I think this 80 number is calculated by summing the maximum errors over all the shards: 20 + 30 + 30. This works as an upper bound **unless multiple buckets are undercounted in a single shard**, as is the case on Shard 1 with X and Y. ",benchaplin,closed,"['>bug', ':Analytics/Aggregations', 'Team:Analytics']",https://github.com/elastic/elasticsearch/issues/134073,2025-09-03T16:55:44Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/134073,"{
  ""application_resource"": ""unsure""
}"
6,134034,Startup in Docker fails with v8.19.3,"### Elasticsearch Version

8.19.3

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Docker

### Problem Description

We noticed a problem when starting Elasticsearch in a docker container, with a `config`-volume bind-mounted since v8.19.3 while prior 8.19.x versions worked fine.

(the same also applied to v9.x where the same issue appeared with v9.1.0 while v9.0.x worked fine. There we could just remove the bind-mounted `config`-volume as a workaround.)

### Steps to Reproduce

- start v8.19.2 with the following minimalistic `docker-compose.yml`-file:
```
services:
  app:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.19.2
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
      - bootstrap.memory_lock=true
      - ""ES_JAVA_OPTS=-Xms2000m -Xmx2000m""
      - xpack.security.enabled=false
    ulimits:
      memlock:
        soft: -1
        hard: -1
    volumes:
      - elasticsearch:/usr/share/elasticsearch/data/
      - elasticsearch-config:/usr/share/elasticsearch/config/
    ports:
      - ""127.0.0.1:9200:9200""
    restart: always
    healthcheck:
      test: [""CMD"", ""curl"", ""-s"", ""http://localhost:9200""]
      interval: 30s
      timeout: 10s
      retries: 5
volumes:
  elasticsearch:
    driver: local
  elasticsearch-config:
    driver: local
```

- run `docker compose up`
- output shows that the container starts without errors, and after a few seconds, http://localhost:9200 starts to become available
- stop the container (Ctrl-C)
- now **change version** in the `docker-compose.yml` file (3rd line) to `8.19.3`
- run `docker compose up`
- instead of a starting container, I see the following output / error message and the container does not start:

```
[+] Running 1/1
 âœ” Container elasticsearch  Recreated                                                                                                                                                             0.1s
Attaching to elasticsearch
elasticsearch  | java.lang.RuntimeException: starting java failed with [1]
elasticsearch  | output:
elasticsearch  | [0.000s][error][logging] Error opening log file 'logs/gc.log': No such file or directory
elasticsearch  | [0.000s][error][logging] Initialization of output 'file=logs/gc.log' using options 'filecount=32,filesize=64m' failed.
elasticsearch  | error:
elasticsearch  | Invalid -Xlog option '-Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,level,pid,tags:filecount=32,filesize=64m', see error log for details.
elasticsearch  | Error: Could not create the Java Virtual Machine.
elasticsearch  | Error: A fatal exception has occurred. Program will exit.
elasticsearch  | 	at org.elasticsearch.server.cli.JvmOption.flagsFinal(JvmOption.java:125)
elasticsearch  | 	at org.elasticsearch.server.cli.JvmOption.findFinalOptions(JvmOption.java:90)
elasticsearch  | 	at org.elasticsearch.server.cli.MachineDependentHeap.determineHeapSettings(MachineDependentHeap.java:59)
elasticsearch  | 	at org.elasticsearch.server.cli.JvmOptionsParser.jvmOptions(JvmOptionsParser.java:146)
elasticsearch  | 	at org.elasticsearch.server.cli.JvmOptionsParser.determineJvmOptions(JvmOptionsParser.java:98)
elasticsearch  | 	at org.elasticsearch.server.cli.ServerCli.startServer(ServerCli.java:269)
elasticsearch  | 	at org.elasticsearch.server.cli.ServerCli.execute(ServerCli.java:112)
elasticsearch  | 	at org.elasticsearch.common.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:55)
elasticsearch  | 	at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:101)
elasticsearch  | 	at org.elasticsearch.cli.Command.main(Command.java:54)
elasticsearch  | 	at org.elasticsearch.launcher.CliToolLauncher.main(CliToolLauncher.java:65)
elasticsearch exited with code 70
elasticsearch exited with code 70
elasticsearch exited with code 70
Gracefully Stopping... press Ctrl+C again to force
 Container elasticsearch  Stopping
 Container elasticsearch  Stopped
```

---

If I delete both the container + the created volume to start from scratch, then run `docker compose up` again with `v8.19.3`, it starts properly and becomes available (and creates a fresh `config`-volume and files in it).

But since we have productive installations of Elasticsearch running in Docker, with config and/or keystore files within those bind-mounted `config`-volumes, it's not a real solution to just trash those volumes + start with a fresh volume to work around this issue.

---

I'm not sure, but I see the possibility that it could be related to https://github.com/elastic/elasticsearch/pull/124966 which was introduced in v8.19.3 and changes the working directory to the logs directory. Maybe that's related and causes problems when that (mounted) directory is not empty.


### Logs (if relevant)

_No response_",mrimann,closed,"['>bug', 'feedback_needed', 'Team:Core/Infra', ':Core/Infra/CLI']",https://github.com/elastic/elasticsearch/issues/134034,2025-09-03T09:55:36Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/134034,"{
  ""application_resource"": ""yes""
}"
7,134001,[CI] ClassificationIT testWithCustomFeatureProcessors failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #10493 / almalinux-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/yczgapjfe2zto)
- [elasticsearch-intake #27848 / part4](https://gradle-enterprise.elastic.co/s/utac6kevyvxps)
- [elasticsearch-pull-request #89434 / part-4](https://gradle-enterprise.elastic.co/s/qq5hit4ojght4)
- [elasticsearch-pull-request #89379 / part-4](https://gradle-enterprise.elastic.co/s/ocjufj3egofi4)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithCustomFeatureProcessors"" -Dtests.seed=E5D17EFE225D2AB6 -Dtests.locale=af-Latn-ZA -Dtests.timezone=America/North_Dakota/Center -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testWithCustomFeatureProcessors'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: 
Expected: (a collection containing a string starting with ""Created analytics with type [classification]"" and a collection containing a string starting with ""Estimated memory usage ["" and a collection containing a string starting with ""Starting analytics on node"" and a collection containing a string starting with ""Started analytics"" and a collection containing a string starting with ""Creating destination index [classification_with_custom_feature_processors_source_index_results]"" and a collection containing a string starting with ""Started reindexing to destination index [classification_with_custom_feature_processors_source_index_results]"" and a collection containing a string starting with ""Finished reindexing to destination index [classification_with_custom_feature_processors_source_index_results]"" and a collection containing a string starting with ""Started loading data"" and a collection containing a string starting with ""Started analyzing"" and a collection con
[truncated]
```

**Issue Reasons:**
- [main] 4 failures in test testWithCustomFeatureProcessors (0.9% fail rate in 455 executions)
- [main] 2 failures in step part-4 (2.9% fail rate in 68 executions)
- [main] 2 failures in pipeline elasticsearch-pull-request (2.9% fail rate in 68 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/134001,2025-09-02T16:24:56Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/134001,"{
  ""application_resource"": ""unsure""
}"
8,133560,[CI] LogsDbVersusReindexedLogsDbChallengeRestIT testMatchAllQuery failing,"**Build Scans:**
- [elasticsearch-periodic #10274 / release-tests](https://gradle-enterprise.elastic.co/s/haoolwgbbbz7w)
- [elasticsearch-pull-request #87103 / part-2](https://gradle-enterprise.elastic.co/s/sjarb3faitjig)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.LogsDbVersusReindexedLogsDbChallengeRestIT.testMatchAllQuery"" -Dtests.seed=5FC25C6A601A252F -Dbuild.snapshot=false -Dtests.jvm.argline=""-Dbuild.snapshot=false"" -Dlicense.key=x-pack/license-tools/src/test/resources/public.key -Dtests.locale=xog-Latn-UG -Dtests.timezone=Chile/Continental -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.LogsDbVersusReindexedLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testMatchAllQuery'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [29]. Source documents don't match for field [Ù®Ø¥Ø½ÛˆØ¶ÛŒÛ¥Û®Û´Û“.â²»â³—â²£â³½â³â²±â³„â²Žâ³¸.á€¹á€§.ð¡ð¯ð¥ð®ð²ð¥ð¸ð½]: Error [Values of type [short] don't match after normalization, normalized actual: [-20929, -11585, -1379, 22470, -31565, 6508, -13710, 14990, 24208, -27025, 12785, 24754, 5810, 25875, 17173, 13751, 13751, -5753, 5466, 28859, -31772, -20797, -30464, 15679], expected: [-20929, -11585, -1379, 22470, -31565, 6508, -13710, 14990, 24208, -27025, 12785, 24754, 5810, 25875, 17173, 13751, -5753, 5466, 28859, -31772, -20797, -30464, 15679]] actual mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""Ê¦ÊœÊ¦Ê„Ê‡Ê‰É±É«Éµ"":{""doc_values"":true,""ignore_malformed"":true,""index"":true,""store"":true,""type"":""ip""},""Íƒ"":{""properties"":{},""type"":""nested""},""Ù®Ø¥Ø½ÛˆØ¶ÛŒÛ¥Û®Û´Û“"":{""enabled"":""true"",""properties"":{""à­à¬¥à¬¤à­¥à­à¬ à­¦"":{""index"":true,""store"":true,""type"":""text""},""á…áŽáœá„á€á–áŽáˆ"":{""doc_values"":false,""index"":true,""st
[truncated]
```

**Issue Reasons:**
- [main] 2 failures in test testMatchAllQuery (0.2% fail rate in 907 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Logs', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/133560,2025-08-26T14:36:04Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/133560,"{
  ""application_resource"": ""unsure""
}"
9,133520,[CI] LogsDbVersusReindexedLogsDbChallengeRestIT testEsqlSource failing,"**Build Scans:**
- [elasticsearch-periodic #10268 / openjdk23_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/sdbyjr2cloxny)
- [elasticsearch-pull-request #87103 / part-2](https://gradle-enterprise.elastic.co/s/sjarb3faitjig)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.LogsDbVersusReindexedLogsDbChallengeRestIT.testEsqlSource"" -Dtests.seed=71E60500F73A2AB7 -Dtests.locale=mai -Dtests.timezone=Pacific/Galapagos -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.LogsDbVersusReindexedLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testEsqlSource'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [4]. Source documents don't match for field [ó € ó ¸ó €±ó €›ó €³ó €¶ó €.ðŸ–]: Error [Values of type [short] don't match after normalization, normalized actual: [-26339, 869, 2454, 4070, -22265, -32523, 10254, 15678], expected: [-26339, 869, 2454, 4070, -22265, -32523, 10254, 15678]] actual mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""Ë·Ê´Ë«ËÊ·ËËŒË©Ë¶"":{""type"":""constant_keyword"",""value"":""PATsA""},""à´àµµàµ¤à´›à´“"":{""doc_values"":false,""index"":false,""store"":true,""type"":""float""},""á„«á†¢á‡·á†¤á… á„œá„‹"":{""doc_values"":false,""index"":false,""store"":true,""type"":""short""},""á¥¤á¥œá¥¬á¥±"":{""fields"":{""subfield_match_only_text"":{""type"":""match_only_text""}},""type"":""wildcard""},""â‰ªâˆ·â‹âŠƒâˆ©â‹…"":{""doc_values"":true,""index"":false,""null_value"":""false"",""store"":true,""type"":""boolean""},""â“¡â’â“¦â“°â“¡â’¿â‘¾â’“â“»â“¶"":{""doc_values"":true,""ignore_malformed"":true,""index"":true,""store"":false,""synthetic_source_keep"":""all"",""type"":""long""},""â¿½â¿±"":{""doc_valu
[truncated]
```

**Issue Reasons:**
- [main] 2 failures in test testEsqlSource (0.2% fail rate in 817 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Logs', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/133520,2025-08-26T05:46:51Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/133520,"{
  ""application_resource"": ""unsure""
}"
10,133518,[CI] StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT testTermsQuery failing,"**Build Scans:**
- [elasticsearch-periodic #10268 / concurrent-search-tests](https://gradle-enterprise.elastic.co/s/q5yrn5mhfc6r2)
- [elasticsearch-periodic-platform-support #10263 / almalinux-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/4xjckkzr7ntom)
- [elasticsearch-periodic-platform-support #10263 / rocky-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/oldge7b5736u6)
- [elasticsearch-periodic-platform-support #10263 / almalinux-8-aarch64_checkpart2_platform-support-arm](https://gradle-enterprise.elastic.co/s/slc6z53tbir3c)
- [elasticsearch-pull-request #87837 / part-2-fips](https://gradle-enterprise.elastic.co/s/win5uqqbg4svi)
- [elasticsearch-pull-request #87818 / part-2](https://gradle-enterprise.elastic.co/s/jcnxog5juocsg)
- [elasticsearch-pull-request #87103 / part-2](https://gradle-enterprise.elastic.co/s/sjarb3faitjig)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT.testTermsQuery"" -Dtests.seed=28F463B1DFD6152 -Dtests.jvm.argline=""-Des.concurrent_search=true"" -Dtests.locale=ro-MD -Dtests.timezone=Australia/LHI -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testTermsQuery'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [0]. Source documents don't match for field [á’¼á‚]: Error [Values of type [float] don't match after normalization, normalized actual: [0.3456565, 0.46642596, 0.8510592, 0.6669057], expected: [0.3456565, 0.46642596, 0.8510592, 0.6669057]] actual mappings [{""_doc"":{""dynamic"":""true"",""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""à±‹à°§à°Ÿà°¼à±¼à°¯à±µ"":{""doc_values"":false,""ignore_malformed"":false,""index"":false,""store"":true,""synthetic_source_keep"":""all"",""type"":""ip""},""á’¼á‚"":{""doc_values"":true,""ignore_malformed"":false,""index"":false,""null_value"":0.3456565,""store"":false,""synthetic_source_keep"":""none"",""type"":""float""},""á³‘á³›á³±"":{""type"":""match_only_text""},""âª"":{""doc_values"":false,""ignore_malformed"":true,""index"":true,""store"":false,""type"":""boolean""},""âŸ™âŸ‚âŸªâŸŸâŸ‰âŸ–"":{""doc_values"":false,""index"":false,""store"":true,""synthetic_source_keep"":""none"",""type"":""unsigned_long""},""âŸ»"":{""doc_values"":true,""ignore_malform
[truncated]
```

**Issue Reasons:**
- [main] 7 failures in test testTermsQuery (0.8% fail rate in 828 executions)
- [main] 2 failures in step part-2 (0.6% fail rate in 334 executions)
- [main] 3 failures in pipeline elasticsearch-pull-request (0.9% fail rate in 329 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Mapping', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/133518,2025-08-26T05:29:33Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/133518,"{
  ""application_resource"": ""yes""
}"
11,133517,[CI] StandardVersusStandardReindexedIntoLogsDbChallengeRestIT testTermsQuery failing,"**Build Scans:**
- [elasticsearch-periodic #10268 / concurrent-search-tests](https://gradle-enterprise.elastic.co/s/q5yrn5mhfc6r2)
- [elasticsearch-periodic-platform-support #10263 / almalinux-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/4xjckkzr7ntom)
- [elasticsearch-periodic-platform-support #10263 / rocky-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/oldge7b5736u6)
- [elasticsearch-periodic-platform-support #10263 / almalinux-8-aarch64_checkpart2_platform-support-arm](https://gradle-enterprise.elastic.co/s/slc6z53tbir3c)
- [elasticsearch-pull-request #87837 / part-2-fips](https://gradle-enterprise.elastic.co/s/win5uqqbg4svi)
- [elasticsearch-pull-request #87818 / part-2](https://gradle-enterprise.elastic.co/s/jcnxog5juocsg)
- [elasticsearch-pull-request #87103 / part-2](https://gradle-enterprise.elastic.co/s/sjarb3faitjig)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StandardVersusStandardReindexedIntoLogsDbChallengeRestIT.testTermsQuery"" -Dtests.seed=28F463B1DFD6152 -Dtests.jvm.argline=""-Des.concurrent_search=true"" -Dtests.locale=csw-CA -Dtests.timezone=Canada/Mountain -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StandardVersusStandardReindexedIntoLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testTermsQuery'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [0]. Source documents don't match for field [á’¼á‚]: Error [Values of type [float] don't match after normalization, normalized actual: [0.3456565, 0.46642596, 0.8510592, 0.6669057], expected: [0.3456565, 0.46642596, 0.8510592, 0.6669057]] actual mappings [{""_doc"":{""dynamic"":""true"",""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""à±‹à°§à°Ÿà°¼à±¼à°¯à±µ"":{""doc_values"":false,""ignore_malformed"":false,""index"":false,""store"":true,""synthetic_source_keep"":""all"",""type"":""ip""},""á’¼á‚"":{""doc_values"":true,""ignore_malformed"":false,""index"":false,""null_value"":0.3456565,""store"":false,""synthetic_source_keep"":""none"",""type"":""float""},""á³‘á³›á³±"":{""type"":""match_only_text""},""âª"":{""doc_values"":false,""ignore_malformed"":true,""index"":true,""store"":false,""type"":""boolean""},""âŸ™âŸ‚âŸªâŸŸâŸ‰âŸ–"":{""doc_values"":false,""index"":false,""store"":true,""synthetic_source_keep"":""none"",""type"":""unsigned_long""},""âŸ»"":{""doc_values"":true,""ignore_malform
[truncated]
```

**Issue Reasons:**
- [main] 7 failures in test testTermsQuery (0.8% fail rate in 827 executions)
- [main] 2 failures in step part-2 (0.6% fail rate in 334 executions)
- [main] 3 failures in pipeline elasticsearch-pull-request (0.9% fail rate in 329 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Mapping', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/133517,2025-08-26T05:29:27Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/133517,"{
  ""application_resource"": ""unsure""
}"
12,133516,[CI] BulkChallengeRestIT testTermsQuery failing,"**Build Scans:**
- [elasticsearch-periodic #10268 / concurrent-search-tests](https://gradle-enterprise.elastic.co/s/q5yrn5mhfc6r2)
- [elasticsearch-periodic-platform-support #10263 / almalinux-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/4xjckkzr7ntom)
- [elasticsearch-periodic-platform-support #10263 / rocky-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/oldge7b5736u6)
- [elasticsearch-periodic-platform-support #10263 / almalinux-8-aarch64_checkpart2_platform-support-arm](https://gradle-enterprise.elastic.co/s/slc6z53tbir3c)
- [elasticsearch-pull-request #87837 / part-2-fips](https://gradle-enterprise.elastic.co/s/win5uqqbg4svi)
- [elasticsearch-pull-request #87818 / part-2](https://gradle-enterprise.elastic.co/s/jcnxog5juocsg)
- [elasticsearch-pull-request #87103 / part-2](https://gradle-enterprise.elastic.co/s/sjarb3faitjig)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.BulkChallengeRestIT.testTermsQuery"" -Dtests.seed=28F463B1DFD6152 -Dtests.jvm.argline=""-Des.concurrent_search=true"" -Dtests.locale=ksh-Latn-DE -Dtests.timezone=Asia/Jayapura -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.BulkChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testTermsQuery'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [0]. Source documents don't match for field [á’¼á‚]: Error [Values of type [float] don't match after normalization, normalized actual: [0.3456565, 0.46642596, 0.8510592, 0.6669057], expected: [0.3456565, 0.46642596, 0.8510592, 0.6669057]] actual mappings [{""_doc"":{""dynamic"":""true"",""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""à±‹à°§à°Ÿà°¼à±¼à°¯à±µ"":{""doc_values"":false,""ignore_malformed"":false,""index"":false,""store"":true,""synthetic_source_keep"":""all"",""type"":""ip""},""á’¼á‚"":{""doc_values"":true,""ignore_malformed"":false,""index"":false,""null_value"":0.3456565,""store"":false,""synthetic_source_keep"":""none"",""type"":""float""},""á³‘á³›á³±"":{""type"":""match_only_text""},""âª"":{""doc_values"":false,""ignore_malformed"":true,""index"":true,""store"":false,""type"":""boolean""},""âŸ™âŸ‚âŸªâŸŸâŸ‰âŸ–"":{""doc_values"":false,""index"":false,""store"":true,""synthetic_source_keep"":""none"",""type"":""unsigned_long""},""âŸ»"":{""doc_values"":true,""ignore_malform
[truncated]
```

**Issue Reasons:**
- [main] 7 failures in test testTermsQuery (0.8% fail rate in 826 executions)
- [main] 2 failures in step part-2 (0.6% fail rate in 334 executions)
- [main] 3 failures in pipeline elasticsearch-pull-request (0.9% fail rate in 329 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Logs', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/133516,2025-08-26T05:29:19Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/133516,"{
  ""application_resource"": ""unsure""
}"
13,133499,[CI] StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT testMatchAllQuery failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #10256 / oraclelinux-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/e4kogwaqif2x4)
- [elasticsearch-pull-request #87862 / part-2](https://gradle-enterprise.elastic.co/s/fhvd52pa2golq)
- [elasticsearch-pull-request #87857 / part-2](https://gradle-enterprise.elastic.co/s/c5b5hacobvmwi)
- [elasticsearch-periodic-platform-support #10256 / ubuntu-2404-aarch64_checkpart2_platform-support-arm](https://gradle-enterprise.elastic.co/s/gugfdt3quv23q)
- [elasticsearch-pull-request #87846 / part-2](https://gradle-enterprise.elastic.co/s/rfki5n4azlblu)
- [elasticsearch-pull-request #87816 / checkpart2_release-tests](https://gradle-enterprise.elastic.co/s/ayok3ynxc2vjk)
- [elasticsearch-pull-request #87806 / part-2](https://gradle-enterprise.elastic.co/s/h7ilz3vz73yn4)
- [elasticsearch-pull-request #87103 / part-2](https://gradle-enterprise.elastic.co/s/sjarb3faitjig)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT.testMatchAllQuery"" -Dtests.seed=2EF4CA0FAF4E2645 -Dtests.locale=vi -Dtests.timezone=Antarctica/South_Pole -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testMatchAllQuery'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [13]. Source documents don't match for field [ï¸¨ï¸¯ï¸¦.ã„’ã„£ã„¢ã„©ã„§ã„—.ê—¼ê•¤ê”–ê”½ê–€ê•Ÿê˜Ÿê˜©]: Error [Values of type [short] don't match after normalization, normalized actual: [-8543], expected: [-8543]] actual mappings [{""_doc"":{""synthetic_source_keep"":""arrays"",""dynamic"":""runtime"",""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""ÞšÞ¢Þ‘Þ„ÞºÞ†ÞšÞ…ÞÞ™"":{""doc_values"":true,""index"":false,""store"":true,""synthetic_source_keep"":""arrays"",""type"":""long""},""à½ºà¾¿à¿ˆ"":{""doc_values"":false,""index"":false,""store"":false,""type"":""byte""},""á‹áŒ£áŒ²áˆŸ"":{""dynamic"":""true"",""enabled"":""true"",""properties"":{""×´Öž×ž"":{""doc_values"":false,""format"":""yyyy_MM_dd_HH_mm_ss_n"",""ignore_malformed"":false,""index"":false,""store"":true,""type"":""date""},""à®à¯¯"":{""properties"":{""á·”"":{""doc_values"":true,""ignore_malformed"":true,""index"":false,""store"":false,""type"":""float""},""ã„žã„ã„ƒ"":{""doc_values"":true,""ignore_malformed"":true,""index"":false,""store"":true,""synthetic_source_ke
[truncated]
```

**Issue Reasons:**
- [main] 8 failures in test testMatchAllQuery (1.0% fail rate in 764 executions)
- [main] 5 failures in step part-2 (1.6% fail rate in 313 executions)
- [main] 6 failures in pipeline elasticsearch-pull-request (1.9% fail rate in 308 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Mapping', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/133499,2025-08-25T21:34:56Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/133499,"{
  ""application_resource"": ""unsure""
}"
14,133498,[CI] StandardVersusStandardReindexedIntoLogsDbChallengeRestIT testMatchAllQuery failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #10256 / oraclelinux-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/e4kogwaqif2x4)
- [elasticsearch-pull-request #87862 / part-2](https://gradle-enterprise.elastic.co/s/fhvd52pa2golq)
- [elasticsearch-pull-request #87857 / part-2](https://gradle-enterprise.elastic.co/s/c5b5hacobvmwi)
- [elasticsearch-periodic-platform-support #10256 / ubuntu-2404-aarch64_checkpart2_platform-support-arm](https://gradle-enterprise.elastic.co/s/gugfdt3quv23q)
- [elasticsearch-pull-request #87846 / part-2](https://gradle-enterprise.elastic.co/s/rfki5n4azlblu)
- [elasticsearch-pull-request #87816 / checkpart2_release-tests](https://gradle-enterprise.elastic.co/s/ayok3ynxc2vjk)
- [elasticsearch-pull-request #87806 / part-2](https://gradle-enterprise.elastic.co/s/h7ilz3vz73yn4)
- [elasticsearch-pull-request #87103 / part-2](https://gradle-enterprise.elastic.co/s/sjarb3faitjig)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StandardVersusStandardReindexedIntoLogsDbChallengeRestIT.testMatchAllQuery"" -Dtests.seed=2EF4CA0FAF4E2645 -Dtests.locale=bal-Latn -Dtests.timezone=America/Punta_Arenas -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StandardVersusStandardReindexedIntoLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testMatchAllQuery'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [13]. Source documents don't match for field [ï¸¨ï¸¯ï¸¦.ã„’ã„£ã„¢ã„©ã„§ã„—.ê—¼ê•¤ê”–ê”½ê–€ê•Ÿê˜Ÿê˜©]: Error [Values of type [short] don't match after normalization, normalized actual: [-8543], expected: [-8543]] actual mappings [{""_doc"":{""synthetic_source_keep"":""arrays"",""dynamic"":""runtime"",""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""ÞšÞ¢Þ‘Þ„ÞºÞ†ÞšÞ…ÞÞ™"":{""doc_values"":true,""index"":false,""store"":true,""synthetic_source_keep"":""arrays"",""type"":""long""},""à½ºà¾¿à¿ˆ"":{""doc_values"":false,""index"":false,""store"":false,""type"":""byte""},""á‹áŒ£áŒ²áˆŸ"":{""dynamic"":""true"",""enabled"":""true"",""properties"":{""×´Öž×ž"":{""doc_values"":false,""format"":""yyyy_MM_dd_HH_mm_ss_n"",""ignore_malformed"":false,""index"":false,""store"":true,""type"":""date""},""à®à¯¯"":{""properties"":{""á·”"":{""doc_values"":true,""ignore_malformed"":true,""index"":false,""store"":false,""type"":""float""},""ã„žã„ã„ƒ"":{""doc_values"":true,""ignore_malformed"":true,""index"":false,""store"":true,""synthetic_source_ke
[truncated]
```

**Issue Reasons:**
- [main] 8 failures in test testMatchAllQuery (1.0% fail rate in 764 executions)
- [main] 5 failures in step part-2 (1.6% fail rate in 313 executions)
- [main] 6 failures in pipeline elasticsearch-pull-request (1.9% fail rate in 308 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Mapping', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/133498,2025-08-25T21:34:49Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/133498,"{
  ""application_resource"": ""unsure""
}"
15,133497,[CI] BulkChallengeRestIT testMatchAllQuery failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #10256 / oraclelinux-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/e4kogwaqif2x4)
- [elasticsearch-pull-request #87862 / part-2](https://gradle-enterprise.elastic.co/s/fhvd52pa2golq)
- [elasticsearch-pull-request #87857 / part-2](https://gradle-enterprise.elastic.co/s/c5b5hacobvmwi)
- [elasticsearch-periodic-platform-support #10256 / ubuntu-2404-aarch64_checkpart2_platform-support-arm](https://gradle-enterprise.elastic.co/s/gugfdt3quv23q)
- [elasticsearch-pull-request #87846 / part-2](https://gradle-enterprise.elastic.co/s/rfki5n4azlblu)
- [elasticsearch-pull-request #87816 / checkpart2_release-tests](https://gradle-enterprise.elastic.co/s/ayok3ynxc2vjk)
- [elasticsearch-pull-request #87806 / part-2](https://gradle-enterprise.elastic.co/s/h7ilz3vz73yn4)
- [elasticsearch-pull-request #87103 / part-2](https://gradle-enterprise.elastic.co/s/sjarb3faitjig)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.BulkChallengeRestIT.testMatchAllQuery"" -Dtests.seed=2EF4CA0FAF4E2645 -Dtests.locale=rwk -Dtests.timezone=Asia/Saigon -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.BulkChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testMatchAllQuery'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [13]. Source documents don't match for field [ï¸¨ï¸¯ï¸¦.ã„’ã„£ã„¢ã„©ã„§ã„—.ê—¼ê•¤ê”–ê”½ê–€ê•Ÿê˜Ÿê˜©]: Error [Values of type [short] don't match after normalization, normalized actual: [-8543], expected: [-8543]] actual mappings [{""_doc"":{""synthetic_source_keep"":""arrays"",""dynamic"":""runtime"",""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""ÞšÞ¢Þ‘Þ„ÞºÞ†ÞšÞ…ÞÞ™"":{""doc_values"":true,""index"":false,""store"":true,""synthetic_source_keep"":""arrays"",""type"":""long""},""à½ºà¾¿à¿ˆ"":{""doc_values"":false,""index"":false,""store"":false,""type"":""byte""},""á‹áŒ£áŒ²áˆŸ"":{""dynamic"":""true"",""enabled"":""true"",""properties"":{""×´Öž×ž"":{""doc_values"":false,""format"":""yyyy_MM_dd_HH_mm_ss_n"",""ignore_malformed"":false,""index"":false,""store"":true,""type"":""date""},""à®à¯¯"":{""properties"":{""á·”"":{""doc_values"":true,""ignore_malformed"":true,""index"":false,""store"":false,""type"":""float""},""ã„žã„ã„ƒ"":{""doc_values"":true,""ignore_malformed"":true,""index"":false,""store"":true,""synthetic_source_ke
[truncated]
```

**Issue Reasons:**
- [main] 8 failures in test testMatchAllQuery (1.0% fail rate in 764 executions)
- [main] 5 failures in step part-2 (1.6% fail rate in 313 executions)
- [main] 6 failures in pipeline elasticsearch-pull-request (1.9% fail rate in 308 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Logs', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/133497,2025-08-25T21:34:43Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/133497,"{
  ""application_resource"": ""unsure""
}"
16,133409,[CI] RcsCcsCommonYamlTestSuiteIT and CcsCommonYamlTestSuiteIT often time out in encryption-at-rest builds,"Since [re-enabling CcsCommonYamlTestSuiteIT](https://github.com/elastic/elasticsearch/pull/132726) there have been a huge number of CI test failures [mostly due to suite timeouts in encryption-at-rest builds](https://es-delivery-stats.elastic.dev/app/r/s/m3OzF).
I'm opening this issue to be able to group related issues that otherwise get opened for individual Yaml tests but are symptoms of the same thing. We should close those cases as duplicates and summarize findings here and agree on a solution here as long as the timeout situation is so dominant. ",cbuescher,closed,"['>test-failure', 'medium-risk', 'Team:Search Foundations', ':Search Foundations/CCS']",https://github.com/elastic/elasticsearch/issues/133409,2025-08-22T18:54:07Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/133409,"{
  ""application_resource"": ""unsure""
}"
17,133077,[CI] GenerativeIT test failing,"**Build Scans:**
- [elasticsearch-intake #27626 / part3](https://gradle-enterprise.elastic.co/s/v73vavwnpzbwm)
- [elasticsearch-pull-request #88422 / part-3](https://gradle-enterprise.elastic.co/s/sncplr7bcdge4)
- [elasticsearch-pull-request #88239 / part-3](https://gradle-enterprise.elastic.co/s/5antjm2ma2yeq)
- [elasticsearch-pull-request #87895 / part-3](https://gradle-enterprise.elastic.co/s/oe7zweexcelqc)
- [elasticsearch-pull-request #87765 / part-3](https://gradle-enterprise.elastic.co/s/pd72buzobsycy)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:esql:qa:server:single-node:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.qa.single_node.GenerativeIT.test"" -Dtests.seed=F4AEF41515696E24 -Dtests.locale=gd-GB -Dtests.timezone=Europe/Bratislava -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.qa.single_node.GenerativeIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('test'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: query: from *,host*,k8s| rename language.id as language_code | lookup join languages_lookup on language_code | grok status ""%{WORD:ksItIZdA} %{WORD:language.name}"" | grok city.country.continent.name ""%{WORD:tTlzdvgLmZP} %{WORD:source.IP}""| rename network.eth0.currently_connected_clients as id_int | lookup join multi_column_joinable_lookup on id_int | FORK  (where  NOT true AND false | mv_expand salary_change.keyword) (where  NOT false OR languages.short != 50) (where  NOT false AND  NOT height.scaled_float >= 50) (where true AND false) (where  NOT false) (where false AND  NOT language_code_byte != 50) (where  NOT false) (where  NOT language_code_short >= 50 AND false) | WHERE _fork == ""fork5"" | DROP _fork | dissect host.version ""%{EJrqUTYs} %{tWDObRtGnOs}"" | limit 7810
exception: Connection is closed
```

**Issue Reasons:**
- [main] 5 failures in test test (0.7% fail rate in 749 executions)
- [main] 4 failures in step part-3 (1.1% fail rate in 375 executions)
- [main] 4 failures in pipeline elasticsearch-pull-request (1.1% fail rate in 372 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:Search Relevance', ':Search Relevance/ES|QL']",https://github.com/elastic/elasticsearch/issues/133077,2025-08-18T15:27:48Z,11,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/133077,"{
  ""application_resource"": ""unsure""
}"
18,132707,Elasticsearch cluster turns red and nodes drop when accessing 1200+ ILM policies via Kibana,"I'm encountering a critical issue with my Elasticsearch cluster. Here's the scenario:
I've created over 1200 Index Lifecycle Management (ILM) policies in my Elasticsearch cluster. Recently, when I try to open the ILM policy list in Kibana (by navigating to the Lifecycle Policies section), the cluster immediately starts behaving abnormallyâ€”nodes begin dropping off, and the cluster health status quickly turns red.
This problem is reproducible: every time I access the policy list in Kibana, the cluster destabilizes. Without opening this list, the cluster runs normally.
Has anyone experienced a similar issue? Could this be related to the large number of ILM policies? What might be causing the cluster to drop nodes and turn red when loading the policy list, and how can I resolve it?
Additional context (if applicable):
Elasticsearch version: [7.16.0]
Kibana version: [7.16.0]
Cluster size: [6]",zhang18668,closed,['needs:triage'],https://github.com/elastic/elasticsearch/issues/132707,2025-08-12T08:04:51Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/132707,"{
  ""application_resource"": ""yes""
}"
19,132602,[CI] StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT testEsqlSource failing,"**Build Scans:**
- [elasticsearch-periodic #10261 / release-tests](https://gradle-enterprise.elastic.co/s/5osyhqqnznxry)
- [elasticsearch-periodic #10261 / openjdk21_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/ocept6hrnqo2k)
- [elasticsearch-periodic #10261 / openjdk24_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/jvifsavbmxbei)
- [elasticsearch-pull-request #87837 / part-2-fips](https://gradle-enterprise.elastic.co/s/win5uqqbg4svi)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT.testEsqlSource"" -Dtests.seed=CEC31CA65764F57F -Dbuild.snapshot=false -Dtests.jvm.argline=""-Dbuild.snapshot=false"" -Dlicense.key=x-pack/license-tools/src/test/resources/public.key -Dtests.locale=so-Latn-SO -Dtests.timezone=Africa/Monrovia -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testEsqlSource'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [20]. Source documents don't match for field [â¿ºâ¿»â¿°â¿¾â¿¶.ê£¡ê£°ê£µê£¢ê£¼ê£¢ê£¶ê£®ê£¼ê£¢]: Error [Values of type [byte] don't match after normalization, normalized actual: [115, -103, 28, -78], expected: [115, -103, 28, -78]] actual mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""ßªß·ß³ß¦ß§ß·"":{""doc_values"":false,""index"":true,""type"":""shape""},""á®µá®¬á®“á®œá®±á®á®®á®°á®´"":{""doc_values"":false,""ignore_malformed"":true,""index"":true,""store"":true,""type"":""ip""},""â‡®â†¾â†µâ‡¢â‡˜â‡£â†“â‡ºâ‡Ž"":{""doc_values"":true,""index"":false,""null_value"":""175.106.2.159"",""store"":true,""type"":""ip""},""â´‰â´Ž"":{""doc_values"":false,""index"":true,""store"":true,""synthetic_source_keep"":""arrays"",""type"":""geo_point""},""â¿ºâ¿»â¿°â¿¾â¿¶"":{""properties"":{""Ý»Ý½Ý¿Ýœ"":{""doc_values"":true,""ignore_malformed"":false,""index"":true,""store"":true,""synthetic_source_keep"":""arrays"",""type"":""ip""},""à²Šà³Žà²¿à³à²‰à³ƒà²˜à³¦à³¶à²•"":{""doc_values"":true,""ignore_malformed"":false,""index"":false,""null_value"":11,""store"":tr
[truncated]
```

**Issue Reasons:**
- [main] 4 failures in test testEsqlSource (9.3% fail rate in 43 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Mapping']",https://github.com/elastic/elasticsearch/issues/132602,2025-08-08T19:03:30Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/132602,"{
  ""application_resource"": ""unsure""
}"
20,132601,[CI] StandardVersusStandardReindexedIntoLogsDbChallengeRestIT testEsqlSource failing,"**Build Scans:**
- [elasticsearch-periodic #10261 / release-tests](https://gradle-enterprise.elastic.co/s/5osyhqqnznxry)
- [elasticsearch-periodic #10261 / openjdk21_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/ocept6hrnqo2k)
- [elasticsearch-periodic #10261 / openjdk24_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/jvifsavbmxbei)
- [elasticsearch-pull-request #87837 / part-2-fips](https://gradle-enterprise.elastic.co/s/win5uqqbg4svi)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StandardVersusStandardReindexedIntoLogsDbChallengeRestIT.testEsqlSource"" -Dtests.seed=CEC31CA65764F57F -Dbuild.snapshot=false -Dtests.jvm.argline=""-Dbuild.snapshot=false"" -Dlicense.key=x-pack/license-tools/src/test/resources/public.key -Dtests.locale=ln -Dtests.timezone=Australia/Canberra -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StandardVersusStandardReindexedIntoLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testEsqlSource'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [20]. Source documents don't match for field [â¿ºâ¿»â¿°â¿¾â¿¶.ê£¡ê£°ê£µê£¢ê£¼ê£¢ê£¶ê£®ê£¼ê£¢]: Error [Values of type [byte] don't match after normalization, normalized actual: [115, -103, 28, -78], expected: [115, -103, 28, -78]] actual mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""ßªß·ß³ß¦ß§ß·"":{""doc_values"":false,""index"":true,""type"":""shape""},""á®µá®¬á®“á®œá®±á®á®®á®°á®´"":{""doc_values"":false,""ignore_malformed"":true,""index"":true,""store"":true,""type"":""ip""},""â‡®â†¾â†µâ‡¢â‡˜â‡£â†“â‡ºâ‡Ž"":{""doc_values"":true,""index"":false,""null_value"":""175.106.2.159"",""store"":true,""type"":""ip""},""â´‰â´Ž"":{""doc_values"":false,""index"":true,""store"":true,""synthetic_source_keep"":""arrays"",""type"":""geo_point""},""â¿ºâ¿»â¿°â¿¾â¿¶"":{""properties"":{""Ý»Ý½Ý¿Ýœ"":{""doc_values"":true,""ignore_malformed"":false,""index"":true,""store"":true,""synthetic_source_keep"":""arrays"",""type"":""ip""},""à²Šà³Žà²¿à³à²‰à³ƒà²˜à³¦à³¶à²•"":{""doc_values"":true,""ignore_malformed"":false,""index"":false,""null_value"":11,""store"":tr
[truncated]
```

**Issue Reasons:**
- [main] 4 failures in test testEsqlSource (9.8% fail rate in 41 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Mapping']",https://github.com/elastic/elasticsearch/issues/132601,2025-08-08T19:03:22Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/132601,"{
  ""application_resource"": ""unsure""
}"
21,132600,[CI] BulkChallengeRestIT testEsqlSource failing,"**Build Scans:**
- [elasticsearch-periodic #10261 / release-tests](https://gradle-enterprise.elastic.co/s/5osyhqqnznxry)
- [elasticsearch-periodic #10261 / openjdk21_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/ocept6hrnqo2k)
- [elasticsearch-periodic #10261 / openjdk24_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/jvifsavbmxbei)
- [elasticsearch-pull-request #87837 / part-2-fips](https://gradle-enterprise.elastic.co/s/win5uqqbg4svi)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.BulkChallengeRestIT.testEsqlSource"" -Dtests.seed=CEC31CA65764F57F -Dbuild.snapshot=false -Dtests.jvm.argline=""-Dbuild.snapshot=false"" -Dlicense.key=x-pack/license-tools/src/test/resources/public.key -Dtests.locale=fr-RE -Dtests.timezone=Asia/Yerevan -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.BulkChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testEsqlSource'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [20]. Source documents don't match for field [â¿ºâ¿»â¿°â¿¾â¿¶.ê£¡ê£°ê£µê£¢ê£¼ê£¢ê£¶ê£®ê£¼ê£¢]: Error [Values of type [byte] don't match after normalization, normalized actual: [115, -103, 28, -78], expected: [115, -103, 28, -78]] actual mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""},""ßªß·ß³ß¦ß§ß·"":{""doc_values"":false,""index"":true,""type"":""shape""},""á®µá®¬á®“á®œá®±á®á®®á®°á®´"":{""doc_values"":false,""ignore_malformed"":true,""index"":true,""store"":true,""type"":""ip""},""â‡®â†¾â†µâ‡¢â‡˜â‡£â†“â‡ºâ‡Ž"":{""doc_values"":true,""index"":false,""null_value"":""175.106.2.159"",""store"":true,""type"":""ip""},""â´‰â´Ž"":{""doc_values"":false,""index"":true,""store"":true,""synthetic_source_keep"":""arrays"",""type"":""geo_point""},""â¿ºâ¿»â¿°â¿¾â¿¶"":{""properties"":{""Ý»Ý½Ý¿Ýœ"":{""doc_values"":true,""ignore_malformed"":false,""index"":true,""store"":true,""synthetic_source_keep"":""arrays"",""type"":""ip""},""à²Šà³Žà²¿à³à²‰à³ƒà²˜à³¦à³¶à²•"":{""doc_values"":true,""ignore_malformed"":false,""index"":false,""null_value"":11,""store"":tr
[truncated]
```

**Issue Reasons:**
- [main] 4 failures in test testEsqlSource (9.5% fail rate in 42 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/132600,2025-08-08T19:03:13Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/132600,"{
  ""application_resource"": ""unsure""
}"
22,132378,[CI] LogsDbVersusReindexedIntoStoredSourceChallengeRestIT testRandomQueries failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #9794 / windows-2025_checkpart2_platform-support-windows](https://gradle-enterprise.elastic.co/s/axv57xr4xogc4)
- [elasticsearch-pull-request #83903 / part-2](https://gradle-enterprise.elastic.co/s/txz3lu2lmszu6)
- [elasticsearch-pull-request #83407 / part-2](https://gradle-enterprise.elastic.co/s/voqe3sig34k2o)

**Reproduction Line:**
```
gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.LogsDbVersusReindexedIntoStoredSourceChallengeRestIT.testRandomQueries"" -Dtests.seed=F09A8887B055EA43 -Dtests.locale=en-TV -Dtests.timezone=Etc/GMT-3 -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.LogsDbVersusReindexedIntoStoredSourceChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testRandomQueries'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Error [Number of documents does not match, actual: [{@timestamp=2024-01-01T10:00:14.000Z, host={name=bFTks}, memory_usage_bytes=1887, method=put, ÄƒÅ¾Ä¨Ä£Ä±ÅŒÅ„Ä©=true, à¹“=2449111642323651955, á§¾á§¦á§µá§µá§¯á§£á§§á§¿=-51324813, á¹ªá»ƒá¹˜á¹áºˆá»‹={Ã¾Ã ÃµÂ·ÃºÃ=áš¸á›á›áš¦á›‚áš½áš¨á›„áš§á›—áš»áš¿á›‰áš©á›ˆá›–áš¡á›–á›¼á›µ, Í†Ì½Í…=[-21512, 1747, 28139, -30975], Ò‰Ñ­=[-4532914055602121960, null, -222276775446353506, -8803397823611586537, -5717785569212210562], Þ¸Þ„Þ¬Þ¥Þ†ÞŸÞ»Þ’Þ˜Þš=[0.33748758, 0.6027099, 0.13886914, 0.17027202], à ¡à ­à °à à µà “à ¸à ¨à ‚=[], à§¤à¦žà§™à¦·à¦Žà¦Žà§¦à¦µà§¤={á’=0.9669328403456894, á©ˆá©ºá¨¯á©”áªžáª‹áªŽá©šá¨¥=204.196.34.33, á±±á±­á±˜á±’á±¨á±®á±¥=[0.5028538768684566, 0.5316068965517243, 0.728285498779574], â±±â±¦â±´â±°â±¼â±ªâ±¹â±¡â± â± =251.221.216.234, â´„â´Žâ´â´ˆâ´—â´‰â´¢=9205, â¶»â¶â·ƒ=-9550, ã‡²ã‡±ã‡¶ã‡¸ã‡¸ã‡±ã‡¹ã‡¾ã‡¾=bSlMM, ê ¹ê ³ê ¶=1e79:6078::4456:be70:0:0, ê«™êª¹êª…êª=[0.4106682256706765, 0.1906612560130998, 0.22417990151598133, 0.09410715646833978, 0.5402745828859048], ð‡•ð‡½ð‡¿ð‡´ð‡ð‡’ð‡­=7081357789898, ð¢ð‘‹=[], ð¬´ð¬‹ð¬‰ð¬¦=0.99452454, ðŸ‘ð©ð—¾ðœ¾ð”¹ð—=[-28995, 3594]}, à»œà»¬àº¬à»’à»àº€àºà»–àº­à»’=[-716969049, -1005751601, -874892265, -1558520387], á®á£á¿á¡=á®€á®¦á®¦á®‰á®á®˜á®¿á®á®Žá®ºá®Œá® á®Žá®‹á®á®’á®¯á®¼á®°á®©á®»á®‰á®¦á®á®‚á®á®›á®»á®”á®†á®¬á® 
[truncated]
```

**Issue Reasons:**
- [main] 3 failures in test testRandomQueries (0.9% fail rate in 335 executions)
- [main] 2 failures in step part-2 (1.7% fail rate in 120 executions)
- [main] 2 failures in pipeline elasticsearch-pull-request (1.7% fail rate in 120 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Mapping', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/132378,2025-08-03T22:09:01Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/132378,"{
  ""application_resource"": ""unsure""
}"
23,132377,[CI] LogsDbVersusLogsDbReindexedIntoStandardModeChallengeRestIT testRandomQueries failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #9794 / windows-2025_checkpart2_platform-support-windows](https://gradle-enterprise.elastic.co/s/axv57xr4xogc4)
- [elasticsearch-pull-request #83903 / part-2](https://gradle-enterprise.elastic.co/s/txz3lu2lmszu6)
- [elasticsearch-pull-request #83407 / part-2](https://gradle-enterprise.elastic.co/s/voqe3sig34k2o)

**Reproduction Line:**
```
gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.LogsDbVersusLogsDbReindexedIntoStandardModeChallengeRestIT.testRandomQueries"" -Dtests.seed=F09A8887B055EA43 -Dtests.locale=nl-SX -Dtests.timezone=Europe/Warsaw -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.LogsDbVersusLogsDbReindexedIntoStandardModeChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testRandomQueries'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Error [Number of documents does not match, actual: [{@timestamp=2024-01-01T10:00:14.000Z, host={name=bFTks}, memory_usage_bytes=1887, method=put, ÄƒÅ¾Ä¨Ä£Ä±ÅŒÅ„Ä©=true, à¹“=2449111642323651955, á§¾á§¦á§µá§µá§¯á§£á§§á§¿=-51324813, á¹ªá»ƒá¹˜á¹áºˆá»‹={Ã¾Ã ÃµÂ·ÃºÃ=áš¸á›á›áš¦á›‚áš½áš¨á›„áš§á›—áš»áš¿á›‰áš©á›ˆá›–áš¡á›–á›¼á›µ, Í†Ì½Í…=[-21512, 1747, 28139, -30975], Ò‰Ñ­=[-4532914055602121960, null, -222276775446353506, -8803397823611586537, -5717785569212210562], Þ¸Þ„Þ¬Þ¥Þ†ÞŸÞ»Þ’Þ˜Þš=[0.33748758, 0.6027099, 0.13886914, 0.17027202], à ¡à ­à °à à µà “à ¸à ¨à ‚=[], à§¤à¦žà§™à¦·à¦Žà¦Žà§¦à¦µà§¤={á’=0.9669328403456894, á©ˆá©ºá¨¯á©”áªžáª‹áªŽá©šá¨¥=204.196.34.33, á±±á±­á±˜á±’á±¨á±®á±¥=[0.5028538768684566, 0.5316068965517243, 0.728285498779574], â±±â±¦â±´â±°â±¼â±ªâ±¹â±¡â± â± =251.221.216.234, â´„â´Žâ´â´ˆâ´—â´‰â´¢=9205, â¶»â¶â·ƒ=-9550, ã‡²ã‡±ã‡¶ã‡¸ã‡¸ã‡±ã‡¹ã‡¾ã‡¾=bSlMM, ê ¹ê ³ê ¶=1e79:6078::4456:be70:0:0, ê«™êª¹êª…êª=[0.4106682256706765, 0.1906612560130998, 0.22417990151598133, 0.09410715646833978, 0.5402745828859048], ð‡•ð‡½ð‡¿ð‡´ð‡ð‡’ð‡­=7081357789898, ð¢ð‘‹=[], ð¬´ð¬‹ð¬‰ð¬¦=0.99452454, ðŸ‘ð©ð—¾ðœ¾ð”¹ð—=[-28995, 3594]}, à»œà»¬àº¬à»’à»àº€àºà»–àº­à»’=[-716969049, -1005751601, -874892265, -1558520387], á®á£á¿á¡=á®€á®¦á®¦á®‰á®á®˜á®¿á®á®Žá®ºá®Œá® á®Žá®‹á®á®’á®¯á®¼á®°á®©á®»á®‰á®¦á®á®‚á®á®›á®»á®”á®†á®¬á® 
[truncated]
```

**Issue Reasons:**
- [main] 3 failures in test testRandomQueries (0.9% fail rate in 335 executions)
- [main] 2 failures in step part-2 (1.7% fail rate in 120 executions)
- [main] 2 failures in pipeline elasticsearch-pull-request (1.7% fail rate in 120 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Logs', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/132377,2025-08-03T22:08:53Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/132377,"{
  ""application_resource"": ""unsure""
}"
24,132376,[CI] LogsDbVersusReindexedLogsDbChallengeRestIT testRandomQueries failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #9794 / windows-2025_checkpart2_platform-support-windows](https://gradle-enterprise.elastic.co/s/axv57xr4xogc4)
- [elasticsearch-pull-request #83903 / part-2](https://gradle-enterprise.elastic.co/s/txz3lu2lmszu6)
- [elasticsearch-pull-request #83407 / part-2](https://gradle-enterprise.elastic.co/s/voqe3sig34k2o)

**Reproduction Line:**
```
gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.LogsDbVersusReindexedLogsDbChallengeRestIT.testRandomQueries"" -Dtests.seed=F09A8887B055EA43 -Dtests.locale=th-Thai-TH -Dtests.timezone=America/Cayenne -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.LogsDbVersusReindexedLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testRandomQueries'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Error [Number of documents does not match, actual: [{@timestamp=2024-01-01T10:00:14.000Z, host={name=bFTks}, memory_usage_bytes=1887, method=put, ÄƒÅ¾Ä¨Ä£Ä±ÅŒÅ„Ä©=true, à¹“=2449111642323651955, á§¾á§¦á§µá§µá§¯á§£á§§á§¿=-51324813, á¹ªá»ƒá¹˜á¹áºˆá»‹={Ã¾Ã ÃµÂ·ÃºÃ=áš¸á›á›áš¦á›‚áš½áš¨á›„áš§á›—áš»áš¿á›‰áš©á›ˆá›–áš¡á›–á›¼á›µ, Í†Ì½Í…=[-21512, 1747, 28139, -30975], Ò‰Ñ­=[-4532914055602121960, null, -222276775446353506, -8803397823611586537, -5717785569212210562], Þ¸Þ„Þ¬Þ¥Þ†ÞŸÞ»Þ’Þ˜Þš=[0.33748758, 0.6027099, 0.13886914, 0.17027202], à ¡à ­à °à à µà “à ¸à ¨à ‚=[], à§¤à¦žà§™à¦·à¦Žà¦Žà§¦à¦µà§¤={á’=0.9669328403456894, á©ˆá©ºá¨¯á©”áªžáª‹áªŽá©šá¨¥=204.196.34.33, á±±á±­á±˜á±’á±¨á±®á±¥=[0.5028538768684566, 0.5316068965517243, 0.728285498779574], â±±â±¦â±´â±°â±¼â±ªâ±¹â±¡â± â± =251.221.216.234, â´„â´Žâ´â´ˆâ´—â´‰â´¢=9205, â¶»â¶â·ƒ=-9550, ã‡²ã‡±ã‡¶ã‡¸ã‡¸ã‡±ã‡¹ã‡¾ã‡¾=bSlMM, ê ¹ê ³ê ¶=1e79:6078::4456:be70:0:0, ê«™êª¹êª…êª=[0.4106682256706765, 0.1906612560130998, 0.22417990151598133, 0.09410715646833978, 0.5402745828859048], ð‡•ð‡½ð‡¿ð‡´ð‡ð‡’ð‡­=7081357789898, ð¢ð‘‹=[], ð¬´ð¬‹ð¬‰ð¬¦=0.99452454, ðŸ‘ð©ð—¾ðœ¾ð”¹ð—=[-28995, 3594]}, à»œà»¬àº¬à»’à»àº€àºà»–àº­à»’=[-716969049, -1005751601, -874892265, -1558520387], á®á£á¿á¡=á®€á®¦á®¦á®‰á®á®˜á®¿á®á®Žá®ºá®Œá® á®Žá®‹á®á®’á®¯á®¼á®°á®©á®»á®‰á®¦á®á®‚á®á®›á®»á®”á®†á®¬á® 
[truncated]
```

**Issue Reasons:**
- [main] 3 failures in test testRandomQueries (0.9% fail rate in 335 executions)
- [main] 2 failures in step part-2 (1.7% fail rate in 120 executions)
- [main] 2 failures in pipeline elasticsearch-pull-request (1.7% fail rate in 120 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Logs', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/132376,2025-08-03T22:08:44Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/132376,"{
  ""application_resource"": ""unsure""
}"
25,132040,Indices created with 7.13 cannot be opened with more recent versions when using index sorting on date_nanos,"Indices created with 7.13 cannot be opened with more recent versions of Elasticsearch, when using index sorting on a `date_nanos` field.

Start Elasticsearch 7.13.x - `./elasticsearch-7.13.0/bin/elasticsearch -E path.data=/tmp/data -E xpack.security.enabled=false`

```
PUT my-sorted-index
{
  ""settings"": {
    ""index"": {
      ""number_of_shards"": 1,
      ""number_of_replicas"": 0,
      ""sort.field"": ""@timestamp"",
      ""sort.order"": ""desc""
    }
  },
  ""mappings"": {
    ""properties"": {
      ""@timestamp"": {
        ""type"": ""date_nanos""
      },
      ""message"": {
        ""type"": ""text""
      }
    }
  }
}
```

```
POST my-sorted-index/_doc
{
  ""@timestamp"": ""2025-07-28T15:00:00Z"",
  ""message"": ""A simple timestamped log message 1.""
}
```

Start Elasticsearch 7.14.x - `./elasticsearch-7.14.0/bin/elasticsearch -E path.data=/tmp/data -E xpack.security.enabled=false`.     AND   elasticsearch-7.17.29


```
Caused by: java.lang.IllegalArgumentException: cannot change previous indexSort=<sortednumeric: ""@timestamp"">! missingValue=-9223372036854775808 selector=MAX type=LONG (from segment=_0(8.8.2):c1:[indexSort=<sortednumeric: ""@timestamp"">! missingValue=-9223372036854775808 selector=MAX type=LONG]:[diagnostics={java.vendor=AdoptOpenJDK, os=Mac OS X, java.version=16, java.vm.version=16+36, lucene.version=8.8.2, os.arch=x86_64, java.runtime.version=16+36, source=flush, os.version=10.16, timestamp=1753732390909}]:[attributes={Lucene87StoredFieldsFormat.mode=BEST_SPEED}] :id=cw83zw6yatfpx1z6ogelhi1zy) to new indexSort=<sortednumeric: ""@timestamp"">! missingValue=0 selector=MAX type=LONG
	at org.apache.lucene.index.IndexWriter.validateIndexSort(IndexWriter.java:1136) ~[lucene-core-8.9.0.jar:8.9.0 05c8a6f0163fe4c330e93775e8e91f3ab66a3f80 - mayyasharipova - 2021-06-10 17:50:37]
	at org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:1071) ~[lucene-core-8.9.0.jar:8.9.0 05c8a6f0163fe4c330e93775e8e91f3ab66a3f80 - mayyasharipova - 2021-06-10 17:50:37]
	at org.elasticsearch.index.engine.InternalEngine.createWriter(InternalEngine.java:2289) ~[elasticsearch-7.14.0.jar:7.14.0]
	at org.elasticsearch.index.engine.InternalEngine.createWriter(InternalEngine.java:2277) ~[elasticsearch-7.14.0.jar:7.14.0]
	at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:239) ~[elasticsearch-7.14.0.jar:7.14.0]
	at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:197) ~[elasticsearch-7.14.0.jar:7.14.0]
	at org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14) ~[elasticsearch-7.14.0.jar:7.14.0]
	at org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:1736) ~[elasticsearch-7.14.0.jar:7.14.0]
	at org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1702) ~[elasticsearch-7.14.0.jar:7.14.0]
	at org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:421) ~[elasticsearch-7.14.0.jar:7.14.0]
	at org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:87) ~[elasticsearch-7.14.0.jar:7.14.0]
	at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:434) ~[elasticsearch-7.14.0.jar:7.14.0]
	... 8 more
```


relates #74760",ChrisHegarty,closed,"['>bug', ':Search/Search', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/132040,2025-07-28T20:00:41Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/132040,"{
  ""application_resource"": ""yes""
}"
26,131855,Page Tables Memory Leak During S3 Snapshots,"### Elasticsearch Version

8.17.1

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux es-data-2 6.6.87+ #1 SMP PREEMPT_DYNAMIC Tue May 13 09:41:09 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux

### Problem Description

# Elasticsearch Page Tables Memory Leak During S3 Snapshots

### **Summary**
Elasticsearch pods are experiencing excessive page table memory usage (20+ GB) during GCS S3 snapshot operations, consuming 31.7% of total system memory and causing severe memory pressure on Kubernetes nodes. This happens when we use new repostories each week to cycle backups. After 90 days nodes are crashing with page table memory >25GB.

### **Environment**
- **Cluster**: Elasticsearch on Kubernetes
- **Node Memory**: 64 GB total (only one elastic pod per node , no other workloads)
- **Elasticsearch Version**: 8.17.1 (with the same issue on 8.18.4 and 9.0.4)
- **Kubernetes Version**: 1.23
- **Storage**: GCS S3-based snapshots

#### **Current State**
```
Total Memory: 64.3 GB
â”œâ”€â”€ Elasticsearch RSS: 33.7 GB (52.4%)
â”œâ”€â”€ Page Tables: 20.4 GB (31.7%) â† ISSUE
â”œâ”€â”€ Buffer/Cache: 8.8 GB (13.7%)
â””â”€â”€ Available: 1.9 GB (3.0%)
```

#### **Symptoms**
1. **Excessive virtual memory allocation**: 11.8 TB VIRT vs 33.7 GB RES
2. **Abnormal page table usage**: 20.4 GB (normal: <1 GB)

#### **Memory Breakdown**
# Kernel memory analysis shows:
PageTables: 20,378 MB (86% of kernel memory)
Slab: 1,617 MB (normal)
KernelStack: 12 MB (normal)
Other: <100 MB (normal)

#### **Virtual Memory Mapping Issue**
- Elasticsearch virtual memory: 11.8 TB
- Required page tables: ~20 GB for 3 billion pages
- **Correlation**: Issue occurs after multiple S3 snapshot operations done to separate repositories

#### **System Memory Stats**
```bash
top - 06:03:21 up 92 days, 16:22,  0 users,  load average: 2.38, 2.43, 2.08
%Cpu(s):  9.8 us,  1.6 sy,  0.0 ni, 82.0 id,  5.4 wa,  0.0 hi,  1.3 si,  0.0 st
MiB Mem :  64309.9 total,   1963.6 free,  53501.5 used,   8844.8 buff/cache

PID 95: java - VIRT: 11.8t, RES: 33.7g, SHR: 2.7g, %CPU: 82.1, %MEM: 53.6
```
Node memory in 30 days, showing 2 full backups taken, leading to node crash. 

<img width=""1652"" height=""655"" alt=""Image"" src=""https://github.com/user-attachments/assets/5468b7e4-b1b7-4604-857d-36745cb2fc23"" />

### Steps to Reproduce

### **Steps to Reproduce**
1. Start S3 snapshot operation on large indices
2. Monitor memory usage during snapshot process
3. Observe page table memory growth in `/proc/meminfo`
4. Page tables remain elevated after snapshot completion, removing repository do not clear page tables memory


### Logs (if relevant)

_No response_",lnowicki10,closed,"['>bug', ':Distributed Coordination/Snapshot/Restore', 'Team:Distributed Coordination']",https://github.com/elastic/elasticsearch/issues/131855,2025-07-24T15:52:51Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/131855,"{
  ""application_resource"": ""yes""
}"
27,131187,[CI] Several BWC rolling upgrade tests failing,"### CI Link

https://gradle-enterprise.elastic.co/s/iclmjvuyp355m/tests/overview?outcome=failed

### Repro line

multiple

### Does it reproduce?

Yes

### Applicable branches

9.1

### Failure history

_No response_

### Failure excerpt
```
[2025-07-13T08:33:19,518][INFO ][o.e.c.c.JoinHelper       ] [test-cluster-0] failed to join {test-cluster-1}{cfTkCj-gRRyD_6tZVtv8qw}{tRFwls1dTKOSP48GFAkWng}{test-cluster-1}{127.0.0.1}{127.0.0.1:37979}{cdfhilmrstw}{9.0.4}{8000099-9009000}{testattr=test, ml.allocated_processors_double=32.0, ml.machine_memory=126604173312, ml.config_version=12.0.0, ml.max_jvm_size=805306368, ml.allocated_processors=32, xpack.installed=true, transform.config_version=10.0.0} with JoinRequest{sourceNode={test-cluster-0}{gPc2FVADTC2tzLKbJ9QI-g}{-7RYpxT5QM2KYV-4n5e64Q}{test-cluster-0}{127.0.0.1}{127.0.0.1:35335}{cdfhilmrstw}{9.1.0}{8000099-9033000}{testattr=test, ml.allocated_processors_double=32.0, ml.machine_memory=126604173312, ml.config_version=12.0.0, ml.max_jvm_size=805306368, ml.allocated_processors=32, xpack.installed=true, transform.config_version=10.0.0}, compatibilityVersions=CompatibilityVersions[transportVersion=9112001, systemIndexMappingsVersion={.secrets-inference=MappingsVersion[version=1, hash=-1434574148], .triggered_watches=MappingsVersion[version=1, hash=-502826165], .fleet-agents-7=MappingsVersion[version=2, hash=830653585], .fleet-servers-7=MappingsVersion[version=1, hash=-916922632], .fleet-policies-leader-7=MappingsVersion[version=1, hash=-1108172796], .ml-config=MappingsVersion[version=1, hash=-319778629], .security-tokens-7=MappingsVersion[version=1, hash=576296021], .geoip_databases=MappingsVersion[version=1, hash=-305757839], .snapshot-blob-cache=MappingsVersion[version=1, hash=632712485], .security-profile-8=MappingsVersion[version=2, hash=-909540896], .search-app-1=MappingsVersion[version=1, hash=-501711141], .watches=MappingsVersion[version=1, hash=-1045118511], .fleet-artifacts-7=MappingsVersion[version=1, hash=-1593703898], .query-rules-2=MappingsVersion[version=2, hash=-1272560824], .transform-internal-007=MappingsVersion[version=1, hash=1144737897], .fleet-enrollment-api-keys-7=MappingsVersion[version=3, hash=1223574253], .fleet-actions-7=MappingsVersion[version=2, hash=-2624357], .tasks=MappingsVersion[version=0, hash=-945584329], .fleet-secrets-7=MappingsVersion[version=1, hash=-745394230], .ml-meta=MappingsVersion[version=2, hash=-613742866], .security-7=MappingsVersion[version=3, hash=-832976091], .connector-secrets-1=MappingsVersion[version=1, hash=-745394230], .logstash=MappingsVersion[version=1, hash=-1058806351], .ml-inference-000005=MappingsVersion[version=3, hash=919553140], .async-search=MappingsVersion[version=0, hash=-1403744380], .inference=MappingsVersion[version=2, hash=-1459421596], .fleet-policies-7=MappingsVersion[version=2, hash=-201702522], .synonyms-2=MappingsVersion[version=1, hash=-888080772]}], features=[mapper.nested.sorting_fields_check_fix, mapper.dense_vector.rescore_vector, mapper.tsdb_nested_field_support, index.synonyms_set_lenient_on_non_existing, semantic_text.highlighter, mapper.npe_on_dims_update_fix, query_rules.numeric_validation, sparse_vector.index_options_supported, text_similarity_reranker_minscore_fix, search.vectors.mappers.default_bbq_hnsw, text_similarity_reranker_alias_handling_fix, mapper.ivf_format_cluster_feature, mapper.logsdb_default_ignore_dynamic_beyond_limit, mapper.ivf_nested_support, logs_stream, mapper.source.mode_from_index_setting, search.completion_field.duplicate.support, inference.cohere.v2, pinned_retriever_supported, semantic_text.match_all_highlighter, simulate.ignored.fields, mapper.range.invalid_date_fix, retriever.negative_rank_window_size_fix, mapper.counted_keyword.synthetic_source_native_support, mapper.ignored_source.dont_expand_dots, test_reranking_service.parse_text_as_score, semantic_text.delete_fix, mapper.copy_to.dynamic_handling, mapper.synthetic_recovery_source, mapper.range.date_range_indexing_fix, semantic_text.support_chunking_config, semantic_text.bit_vector_support, mapper.patterned_text, semantic_text.inference_metadata_fields.enabled_by_default, mapper.subobjects_false_mapping_update_fix, search.semantic_sparse_vector_query_rewrite_interception_supported, test_rule_retriever.with_indices_that_dont_return_rank_docs, semantic_text.single_field_update_fix, synonyms_set.get.return_empty_synonym_sets, mapper.unknown_field_mapping_update_error_message, rank_vectors, mapper.ignored_source_as_top_level_metadata_array_field, mapper.dense_vector.default_oversample_value_for_bbq, rrf_retriever.multi_fields_query_format_support, multi_project, linear_retriever_minscore_fix, mapper.fix_parsing_subobjects_false_dynamic_false, data_stream.failure_store, mapper.dense_vector.rescore_zero_vector, linear_retriever.minmax_single_doc_fix, semantic_text.handle_empty_input, semantic_text.skip_inference_fields, routing.logsb_route_on_sort_fields, cluster.stats.source_modes, meta_fetch_fields_error_code_changed, data_stream.downsample.default_aggregate_metric_fix, mapper.doc_values_skipper, mapper.search_load_per_shard, esql.metrics_syntax, semantic_text.exclude_sub_fields_from_field_caps, mapper.ignored_source.always_store_object_arraâ€¦	
Caused by: java.lang.IllegalStateException: Node gPc2FVADTC2tzLKbJ9QI-g is missing required features [search.vectors.no_dimensions_bugfix]	
	at org.elasticsearch.cluster.coordination.NodeJoinExecutor.enforceNodeFeatureBarrier(NodeJoinExecutor.java:550)	
	at org.elasticsearch.cluster.coordination.NodeJoinExecutor.execute(NodeJoinExecutor.java:180)	
	at org.elasticsearch.cluster.service.MasterService.innerExecuteTasks(MasterService.java:1069)	
	at org.elasticsearch.cluster.service.MasterService.executeTasks(MasterService.java:1032)	
	at org.elasticsearch.cluster.service.MasterService.executeAndPublishBatch(MasterService.java:244)	
	at org.elasticsearch.cluster.service.MasterService$BatchingTaskQueue$Processor.lambda$run$2(MasterService.java:1685)	
	at org.elasticsearch.action.ActionListener.run(ActionListener.java:454)	
	at org.elasticsearch.cluster.service.MasterService$BatchingTaskQueue$Processor.run(MasterService.java:1682)	
	at org.elasticsearch.cluster.service.MasterService$5.lambda$doRun$0(MasterService.java:1277)	
	at org.elasticsearch.action.ActionListener.run(ActionListener.java:454)	
	at org.elasticsearch.cluster.service.MasterService$5.doRun(MasterService.java:1256)	
	at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:1044)	
	at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:27)	
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1095)	
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:619)	
	at java.lang.Thread.run(Thread.java:1447)
```",ldematte,closed,"['blocker', '>test-failure', ':Search Relevance/Vectors', 'Team:Search Relevance', 'v9.1.0', 'v9.1.1']",https://github.com/elastic/elasticsearch/issues/131187,2025-07-14T07:34:46Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/131187,"{
  ""application_resource"": ""yes""
}"
28,130788,[CI] EnrichIT testSumDurationByArtist failing,"**Build Scans:**
- [elasticsearch-intake #25170 / part3](https://gradle-enterprise.elastic.co/s/ofbl7l5eeiwym)
- [elasticsearch-periodic #9223 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/x4u3ylypgmy2o)
- [elasticsearch-periodic-platform-support #9234 / ubuntu-2404_platform-support-unix](https://gradle-enterprise.elastic.co/s/lvllwvszlnj6a)
- [elasticsearch-periodic #9223 / openjdk24_checkpart3_java-matrix](https://gradle-enterprise.elastic.co/s/k4chrkmrpliya)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:esql:internalClusterTest"" --tests ""org.elasticsearch.xpack.esql.action.EnrichIT.testForPushDownEnrichRule"" -Dtests.seed=FC9C12DEDB2B3119 -Dtests.locale=kk -Dtests.timezone=SystemV/YST9 -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.action.EnrichIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testSumDurationByArtist'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Request breaker not reset to 0 on node: node_s1
Expected: <0L>
     but: was <1773L>
```

**Issue Reasons:**
- [main] 4 failures in test testSumDurationByArtist (1.8% fail rate in 217 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/130788,2025-07-08T06:24:16Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/130788,"{
  ""application_resource"": ""yes""
}"
29,130339,[ML] Get Inference returns inaccurate Trained Models,"Create an inference endpoint:
```
curl -X PUT -u elastic:password -H ""Content-Type: application/json"" -d '{""service"":""elser"",""service_settings"":{""num_allocations"":1,""num_threads"":1}}' ""http://localhost:9200/_inference/sparse_embedding/my-elser-model""
```
shows:
```
{
  ""inference_id"": ""my-elser-model"",
  ""task_type"": ""sparse_embedding"",
  ""service"": ""elasticsearch"",
  ""service_settings"": {
    ""num_allocations"": 1,
    ""num_threads"": 1,
    ""model_id"": "".elser_model_2_linux-x86_64""
  },
  ""chunking_settings"": {
    ""strategy"": ""sentence"",
    ""max_chunk_size"": 250,
    ""sentence_overlap"": 1
  }
}
```

Enable adaptive allocations:
```
curl -X POST -u elastic:password -H ""Content-Type: application/json"" -d '{""adaptive_allocations"": { ""enabled"": ""true"", ""min_number_of_allocations"": 0, ""max_number_of_allocations"": 1} }' ""http://localhost:9200/_ml/trained_models/my-elser-model/deployment/_update""
```
shows:
```
{
  ""assignment"": {
    ""task_parameters"": {
      ""model_id"": "".elser_model_2_linux-x86_64"",
      ""deployment_id"": ""my-elser-model"",
      ""model_bytes"": 274756282,
      ""threads_per_allocation"": 1,
      ""number_of_allocations"": 1,
      ""queue_capacity"": 10000,
      ""cache_size"": ""274756282b"",
      ""priority"": ""normal"",
      ""per_deployment_memory_bytes"": 0,
      ""per_allocation_memory_bytes"": 0
    },
    ""routing_table"": {
      ""VtOsT8emQHaBZzXvZX8g7Q"": {
        ""current_allocations"": 1,
        ""target_allocations"": 1,
        ""routing_state"": ""started"",
        ""reason"": """"
      }
    },
    ""assignment_state"": ""started"",
    ""start_time"": ""2025-06-30T15:01:20.059416449Z"",
    ""max_assigned_allocations"": 1,
    ""adaptive_allocations"": {
      ""enabled"": true,
      ""min_number_of_allocations"": 0,
      ""max_number_of_allocations"": 1
    }
  }
}
```

```
curl -u elastic:password http://localhost:9200/_inference/sparse_embedding/my-elser-model
```

-------------------------------------

Expected (contains adaptive allocations):
```
{
  ""endpoints"": [
    {
      ""inference_id"": ""my-elser-model"",
      ""task_type"": ""sparse_embedding"",
      ""service"": ""elasticsearch"",
      ""service_settings"": {
        ""num_allocations"": 1,
        ""num_threads"": 1,
        ""adaptive_allocations"": {
          ""enabled"": true,
          ""min_number_of_allocations"": 0,
          ""max_number_of_allocations"": 1
        },
        ""model_id"": "".elser_model_2_linux-x86_64""
      },
      ""chunking_settings"": {
        ""strategy"": ""sentence"",
        ""max_chunk_size"": 250,
        ""sentence_overlap"": 1
      }
    }
  ]
}
```
Actual:
```
{
  ""endpoints"": [
    {
      ""inference_id"": ""my-elser-model"",
      ""task_type"": ""sparse_embedding"",
      ""service"": ""elasticsearch"",
      ""service_settings"": {
        ""num_allocations"": 1,
        ""num_threads"": 1,
        ""model_id"": "".elser_model_2_linux-x86_64""
      },
      ""chunking_settings"": {
        ""strategy"": ""sentence"",
        ""max_chunk_size"": 250,
        ""sentence_overlap"": 1
      }
    }
  ]
}
```",prwhelan,closed,"['>bug', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/130339,2025-06-30T15:10:44Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/130339,"{
  ""application_resource"": ""yes""
}"
30,130012,Cannot use the docker image anymore,"### Elasticsearch Version

8.18.3

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Ubuntu 24.04

### Problem Description

Until version 8.18.2, I was able to use the `docker.elastic.co/elasticsearch/elasticsearch` Docker image with the following environment variables:

- action.destructive_requires_name=false
- bootstrap.memory_lock=true
- cluster.name=dev
- ""discovery.type=single-node""
- ""ES_JAVA_OPTS=-Xms512m -Xmx512m""
- xpack.security.enabled=true
- xpack.security.authc.api_key.enabled=true
- xpack.security.authc.anonymous.roles=superuser
- ELASTIC_PASSWORD=changeme

Please note that I use these variables in order check different authentication options during development, but without having to deal with certificates.

After upgrading to 8.18.3 version, I observe the following warning at the logs:
`received plaintext http traffic on an https channel, closing connection`

Checking the release notes, I do not see if/why something changed related to that.
https://www.elastic.co/guide/en/elasticsearch/reference/8.18/release-notes-8.18.3.html
The only suspicious change seems to be the Ubuntu upgrade. Could it be that something broke with this upgrade?

### Steps to Reproduce

Use the following docker-compose file with the problematic version and check the health with `docker ps` and the Docker logs for the warning.

```
elasticsearch-8:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.18.3
    ports:
      - 9202:9200
    environment:
      - action.destructive_requires_name=false
      - bootstrap.memory_lock=true
      - cluster.name=dev
      - ""discovery.type=single-node""
      - ""ES_JAVA_OPTS=-Xms512m -Xmx512m""
      - xpack.security.enabled=true
      - xpack.security.authc.api_key.enabled=true
      - xpack.security.authc.anonymous.roles=superuser
      - ELASTIC_PASSWORD=changeme
    ulimits:
      memlock:
        soft: -1
        hard: -1
    mem_limit: 6GB
    healthcheck:
      test: [""CMD"", ""curl"", ""-f"", ""http://localhost:9200""]
      interval: 10s
      timeout: 10s
      retries: 3
      start_period: 10s
```

### Logs (if relevant)

_No response_",gpetrou,closed,"['>bug', ':Delivery/Build', 'Team:Delivery']",https://github.com/elastic/elasticsearch/issues/130012,2025-06-25T13:36:39Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/130012,"{
  ""application_resource"": ""no""
}"
31,129974,Index will be yellow when there is a node that the disk usage is higher then the high level watermark,"### Elasticsearch Version

8.17.0

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux x86_64

### Problem Description


When a node's disk usage is above the high water mark, new indexes appear in yellow.
Even if there are many nodes whose disk usage is below the disk watermark.

But I find that if I change the deprecated setting:
```
cluster.routing.allocation.type: balanced
```

New indexes can be created in green.


### Steps to Reproduce

1. Create a cluster that more then three data nodes.
2. Make the data of a data node higher then the high level watermark.( only one data node reaches the high level watermark).
3. put cluster settings:
```
PUT _cluster/settings
{
  ""persistent"": {
        ""cluster.routing.allocation.disk.watermark.high"": ""90%"",
    ""cluster.routing.allocation.disk.watermark.low"": ""85%""
  }
}
```
4. Create a index, the index will be yellow

### Logs (if relevant)

_No response_",weizijun,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/129974,2025-06-25T03:43:45Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/129974,"{
  ""application_resource"": ""yes""
}"
32,129935,[CI] DockerTests test083EnvironmentVariablesUsingFilesHaveCorrectPermissions failing,"**Build Scans:**
- [elasticsearch-periodic-packaging #8712 / ubuntu-2204_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/qwuk7yermwesi)
- [elasticsearch-periodic-packaging #8691 / ubuntu-2204_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/7e3bwocyqb33y)

**Reproduction Line:**
```
null
```

**Applicable branches:**
9.1

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.packaging.test.DockerTests),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(test083EnvironmentVariablesUsingFilesHaveCorrectPermissions),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Elasticsearch container did not start successfully.

ps output:
0

Stdout:
Created elasticsearch keystore in /usr/share/elasticsearch/config/elasticsearch.keystore
13:08:15.257 [main] INFO  org.elasticsearch.common.util.FeatureFlag - The current build is a snapshot, feature flag [new_ml_memory_computation] is enabled

Stderr:


Thread dump:

```

**Issue Reasons:**
- [9.1] 2 failures in test test083EnvironmentVariablesUsingFilesHaveCorrectPermissions (1.3% fail rate in 154 executions)
- [9.1] 2 failures in step ubuntu-2204_packaging-tests-unix (50.0% fail rate in 4 executions)
- [9.1] 2 failures in pipeline elasticsearch-periodic-packaging (50.0% fail rate in 4 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"[':Delivery/Packaging', '>test-failure', 'Team:Delivery', 'low-risk']",https://github.com/elastic/elasticsearch/issues/129935,2025-06-24T14:39:51Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/129935,"{
  ""application_resource"": ""unsure""
}"
33,129599,Issue on ARM64 bit system,"### Elasticsearch Version

9.0.x, 8.18.2

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

6.6.74-rt48-7.2.0-devel-ge1ccbf750eb5

### Problem Description

I get following java error while trying to run the docker containers for elastic search on my ARM64 device

for 9.0.x
`
Exception in thread ""main"" java.lang.NoClassDefFoundError: org/elasticsearch/cli/ProcessInfo
        at org.elasticsearch.launcher.CliToolLauncher.main(CliToolLauncher.java:53)
Caused by: java.lang.ClassNotFoundException: org.elasticsearch.cli.ProcessInfo
        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:580)
        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:490)
        ... 1 more
`

for 8.18.2
`
Exception in thread ""main"" java.lang.NoClassDefFoundError: org/apache/lucene/util/SetOnce
        at org.elasticsearch.common.settings.Settings$Builder.<init>(Settings.java:889)
        at org.elasticsearch.common.settings.Settings.builder(Settings.java:694)
        at org.elasticsearch.launcher.CliToolLauncher.configureLoggingWithoutConfig(CliToolLauncher.java:114)
        at org.elasticsearch.launcher.CliToolLauncher.main(CliToolLauncher.java:56)
Caused by: java.lang.ClassNotFoundException: org.apache.lucene.util.SetOnce
        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:580)
        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:490)
        ... 4 more
`

I use the following docker command to run
`docker run --rm --name es01 --net elastic -p 9200:9200 -it -m 6GB -e ""xpack.ml.use_auto_machine_memory_percent=true"" docker.elastic.co/elasticsearch/elasticsearch:xxx`

### Steps to Reproduce

Following commands was used to pull and run (https://www.elastic.co/docs/deploy-manage/deploy/self-managed/install-elasticsearch-docker-basic)

`docker pull docker.elastic.co/elasticsearch/elasticsearch:xxx`
`docker run --rm --name es01 --net elastic -p 9200:9200 -it -m 6GB -e ""xpack.ml.use_auto_machine_memory_percent=true"" docker.elastic.co/elasticsearch/elasticsearch:8.18.2`

### Logs (if relevant)

_No response_",gauravks,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/129599,2025-06-17T23:24:31Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/129599,"{
  ""application_resource"": ""no""
}"
34,129529,[CI] StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT testMatchAllQuery failing,"**Build Scans:**
- [elasticsearch-intake #24125 / part2](https://gradle-enterprise.elastic.co/s/7efe3zxe23igw)
- [elasticsearch-pull-request #75145 / part-2](https://gradle-enterprise.elastic.co/s/cwtkds2cr75sc)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT.testMatchAllQuery"" -Dtests.seed=5F44C1E6C3493375 -Dtests.locale=be-TARASK -Dtests.timezone=Asia/Anadyr -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testMatchAllQuery),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [2]. Source documents don't match for field [O.mB]: Error [Values of dynamically mapped field containing double values don't match after normalization, normalized actual: [0.27784666, 0.5428209, 0.735376, 0.08668967, 0.0055701495], expected: [0.27784666, 0.5428209, 0.735376, 0.0055701495, 0.08668968]] actual mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""}}}}] actual settings [{""index"":{""mode"":""logsdb"",""mapping"":{""synthetic_source_keep"":""arrays"",""total_fields"":{""limit"":""5000""}}}}] expected mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""}}}}] expected settings [{""index"":{""mode"":""logsdb"",""mapping"":{""synthetic_source_keep"":""arrays"",""total_fields"":{""limit"":""5000""},""source"":{""mode"":""stored""}}}}] 
```

**Issue Reasons:**
- [main] 2 failures in test testMatchAllQuery (0.2% fail rate in 876 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Mapping']",https://github.com/elastic/elasticsearch/issues/129529,2025-06-17T08:59:51Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/129529,"{
  ""application_resource"": ""unsure""
}"
35,129528,[CI] BulkChallengeRestIT testMatchAllQuery failing,"**Build Scans:**
- [elasticsearch-intake #24125 / part2](https://gradle-enterprise.elastic.co/s/7efe3zxe23igw)
- [elasticsearch-pull-request #75145 / part-2](https://gradle-enterprise.elastic.co/s/cwtkds2cr75sc)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.BulkChallengeRestIT.testMatchAllQuery"" -Dtests.seed=5F44C1E6C3493375 -Dtests.locale=zgh-Tfng-MA -Dtests.timezone=America/Regina -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
Yes

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.BulkChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testMatchAllQuery),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [2]. Source documents don't match for field [O.mB]: Error [Values of dynamically mapped field containing double values don't match after normalization, normalized actual: [0.27784666, 0.5428209, 0.735376, 0.08668967, 0.0055701495], expected: [0.27784666, 0.5428209, 0.735376, 0.0055701495, 0.08668968]] actual mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""}}}}] actual settings [{""index"":{""mode"":""logsdb"",""mapping"":{""synthetic_source_keep"":""arrays"",""total_fields"":{""limit"":""5000""}}}}] expected mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""}}}}] expected settings [{""index"":{""mapping"":{""total_fields"":{""limit"":""5000""}}}}] 
```

**Issue Reasons:**
- [main] 2 failures in test testMatchAllQuery (0.2% fail rate in 876 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/129528,2025-06-17T08:59:43Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/129528,"{
  ""application_resource"": ""unsure""
}"
36,129527,[CI] StandardVersusStandardReindexedIntoLogsDbChallengeRestIT testMatchAllQuery failing,"**Build Scans:**
- [elasticsearch-intake #24125 / part2](https://gradle-enterprise.elastic.co/s/7efe3zxe23igw)
- [elasticsearch-pull-request #75145 / part-2](https://gradle-enterprise.elastic.co/s/cwtkds2cr75sc)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StandardVersusStandardReindexedIntoLogsDbChallengeRestIT.testMatchAllQuery"" -Dtests.seed=5F44C1E6C3493375 -Dtests.locale=hi-Deva-IN -Dtests.timezone=America/Asuncion -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
Yes

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StandardVersusStandardReindexedIntoLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testMatchAllQuery),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [2]. Source documents don't match for field [O.mB]: Error [Values of dynamically mapped field containing double values don't match after normalization, normalized actual: [0.27784666, 0.5428209, 0.735376, 0.08668967, 0.0055701495], expected: [0.27784666, 0.5428209, 0.735376, 0.0055701495, 0.08668968]] actual mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""}}}}] actual settings [{""index"":{""mode"":""logsdb"",""mapping"":{""synthetic_source_keep"":""arrays"",""total_fields"":{""limit"":""5000""}}}}] expected mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""method"":{""type"":""keyword""}}}}] expected settings [{""index"":{""mapping"":{""total_fields"":{""limit"":""5000""}}}}] 
```

**Issue Reasons:**
- [main] 2 failures in test testMatchAllQuery (0.2% fail rate in 876 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Mapping', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/129527,2025-06-17T08:59:35Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/129527,"{
  ""application_resource"": ""yes""
}"
37,129062,Include index.sort.* index settings defaults for time_series and logsdb index modes.,"Today when index mode is either logsdb and tsdb, then index sorting is used. However when requesting the `index.sort.*` setting, then no of the index sort index settings have a value. Even when asking for default index setting values. However index sorting has been configured.

This makes it difficult to figure out how either of the index mode work and confusing whether index sorting is actually active. Especially if index sorting gets customized while using logs index mode. 

The fix would be to include the default logsdb and time series index modes' default index sort settings in the get index settings api as default values.

```
POST /logs-myapp-prod/_doc
{
    ""@timestamp"": ""1999-12-31T23:59:59.999Z""
}

GET /logs-myapp-prod/_settings?include_defaults
```

The last api call doesn't include any values for `index.sort.*` index settings:

<details><summary>get index api response</summary>
<p>

```json
{
    "".ds-logs-myapp-prod-2025.06.06-000001"": {
        ""settings"": {
            ""index"": {
                ""mapping"": {
                    ""total_fields"": {
                        ""ignore_dynamic_beyond_limit"": ""true""
                    },
                    ""ignore_malformed"": ""true""
                },
                ""hidden"": ""true"",
                ""provided_name"": "".ds-logs-myapp-prod-2025.06.06-000001"",
                ""creation_date"": ""1749220646540"",
                ""number_of_replicas"": ""1"",
                ""uuid"": ""uSWly65PQky-lnmD7rtT7A"",
                ""version"": {
                    ""created"": ""9028000""
                },
                ""lifecycle"": {
                    ""name"": ""logs""
                },
                ""mode"": ""logsdb"",
                ""codec"": ""best_compression"",
                ""routing"": {
                    ""allocation"": {
                        ""include"": {
                            ""_tier_preference"": ""data_hot""
                        }
                    }
                },
                ""number_of_shards"": ""1"",
                ""logsdb"": {
                    ""add_host_name_field"": ""true"",
                    ""sort_on_host_name"": ""true""
                },
                ""default_pipeline"": ""logs@default-pipeline""
            }
        },
        ""defaults"": {
            ""index"": {
                ""flush_after_merge"": ""512mb"",
                ""time_series"": {
                    ""end_time"": ""9999-12-31T23:59:59.999Z"",
                    ""start_time"": ""-9999-01-01T00:00:00Z"",
                    ""es87tsdb_codec"": {
                        ""enabled"": ""true""
                    }
                },
                ""final_pipeline"": ""_none"",
                ""max_inner_result_window"": ""100"",
                ""unassigned"": {
                    ""node_left"": {
                        ""delayed_timeout"": ""1m""
                    }
                },
                ""max_terms_count"": ""65536"",
                ""rollup"": {
                    ""source"": {
                        ""name"": """",
                        ""uuid"": """"
                    }
                },
                ""lifecycle"": {
                    ""prefer_ilm"": ""true"",
                    ""rollover_alias"": """",
                    ""origination_date"": ""-1"",
                    ""parse_origination_date"": ""false"",
                    ""skip"": ""false"",
                    ""step"": {
                        ""wait_time_threshold"": ""12h""
                    },
                    ""indexing_complete"": ""false""
                },
                ""routing_partition_size"": ""1"",
                ""force_memory_term_dictionary"": ""false"",
                ""max_docvalue_fields_search"": ""100"",
                ""merge"": {
                    ""scheduler"": {
                        ""max_thread_count"": ""4"",
                        ""auto_throttle"": ""true"",
                        ""max_merge_count"": ""9""
                    },
                    ""policy"": {
                        ""merge_factor"": ""32"",
                        ""floor_segment"": ""2mb"",
                        ""max_merge_at_once_explicit"": ""30"",
                        ""max_merge_at_once"": ""10"",
                        ""max_merged_segment"": ""0b"",
                        ""expunge_deletes_allowed"": ""10.0"",
                        ""segments_per_tier"": ""10.0"",
                        ""type"": ""UNSET"",
                        ""deletes_pct_allowed"": ""20.0""
                    }
                },
                ""max_refresh_listeners"": ""1000"",
                ""max_regex_length"": ""1000"",
                ""load_fixed_bitset_filters_eagerly"": ""true"",
                ""number_of_routing_shards"": ""1"",
                ""write"": {
                    ""wait_for_active_shards"": ""1""
                },
                ""seq_no"": {
                    ""index_options"": ""DOC_VALUES_ONLY""
                },
                ""verified_before_close"": ""false"",
                ""mapping"": {
                    ""coerce"": ""false"",
                    ""semantic_text"": {
                        ""use_legacy_format"": ""false""
                    },
                    ""field_name_length"": {
                        ""limit"": ""9223372036854775807""
                    },
                    ""total_fields"": {
                        ""limit"": ""1000""
                    },
                    ""ignore_above"": ""8191"",
                    ""nested_objects"": {
                        ""limit"": ""10000""
                    },
                    ""source"": {
                        ""mode"": ""SYNTHETIC""
                    },
                    ""synthetic_source"": {
                        ""skip_ignored_source_read"": ""false"",
                        ""skip_ignored_source_write"": ""false""
                    },
                    ""nested_fields"": {
                        ""limit"": ""50""
                    },
                    ""synthetic_source_keep"": ""arrays"",
                    ""depth"": {
                        ""limit"": ""20""
                    },
                    ""dimension_fields"": {
                        ""limit"": ""32768""
                    },
                    ""use_doc_values_skipper"": ""false""
                },
                ""source_only"": ""false"",
                ""soft_deletes"": {
                    ""enabled"": ""true"",
                    ""retention"": {
                        ""operations"": ""0""
                    },
                    ""retention_lease"": {
                        ""period"": ""12h""
                    }
                },
                ""max_script_fields"": ""32"",
                ""query"": {
                    ""default_field"": [
                        ""*""
                    ],
                    ""parse"": {
                        ""allow_unmapped_fields"": ""true""
                    }
                },
                ""format"": ""0"",
                ""sort"": {
                    ""missing"": [],
                    ""mode"": [],
                    ""field"": [],
                    ""order"": []
                },
                ""priority"": ""1"",
                ""routing_path"": [],
                ""version"": {
                    ""compatibility"": ""9028000""
                },
                ""dense_vector"": {
                    ""hnsw_filter_heuristic"": ""ACORN""
                },
                ""max_rescore_window"": ""10000"",
                ""bloom_filter_for_id_field"": {
                    ""enabled"": ""true""
                },
                ""max_adjacency_matrix_filters"": ""100"",
                ""analyze"": {
                    ""max_token_count"": ""10000""
                },
                ""gc_deletes"": ""60s"",
                ""top_metrics_max_size"": ""10"",
                ""failure_store"": {
                    ""version"": ""0""
                },
                ""optimize_auto_generated_id"": ""true"",
                ""max_ngram_diff"": ""1"",
                ""translog"": {
                    ""flush_threshold_age"": ""1m"",
                    ""generation_threshold_size"": ""64mb"",
                    ""flush_threshold_size"": ""10gb"",
                    ""sync_interval"": ""5s"",
                    ""retention"": {
                        ""size"": ""-1"",
                        ""age"": ""-1""
                    },
                    ""durability"": ""REQUEST""
                },
                ""auto_expand_replicas"": ""false"",
                ""fast_refresh"": ""false"",
                ""mapper"": {
                    ""dynamic"": ""true""
                },
                ""recovery"": {
                    ""type"": """",
                    ""use_synthetic_source"": ""true""
                },
                ""requests"": {
                    ""cache"": {
                        ""enable"": ""true""
                    }
                },
                ""data_path"": """",
                ""highlight"": {
                    ""max_analyzed_offset"": ""1000000"",
                    ""weight_matches_mode"": {
                        ""enabled"": ""true""
                    }
                },
                ""look_back_time"": ""2h"",
                ""routing"": {
                    ""rebalance"": {
                        ""enable"": ""all""
                    },
                    ""allocation"": {
                        ""disk"": {
                            ""watermark"": {
                                ""ignore"": ""false""
                            }
                        },
                        ""enable"": ""all"",
                        ""total_shards_per_node"": ""-1""
                    }
                },
                ""search"": {
                    ""slowlog"": {
                        ""include"": {
                            ""user"": ""false""
                        },
                        ""level"": ""TRACE"",
                        ""threshold"": {
                            ""fetch"": {
                                ""warn"": ""-1"",
                                ""trace"": ""-1"",
                                ""debug"": ""-1"",
                                ""info"": ""-1""
                            },
                            ""query"": {
                                ""warn"": ""-1"",
                                ""trace"": ""-1"",
                                ""debug"": ""-1"",
                                ""info"": ""-1""
                            }
                        }
                    },
                    ""idle"": {
                        ""after"": ""30s""
                    }
                },
                ""fielddata"": {
                    ""cache"": ""node""
                },
                ""look_ahead_time"": ""30m"",
                ""max_slices_per_scroll"": ""1024"",
                ""shard"": {
                    ""check_on_startup"": ""false""
                },
                ""xpack"": {
                    ""watcher"": {
                        ""template"": {
                            ""version"": """"
                        }
                    },
                    ""version"": """",
                    ""ccr"": {
                        ""following_index"": ""false""
                    }
                },
                ""percolator"": {
                    ""map_unmapped_fields_as_text"": ""false""
                },
                ""verified_read_only"": ""false"",
                ""allocation"": {
                    ""max_retries"": ""5"",
                    ""existing_shards_allocator"": ""gateway_allocator""
                },
                ""refresh_interval"": ""1s"",
                ""indexing"": {
                    ""slowlog"": {
                        ""include"": {
                            ""user"": ""false""
                        },
                        ""reformat"": ""true"",
                        ""threshold"": {
                            ""index"": {
                                ""warn"": ""-1"",
                                ""trace"": ""-1"",
                                ""debug"": ""-1"",
                                ""info"": ""-1""
                            }
                        },
                        ""source"": ""1000"",
                        ""level"": ""TRACE""
                    }
                },
                ""compound_format"": ""1gb"",
                ""blocks"": {
                    ""metadata"": ""false"",
                    ""read"": ""false"",
                    ""read_only_allow_delete"": ""false"",
                    ""read_only"": ""false"",
                    ""write"": ""false""
                },
                ""esql"": {
                    ""stored_fields_sequential_proportion"": ""0.2""
                },
                ""max_result_window"": ""10000"",
                ""store"": {
                    ""stats_refresh_interval"": ""10s"",
                    ""type"": """",
                    ""fs"": {
                        ""fs_lock"": ""native""
                    },
                    ""preload"": [],
                    ""snapshot"": {
                        ""snapshot_name"": """",
                        ""index_uuid"": """",
                        ""cache"": {
                            ""prewarm"": {
                                ""enabled"": ""true""
                            },
                            ""enabled"": ""true"",
                            ""excluded_file_types"": []
                        },
                        ""repository_uuid"": """",
                        ""uncached_chunk_size"": ""-1b"",
                        ""delete_searchable_snapshot"": ""false"",
                        ""index_name"": """",
                        ""partial"": ""false"",
                        ""blob_cache"": {
                            ""metadata_files"": {
                                ""max_length"": ""64kb""
                            }
                        },
                        ""repository_name"": """",
                        ""snapshot_uuid"": """"
                    }
                },
                ""queries"": {
                    ""cache"": {
                        ""enabled"": ""true""
                    }
                },
                ""shard_limit"": {
                    ""group"": ""normal""
                },
                ""warmer"": {
                    ""enabled"": ""true""
                },
                ""downsample"": {
                    ""interval"": """",
                    ""source"": {
                        ""name"": """",
                        ""uuid"": """"
                    },
                    ""origin"": {
                        ""name"": """",
                        ""uuid"": """"
                    },
                    ""status"": ""unknown""
                },
                ""logsdb"": {
                    ""route_on_sort_fields"": ""false""
                },
                ""override_write_load_forecast"": ""0.0"",
                ""max_shingle_diff"": ""3"",
                ""query_string"": {
                    ""lenient"": ""false""
                }
            }
        }
    }
}
```

</p>
</details> 

The default section contains empty values for the `index.sort.*` index setting:

```
...
""sort"": {
    ""missing"": [],
    ""mode"": [],
    ""field"": [],
    ""order"": []
},
...
```

The fix should include the default values for both logsdb and tsdb.",martijnvg,closed,"['>bug', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/129062,2025-06-06T13:44:08Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/129062,"{
  ""application_resource"": ""yes""
}"
38,129055,"[Docker] Elasticsearch Docker container stuck on ""loaded module [...]"" logs and never fully starts","**Description**
While running the Elasticsearch container (tag: docker.elastic.co/elasticsearch/elasticsearch:8.13.4), the service fails to complete startup and gets stuck after logging multiple loaded module [...] messages.

**Logs**
[full_logs.txt](https://github.com/user-attachments/files/20628393/full_logs.txt)

**Steps to Reproduce:**
Ran script provided by the official repo: https://github.com/elastic/start-local

**Additional Context:**
System: Debian
Docker version: 28.2.2
Elasticsearch version: 8.13.4
Firewall: no UFW and iptables locally on remote VM

**Troubleshooting Attempted:**
- Verified `vm.max_map_count=262144`
- Disabled x-pack security for simplicity
- No errors or stack traces are visible, only repeated module loading info logs
- Upgrading Debian VM 11 -> 12
- Installing different versions of Elasticsearch
- Installing the project in WSL Ubuntu 24.04 - Everything Worked perfectly. Using same approach on remote Debian VM - no success.
- Allocating more memory (512mb -> 2gb -> 4gb)",mantvydasBra,closed,['needs:triage'],https://github.com/elastic/elasticsearch/issues/129055,2025-06-06T12:58:33Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/129055,"{
  ""application_resource"": ""unsure""
}"
39,128862,[CI] IndexSortUpgradeIT testIndexSortForNumericTypes {upgradedNodes=1} failing,"**Build Scans:**
- [elasticsearch-intake #23591 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/rniq73ofwkdd6)
- [elasticsearch-pull-request #73763 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/clt42yobqcoz4)
- [elasticsearch-intake #23590 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/2qgz2g2dyndnc)
- [elasticsearch-pull-request #73758 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/w72x3aw2oygaq)
- [elasticsearch-pull-request #73751 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/4omwefrw6gtkc)
- [elasticsearch-pull-request #73749 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/oajzunnycskme)
- [elasticsearch-intake #23587 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/al53msp3kuhyg)
- [elasticsearch-pull-request #73748 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/ickaj3g6e276y)
- [elasticsearch-pull-request #73747 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/n2l6dbljkfhre)
- [elasticsearch-pull-request #73746 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/cuaodzrrplsyg)

**Reproduction Line:**
```
./gradlew "":qa:rolling-upgrade:v8.19.0#bwcTest"" -Dtests.class=""org.elasticsearch.upgrades.IndexSortUpgradeIT"" -Dtests.method=""testIndexSortForNumericTypes {upgradedNodes=2}"" -Dtests.seed=5F767E306F2E734F -Dtests.bwc=true -Dtests.locale=twq-NE -Dtests.timezone=Africa/Casablanca -Druntime.java=24
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.upgrades.IndexSortUpgradeIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testIndexSortForNumericTypes%20%7BupgradedNodes%3D1%7D),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.RuntimeException: An error occurred while checking cluster 'test-cluster' status.
```

**Issue Reasons:**
- [main] 3 consecutive failures in test testIndexSortForNumericTypes {upgradedNodes=1}
- [main] 16 consecutive failures in step 8.19.0_bwc-snapshots
- [main] 2 consecutive failures in pipeline elasticsearch-intake
- [main] 16 failures in test testIndexSortForNumericTypes {upgradedNodes=1} (3.9% fail rate in 407 executions)
- [main] 16 failures in step 8.19.0_bwc-snapshots (12.4% fail rate in 129 executions)
- [main] 5 failures in pipeline elasticsearch-intake (14.7% fail rate in 34 executions)
- [main] 11 failures in pipeline elasticsearch-pull-request (11.3% fail rate in 97 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['blocker', '>test-failure', 'Team:Search Relevance', ':Search Relevance/Search']",https://github.com/elastic/elasticsearch/issues/128862,2025-06-03T19:30:54Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/128862,"{
  ""application_resource"": ""unsure""
}"
40,128672,lucene_snapshot: Examine the MergeReaderWrapper::getOffHeapByteSize implementation,"To get the lucene_snapshot branch testing again, I committed a change whereby `MergeReaderWrapper::getOffHeapByteSize` returns an empty map signalling no off-heap memory usage - since this is commonly true of the `mainReader` which should always be using direct IO.  However, in the case where the reader is created with a merge IOConext this is not true. Why would we create a MergeReaderWrapper when the context is merge/flush ?",ChrisHegarty,closed,"[':Search Relevance/Vectors', 'Team:Search Relevance', 'lucene_10_3_dev']",https://github.com/elastic/elasticsearch/issues/128672,2025-05-30T12:48:52Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/128672,"{
  ""application_resource"": ""yes""
}"
41,128658,"""Unable to find client with name [default]"" when using Azure Workload Identity for Azure repository","### Elasticsearch Version

8.18.0

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

 AKSUbuntu-2204gen2containerd-202505.14.0

### Problem Description

I've followed the steps in https://www.elastic.co/docs/deploy-manage/tools/snapshot-and-restore/azure-repository to use Workload Identity Federation to authenticate an Azure repository, but I'm given the following error when verifying the connection:

`Unable to find client with name [default]`

### Steps to Reproduce

With ECK 2.16.1 installed, deploy the following resources:

```
---
# Source: eck-stack/charts/eck-kibana/templates/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: prd
  labels:
    helm.sh/chart: eck-kibana-0.14.1
    app.kubernetes.io/name: eck-kibana
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
  annotations:
    nginx.ingress.kubernetes.io/backend-protocol: https
    nginx.ingress.kubernetes.io/force-ssl-redirect: ""true""
spec:
  ingressClassName: ""nginx""
  rules:
  - host: ""prd.foo.com""
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: prd-kb-http
            port:
              number: 5601
---
# Source: eck-stack/charts/eck-elasticsearch/templates/elasticsearch.yaml
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: prd
  labels:
    helm.sh/chart: eck-elasticsearch-0.14.1
    app.kubernetes.io/name: eck-elasticsearch
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
  annotations:
    eck.k8s.elastic.co/license: basic
spec:
  http:
    service:
      spec:
        type: LoadBalancer
  version: 8.18.0
  monitoring:
    logs:
      elasticsearchRefs:
      - name: monitoring
    metrics:
      elasticsearchRefs:
      - name: monitoring
  nodeSets:
    
    - config:
        node.roles:
        - master
      count: 1
      name: master
      podTemplate:
        metadata:
          labels:
            azure.workload.identity/use: ""true""
        spec:
          containers:
          - name: elasticsearch
            resources:
              limits:
                memory: 2Gi
              requests:
                cpu: 1
                memory: 2Gi
          initContainers:
          - command:
            - sh
            - -c
            - sysctl -w vm.max_map_count=262144
            name: sysctl
            securityContext:
              privileged: true
              runAsUser: 0
          secureSettings:
          - secretName: keystore
          serviceAccountName: workload-identity
      volumeClaimTemplates:
      - metadata:
          name: elasticsearch-data
        spec:
          accessModes:
          - ReadWriteOnce
          resources:
            requests:
              storage: 5Gi
          storageClassName: managed-csi-premium
    - config:
        node.roles:
        - data_hot
        - data_content
        - ingest
      count: 1
      name: hot
      podTemplate:
        metadata:
          labels:
            azure.workload.identity/use: ""true""
        spec:
          containers:
          - name: elasticsearch
            resources:
              limits:
                memory: 4Gi
              requests:
                cpu: 2
                memory: 4Gi
          initContainers:
          - command:
            - sh
            - -c
            - sysctl -w vm.max_map_count=262144
            name: sysctl
            securityContext:
              privileged: true
              runAsUser: 0
          secureSettings:
          - secretName: keystore
          serviceAccountName: workload-identity
      volumeClaimTemplates:
      - metadata:
          name: elasticsearch-data
        spec:
          accessModes:
          - ReadWriteOnce
          resources:
            requests:
              storage: 30Gi
          storageClassName: managed-csi-premium
    - config:
        node.roles:
        - data_cold
      count: 1
      name: cold
      podTemplate:
        metadata:
          labels:
            azure.workload.identity/use: ""true""
        spec:
          containers:
          - name: elasticsearch
            resources:
              limits:
                memory: 4Gi
              requests:
                cpu: 2
                memory: 4Gi
          initContainers:
          - command:
            - sh
            - -c
            - sysctl -w vm.max_map_count=262144
            name: sysctl
            securityContext:
              privileged: true
              runAsUser: 0
          secureSettings:
          - secretName: keystore
          serviceAccountName: workload-identity
      volumeClaimTemplates:
      - metadata:
          name: elasticsearch-data
        spec:
          accessModes:
          - ReadWriteOnce
          resources:
            requests:
              storage: 30Gi
          storageClassName: managed-csi-premium
    - config:
        node.roles:
        - data_frozen
      count: 1
      name: frozen
      podTemplate:
        metadata:
          labels:
            azure.workload.identity/use: ""true""
        spec:
          containers:
          - name: elasticsearch
            resources:
              limits:
                memory: 4Gi
              requests:
                cpu: 2
                memory: 4Gi
          initContainers:
          - command:
            - sh
            - -c
            - sysctl -w vm.max_map_count=262144
            name: sysctl
            securityContext:
              privileged: true
              runAsUser: 0
          secureSettings:
          - secretName: keystore
          serviceAccountName: workload-identity
      volumeClaimTemplates:
      - metadata:
          name: elasticsearch-data
        spec:
          accessModes:
          - ReadWriteOnce
          resources:
            requests:
              storage: 30Gi
          storageClassName: managed-csi-premium
---
# Source: eck-stack/charts/eck-kibana/templates/kibana.yaml
apiVersion: kibana.k8s.elastic.co/v1
kind: Kibana
metadata:
  name: prd
  labels:
    helm.sh/chart: eck-kibana-0.14.1
    app.kubernetes.io/name: eck-kibana
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
  annotations:
    eck.k8s.elastic.co/license: basic
spec:
  version: 8.17.4
  count: 1
  elasticsearchRef:
    name: prd
  config:
    
    server.publicBaseUrl: https://prd.foo.com
  podTemplate:
    
    spec:
      containers:
      - name: kibana
        resources:
          limits:
            memory: 1Gi
          requests:
            cpu: 1
            memory: 1Gi
---
apiVersion: v1
kind: ServiceAccount
metadata:
  annotations:
    azure.workload.identity/client-id: ""52bf0fcd-740b-4e14-ae64-902dff87b8a0""
  name: workload-identity
---
apiVersion: v1
kind: Secret
metadata:
  name: keystore
type: Opaque
stringData:
  azure.client.default.account: sa0sbx0sbx0uks0eckdemo
---
apiVersion: v1
kind: Secret
metadata:
  name: eck-trial-license
  labels:
    license.k8s.elastic.co/type: enterprise_trial
  annotations:
    elastic.co/eula: accepted
```

Workload Identity itself is working fine, because I can do this on the same cluster:

```
---
apiVersion: v1
kind: Pod
metadata:
  labels:
    azure.workload.identity/use: ""true""
  name: azcli
  namespace: elastic
spec:
  serviceAccountName: workload-identity
  containers:
    - name: azcli
      image: mcr.microsoft.com/azure-cli:latest
      args:
        - /bin/bash
        - -c
        - sleep 9999
```
..and then:
```
kubectl exec -ti azcli -n elastic -- /bin/sh
az login --identity
```

### Logs (if relevant)

```
elasticsearch [2025-05-30T08:06:11,154[][WARN [][r.suppressed             [] [prd-es-master-0[] path: /_snapshot/Test/_verify, params: {repository=Test}, status: 500 org.elasticsearch.repositories.RepositoryVerificationException: [Test[] path  is not accessible on master node
elasticsearch Caused by: org.elasticsearch.common.settings.SettingsException: Unable to find client with name [default[]
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.AzureStorageService.getClientSettings(AzureStorageService.java:99)
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.AzureStorageService.client(AzureStorageService.java:89)
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.AzureBlobStore.getAzureBlobServiceClientClient(AzureBlobStore.java:632)
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.AzureBlobStore.asyncClient(AzureBlobStore.java:628)
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.AzureBlobStore.lambda$executeSingleUpload$19(AzureBlobStore.java:462)
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.SocketAccess.lambda$doPrivilegedVoidException$0(SocketAccess.java:47)
elasticsearch     at java.base/java.security.AccessController.doPrivileged(AccessController.java:251)
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.SocketAccess.doPrivilegedVoidException(SocketAccess.java:46)
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.AzureBlobStore.executeSingleUpload(AzureBlobStore.java:461)
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.AzureBlobStore.writeBlob(AzureBlobStore.java:386)
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.AzureBlobContainer.writeBlob(AzureBlobContainer.java:116)
elasticsearch     at org.elasticsearch.repository.azure@8.18.0/org.elasticsearch.repositories.azure.AzureBlobContainer.writeBlobAtomic(AzureBlobContainer.java:111)
elasticsearch     at org.elasticsearch.server@8.18.0/org.elasticsearch.repositories.blobstore.BlobStoreRepository.startVerification(BlobStoreRepository.java:2211)
elasticsearch     at org.elasticsearch.server@8.18.0/org.elasticsearch.repositories.RepositoriesService$4.doRun(RepositoriesService.java:549)
elasticsearch     at org.elasticsearch.server@8.18.0/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:1044)
elasticsearch     at org.elasticsearch.server@8.18.0/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:27)
elasticsearch     at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1095)
elasticsearch     at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:619)
elasticsearch     at java.base/java.lang.Thread.run(Thread.java:1447)
```",frasdav,closed,"['>bug', ':Distributed Coordination/Snapshot/Restore', 'Team:Distributed Coordination']",https://github.com/elastic/elasticsearch/issues/128658,2025-05-30T08:59:14Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/128658,"{
  ""application_resource"": ""yes""
}"
42,128441,marking and sending shard failed due to [failed recovery] Call to posix_madvise failed with return code 11,"This is just for posterity. I've encountered this issue when updating to 9.0.1 from 8.18.1


for my allocator hosts in ECE I had to increase the `vm.max_map_count=262144` [Docu](https://www.elastic.co/guide/en/cloud-enterprise/3.8/ece-configure-hosts-ubuntu-cloud.html#ece-update-config-ubuntu-cloud) to 2097152 otherwise the update was failing(my container just keep restarting) with `marking and sending shard failed due to [failed recovery] Call to posix_madvise failed with return code 11`

```failed engine [refresh failed source[schedule]]
java.io.IOException: Call to posix_madvise with address=0x6A6939205000 and byteSize=12939 failed with return code 11.
```


most probably the new code of elasticsearch 9.x and/or the bundled java brought this changes.

https://kernel.org/doc/Documentation/sysctl/vm.txt

[(external, opens in a new tab or window)](https://kernel.org/doc/Documentation/sysctl/vm.txt)

see:
""
max_map_count:

This file contains the maximum number of memory map areas a process may have. Memory map areas are used as a side-effect of calling malloc, directly by mmap, mprotect, and madvise, and also when loading shared libraries.

While most applications need less than a thousand maps, certain
programs, particularly malloc debuggers, may consume lots of them,
e.g., up to one or two maps per allocation.

The default value is 65536.
""",zez3,closed,[],https://github.com/elastic/elasticsearch/issues/128441,2025-05-26T08:43:46Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/128441,"{
  ""application_resource"": ""yes""
}"
43,127473,"Error connecting to Elasticsearch."" The Elasticsearch cluster is not reachable from python app in same docker network","### Elasticsearch Version

8.17

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

ubuntu

### Problem Description

I am using docker compose to create elasticsearch docker container using below compose file 

```
 elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.17.0
    container_name: elasticsearch
    ports:
      - 9200:9200
    environment:
      - node.name=elasticsearch
      - cluster.name=docker-cluster
      - discovery.type=single-node
      - ELASTIC_PASSWORD=test
      - bootstrap.memory_lock=true
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=false
      - xpack.security.transport.ssl.enabled=false
      - xpack.license.self_generated.type=basic
      - ES_JAVA_OPTS=-Xmx2g
      #- node.max_local_storage_nodes=6
    ulimits:
      memlock:
        soft: -1
        hard: -1
    healthcheck:
      test: [""CMD-SHELL"", ""curl -s http://localhost:9200/_cluster/health?wait_for_status=yellow&timeout=500ms""]
      retries: 300
      interval: 1s
    volumes:
      #- ./elasticsearch.yml:/etc/elasticsearch/elasticsearch.yml
      -  ./es_data:/usr/share/elasticsearch/data
```
Now, within the same docker-compose file, I have another Python app that is connecting to this Elasticsearch, but while trying, it says, **Error connecting to Elasticsearch."" The Elasticsearch cluster is not reachable**.

Below is the way I am using to connect to elasticsearch

```
# Initialize components
post_process = PostProcessing()
es_connect = ESConnector()
es_host = environ.get(""ELASTIC_SEARCH_HOST"")
print(es_host)
es_user = environ.get(""ELASTIC_SEARCH_NAME"")
print(es_user)
es_password = environ.get(""ELASTIC_SEARCH_PASSWORD"")
print(es_password)
es = es_connect.connect_elasticsearch(es_host, es_user, es_password)
```
but when I am doing 
Telnet from another running container to the Elasticsearch container IP it is connecting to.

Am I using the old way of connecting to Elasticsearch, or what am I missing? I have tried with the Elasticsearch host and container IP as well but no luck

### Steps to Reproduce

custom app

### Logs (if relevant)

_No response_",Vijaygawate,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/127473,2025-04-28T15:42:15Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/127473,"{
  ""application_resource"": ""no""
}"
44,127300,Analysis of ES 7.16 Memory Consumption: Multiple Factors Leading to Memory Surge and the Mystery of 9GB Memory Stuck in GC and Optimization Exploration,"The recent memory consumption of JVM is as follows:

![Image](https://github.com/user-attachments/assets/eb235e00-c37b-4c62-8617-826dfddca7dd)

The green area has optimized space for resident memory
The heap memory of ES is basically divided into segment memory Filter Cacheã€Field Data Cacheã€Bulk Queueã€Indexing Bufferã€Cluster State Bufferã€ The result set fetch consumed by various aggregation queries



ä¸€ã€Segment Memory
This memory is not used by GC and currently only occupies 500M

2ã€Filter Cache

This memory is also not used by GC, currently occupying less than 500M

3ã€Field Data Cache
This memory is also not used by GC and currently only occupies less than 700M. We manually cleaned it up

4ã€Bulk Queue Indexing Buffer
Both of these are system default values, 10%, and the usage will not be very large

Cluster State Buffer
My ES version is 7.16, and now it's this state buffer. I can't confirm how much I've used. Currently, the disk usage of my cold node is only 45%. When I increased the utilization of the cold disk, I found that the memory skyrocketed severely,

![Image](https://github.com/user-attachments/assets/15b33bfa-d25b-4559-ad9f-49cfae0d4b5a)

7ã€ Fetch of ultra large search aggregation result set
I use scroll queries for everything, and I have also tried manually deleting all scorels without seeing a decrease in permanent memory

After overall investigation, it is still due to the fact that the larger the amount of data, the higher the memory. Also, where did the 9 GB of memory that has been stuck in GC go? How to optimize the memory usage of this part?",zhang18668,closed,['needs:triage'],https://github.com/elastic/elasticsearch/issues/127300,2025-04-24T03:48:33Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/127300,"{
  ""application_resource"": ""yes""
}"
45,126888,Request for RISC-V Architecture Support in Elasticsearch,"### Description

**Description:** As RISC-V architecture gains momentum in cloud-native and edge computing scenarios, we propose adding official RISC-V support to Elasticsearch. This would enable deployments on RISC-V based servers/IoT devices and align with the open-source philosophy shared by both projects.

**Technical Considerations:**
  **JDK Compatibility:** Requires OpenJDK RISC-V port (currently experimental in JDK 21+). Track progress via [OpenJDK Portola Project](https://openjdk.org/projects/portola/)
  **Native Libraries:**
  Rebuild JNI components (e.g., Lucene native modules, Netty transport) for RISC-V
  Verify dependencies like zlib/jemalloc compatibility
  **CI/CD Pipeline:**
  Add RISC-V build targets (QEMU emulation or physical hardware)
  Cross-compilation support in Gradle build system
  **Performance Testing:**
  Benchmark search/ingestion performance on RISC-V vs x86/ARM
  Memory management validation for 64-bit RV64GC

**Community Impact:**
  1. Attract developers in RISC-V ecosystem (China/EU markets show strong adoption)
  2.  Enable edge computing use cases with low-power devices
  3. Strengthen open-source infrastructure diversity

**Proposed Milestones:**
  Phase 1: CI pipeline setup with RISC-V emulation
  Phase 2: Core functionality validation
  Phase 3: Performance optimization

**Additional Context:** Recent RISC-V developments show promising server-grade implementations like [Alibaba Xuantie](https://www.alibaba.com/) and [Ventana Veyron](https://www.ventanamicro.com/). Reference implementations exist in https://github.com/python/cpython/pull/104071 and [MySQL](https://mysqlrelease.com/2023/04/mysql-on-risc-v/).

Would appreciate feedback from maintainers on feasibility and potential collaboration avenues.",ghost,closed,"['>enhancement', ':Delivery/Build', 'Team:Delivery']",https://github.com/elastic/elasticsearch/issues/126888,2025-04-16T03:26:41Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/126888,"{
  ""application_resource"": ""no""
}"
46,126886,Request for RISC-V Architecture Support in Elasticsearch,"### Description

**Description:** As RISC-V architecture gains momentum in cloud-native and edge computing scenarios, we propose adding official RISC-V support to Elasticsearch. This would enable deployments on RISC-V based servers/IoT devices and align with the open-source philosophy shared by both projects.

**Technical Considerations:**
  1. **JDK Compatibility:** Requires OpenJDK RISC-V port (currently experimental in JDK 21+). Track progress via [OpenJDK Portola Project](https://openjdk.org/projects/portola/)
  2. **Native Libraries:**
  Rebuild JNI components (e.g., Lucene native modules, Netty transport) for RISC-V
  Verify dependencies like zlib/jemalloc compatibility
  3. **CI/CD Pipeline:**
  Add RISC-V build targets (QEMU emulation or physical hardware)
  Cross-compilation support in Gradle build system
  4. **Performance Testing:**
  Benchmark search/ingestion performance on RISC-V vs x86/ARM
  Memory management validation for 64-bit RV64GC

**Community Impact:**
  1. Attract developers in RISC-V ecosystem (China/EU markets show strong adoption)
  2. Enable edge computing use cases with low-power devices
  3.  Strengthen open-source infrastructure diversity

**Proposed Milestones:**
  Phase 1: CI pipeline setup with RISC-V emulation
  Phase 2: Core functionality validation
  Phase 3: Performance optimization

**Additional Context:** Recent RISC-V developments show promising server-grade implementations like [Alibaba Xuantie](https://www.alibaba.com/) and [Ventana Veyron](https://www.ventanamicro.com/). Reference implementations exist in [Python](https://github.com/python/cpython/pull/104071) and [MySQL](https://mysqlrelease.com/2023/04/mysql-on-risc-v/).

Would appreciate feedback from maintainers on feasibility and potential collaboration avenues.",gong-flying,closed,"['>enhancement', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/126886,2025-04-16T02:32:02Z,0,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/126886,"{
  ""application_resource"": ""no""
}"
47,126535,Re-evaluate the ML node memory availability formula,"Currently, if `ml.use_auto_machine_memory_percent` is set to `true`, the amount of available memory on an ML node is [calculated](https://github.com/elastic/elasticsearch/blob/d82886fc5251ea33adda0aad9b526f969751af22/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/utils/NativeMemoryCalculator.java#L143) as 
`NODE_MEMORY - JVM_HEAP_SIZE  - 200MB OFF-HEAP MEMORY`   

Where `JVM_HEAP_SIZE` is configured on ES start, and the off-heap memory is estimated at 200MB as a fixed value.

Some empirical evidence suggests that the off-heap memory can be significantly larger, which can lead to the Java process being killed by the OOM-killer.

We need to re-evaluate whether the way the ML code is becoming aware of the available memory needs to be adjusted or changed. ",valeriy42,closed,"[':Core/Infra/Core', ':ml', 'Team:Core/Infra', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/126535,2025-04-09T14:13:35Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/126535,"{
  ""application_resource"": ""yes""
}"
48,126124,[CI] EnterpriseGeoIpDownloaderIT testEnterpriseDownloaderTask failing,"**Build Scans:**
- [elasticsearch-intake #25303 / part1](https://gradle-enterprise.elastic.co/s/yhn6t6b2ev43u)
- [elasticsearch-periodic #9261 / openjdk23_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/wnzk2g6jdwktg)
- [elasticsearch-periodic #9261 / openjdk17_checkpart1_java-fips-matrix](https://gradle-enterprise.elastic.co/s/nw6rgye4574ru)
- [elasticsearch-periodic #9261 / openjdk21_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/3qi44vbuugtpc)
- [elasticsearch-periodic #9254 / openjdk17_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/nmxzy5pl2vwbi)
- [elasticsearch-periodic #9247 / openjdk21_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/5tsn52ni7ckbm)
- [elasticsearch-periodic #9233 / encryption-at-rest](https://gradle-enterprise.elastic.co/s/inxi6c533qn6u)
- [elasticsearch-periodic #9233 / openjdk17_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/y76q42c7cqdno)
- [elasticsearch-periodic #9226 / third-party_geoip](https://gradle-enterprise.elastic.co/s/p4kkuedir5q7k)
- [elasticsearch-periodic #9219 / third-party_geoip](https://gradle-enterprise.elastic.co/s/7wlcop6l5falu)

**Reproduction Line:**
```
./gradlew "":modules:ingest-geoip:internalClusterTest"" --tests ""org.elasticsearch.ingest.geoip.EnterpriseGeoIpDownloaderIT.testEnterpriseDownloaderTask"" -Dtests.seed=34C030C63CB67356 -Dtests.locale=so-Latn-SO -Dtests.timezone=America/Halifax -Druntime.java=24
```

**Applicable branches:**
8.18

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.ingest.geoip.EnterpriseGeoIpDownloaderIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!('testEnterpriseDownloaderTask'),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: 
Expected: <2>
     but: was <1>
```

**Issue Reasons:**
- [8.18] 13 failures in test testEnterpriseDownloaderTask (3.8% fail rate in 341 executions)
- [8.18] 2 failures in step openjdk17_checkpart1_java-matrix (18.2% fail rate in 11 executions)
- [8.18] 2 failures in step openjdk21_checkpart1_java-matrix (18.2% fail rate in 11 executions)
- [8.18] 2 failures in step third-party_geoip (20.0% fail rate in 10 executions)
- [8.18] 2 failures in step ubuntu-2204_platform-support-unix (20.0% fail rate in 10 executions)
- [8.18] 6 failures in pipeline elasticsearch-periodic (54.5% fail rate in 11 executions)
- [8.18] 3 failures in pipeline elasticsearch-periodic-platform-support (27.3% fail rate in 11 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':Data Management/Ingest Node', 'Team:Data Management', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/126124,2025-04-02T13:13:39Z,16,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/126124,"{
  ""application_resource"": ""unsure""
}"
49,125920,Increased memory usage in 8.18/9.0,"### Elasticsearch Version

8.18, 9.0, main

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

All (confirmend on Linux and OSX)

### Problem Description

We observed an increased usage of memory from ES processes; when running in 1GiB containers, this leads ES to occasionally exceed the limits of the container and get oom-killed.
Apparently, this happens more frequently with 8.18, main, and with cgroups v2; 9.0 appeared to be unaffected, and so nodes running with cgroups v1, but this seems to be more due to chance than hard evidence.

This issue was observed internally in our cloud depolyments (ECE and Serverless) -- Incident 1321.

The root cause seems to be an increase to Java ""Internal"" memory (one of the categories reported by Java NMT ([Native Memory Tracking](https://docs.oracle.com/en/java/javase/24/vm/native-memory-tracking.html)), which is ~100MB greater than in previous versions. It seems the additional memory is allocated/retained by the JVM as a consequence of enabling Entitlements.


### Steps to Reproduce

The increased memory consumption can be seen by running ES 8.18; in particular, running it with NMT shows the increase in Internal size.
In order to compare the numbers with a baseline however it is necessary to run ES 8.18 (or main) with entitlements off; to do that, you need a code change (look for write usages of the `useEntitlements` variable).

### Logs (if relevant)

_No response_",ldematte,closed,"['>bug', 'Team:Core/Infra', 'v9.0.0', 'v8.18.0', ':Core/Infra/Entitlements']",https://github.com/elastic/elasticsearch/issues/125920,2025-03-31T08:31:21Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/125920,"{
  ""application_resource"": ""yes""
}"
50,125156,Downsampling fails if source index contains fields of type passthrough,"Downsampling fails if source index contains fields of type passthrough and these fields are configured with `time_series_dimension` to `true`.  There are two problems that occur in this case:

- The target index that the downsample api tries to creates is with a flattened like mapping (fields with dots) and so the type of the object field is never specified (1).
- The downsample api detects all fields with `time_series_dimension` set to `true` as dimension fields. This isn't true as passthrough fields are just container fields.

1: This is a field mapping that the downsample tries to create:

```
        ""metrics.process.memory.usage"": {
            ""type"": ""aggregate_metric_double"",
            ""metrics"": [
                ""max"",
                ""min"",
                ""value_count"",
                ""sum""
            ],
            ""default_metric"": ""max"",
            ""time_series_metric"": ""gauge""
        },
``` 

The `metrics.` is an object field here and but in the mapping that this fields get merged with it is a passthrough object field.

",martijnvg,closed,"['>bug', ':StorageEngine/Downsampling', 'Team:StorageEngine']",https://github.com/elastic/elasticsearch/issues/125156,2025-03-18T19:42:53Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/125156,"{
  ""application_resource"": ""yes""
}"
51,124844,[CI] ClassificationIT testDeleteExpiredData_RemovesUnusedState failing,"**Build Scans:**
- [elasticsearch-periodic #7030 / openjdk21_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/in56dvk2nhibg)
- [elasticsearch-periodic #6981 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/wccimnuwfmtyc)
- [elasticsearch-periodic #6925 / openjdk22_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/zxfxdghqspckc)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testDeleteExpiredData_RemovesUnusedState"" -Dtests.seed=311BCA03A4C11FF0 -Dtests.locale=mt-MT -Dtests.timezone=Antarctica/Troll -Druntime.java=21
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testDeleteExpiredData_RemovesUnusedState),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_delete_expired_data"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":93},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":100,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1742129434903,""peak_usage_bytes"":56552,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1742129434903,""iteration"":16,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":1.744853789550222,""downsample_factor"":0.6273126154109778,""eta"":0.2306758273935785,""eta_growth_rate_per_tree"":1.128221351693222,""feature_bag_fraction"":0.1
[truncated]
```

**Issue Reasons:**
- [8.17] 3 failures in test testDeleteExpiredData_RemovesUnusedState (0.6% fail rate in 492 executions)
- [8.17] 3 failures in pipeline elasticsearch-periodic (18.8% fail rate in 16 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/124844,2025-03-14T05:19:20Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/124844,"{
  ""application_resource"": ""unsure""
}"
52,124833,[CI] LogsdbIndexingRollingUpgradeIT testIndexing {upgradedNodes=1} failing,"**Build Scans:**
- [elasticsearch-intake #20048 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/tmv3x5wtmxqd2)
- [elasticsearch-pull-request #62598 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/skkbcrnhct2hg)
- [elasticsearch-pull-request #62595 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/2sc7vt6vrj6ic)
- [elasticsearch-pull-request #62592 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/jncp3qirpdhuw)
- [elasticsearch-intake #20046 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/3je2bqs3i7zkq)
- [elasticsearch-pull-request #62589 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/2ztic45q6b4ww)
- [elasticsearch-pull-request #62581 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/kczublcxyt56e)
- [elasticsearch-pull-request #62574 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/7sqrlgng6f3ls)
- [elasticsearch-pull-request #62504 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/rl76b3a5kmta4)
- [elasticsearch-pull-request #62049 / 8.19.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/a67q3j5l2yzbg)

**Reproduction Line:**
```
./gradlew "":qa:rolling-upgrade:v9.0.0#bwcTest"" -Dtests.class=""org.elasticsearch.upgrades.LogsdbIndexingRollingUpgradeIT"" -Dtests.method=""testIndexing {upgradedNodes=1}"" -Dtests.seed=BC808F086923CB28 -Dtests.bwc=true -Dtests.locale=es-PA -Dtests.timezone=Pacific/Fiji -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.upgrades.LogsdbIndexingRollingUpgradeIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testIndexing%20%7BupgradedNodes%3D1%7D),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: timed out waiting for green state for index [logs-bwc-test] cluster state [{
  ""cluster_name"" : ""test-cluster"",
  ""cluster_uuid"" : ""bDRMLq-FTiaBRwWDcOp73Q"",
  ""version"" : 92,
  ""state_uuid"" : ""wJZwpQztSJSWdertfdwIqA"",
  ""master_node"" : ""V20gptq2RlyMtqOAmf0Qgw"",
  ""blocks"" : { },
  ""nodes"" : {
    ""V20gptq2RlyMtqOAmf0Qgw"" : {
      ""name"" : ""test-cluster-1"",
      ""ephemeral_id"" : ""45sNebf6Rr6Vw-t2H7lMQw"",
      ""transport_address"" : ""127.0.0.1:39141"",
      ""external_id"" : ""test-cluster-1"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""transform.config_version"" : ""10.0.0"",
        ""xpack.installed"" : ""true"",
        ""ml.allocated_processors"" : ""32"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""ml.config_version"" : ""12.0.0"",
        ""ml.machine_memory"" : ""101237063680"",
        ""ml.allocated_processors_double"" : ""32.0""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data
[truncated]
```

**Issue Reasons:**
- [main] 3 consecutive failures in step 9.0.0_bwc-snapshots
- [main] 13 failures in test testIndexing {upgradedNodes=1} (1.4% fail rate in 947 executions)
- [main] 10 failures in step 9.0.0_bwc-snapshots (3.5% fail rate in 286 executions)
- [main] 2 failures in step 9.1.0_bwc-snapshots (0.7% fail rate in 288 executions)
- [main] 2 failures in pipeline elasticsearch-intake (3.0% fail rate in 67 executions)
- [main] 9 failures in pipeline elasticsearch-pull-request (3.8% fail rate in 236 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/124833,2025-03-13T21:53:15Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/124833,"{
  ""application_resource"": ""yes""
}"
53,124831,[CI] LogsdbIndexingRollingUpgradeIT testIndexing {upgradedNodes=3} failing,"**Build Scans:**
- [elasticsearch-intake #20048 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/tmv3x5wtmxqd2)
- [elasticsearch-pull-request #62598 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/skkbcrnhct2hg)
- [elasticsearch-pull-request #62595 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/2sc7vt6vrj6ic)
- [elasticsearch-pull-request #62597 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/u7kpiq3ddzhu6)
- [elasticsearch-pull-request #62592 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/jncp3qirpdhuw)
- [elasticsearch-intake #20046 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/3je2bqs3i7zkq)
- [elasticsearch-pull-request #62590 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/wv7y2pgb4dlfw)
- [elasticsearch-intake #20045 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/llcvekzfdmwkg)
- [elasticsearch-pull-request #62589 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/2ztic45q6b4ww)
- [elasticsearch-intake #20044 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/cocx3p5wvv7mi)

**Reproduction Line:**
```
./gradlew "":qa:rolling-upgrade:v9.0.0#bwcTest"" -Dtests.class=""org.elasticsearch.upgrades.LogsdbIndexingRollingUpgradeIT"" -Dtests.method=""testIndexing {upgradedNodes=1}"" -Dtests.seed=BC808F086923CB28 -Dtests.bwc=true -Dtests.locale=es-PA -Dtests.timezone=Pacific/Fiji -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.upgrades.LogsdbIndexingRollingUpgradeIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testIndexing%20%7BupgradedNodes%3D3%7D),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: timed out waiting for green state for index [logs-bwc-test] cluster state [{
  ""cluster_name"" : ""test-cluster"",
  ""cluster_uuid"" : ""bDRMLq-FTiaBRwWDcOp73Q"",
  ""version"" : 92,
  ""state_uuid"" : ""wJZwpQztSJSWdertfdwIqA"",
  ""master_node"" : ""V20gptq2RlyMtqOAmf0Qgw"",
  ""blocks"" : { },
  ""nodes"" : {
    ""V20gptq2RlyMtqOAmf0Qgw"" : {
      ""name"" : ""test-cluster-1"",
      ""ephemeral_id"" : ""45sNebf6Rr6Vw-t2H7lMQw"",
      ""transport_address"" : ""127.0.0.1:39141"",
      ""external_id"" : ""test-cluster-1"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""transform.config_version"" : ""10.0.0"",
        ""xpack.installed"" : ""true"",
        ""ml.allocated_processors"" : ""32"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""ml.config_version"" : ""12.0.0"",
        ""ml.machine_memory"" : ""101237063680"",
        ""ml.allocated_processors_double"" : ""32.0""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data
[truncated]
```

**Issue Reasons:**
- [main] 10 consecutive failures in step 9.0.0_bwc-snapshots
- [main] 17 failures in test testIndexing {upgradedNodes=3} (1.8% fail rate in 947 executions)
- [main] 14 failures in step 9.0.0_bwc-snapshots (4.9% fail rate in 286 executions)
- [main] 2 failures in step 9.1.0_bwc-snapshots (0.7% fail rate in 288 executions)
- [main] 4 failures in pipeline elasticsearch-intake (6.0% fail rate in 67 executions)
- [main] 11 failures in pipeline elasticsearch-pull-request (4.7% fail rate in 236 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/124831,2025-03-13T21:44:35Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/124831,"{
  ""application_resource"": ""yes""
}"
54,124830,[CI] LogsdbIndexingRollingUpgradeIT testIndexing {upgradedNodes=2} failing,"**Build Scans:**
- [elasticsearch-intake #20048 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/tmv3x5wtmxqd2)
- [elasticsearch-pull-request #62598 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/skkbcrnhct2hg)
- [elasticsearch-pull-request #62595 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/2sc7vt6vrj6ic)
- [elasticsearch-pull-request #62597 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/u7kpiq3ddzhu6)
- [elasticsearch-pull-request #62592 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/jncp3qirpdhuw)
- [elasticsearch-intake #20046 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/3je2bqs3i7zkq)
- [elasticsearch-pull-request #62590 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/wv7y2pgb4dlfw)
- [elasticsearch-pull-request #62589 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/2ztic45q6b4ww)
- [elasticsearch-intake #20044 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/cocx3p5wvv7mi)
- [elasticsearch-pull-request #62581 / 9.0.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/kczublcxyt56e)

**Reproduction Line:**
```
./gradlew "":qa:rolling-upgrade:v9.0.0#bwcTest"" -Dtests.class=""org.elasticsearch.upgrades.LogsdbIndexingRollingUpgradeIT"" -Dtests.method=""testIndexing {upgradedNodes=1}"" -Dtests.seed=BC808F086923CB28 -Dtests.bwc=true -Dtests.locale=es-PA -Dtests.timezone=Pacific/Fiji -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.upgrades.LogsdbIndexingRollingUpgradeIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testIndexing%20%7BupgradedNodes%3D2%7D),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: timed out waiting for green state for index [logs-bwc-test] cluster state [{
  ""cluster_name"" : ""test-cluster"",
  ""cluster_uuid"" : ""bDRMLq-FTiaBRwWDcOp73Q"",
  ""version"" : 92,
  ""state_uuid"" : ""wJZwpQztSJSWdertfdwIqA"",
  ""master_node"" : ""V20gptq2RlyMtqOAmf0Qgw"",
  ""blocks"" : { },
  ""nodes"" : {
    ""V20gptq2RlyMtqOAmf0Qgw"" : {
      ""name"" : ""test-cluster-1"",
      ""ephemeral_id"" : ""45sNebf6Rr6Vw-t2H7lMQw"",
      ""transport_address"" : ""127.0.0.1:39141"",
      ""external_id"" : ""test-cluster-1"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""transform.config_version"" : ""10.0.0"",
        ""xpack.installed"" : ""true"",
        ""ml.allocated_processors"" : ""32"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""ml.config_version"" : ""12.0.0"",
        ""ml.machine_memory"" : ""101237063680"",
        ""ml.allocated_processors_double"" : ""32.0""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data
[truncated]
```

**Issue Reasons:**
- [main] 7 consecutive failures in step 9.0.0_bwc-snapshots
- [main] 16 failures in test testIndexing {upgradedNodes=2} (1.7% fail rate in 947 executions)
- [main] 13 failures in step 9.0.0_bwc-snapshots (4.5% fail rate in 286 executions)
- [main] 2 failures in step 9.1.0_bwc-snapshots (0.7% fail rate in 288 executions)
- [main] 3 failures in pipeline elasticsearch-intake (4.5% fail rate in 67 executions)
- [main] 11 failures in pipeline elasticsearch-pull-request (4.7% fail rate in 236 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/124830,2025-03-13T21:44:27Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/124830,"{
  ""application_resource"": ""yes""
}"
55,124744,ESQL: Make INLINESTATS properly track memory of data passed between phases,"When INLINESTATS is executed, it performs a first phase where it only computes the `STATS`, then it stuffs the result thereof into the query plan of the second phase, which uses it to perform an `InlineJoin`.

The memory used for this was not properly tracked; instead we put a 1MB limit in place.

This should be properly tracked with ES|QL's circuit breaking infrastructure, otherwise many parallel INLINESTATS requests could run a node out of memory.",alex-spies,closed,"['Team:Analytics', '>tech debt', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/124744,2025-03-13T13:37:46Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/124744,"{
  ""application_resource"": ""yes""
}"
56,124499,"Vector index merge time regression in 8.16.0 onwards, with MGLRU enabled in Linux kernel","### Elasticsearch Version

8.16.0+

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux kernel 6.3+

### Problem Description

Starting from 8.16.0, with MGLRU enabled in Linux kernel (`cat /sys/kernel/mm/lru_gen/enabled` returns `0x0007`), and Linux kernel version 6.3+, vector index merge process might take a very long time to complete. This applies to non-quantized vector format like in example below. Note that default vector type is quantized (`int8_hnsw`) since version 8.14.

```
        ""titleVector"" : {
          ""type"" : ""dense_vector"",
          ""dims"" : 768,
          ""index"" : true,
          ""similarity"" : ""dot_product"",
          ""index_options"" : {
            ""type"" : ""hnsw"", <--- HERE
            ""m"" : 16,
            ""ef_construction"" : 100
          }
        },
```

The most characteristic symptom is the Lucene merge thread is constantly calculating vector dot product.

(note: below outputs for ES 8.17.2 and Linux kernel 6.8)

```
$ ./jdk/bin/jstack -l -e $(./jdk/bin/jps | grep Elasticsearch | awk '{print $1}') | grep ""Lucene Merge Thread"" -A35
""elasticsearch[<REDACTED>][[vectors][0]: Lucene Merge Thread #0]"" #85 [14473] daemon prio=5 os_prio=0 cpu=2086890.49ms elapsed=9886.33s allocated=11887M defined_classes=212 tid=0x00007f865c0188f0 nid=14473 runnable  [0x00007f86f4afc000]
   java.lang.Thread.State: RUNNABLE
        at org.apache.lucene.internal.vectorization.PanamaVectorUtilSupport.dotProductBody(org.apache.lucene.core@9.12.0/PanamaVectorUtilSupport.java:122)
        at org.apache.lucene.internal.vectorization.PanamaVectorUtilSupport.dotProduct(org.apache.lucene.core@9.12.0/PanamaVectorUtilSupport.java:102)
        at org.apache.lucene.util.VectorUtil.dotProduct(org.apache.lucene.core@9.12.0/VectorUtil.java:66)
        at org.apache.lucene.index.VectorSimilarityFunction$2.compare(org.apache.lucene.core@9.12.0/VectorSimilarityFunction.java:55)
        at org.apache.lucene.codecs.hnsw.DefaultFlatVectorScorer$FloatScoringSupplier$1.score(org.apache.lucene.core@9.12.0/DefaultFlatVectorScorer.java:149)
        at org.apache.lucene.util.hnsw.HnswGraphSearcher.searchLevel(org.apache.lucene.core@9.12.0/HnswGraphSearcher.java:237)
        at org.apache.lucene.util.hnsw.HnswGraphBuilder.addGraphNode(org.apache.lucene.core@9.12.0/HnswGraphBuilder.java:265)
        at org.apache.lucene.util.hnsw.HnswConcurrentMergeBuilder$ConcurrentMergeWorker.addGraphNode(org.apache.lucene.core@9.12.0/HnswConcurrentMergeBuilder.java:200)
        at org.apache.lucene.util.hnsw.HnswGraphBuilder.addVectors(org.apache.lucene.core@9.12.0/HnswGraphBuilder.java:197)
        at org.apache.lucene.util.hnsw.HnswConcurrentMergeBuilder$ConcurrentMergeWorker.run(org.apache.lucene.core@9.12.0/HnswConcurrentMergeBuilder.java:180)
        at org.apache.lucene.util.hnsw.HnswConcurrentMergeBuilder.lambda$build$0(org.apache.lucene.core@9.12.0/HnswConcurrentMergeBuilder.java:86)
        at org.apache.lucene.util.hnsw.HnswConcurrentMergeBuilder$$Lambda/0x00007f86a06496a8.call(org.apache.lucene.core@9.12.0/Unknown Source)
        at java.util.concurrent.FutureTask.run(java.base@23/FutureTask.java:317)
        at org.apache.lucene.search.TaskExecutor$TaskGroup$1.run(org.apache.lucene.core@9.12.0/TaskExecutor.java:120)
        at org.apache.lucene.search.TaskExecutor$TaskGroup.invokeAll(org.apache.lucene.core@9.12.0/TaskExecutor.java:176)
        at org.apache.lucene.search.TaskExecutor.invokeAll(org.apache.lucene.core@9.12.0/TaskExecutor.java:84)
        at org.apache.lucene.util.hnsw.HnswConcurrentMergeBuilder.build(org.apache.lucene.core@9.12.0/HnswConcurrentMergeBuilder.java:90)
        at org.apache.lucene.util.hnsw.IncrementalHnswGraphMerger.merge(org.apache.lucene.core@9.12.0/IncrementalHnswGraphMerger.java:147)
        at org.apache.lucene.codecs.lucene99.Lucene99HnswVectorsWriter.mergeOneField(org.apache.lucene.core@9.12.0/Lucene99HnswVectorsWriter.java:377)
        at org.apache.lucene.codecs.perfield.PerFieldKnnVectorsFormat$FieldsWriter.mergeOneField(org.apache.lucene.core@9.12.0/PerFieldKnnVectorsFormat.java:121)
        at org.apache.lucene.codecs.KnnVectorsWriter.merge(org.apache.lucene.core@9.12.0/KnnVectorsWriter.java:106)
        at org.apache.lucene.index.SegmentMerger.mergeVectorValues(org.apache.lucene.core@9.12.0/SegmentMerger.java:271)
        at org.apache.lucene.index.SegmentMerger$$Lambda/0x00007f86a0638000.merge(org.apache.lucene.core@9.12.0/Unknown Source)
        at org.apache.lucene.index.SegmentMerger.mergeWithLogging(org.apache.lucene.core@9.12.0/SegmentMerger.java:314)
        at org.apache.lucene.index.SegmentMerger.merge(org.apache.lucene.core@9.12.0/SegmentMerger.java:158)
        at org.apache.lucene.index.IndexWriter.mergeMiddle(org.apache.lucene.core@9.12.0/IndexWriter.java:5292)
        at org.apache.lucene.index.IndexWriter.merge(org.apache.lucene.core@9.12.0/IndexWriter.java:4758)
        at org.apache.lucene.index.IndexWriter$IndexWriterMergeSource.merge(org.apache.lucene.core@9.12.0/IndexWriter.java:6581)
        at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(org.apache.lucene.core@9.12.0/ConcurrentMergeScheduler.java:660)
        at org.elasticsearch.index.engine.ElasticsearchConcurrentMergeScheduler.doMerge(org.elasticsearch.server@8.17.2/ElasticsearchConcurrentMergeScheduler.java:103)
        at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(org.apache.lucene.core@9.12.0/ConcurrentMergeScheduler.java:721)

   Locked ownable synchronizers:
        - None
```

Hot threads show high I/O wait, notice `other=88.1%`:

```
$ curl -u <REDACTED> ""http://localhost:9200/_nodes/hot_threads?threads=10000"" -s | grep ""\[vectors\]\[0\]: Lucene Merge Thread #0"" -A25
   100.0% [cpu=11.9%, other=88.1%] (500ms out of 500ms) cpu usage by thread 'elasticsearch[ip-172-31-32-115][[vectors][0]: Lucene Merge Thread #0]'
     10/10 snapshots sharing following 31 elements
       app/org.apache.lucene.core@9.12.0/org.apache.lucene.internal.vectorization.PanamaVectorUtilSupport.dotProductBody(PanamaVectorUtilSupport.java:122)
       app/org.apache.lucene.core@9.12.0/org.apache.lucene.internal.vectorization.PanamaVectorUtilSupport.dotProduct(PanamaVectorUtilSupport.java:102)
       app/org.apache.lucene.core@9.12.0/org.apache.lucene.util.VectorUtil.dotProduct(VectorUtil.java:66)
       app/org.apache.lucene.core@9.12.0/org.apache.lucene.index.VectorSimilarityFunction$2.compare(VectorSimilarityFunction.java:55)
       app/org.apache.lucene.core@9.12.0/org.apache.lucene.codecs.hnsw.DefaultFlatVectorScorer$FloatScoringSupplier$1.score(DefaultFlatVectorScorer.java:149)
       app/org.apache.lucene.core@9.12.0/org.apache.lucene.util.hnsw.HnswGraphSearcher.searchLevel(HnswGraphSearcher.java:237)
       app/org.apache.lucene.core@9.12.0/org.apache.lucene.util.hnsw.HnswGraphBuilder.addGraphNode(HnswGraphBuilder.java:265)
       app/org.apache.lucene.core@9.12.0/org.apache.lucene.util.hnsw.HnswConcurrentMergeBuilder$ConcurrentMergeWorker.addGraphNode(HnswConcurrentMergeBuilder.java:200)
       app/org.apache.lucene.core@9.12.0/org.apache.lucene.util.hnsw.HnswGraphBuilder.addVectors(HnswGraphBuilder.java:197)
[..]
```

From OS perspective, high level of major page faults...
```
$ sar -B 1 5
Linux 6.8.0-1021-aws (<REDACTED>)         03/10/25        _x86_64_        (4 CPU)

13:30:01     pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff
13:30:02     77240.00     60.00  19313.00  19310.00  25420.00  25408.00      0.00  50816.00    200.00
13:30:03     77640.00      0.00  19410.00  19410.00     11.00      0.00      0.00      0.00      0.00
13:30:04     78244.00      0.00  19561.00  19561.00  25419.00  25408.00      0.00  50816.00    200.00
13:30:05     78756.00      0.00  19689.00  19689.00  25420.00  25408.00      0.00  50816.00    200.00
13:30:06     78344.00      0.00  19586.00  19586.00  25418.00  25408.00      0.00  50816.00    200.00
Average:     78044.80     12.00  19511.80  19511.20  20337.60  20326.40      0.00  40652.80    200.00
```

... and I/O wait, see `wa` column:

(note: that's on a reproduction system that has nothing else to do, just the merge, on busy systems CPU I/O wait might be ""hidden"")

```
$ vmstat -a -SM 1 5
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free  inact active   si   so    bi    bo   in   cs us sy id wa st
 2  1      0    331   8646   6168    0    0  6662   656   96   96  3  2 82 13  0
 0  2      0    264   8715   6169    0    0 71296     0 20083 35919  1  5 51 43  0
 0  2      0    287   8690   6169    0    0 75572     0 21292 38060  1  5 51 43  0
 0  2      0    311   8659   6169    0    0 69932     0 19752 35268  2  4 51 43  0
 0  2      0    350   8632   6169    0    0 74724     8 21119 37623  2  5 51 42  0
```

... and I/O PSI metrics:

```
$ cat /proc/pressure/io
some avg10=54.40 avg60=51.46 avg300=51.83 total=15287830871
full avg10=54.39 avg60=51.41 avg300=51.79 total=15251110144
```

The exact level of major page faults will depend on the system. The above was seen in a system with 2 concurrent Lucene merge threads, with a NVMe SSD disk with 100 us read latency (`r_await`). With higher read latency, major page faults might be proportionally lower.

```
$ iostat -xdz 1
[..]
Device            r/s     rkB/s   rrqm/s  %rrqm r_await rareq-sz     w/s     wkB/s   wrqm/s  %wrqm w_await wareq-sz     d/s     dkB/s   drqm/s  %drqm d_await dareq-sz     f/s f_await  aqu-sz  %util
nvme0n1       19402.00  77612.00     0.00   0.00    0.09     4.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    1.73  98.40


Device            r/s     rkB/s   rrqm/s  %rrqm r_await rareq-sz     w/s     wkB/s   wrqm/s  %wrqm w_await wareq-sz     d/s     dkB/s   drqm/s  %drqm d_await dareq-sz     f/s f_await  aqu-sz  %util
nvme0n1       19681.00  78720.00     0.00   0.00    0.09     4.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00      0.00     0.00   0.00    0.00     0.00    0.00    0.00    1.75  98.30
[..]
```

The regression is a combination of:
* Lucene using `MADV_RANDOM` madvise for VEC files
* Elasticsearch not overriding this starting from https://github.com/elastic/elasticsearch/pull/110159
* Changed semantics of `MADV_RANDOM` in Linux kernel with MGLRU, specifically after https://github.com/torvalds/linux/commit/8788f6781486769d9598dcaedc3fe0eb12fc3e59

### Steps to Reproduce

The following steps reproduce the problem reliably on hosts with 4 or 8 CPU cores and 16 GiB of RAM, and Intel processors supporting AVX-512 extension. The problem might be present elsewhere, but that's how the repros were run. The data is based on [SO Vector](https://github.com/elastic/rally-tracks/tree/master/so_vector) Rally track which creates a single `vectors` index with 2 shards. This specific payload uses `hnsw` vector index type which is _not_ the default since 8.14.0.

```
# make sure you have 6.3+ Linux kernel
uname -a

# make sure MGLRU is enabled (should return 0x0007)
cat /sys/kernel/mm/lru_gen/enabled

# make sure AVX-512 extensions are available
grep avx512 /proc/cpuinfo

# make sure you have 16 GiB of memory
grep MemTotal /proc/meminfo

# for fancy download
sudo apt-get update
sudo apt install aria2

# download (607 MiB) and unpack Elasticsearch version 8.17.2
aria2c -x 4 https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.17.2-linux-x86_64.tar.gz
tar zxf elasticsearch-8.17.2-linux-x86_64.tar.gz
cd elasticsearch-8.17.2

# download Lucene 9.12.0 with modified logging
mv lib/lucene-core-9.12.0.jar lib/lucene-core-9.12.0.jar.orig
wget https://storage.googleapis.com/so-vector-test-public/lucene-core-9.12.0.jar -O lib/lucene-core-9.12.0.jar

# configure Elasticsearch user/password
./bin/elasticsearch-users useradd test -p test123 -r superuser

# set heap size to 4 GiB
echo ""-Xms4g"" >> config/jvm.options
echo ""-Xmx4g"" >> config/jvm.options

# set force merge thread pool size to 2
echo ""thread_pool.force_merge.size: 2"" >> config/elasticsearch.yml

# download the SO Vector Rally track data with ""hnsw"" vector index type ingested into ES (31 GiB) and untar it
aria2c -x 4 https://storage.googleapis.com/so-vector-test-public/8.17.2-data.tar
tar -xf 8.17.2-data.tar

# start tmux session
tmux

# start Elasticsearch
./bin/elasticsearch

# wait for this log line:
# [2025-03-10T10:12:57,968][INFO ][o.e.c.r.a.AllocationService] [<REDACTED>] current.health=""GREEN"" message=""Cluster health status changed from [RED] to [GREEN] (reason: [shards started [[vectors][0]]])."" previous.health=""RED"" reason=""shards started [[vectors][0]]""

# --- in a new window

# list indices
curl -u test:test123 ""http://localhost:9200/_cat/indices?v""

# --- example output ---
# health status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size dataset.size
# green  open   vectors zJfxtEMfR5-V8o84Fsr2-w   2   0    2000000            0     30.7gb         30.7gb       30.7gb

# initiate force merge of the ""vectors"" index
curl -u test:test123 -X POST ""http://localhost:9200/vectors/_forcemerge?max_num_segments=1&wait_for_completion=false""

# --- example output ---
# {""task"":""KbsRAY4bScCt_8EcwpO1bw:212""}
```

### Logs (if relevant)

~10 minutes after force merge initiation, the graph build process starts. Here, each 1000-vector chunk is processed in around a second:

```
[2025-03-10T10:47:17,579][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] addVectors [0 2048]
[2025-03-10T10:47:17,672][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] built 0 in 92/92 ms
[2025-03-10T10:47:17,869][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] addVectors [0 2048]
[2025-03-10T10:47:18,098][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] built 0 in 228/228 ms
[2025-03-10T10:47:19,121][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] built 1000 in 1449/1541 ms
[2025-03-10T10:47:20,290][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] built 2000 in 1168/2710 ms
[2025-03-10T10:47:20,346][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] addVectors [2048 4096]
[2025-03-10T10:47:21,435][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] built 3000 in 1089/1089 ms
[2025-03-10T10:47:22,613][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] built 4000 in 1178/2267 ms
```

But later the process degrades, and each chunk can take way more time:

```
[2025-03-10T11:15:22,990][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] addVectors [659456 661504]
[2025-03-10T11:15:27,159][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] addVectors [591872 593920]
[2025-03-10T11:15:30,313][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] built 592000 in 3154/3154 ms
[2025-03-10T11:15:36,239][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] built 660000 in 13249/13249 ms
[2025-03-10T11:15:54,574][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] built 593000 in 24260/27414 ms
[2025-03-10T11:15:59,629][INFO ][o.a.l.u.h.HnswGraphBuilder] [<REDACTED>] built 661000 in 23389/36639 ms
```

(note the process ends at 1M vectors in each shard)

### Workaround

Disable MGLRU:
```
sudo sh -c 'echo 0 > /sys/kernel/mm/lru_gen/enabled'
```",gbanasiak,closed,"['>bug', ':Performance', 'Team:Performance', ':Search Relevance/Vectors', 'priority:high', 'Team:Search Relevance']",https://github.com/elastic/elasticsearch/issues/124499,2025-03-10T14:52:06Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/124499,"{
  ""application_resource"": ""yes""
}"
57,124440,[CI] ClassificationIT testStopAndRestart failing,"**Build Scans:**
- [elasticsearch-periodic #6876 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/rngckxdbnot6y)
- [elasticsearch-periodic #6834 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/n3dgthajtijng)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testStopAndRestart"" -Dtests.seed=E0A6B536E3E3AED2 -Dtests.locale=bo-CN -Dtests.timezone=Asia/Tehran -Druntime.java=17 -Dtests.fips.enabled=true
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testStopAndRestart),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_stop_and_restart"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":100},{""phase"":""final_training"",""progress_percent"":100},{""phase"":""writing_results"",""progress_percent"":100},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":350,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1741499543362,""peak_usage_bytes"":75948,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1741499543362,""iteration"":18,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":2.151715174504274,""downsample_factor"":0.26208524553128787,""eta"":0.8325084985174382,""eta_growth_rate_per_tree"":1.4663259254105783,""feature_bag_fraction""
[truncated]
```

**Issue Reasons:**
- [8.17] 2 failures in test testStopAndRestart (1.0% fail rate in 192 executions)
- [8.17] 2 failures in pipeline elasticsearch-periodic (28.6% fail rate in 7 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/124440,2025-03-09T06:18:08Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/124440,"{
  ""application_resource"": ""unsure""
}"
58,124052,[CI] CoreWithMultipleProjectsClientYamlTestSuiteIT test {yaml=search.vectors/41_knn_search_bbq_hnsw/Vector rescoring has same scoring as exact search for kNN section} failing,"**Build Scans:**
- [elasticsearch-periodic #6789 / openjdk21_entitlements_true_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/hnoqpfiaww3ua)
- [elasticsearch-pull-request #60458 / part-2](https://gradle-enterprise.elastic.co/s/ov6wvelvpmq2q)
- [elasticsearch-pull-request #60204 / part-2](https://gradle-enterprise.elastic.co/s/yrqdgy5bc3wce)

**Reproduction Line:**
```
./gradlew "":x-pack:qa:multi-project:core-rest-tests-with-multiple-projects:yamlRestTest"" --tests ""org.elasticsearch.multiproject.test.CoreWithMultipleProjectsClientYamlTestSuiteIT"" -Dtests.method=""test {yaml=search.vectors/41_knn_search_bbq_hnsw/Vector rescoring has same scoring as exact search for kNN section}"" -Dtests.seed=DF1DDE5C4B469CD5 -Dtests.jvm.argline=""-Des.entitlements.enabled=true"" -Dtests.locale=ksf-Latn-CM -Dtests.timezone=Etc/GMT+3 -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.multiproject.test.CoreWithMultipleProjectsClientYamlTestSuiteIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(test%20%7Byaml%3Dsearch.vectors%2F41_knn_search_bbq_hnsw%2FVector%20rescoring%20has%20same%20scoring%20as%20exact%20search%20for%20kNN%20section%7D),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Failure at [search.vectors/41_knn_search_bbq_hnsw:171]: 
Expected: <3>
     but: was <2>
```

**Issue Reasons:**
- [main] 3 failures in test test {yaml=search.vectors/41_knn_search_bbq_hnsw/Vector rescoring has same scoring as exact search for kNN section} (1.1% fail rate in 278 executions)
- [main] 2 failures in step part-2 (1.7% fail rate in 116 executions)
- [main] 2 failures in pipeline elasticsearch-pull-request (1.7% fail rate in 118 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':Search Relevance/Vectors', 'low-risk', 'Team:Search Relevance']",https://github.com/elastic/elasticsearch/issues/124052,2025-03-04T22:59:18Z,10,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/124052,"{
  ""application_resource"": ""unsure""
}"
59,123892,[CI] HeapAttackIT testSortByManyLongsSuccess failing,"**Build Scans:**
- [elasticsearch-periodic #6759 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/id7kr6yjbqk6a)
- [elasticsearch-periodic #6745 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/xcjpfxwuvu2po)

**Reproduction Line:**
```
./gradlew "":test:external-modules:test-esql-heap-attack:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.testEnrichExplosionManyMatches"" -Dtests.seed=25F269D7FF8C8AC1 -Dtests.configure_test_clusters_with_one_processor=true -Dtests.locale=cv-RU -Dtests.timezone=America/Cayenne -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testSortByManyLongsSuccess),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.net.ConnectException: Connection refused
```

**Issue Reasons:**
- [8.x] 2 failures in test testSortByManyLongsSuccess (2.0% fail rate in 101 executions)
- [8.x] 2 failures in step single-processor-node-tests (50.0% fail rate in 4 executions)
- [8.x] 2 failures in pipeline elasticsearch-periodic (50.0% fail rate in 4 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'low-risk']",https://github.com/elastic/elasticsearch/issues/123892,2025-03-03T15:20:20Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/123892,"{
  ""application_resource"": ""unsure""
}"
60,123844,[CI] ClassificationIT testWithOnlyTrainingRowsAndTrainingPercentIsHundred failing,"**Build Scans:**
- [elasticsearch-periodic #6885 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/u4u5ihidkelfw)
- [elasticsearch-periodic #6794 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/bvqgict6dtopo)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsHundred"" -Dtests.seed=685E10DD60FE3265 -Dtests.locale=fr-BL -Dtests.timezone=Asia/Singapore -Druntime.java=17
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithOnlyTrainingRowsAndTrainingPercentIsHundred),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_only_training_data_and_training_percent_is_100"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":87},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":300,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1741525954640,""peak_usage_bytes"":32324,""status"":""ok""},""node"":{""id"":""JgorkFYsTeSRF6jUoUGBSg"",""name"":""javaRestTest-2"",""ephemeral_id"":""WCEKbHWCRH2LdwAvD9aNlQ"",""transport_address"":""127.0.0.1:41241"",""attributes"":{""testattr"":""test"",""ml.allocated_processors"":""32"",""ml.max_jvm_size"":""536870912"",""ml.config_version"":""12.0.0"",""ml.machine_memory"":""1266042101
[truncated]
```

**Issue Reasons:**
- [8.x] 2 failures in test testWithOnlyTrainingRowsAndTrainingPercentIsHundred (0.4% fail rate in 542 executions)
- [8.x] 2 failures in pipeline elasticsearch-periodic (14.3% fail rate in 14 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/123844,2025-03-03T06:28:34Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/123844,"{
  ""application_resource"": ""unsure""
}"
61,123843,[CI] ClassificationIT testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsInteger failing,"**Build Scans:**
- [elasticsearch-periodic #6841 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/pcqtx6ggsokuw)
- [elasticsearch-periodic #6750 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/lfsn4fpawuwqs)
- [elasticsearch-periodic #6722 / openjdk21_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/fbh327qbw7slc)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsInteger"" -Dtests.seed=28AB328EDCC20E90 -Dtests.locale=sn-ZW -Dtests.timezone=America/Buenos_Aires -Druntime.java=17 -Dtests.fips.enabled=true
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsInteger),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_training_percent_is_50_integer"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":89},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":150,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1741355681802,""peak_usage_bytes"":19264,""status"":""ok""},""node"":{""id"":""OP3iVjfVTyOpRBGudA3Q0g"",""name"":""javaRestTest-2"",""ephemeral_id"":""bQglAw5XTemVuA-y4K57Yg"",""transport_address"":""127.0.0.1:33633"",""attributes"":{""ml.allocated_processors"":""32"",""xpack.installed"":""true"",""transform.config_version"":""10.0.0"",""testattr"":""test"",""ml.allocated_processors_double"":""32.0"",""ml.m
[truncated]
```

**Issue Reasons:**
- [8.17] 3 failures in test testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsInteger (0.6% fail rate in 527 executions)
- [8.17] 3 failures in pipeline elasticsearch-periodic (16.7% fail rate in 18 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/123843,2025-03-03T06:28:30Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/123843,"{
  ""application_resource"": ""unsure""
}"
62,123805,[CI] HeapAttackIT testFetchTooManyMvLongs failing,"**Build Scans:**
- [elasticsearch-periodic #6724 / concurrent-search-tests](https://gradle-enterprise.elastic.co/s/vsi2vycsxvj4m)
- [elasticsearch-periodic-platform-support #6616 / debian-11_platform-support-unix](https://gradle-enterprise.elastic.co/s/ahvhj3xyuxpye)

**Reproduction Line:**
```
./gradlew "":test:external-modules:test-esql-heap-attack:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.testHugeConcat"" -Dtests.seed=FA1A265012D38730 -Dtests.jvm.argline=""-Des.concurrent_search=true"" -Dtests.locale=es-EC -Dtests.timezone=SystemV/PST8 -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testFetchTooManyMvLongs),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
org.junit.TestCouldNotBeSkippedException: Test could not be skipped due to other failures
```

**Issue Reasons:**
- [8.x] 2 failures in test testFetchTooManyMvLongs (0.4% fail rate in 549 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'low-risk']",https://github.com/elastic/elasticsearch/issues/123805,2025-03-01T23:17:12Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/123805,"{
  ""application_resource"": ""unsure""
}"
63,123432,[CI] HeapAttackIT testLookupExplosionNoFetch failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #6766 / almalinux-8-aarch64_checkpart1_platform-support-arm](https://gradle-enterprise.elastic.co/s/g7ph3sgcxgyok)
- [elasticsearch-pull-request #59795 / part-1](https://gradle-enterprise.elastic.co/s/dvl37lhqhrayk)

**Reproduction Line:**
```
./gradlew "":test:external-modules:test-esql-heap-attack:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.testLookupExplosionNoFetch"" -Dtests.seed=B6380225CF313F5E -Dtests.locale=en-KI -Dtests.timezone=America/Los_Angeles -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testLookupExplosionNoFetch),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:34875], URI [/_query?error_trace=], status line [HTTP/1.1 429 Too Many Requests]
Warnings: [No limit defined, adding default limit of [1000]]
{""error"":{""root_cause"":[{""type"":""circuit_breaking_exception"",""reason"":""[request] Data too large, data for [serialize lookup join response] would be [348652480/332.5mb], which is larger than the limit of [322122547/307.1mb]; for more information, see https://www.elastic.co/guide/en/elasticsearch/reference/master/circuit-breaker-errors.html"",""bytes_wanted"":348652480,""bytes_limit"":322122547,""durability"":""TRANSIENT"",""stack_trace"":""org.elasticsearch.common.breaker.CircuitBreakingException: [request] Data too large, data for [serialize lookup join response] would be [348652480/332.5mb], which is larger than the limit of [322122547/307.1mb]; for more information, see https://www.elastic.co/guide/en/elasticsearch/reference/master/circuit-breaker-errors.html\n\tat org.elasticsea
[truncated]
```

**Issue Reasons:**
- [main] 2 failures in test testLookupExplosionNoFetch (0.3% fail rate in 611 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/123432,2025-02-25T23:37:08Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/123432,"{
  ""application_resource"": ""yes""
}"
64,123354,Limit number of suppressed S3 deletion errors,"When issuing blob deletions to S3, there is no limit to the number of errors that we accumulate while [deletions](https://github.com/elastic/elasticsearch/blob/12fcdd8633f03159a8f1505d2f828ed0bba06709/modules/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3BlobStore.java#L377) are ongoing. The combination of large snapshot clean ups which would issue many such calls, and all deletions and their retries failing e.g. due to some setup issue, could lead to a huge amount of memory usage and potentially OOMing the node. It is not clear how severe the same issue can be in other object stores, since it might depend a bit on the error responses that the SDK returns and how large it is, but theoretically this could still happen there too. We should limit the suppressed errors we keep while issuing deletes as I do not think there is any value in recording all of these in the exception (I'm not even sure they are preserved).",pxsalehi,closed,"['>bug', ':Distributed Coordination/Snapshot/Restore', 'Team:Distributed Coordination']",https://github.com/elastic/elasticsearch/issues/123354,2025-02-25T10:03:01Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/123354,"{
  ""application_resource"": ""yes""
}"
65,123347,[CI] ClassificationIT testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsBoolean failing,"**Build Scans:**
- [elasticsearch-periodic #7044 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/mzlghevrblddq)
- [elasticsearch-periodic #6995 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/jcqamvxu6duea)
- [elasticsearch-periodic #6995 / openjdk21_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/nigjmy5kvpabg)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsBoolean"" -Dtests.seed=B63710B3BCE98353 -Dtests.locale=ar-JO -Dtests.timezone=PLT -Druntime.java=17
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsBoolean),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_training_percent_is_50_boolean"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":84},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":150,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1742187083709,""peak_usage_bytes"":19250,""status"":""ok""},""node"":{""id"":""oWYFlkFmRJOijkenMn7bVw"",""name"":""javaRestTest-2"",""ephemeral_id"":""BeW-f7jETzqrtfM7ZUfZxw"",""transport_address"":""127.0.0.1:38575"",""attributes"":{""testattr"":""test"",""transform.config_version"":""10.0.0"",""xpack.installed"":""true"",""ml.allocated_processors"":""32"",""ml.max_jvm_size"":""536870912"",""ml.config_vers
[truncated]
```

**Issue Reasons:**
- [8.17] 3 failures in test testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsBoolean (1.3% fail rate in 223 executions)
- [8.17] 2 failures in step openjdk17_checkpart4_java-matrix (25.0% fail rate in 8 executions)
- [8.17] 2 failures in pipeline elasticsearch-periodic (25.0% fail rate in 8 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/123347,2025-02-25T08:55:53Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/123347,"{
  ""application_resource"": ""unsure""
}"
66,123040,[CI] HeapAttackIT class failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #6885 / debian-12_platform-support-unix](https://gradle-enterprise.elastic.co/s/k2p5vy3aet3ag)
- [elasticsearch-periodic-platform-support #6878 / opensuse-leap-15_platform-support-unix](https://gradle-enterprise.elastic.co/s/7ebcgmwpafaim)
- [elasticsearch-periodic-platform-support #6878 / ubuntu-2404_platform-support-unix](https://gradle-enterprise.elastic.co/s/er4tn55cugmqs)
- [elasticsearch-periodic-platform-support #6835 / rhel-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/lqwgwgj2rhmui)
- [elasticsearch-periodic-platform-support #6816 / sles-12_platform-support-unix](https://gradle-enterprise.elastic.co/s/sfeejiuu2wogk)
- [elasticsearch-periodic-platform-support #6800 / almalinux-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/oukjygfuqkuja)
- [elasticsearch-periodic-platform-support #6785 / ubuntu-2204_platform-support-unix](https://gradle-enterprise.elastic.co/s/z5i5s7by6nmci)
- [elasticsearch-periodic #6759 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/id7kr6yjbqk6a)
- [elasticsearch-periodic-platform-support #6748 / debian-12_platform-support-unix](https://gradle-enterprise.elastic.co/s/nyzlu7a5c44kc)
- [elasticsearch-periodic #6745 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/xcjpfxwuvu2po)

**Reproduction Line:**
```
./gradlew "":test:external-modules:test-esql-heap-attack:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.testLookupExplosionBigString"" -Dtests.seed=2ED3ABFD661AD0C0 -Dtests.locale=sah -Dtests.timezone=America/Argentina/ComodRivadavia -Druntime.java=24
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
org.junit.TestCouldNotBeSkippedException: Test could not be skipped due to other failures
```

**Issue Reasons:**
- [8.x] 11 failures in class org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT (1.3% fail rate in 819 executions)
- [8.x] 2 failures in step debian-12_platform-support-unix (10.0% fail rate in 20 executions)
- [8.x] 2 failures in step single-processor-node-tests (10.0% fail rate in 20 executions)
- [8.x] 8 failures in pipeline elasticsearch-periodic-platform-support (38.1% fail rate in 21 executions)
- [8.x] 2 failures in pipeline elasticsearch-periodic (9.5% fail rate in 21 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'low-risk']",https://github.com/elastic/elasticsearch/issues/123040,2025-02-20T15:14:26Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/123040,"{
  ""application_resource"": ""unsure""
}"
67,122985,[CI] HeapAttackIT testTooManyEval failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #6511 / oraclelinux-7_platform-support-unix](https://gradle-enterprise.elastic.co/s/4v7pzarxqoc44)
- [elasticsearch-periodic-platform-support #6469 / ubuntu-2204_platform-support-unix](https://gradle-enterprise.elastic.co/s/re6mg2v3wqzmc)

**Reproduction Line:**
```
./gradlew "":test:external-modules:test-esql-heap-attack:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.testTooManyEval"" -Dtests.seed=2621B4298B0075C4 -Dtests.locale=lag-Latn-TZ -Dtests.timezone=Australia/Melbourne -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testTooManyEval),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
org.junit.TestCouldNotBeSkippedException: Test could not be skipped due to other failures
```

**Issue Reasons:**
- [8.x] 2 failures in test testTooManyEval (0.8% fail rate in 242 executions)
- [8.x] 2 failures in pipeline elasticsearch-periodic-platform-support (28.6% fail rate in 7 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/122985,2025-02-20T07:14:43Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/122985,"{
  ""application_resource"": ""unsure""
}"
68,122942,[CI] ClassificationIT testDependentVariableIsAliasToNested failing,"**Build Scans:**
- [elasticsearch-periodic #7051 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/22du3r4r5qrfi)
- [elasticsearch-periodic #6925 / openjdk23_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/j4ht76rf6wf6w)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testDependentVariableIsAliasToNested"" -Dtests.seed=EE794CCAEDA0ACB5 -Dtests.locale=ky-Cyrl-KG -Dtests.timezone=Europe/Samara -Druntime.java=17
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testDependentVariableIsAliasToNested),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""dependent_variable_is_alias_to_nested"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":84},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":100,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1742215967451,""peak_usage_bytes"":14789,""status"":""ok""},""node"":{""id"":""kbGun7KcRTG6Fu0OgD36Cg"",""name"":""javaRestTest-1"",""ephemeral_id"":""Y6OD6_3jSC6dKfVLm32PGg"",""transport_address"":""127.0.0.1:40961"",""attributes"":{""testattr"":""test"",""ml.allocated_processors_double"":""32.0"",""ml.machine_memory"":""126604222464"",""ml.config_version"":""12.0.0"",""ml.max_jvm_size"":""536870912"",""ml.allocat
[truncated]
```

**Issue Reasons:**
- [8.17] 2 failures in test testDependentVariableIsAliasToNested (0.3% fail rate in 588 executions)
- [8.17] 2 failures in pipeline elasticsearch-periodic (10.5% fail rate in 19 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/122942,2025-02-19T14:52:42Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/122942,"{
  ""application_resource"": ""unsure""
}"
69,122913,[CI] HeapAttackIT testEnrichExplosionManyMatches failing,"**Build Scans:**
- [elasticsearch-periodic #6759 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/id7kr6yjbqk6a)
- [elasticsearch-periodic-platform-support #6748 / debian-12_platform-support-unix](https://gradle-enterprise.elastic.co/s/nyzlu7a5c44kc)
- [elasticsearch-periodic #6745 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/xcjpfxwuvu2po)
- [elasticsearch-periodic-platform-support #6727 / rocky-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/lcwknvqdeh7pk)
- [elasticsearch-periodic #6724 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/ovwtsujzs57oq)
- [elasticsearch-periodic #6724 / concurrent-search-tests](https://gradle-enterprise.elastic.co/s/vsi2vycsxvj4m)
- [elasticsearch-periodic-platform-support #6657 / rhel-7_platform-support-unix](https://gradle-enterprise.elastic.co/s/x5b6mn4fbojau)
- [elasticsearch-periodic-platform-support #6637 / opensuse-leap-15_platform-support-unix](https://gradle-enterprise.elastic.co/s/de4cqyjz2vtis)
- [elasticsearch-periodic-platform-support #6630 / oraclelinux-7_platform-support-unix](https://gradle-enterprise.elastic.co/s/lqkhyelf7ev7a)
- [elasticsearch-periodic #6634 / concurrent-search-tests](https://gradle-enterprise.elastic.co/s/iq6qkbxe4t2eo)

**Reproduction Line:**
```
./gradlew "":test:external-modules:test-esql-heap-attack:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.testEnrichExplosionManyMatches"" -Dtests.seed=25F269D7FF8C8AC1 -Dtests.configure_test_clusters_with_one_processor=true -Dtests.locale=cv-RU -Dtests.timezone=America/Cayenne -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testEnrichExplosionManyMatches),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.net.ConnectException: Connection refused
```

**Issue Reasons:**
- [8.x] 11 failures in test testEnrichExplosionManyMatches (1.6% fail rate in 683 executions)
- [8.x] 3 failures in step single-processor-node-tests (15.8% fail rate in 19 executions)
- [8.x] 2 failures in step concurrent-search-tests (11.1% fail rate in 18 executions)
- [8.x] 4 failures in pipeline elasticsearch-periodic (20.0% fail rate in 20 executions)
- [8.x] 6 failures in pipeline elasticsearch-periodic-platform-support (31.6% fail rate in 19 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'low-risk']",https://github.com/elastic/elasticsearch/issues/122913,2025-02-19T06:34:40Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/122913,"{
  ""application_resource"": ""yes""
}"
70,122908,[CI] ClassificationIT testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsKeyword failing,"**Build Scans:**
- [elasticsearch-intake #18422 / part4](https://gradle-enterprise.elastic.co/s/5ooco3gvmxacy)
- [elasticsearch-pull-request #56468 / part-4](https://gradle-enterprise.elastic.co/s/xpvhqt5pyx22w)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsKeyword"" -Dtests.seed=E76CD2330EEAC243 -Dtests.locale=doi-Deva-IN -Dtests.timezone=Etc/GMT-13 -Druntime.java=23
```

**Applicable branches:**
8.18

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsKeyword),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_training_percent_is_50_keyword"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":89},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":150,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739923363099,""peak_usage_bytes"":19112,""status"":""ok""},""node"":{""id"":""b5KhG7utR8i3PHB1TC_iBQ"",""name"":""javaRestTest-1"",""ephemeral_id"":""he0hSTEuQuu7yCzdvUi99A"",""transport_address"":""127.0.0.1:45639"",""attributes"":{""ml.machine_memory"":""126604214272"",""ml.config_version"":""12.0.0"",""ml.max_jvm_size"":""536870912"",""ml.allocated_processors"":""32"",""xpack.installed"":""true"",""tran
[truncated]
```

**Issue Reasons:**
- [8.18] 2 failures in test testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsKeyword (0.3% fail rate in 796 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/122908,2025-02-19T00:33:05Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/122908,"{
  ""application_resource"": ""unsure""
}"
71,122692,[CI] ClassificationIT testSetUpgradeMode_ExistingTaskGetsUnassigned failing,"**Build Scans:**
- [elasticsearch-periodic #6430 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/p3t4tbxbbn73c)
- [elasticsearch-intake #18147 / part4](https://gradle-enterprise.elastic.co/s/zfkighzcbotpi)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsKeyword"" -Dtests.seed=B02FCEFFF62270B0 -Dtests.locale=or-Orya-IN -Dtests.timezone=Canada/Saskatchewan -Druntime.java=17
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testSetUpgradeMode_ExistingTaskGetsUnassigned),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_training_percent_is_50_keyword"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":59},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":150,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739657833678,""peak_usage_bytes"":58080,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1739657833678,""iteration"":10,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":3.1453819005602686,""downsample_factor"":0.3685444750839404,""eta"":0.7182545337363935,""eta_growth_rate_per_tree"":1.1554419751368594,""feature_bag_
[truncated]
```

**Issue Reasons:**
- [8.17] 2 failures in test testSetUpgradeMode_ExistingTaskGetsUnassigned (2.0% fail rate in 101 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/122692,2025-02-15T22:52:34Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/122692,"{
  ""application_resource"": ""unsure""
}"
72,122684,[CI] ClassificationIT testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsTextAndKeyword failing,"**Build Scans:**
- [elasticsearch-periodic #7030 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/weltkiue4q5pc)
- [elasticsearch-periodic #6925 / openjdk23_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/j4ht76rf6wf6w)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsTextAndKeyword"" -Dtests.seed=5D1D9FFB2A0293C4 -Dtests.locale=en-GY -Dtests.timezone=Asia/Kathmandu -Druntime.java=17
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsTextAndKeyword),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_training_percent_is_50_text_and_keyword"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":150,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1742129342018,""peak_usage_bytes"":19086,""status"":""ok""},""node"":{""id"":""AqV_ZP8uTB-HyXJMZ8afxA"",""name"":""javaRestTest-2"",""ephemeral_id"":""kTBGwlPoRX6wyhdqV8Dd4Q"",""transport_address"":""127.0.0.1:38753"",""attributes"":{""ml.machine_memory"":""126604201984"",""ml.allocated_processors_double"":""32.0"",""testattr"":""test"",""transform.config_version"":""10.0.0"",""xpack.installed
[truncated]
```

**Issue Reasons:**
- [8.17] 2 failures in test testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsTextAndKeyword (0.4% fail rate in 493 executions)
- [8.17] 2 failures in pipeline elasticsearch-periodic (12.5% fail rate in 16 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/122684,2025-02-15T14:41:08Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/122684,"{
  ""application_resource"": ""unsure""
}"
73,122682,[CI] ClassificationIT testDependentVariableIsAliasToKeyword failing,"**Build Scans:**
- [elasticsearch-periodic #6960 / openjdk22_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/2zezmfro6d6jy)
- [elasticsearch-periodic #6848 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/ozewks7tngmdk)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testDependentVariableIsAliasToKeyword"" -Dtests.seed=F11D70CBAB5F2CEC -Dtests.locale=en-NL -Dtests.timezone=America/Santiago -Druntime.java=22
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testDependentVariableIsAliasToKeyword),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""dependent_variable_is_alias"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":85},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":100,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1741841626872,""peak_usage_bytes"":14710,""status"":""ok""},""node"":{""id"":""jL_9KMc6Sp2iVXWyB_BpKA"",""name"":""javaRestTest-1"",""ephemeral_id"":""a-_O04kjT3qJZ7Lzw3DDAg"",""transport_address"":""127.0.0.1:37367"",""attributes"":{""testattr"":""test"",""xpack.installed"":""true"",""transform.config_version"":""10.0.0"",""ml.allocated_processors_double"":""32.0"",""ml.machine_memory"":""126604214272"",""ml.config_version""
[truncated]
```

**Issue Reasons:**
- [8.17] 2 failures in test testDependentVariableIsAliasToKeyword (0.4% fail rate in 529 executions)
- [8.17] 2 failures in pipeline elasticsearch-periodic (11.8% fail rate in 17 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/122682,2025-02-15T14:34:25Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/122682,"{
  ""application_resource"": ""unsure""
}"
74,122667,[CI] ClassificationIT testDependentVariableIsNested failing,"**Build Scans:**
- [elasticsearch-periodic #7045 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/45fzxmbzkqqm6)
- [elasticsearch-periodic #6947 / openjdk22_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/fm2bxidl5vef2)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testDependentVariableIsNested"" -Dtests.seed=FBCB16629DFD4D30 -Dtests.locale=wae-Latn-CH -Dtests.timezone=Pacific/Port_Moresby -Druntime.java=17 -Dtests.fips.enabled=true
```

**Applicable branches:**
8.18

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testDependentVariableIsNested),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""dependent_variable_is_nested"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":86},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":100,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1742187746622,""peak_usage_bytes"":14737,""status"":""ok""},""node"":{""id"":""K_9bQqo5SNOYvgj-0scaHw"",""name"":""javaRestTest-1"",""ephemeral_id"":""j2A9_xr8QoSHZXwkB9co9Q"",""transport_address"":""127.0.0.1:40633"",""attributes"":{""testattr"":""test"",""ml.allocated_processors"":""32"",""ml.max_jvm_size"":""536870912"",""ml.config_version"":""12.0.0"",""ml.machine_memory"":""126604206080"",""ml.allocated_processors_doub
[truncated]
```

**Issue Reasons:**
- [8.18] 2 failures in test testDependentVariableIsNested (0.4% fail rate in 571 executions)
- [8.18] 2 failures in pipeline elasticsearch-periodic (13.3% fail rate in 15 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/122667,2025-02-15T05:57:19Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/122667,"{
  ""application_resource"": ""unsure""
}"
75,122145,[CI] DataFrameAnalysisCustomFeatureIT testNGramCustomFeature failing,"**Build Scans:**
- [elasticsearch-periodic #6303 / openjdk23_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/tcimauvw3gjie)
- [elasticsearch-periodic #6296 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/swxv5kvsl3jje)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.DataFrameAnalysisCustomFeatureIT.testNGramCustomFeature"" -Dtests.seed=E49323ED4B139062 -Dtests.locale=en -Dtests.timezone=America/Whitehorse -Druntime.java=23
```

**Applicable branches:**
8.18

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.DataFrameAnalysisCustomFeatureIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testNGramCustomFeature),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""test_ngram_feature_processor"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":76},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":300,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739138413701,""peak_usage_bytes"":61771,""status"":""ok""},""analysis_stats"":{""regression_stats"":{""timestamp"":1739138413701,""iteration"":13,""hyperparameters"":{""alpha"":2.259835820886348,""downsample_factor"":0.43322615672193665,""eta"":0.447213595499958,""eta_growth_rate_per_tree"":1.3090216007901463,""feature_bag_fraction"":0.4183977132263613,""gamma"":1.4159248269651157,""lambda"":9.2566589231
[truncated]
```

**Issue Reasons:**
- [8.18] 2 failures in test testNGramCustomFeature (1.9% fail rate in 103 executions)
- [8.18] 2 failures in pipeline elasticsearch-periodic (50.0% fail rate in 4 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/122145,2025-02-09T22:30:38Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/122145,"{
  ""application_resource"": ""unsure""
}"
76,121928,[CI] ClassificationIT testSetUpgradeMode_ExistingTaskGetsUnassigned failing,"**Build Scans:**
- [elasticsearch-periodic #6352 / openjdk22_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/dl4xs2y5ijs54)
- [elasticsearch-periodic #6268 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/q64egmgg5wq2e)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testSetUpgradeMode_ExistingTaskGetsUnassigned"" -Dtests.seed=A35A8A9733CAE959 -Dtests.locale=ca-Latn-ES -Dtests.timezone=SystemV/AST4ADT -Druntime.java=22
```

**Applicable branches:**
8.18

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testSetUpgradeMode_ExistingTaskGetsUnassigned),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_set_upgrade_mode"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":71},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":300,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739340156643,""peak_usage_bytes"":71978,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1739340156643,""iteration"":12,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":5.518953485432152,""downsample_factor"":0.32708277408902786,""eta"":0.6213224928739096,""eta_growth_rate_per_tree"":1.2805202848210226,""feature_bag_fraction"":0.39
[truncated]
```

**Issue Reasons:**
- [8.18] 2 failures in test testSetUpgradeMode_ExistingTaskGetsUnassigned (0.5% fail rate in 443 executions)
- [8.18] 2 failures in pipeline elasticsearch-periodic (15.4% fail rate in 13 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121928,2025-02-06T17:20:56Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121928,"{
  ""application_resource"": ""unsure""
}"
77,121680,[CI] ClassificationIT testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsBoolean failing,"**Build Scans:**
- [elasticsearch-periodic #6325 / openjdk23_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/s44y6ifksubve)
- [elasticsearch-periodic #6311 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/4jg5mh673twku)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsBoolean"" -Dtests.seed=8E54129AB6EE94ED -Dtests.locale=sw-KE -Dtests.timezone=Europe/Samara -Druntime.java=23
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsBoolean),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_training_percent_is_50_boolean"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":86},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":150,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739225691908,""peak_usage_bytes"":19271,""status"":""ok""},""node"":{""id"":""_ytH0VUOS9uO4khegPTUyA"",""name"":""javaRestTest-1"",""ephemeral_id"":""OjCLUkyFQpSp59sEbQp5tw"",""transport_address"":""127.0.0.1:43773"",""attributes"":{""transform.config_version"":""10.0.0"",""testattr"":""test"",""ml.allocated_processors"":""32"",""ml.max_jvm_size"":""536870912"",""ml.config_version"":""12.0.0"",""ml.allocat
[truncated]
```

**Issue Reasons:**
- [8.17] 2 failures in test testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsBoolean (2.1% fail rate in 97 executions)
- [8.17] 2 failures in pipeline elasticsearch-periodic (50.0% fail rate in 4 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121680,2025-02-04T16:11:07Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121680,"{
  ""application_resource"": ""unsure""
}"
78,121651,Indexing Pressure should also account for the parsing memory,"### Description

Indexing pressure does not currently account for the extra heap memory required for parsing indexed documents, i.e. by the `index.mapper.SourceToParse` and `jackson.core.util.ReadConstrainedTextBuffer` classes. In the worst cases, the extra memory can be 1x and 2x, respectively, the memory of the indexed document (the memory that's accounted by the `IndexingPressure`).
In some cases this can OOM the node rather than reject the indexing request.",albertzaharovits,closed,"['>enhancement', ':Distributed Indexing/CRUD', 'Team:Distributed Indexing']",https://github.com/elastic/elasticsearch/issues/121651,2025-02-04T12:27:44Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121651,"{
  ""application_resource"": ""yes""
}"
79,121532,"[ML] ""Get deployment stats failed"" shown when ML is disabled","### Elasticsearch Version

8.17.0

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

All

### Problem Description

Logs show WARN related to ML errors when ML is disabled:
```
es01-1    | [14:27:20,222][WARN ][o.e.x.i.s.e.ElasticsearchInternalService] Get deployment stats failed, cannot update the endpoint's number of allocations
es01-1    | java.lang.IllegalStateException: failed to find action [cluster:internal/xpack/ml/trained_models/deployments/stats/get] to execute
es01-1    | 	at org.elasticsearch.client.internal.node.NodeClient.transportAction(NodeClient.java:135) ~[elasticsearch-8.17.0.jar:?]
es01-1    | 	at org.elasticsearch.client.internal.node.NodeClient.executeLocally(NodeClient.java:108) ~[elasticsearch-8.17.0.jar:?]
es01-1    | 	at org.elasticsearch.client.internal.node.NodeClient.doExecute(NodeClient.java:84) ~[elasticsearch-8.17.0.jar:?]
es01-1    | 	at org.elasticsearch.client.internal.support.AbstractClient.execute(AbstractClient.java:140) ~[elasticsearch-8.17.0.jar:?]
es01-1    | 	at org.elasticsearch.client.internal.FilterClient.doExecute(FilterClient.java:56) ~[elasticsearch-8.17.0.jar:?]
es01-1    | 	at org.elasticsearch.client.internal.OriginSettingClient.doExecute(OriginSettingClient.java:44) ~[elasticsearch-8.17.0.jar:?]
es01-1    | 	at org.elasticsearch.client.internal.support.AbstractClient.execute(AbstractClient.java:140) ~[elasticsearch-8.17.0.jar:?]
es01-1    | 	at org.elasticsearch.xpack.inference.services.elasticsearch.ElasticsearchInternalService.updateModelsWithDynamicFields(ElasticsearchInternalService.java:847) ~[?:?]
es01-1    | 	at org.elasticsearch.xpack.inference.action.TransportGetInferenceModelAction.parseModels(TransportGetInferenceModelAction.java:168) ~[?:?]
es01-1    | 	at org.elasticsearch.xpack.inference.action.TransportGetInferenceModelAction.lambda$getAllModels$2(TransportGetInferenceModelAction.java:120) ~[?:?]
es01-1    | 	at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:956) ~[elasticsearch-8.17.0.jar:?]
es01-1    | 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?]
es01-1    | 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?]
es01-1    | 	at java.lang.Thread.run(Thread.java:1575) ~[?:?]
```

### Steps to Reproduce

1. Launch docker container for 8.17.0
2. Call `_xpack/usage`

```
version: '2.2'
services:
  es01:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.17.0
    container_name: es01-1
    environment:
      - node.name=es01-1
      - cluster.name=es-docker-cluster
      - xpack.security.enabled=false
      - discovery.type=single-node
      - bootstrap.memory_lock=true
      - ""ES_JAVA_OPTS=-Xms512m -Xmx512m""
      - path.repo=/usr/share/elasticsearch/backup
      - xpack.ml.enabled=false
    ulimits:
      memlock:
        soft: -1
        hard: -1
    volumes:
      - data01:/usr/share/elasticsearch/data
    ports:
      - 9200:9200
      - 9300:9300
    networks:
      - elastic

volumes:
  data01:
    driver: local
  kibana-data01:
    driver: local

networks:
  elastic:
    driver: bridge
```

### Logs (if relevant)

_No response_",prwhelan,closed,"['>bug', ':ml', 'Team:ML', 'v8.17.0']",https://github.com/elastic/elasticsearch/issues/121532,2025-02-03T14:40:41Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121532,"{
  ""application_resource"": ""yes""
}"
80,121502,[CI] ClassificationIT testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsTextAndKeyword failing,"**Build Scans:**
- [elasticsearch-periodic #6354 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/fm4czxovqq43i)
- [elasticsearch-periodic #6249 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/2hhutxlqrfyfc)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsTextAndKeyword"" -Dtests.seed=1EA69F38DA4EE0D0 -Dtests.locale=vi -Dtests.timezone=Asia/Pontianak -Druntime.java=17
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsTextAndKeyword),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_training_percent_is_50_text_and_keyword"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":89},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":150,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739341465564,""peak_usage_bytes"":19083,""status"":""ok""},""node"":{""id"":""XGdfcRJVTV-veWv0qWOigw"",""name"":""javaRestTest-1"",""ephemeral_id"":""NXCBQKgrQPOlY0KfN7VTIw"",""transport_address"":""127.0.0.1:33783"",""attributes"":{""testattr"":""test"",""xpack.installed"":""true"",""transform.config_version"":""10.0.0"",""ml.config_version"":""12.0.0"",""ml.max_jvm_size"":""536870912"",""ml.allo
[truncated]
```

**Issue Reasons:**
- [8.x] 2 failures in test testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsTextAndKeyword (0.3% fail rate in 634 executions)
- [8.x] 2 failures in pipeline elasticsearch-periodic (12.5% fail rate in 16 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121502,2025-02-02T22:51:40Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121502,"{
  ""application_resource"": ""unsure""
}"
81,121492,[CI] ClassificationIT testDependentVariableIsAliasToKeyword failing,"**Build Scans:**
- [elasticsearch-periodic #6310 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/qv5qk2qcwjzbo)
- [elasticsearch-periodic #6310 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/7ldi7xgv7azau)
- [elasticsearch-periodic #6268 / openjdk23_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/7uwtjmilaqboy)
- [elasticsearch-periodic #6240 / openjdk21_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/hycnttlk6llte)
- [elasticsearch-periodic #6212 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/gmbzplcqgoluk)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testDependentVariableIsAliasToKeyword"" -Dtests.seed=409939CD09A7C51 -Dtests.locale=bg -Dtests.timezone=MET -Druntime.java=17 -Dtests.fips.enabled=true
```

**Applicable branches:**
8.18

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testDependentVariableIsAliasToKeyword),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""dependent_variable_is_alias"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":100},{""phase"":""final_training"",""progress_percent"":90},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":100,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739167154201,""peak_usage_bytes"":58190,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1739167154201,""iteration"":18,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":1.829270318865337,""downsample_factor"":0.7744532187423918,""eta"":0.1780331653111316,""eta_growth_rate_per_tree"":1.0989598839217238,""feature_bag_fraction"":0.27415
[truncated]
```

**Issue Reasons:**
- [8.18] 2 consecutive failures in test testDependentVariableIsAliasToKeyword
- [8.18] 5 failures in test testDependentVariableIsAliasToKeyword (0.9% fail rate in 572 executions)
- [8.18] 2 failures in step openjdk17_checkpart4_java-matrix (13.3% fail rate in 15 executions)
- [8.18] 4 failures in pipeline elasticsearch-periodic (26.7% fail rate in 15 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121492,2025-02-02T06:29:17Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121492,"{
  ""application_resource"": ""unsure""
}"
82,121479,[CI] ClassificationIT testSingleNumericFeatureAndMixedTrainingAndNonTrainingRows failing,"**Build Scans:**
- [elasticsearch-periodic #6323 / openjdk23_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/l3jmcdex74cm4)
- [elasticsearch-periodic #6232 / openjdk23_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/4wjmmudo2ylpm)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testSingleNumericFeatureAndMixedTrainingAndNonTrainingRows"" -Dtests.seed=9D456C168B688B05 -Dtests.locale=csw-Cans-CA -Dtests.timezone=America/Maceio -Druntime.java=23
```

**Applicable branches:**
9.0

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testSingleNumericFeatureAndMixedTrainingAndNonTrainingRows),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_single_numeric_feature_and_mixed_data_set"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":88},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":300,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739224185453,""peak_usage_bytes"":32329,""status"":""ok""},""node"":{""id"":""hKVzlDVjRlmK6zCBLDhtTA"",""name"":""javaRestTest-2"",""ephemeral_id"":""5ULWZ99HTf-1cfTXc5rjmg"",""transport_address"":""127.0.0.1:43911"",""attributes"":{""ml.allocated_processors_double"":""32.0"",""ml.max_jvm_size"":""536870912"",""ml.allocated_processors"":""32"",""testattr"":""test"",""transform.config_version
[truncated]
```

**Issue Reasons:**
- [9.0] 2 failures in test testSingleNumericFeatureAndMixedTrainingAndNonTrainingRows (0.5% fail rate in 420 executions)
- [9.0] 2 failures in step openjdk23_checkpart4_java-matrix (14.3% fail rate in 14 executions)
- [9.0] 2 failures in pipeline elasticsearch-periodic (14.3% fail rate in 14 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121479,2025-02-01T06:49:50Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121479,"{
  ""application_resource"": ""unsure""
}"
83,121473,[CI] ClassificationIT testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsInteger failing,"**Build Scans:**
- [elasticsearch-periodic #6276 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/xtgvybqx4qa6o)
- [elasticsearch-periodic #6178 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/7lyg3qi2b633i)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsInteger"" -Dtests.seed=E346077ED9E27ECD -Dtests.locale=et-Latn-EE -Dtests.timezone=Pacific/Fakaofo -Druntime.java=17 -Dtests.fips.enabled=true
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsInteger),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_training_percent_is_50_integer"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":89},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":150,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739023832439,""peak_usage_bytes"":19273,""status"":""ok""},""node"":{""id"":""-J8s7hx6SJm5cQzFb87UNA"",""name"":""javaRestTest-1"",""ephemeral_id"":""-mn9N3rIT9aBHmk7oKT11w"",""transport_address"":""127.0.0.1:45243"",""attributes"":{""ml.config_version"":""12.0.0"",""ml.max_jvm_size"":""536870912"",""ml.allocated_processors"":""32"",""ml.allocated_processors_double"":""32.0"",""ml.machine_memory"":""1266
[truncated]
```

**Issue Reasons:**
- [8.17] 2 failures in test testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsInteger (0.4% fail rate in 450 executions)
- [8.17] 2 failures in pipeline elasticsearch-periodic (13.3% fail rate in 15 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121473,2025-01-31T23:54:12Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121473,"{
  ""application_resource"": ""unsure""
}"
84,121465,[CI] HeapAttackIT testLookupExplosionBigStringManyMatches failing,"**Build Scans:**
- [elasticsearch-intake #17468 / part1](https://gradle-enterprise.elastic.co/s/terkg6hcnbvfe)
- [elasticsearch-intake #17439 / part1](https://gradle-enterprise.elastic.co/s/e4ki6d433mnbo)
- [elasticsearch-periodic-platform-support #6217 / rhel-7_platform-support-unix](https://gradle-enterprise.elastic.co/s/xfqq2w3cy7voq)
- [elasticsearch-intake #17394 / part1](https://gradle-enterprise.elastic.co/s/3as3rwbdux2ui)
- [elasticsearch-intake #17376 / part1](https://gradle-enterprise.elastic.co/s/65sawbbrentsq)
- [elasticsearch-periodic-platform-support #6189 / sles-12_platform-support-unix](https://gradle-enterprise.elastic.co/s/vm6m3ztodtnio)
- [elasticsearch-intake #17150 / part1](https://gradle-enterprise.elastic.co/s/hzqk7azo2d5om)
- [elasticsearch-periodic #6172 / openjdk23_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/wmkzerzmvgoxw)
- [elasticsearch-periodic-platform-support #6147 / amazonlinux-2_platform-support-aws](https://gradle-enterprise.elastic.co/s/2aafggjxifwpk)
- [elasticsearch-periodic-platform-support #6133 / amazonlinux-2_platform-support-aws](https://gradle-enterprise.elastic.co/s/oqzjmxvq3durw)

**Reproduction Line:**
```
./gradlew "":test:external-modules:test-esql-heap-attack:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.testLookupExplosionBigStringManyMatches"" -Dtests.seed=D59D0CC178364FFA -Dtests.locale=gl-Latn-ES -Dtests.timezone=Greenwich -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testLookupExplosionBigStringManyMatches),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
junit.framework.AssertionFailedError: Expected exception ResponseException but no exception was thrown
```

**Issue Reasons:**
- [8.x] 12 failures in test testLookupExplosionBigStringManyMatches (1.9% fail rate in 642 executions)
- [8.x] 5 failures in step part1 (6.2% fail rate in 81 executions)
- [8.x] 2 failures in step amazonlinux-2_platform-support-aws (12.5% fail rate in 16 executions)
- [8.x] 5 failures in pipeline elasticsearch-intake (6.2% fail rate in 81 executions)
- [8.x] 6 failures in pipeline elasticsearch-periodic-platform-support (37.5% fail rate in 16 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'low-risk']",https://github.com/elastic/elasticsearch/issues/121465,2025-01-31T22:18:18Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121465,"{
  ""application_resource"": ""unsure""
}"
85,121458,[CI] ClassificationIT testDependentVariableIsNested failing,"**Build Scans:**
- [elasticsearch-intake #17317 / part4](https://gradle-enterprise.elastic.co/s/iwumcliowoc5w)
- [elasticsearch-pull-request #54066 / part-4](https://gradle-enterprise.elastic.co/s/st3coups6d3gi)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testDependentVariableIsNested"" -Dtests.seed=36AD92812B8A985C -Dtests.locale=rm-CH -Dtests.timezone=Poland -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testDependentVariableIsNested),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""dependent_variable_is_nested"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":37},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":100,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1738769510070,""peak_usage_bytes"":52836,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1738769510070,""iteration"":6,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":19.85752161157305,""downsample_factor"":0.4253529339818778,""eta"":0.775495459781878,""eta_growth_rate_per_tree"":1.2720234564895039,""feature_bag_fraction"":0.14606548
[truncated]
```

**Issue Reasons:**
- [8.x] 2 failures in test testDependentVariableIsNested (0.3% fail rate in 735 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121458,2025-01-31T20:04:34Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121458,"{
  ""application_resource"": ""unsure""
}"
86,121433,[CI] ClassificationIT testStopAndRestart failing,"**Build Scans:**
- [elasticsearch-intake #16964 / part4](https://gradle-enterprise.elastic.co/s/xkvrjlba4x5qg)
- [elasticsearch-periodic #6093 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/z6qkovmjzzx5y)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsHundred"" -Dtests.seed=A2A9B3783A377B90 -Dtests.locale=ar-EH -Dtests.timezone=Africa/Bangui -Druntime.java=23
```

**Applicable branches:**
8.18

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testStopAndRestart),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_only_training_data_and_training_percent_is_100"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":89},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":300,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1738336556982,""peak_usage_bytes"":32286,""status"":""ok""},""node"":{""id"":""hVJN9h9eQBaTIy0WY8XhEA"",""name"":""javaRestTest-1"",""ephemeral_id"":""B-6n8PnfSIOKb3haCqKuPA"",""transport_address"":""127.0.0.1:37643"",""attributes"":{""ml.config_version"":""12.0.0"",""ml.machine_memory"":""126604193792"",""ml.allocated_processors_double"":""32.0"",""transform.config_version"":""10.0.0""
[truncated]
```

**Issue Reasons:**
- [8.18] 2 failures in test testStopAndRestart (1.9% fail rate in 104 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121433,2025-01-31T15:50:02Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121433,"{
  ""application_resource"": ""unsure""
}"
87,121415,[CI] ClassificationIT testDependentVariableIsAliasToNested failing,"**Build Scans:**
- [elasticsearch-periodic #6298 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/udn5jgocotola)
- [elasticsearch-periodic #6277 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/gvn4klqr3uzau)
- [elasticsearch-periodic #6256 / openjdk21_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/5r5eypj5r4y3c)
- [elasticsearch-periodic #6221 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/tg6ua7nqghboa)
- [elasticsearch-periodic #6172 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/qy5ya64ehfpo6)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testDependentVariableIsAliasToNested"" -Dtests.seed=2DBCF66B1E7A3A99 -Dtests.locale=dav-KE -Dtests.timezone=America/Indiana/Vincennes -Druntime.java=17 -Dtests.fips.enabled=true
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testDependentVariableIsAliasToNested),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""dependent_variable_is_alias_to_nested"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":65},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":100,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739110845648,""peak_usage_bytes"":54884,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1739110845648,""iteration"":11,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":2.220867926565293,""downsample_factor"":0.3260818684967902,""eta"":0.4147235408695942,""eta_growth_rate_per_tree"":1.2395805014605752,""feature_bag_fraction""
[truncated]
```

**Issue Reasons:**
- [8.x] 5 failures in test testDependentVariableIsAliasToNested (0.6% fail rate in 780 executions)
- [8.x] 3 failures in step openjdk17_checkpart4_java-matrix (16.7% fail rate in 18 executions)
- [8.x] 5 failures in pipeline elasticsearch-periodic (26.3% fail rate in 19 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121415,2025-01-31T15:02:02Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121415,"{
  ""application_resource"": ""unsure""
}"
88,121368,[CI] ClassificationIT testWithOnlyTrainingRowsAndTrainingPercentIsHundred failing,"**Build Scans:**
- [elasticsearch-periodic #6212 / openjdk17_checkpart4_java-fips-matrix](https://gradle-enterprise.elastic.co/s/dckwd5jyz5zsu)
- [elasticsearch-intake #16964 / part4](https://gradle-enterprise.elastic.co/s/xkvrjlba4x5qg)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsHundred"" -Dtests.seed=2FA15763BDAED97C -Dtests.locale=en-GI -Dtests.timezone=Asia/Thimbu -Druntime.java=17 -Dtests.fips.enabled=true
```

**Applicable branches:**
8.18

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithOnlyTrainingRowsAndTrainingPercentIsHundred),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_only_training_data_and_training_percent_is_100"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":59},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":300,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1738764125797,""peak_usage_bytes"":71582,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1738764125797,""iteration"":10,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":1.401285053187932,""downsample_factor"":0.27090819029319513,""eta"":0.7138966995260734,""eta_growth_rate_per_tree"":1.15544197513685
[truncated]
```

**Issue Reasons:**
- [8.18] 2 failures in test testWithOnlyTrainingRowsAndTrainingPercentIsHundred (0.5% fail rate in 426 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121368,2025-01-31T06:51:59Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121368,"{
  ""application_resource"": ""unsure""
}"
89,121236,[CI] ClassificationIT testWithDatastreams failing,"**Build Scans:**
- [elasticsearch-periodic #6311 / openjdk21_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/s26opisxqqkcm)
- [elasticsearch-periodic #6269 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/fupjbzcf3bi7g)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithDatastreams"" -Dtests.seed=C44759E89B85D865 -Dtests.locale=ff-Adlm-GW -Dtests.timezone=America/Guadeloupe -Druntime.java=21
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithDatastreams),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_with_datastreams"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":98},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":300,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1739167749478,""peak_usage_bytes"":70234,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1739167749478,""iteration"":17,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":2.253493216325616,""downsample_factor"":0.3876909661561454,""eta"":0.5557600605717856,""eta_growth_rate_per_tree"":1.3727348114128046,""feature_bag_fraction"":0.125
[truncated]
```

**Issue Reasons:**
- [8.17] 2 failures in test testWithDatastreams (1.1% fail rate in 190 executions)
- [8.17] 2 failures in pipeline elasticsearch-periodic (28.6% fail rate in 7 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/121236,2025-01-29T21:55:57Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121236,"{
  ""application_resource"": ""unsure""
}"
90,121168,[ML] Update model_size_stats as soon as an anomaly detection job is opened,"When we open a job, the memory tracker will reserve `model_memory_limit` bytes for this model on an ML node. However, this usage is not reflected in `model_size_stats` from `GET _ml/anomaly_detectors/_stats?filter_path=jobs.model_size_stats` until we start the datafeed and the job starts to produce the first results and report `model_memory_stats`. 

This means that between opening the job and starting the datafeed, the reported memory usage in `model_size_stats` is 0:
```json
{
    ""model_size_stats"": {
      ""job_id"": ""my-job-id"",
      ""result_type"": ""model_size_stats"",
      ""model_bytes"": 0,
      ""total_by_field_count"": 0,
      ""total_over_field_count"": 0,
      ""total_partition_field_count"": 0,
      ""bucket_allocation_failures_count"": 0,
      ""memory_status"": ""ok"",
      ""categorized_doc_count"": 0,
      ""total_category_count"": 0,
      ""frequent_category_count"": 0,
      ""rare_category_count"": 0,
      ""dead_category_count"": 0,
      ""failed_category_count"": 0,
      ""categorization_status"": ""ok"",
      ""log_time"": 1736525034132
    }
  }
``` 

The actually should be something like 
```json
{
    ""model_size_stats"": {
      ""job_id"": ""my-job-id"",
      ""result_type"": ""model_size_stats"",
      ""model_bytes"": 0,
      ""model_bytes_memory_limit"": 11534336,
      ""assignment_memory_basis"": ""model_memory_limit"",
      ""total_by_field_count"": 0,
      ""total_over_field_count"": 0,
      ""total_partition_field_count"": 0,
      ""bucket_allocation_failures_count"": 0,
      ""memory_status"": ""ok"",
      ""categorized_doc_count"": 0,
      ""total_category_count"": 0,
      ""frequent_category_count"": 0,
      ""rare_category_count"": 0,
      ""dead_category_count"": 0,
      ""failed_category_count"": 0,
      ""categorization_status"": ""ok"",
      ""log_time"": 1736525034132
    }
  }
```",valeriy42,closed,"['>bug', ':ml', 'Team:ML', 'priority:normal', 'v8.19.0', 'v9.1.0']",https://github.com/elastic/elasticsearch/issues/121168,2025-01-29T12:58:29Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121168,"{
  ""application_resource"": ""yes""
}"
91,121112,[CI] HeapAttackIT class failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #6050 / ubuntu-2404_platform-support-unix](https://gradle-enterprise.elastic.co/s/tpd2gfab673ci)
- [elasticsearch-periodic-platform-support #6040 / ubuntu-2204_platform-support-unix](https://gradle-enterprise.elastic.co/s/6e7k4rczse3js)
- [elasticsearch-periodic-platform-support #6040 / ubuntu-2004_platform-support-unix](https://gradle-enterprise.elastic.co/s/hh4wkcydgb7am)
- [elasticsearch-periodic-platform-support #6030 / ubuntu-1804_platform-support-unix](https://gradle-enterprise.elastic.co/s/7eu2x23jzzrpg)
- [elasticsearch-periodic #6041 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/ur47jya6bqzfk)
- [elasticsearch-periodic-platform-support #6020 / rocky-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/55n2hs3thepsm)
- [elasticsearch-periodic-platform-support #6005 / ubuntu-2004_platform-support-unix](https://gradle-enterprise.elastic.co/s/kpmg7xntab5ao)
- [elasticsearch-periodic #6011 / concurrent-search-tests](https://gradle-enterprise.elastic.co/s/v4rbf74vad5mu)
- [elasticsearch-periodic #6011 / encryption-at-rest](https://gradle-enterprise.elastic.co/s/lrg4h6rvvqwpk)
- [elasticsearch-periodic-platform-support #5995 / opensuse-leap-15_platform-support-unix](https://gradle-enterprise.elastic.co/s/ikcle4ajizhb2)

**Reproduction Line:**
```
./gradlew "":test:external-modules:test-esql-heap-attack:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.testHugeManyConcatFromRow"" -Dtests.seed=AB4E7BF992F01785 -Dtests.locale=ml-IN -Dtests.timezone=America/Nassau -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
junit.framework.AssertionFailedError: Unexpected exception type, expected ResponseException but got java.net.ConnectException: Connection refused
```

**Issue Reasons:**
- [8.x] 10 failures in class org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT (1.9% fail rate in 521 executions)
- [8.x] 2 failures in step ubuntu-2004_platform-support-unix (18.2% fail rate in 11 executions)
- [8.x] 6 failures in pipeline elasticsearch-periodic-platform-support (50.0% fail rate in 12 executions)
- [8.x] 2 failures in pipeline elasticsearch-periodic (18.2% fail rate in 11 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/121112,2025-01-28T22:47:26Z,10,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/121112,"{
  ""application_resource"": ""unsure""
}"
92,120832,[CI] StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT testEsqlSource failing,"**Build Scans:**
- [elasticsearch-periodic #6006 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/xapky6jgfbiuk)
- [elasticsearch-periodic-platform-support #5995 / debian-11_platform-support-unix](https://gradle-enterprise.elastic.co/s/bhvnur7ck33na)
- [elasticsearch-periodic-platform-support #5995 / ubuntu-2204_platform-support-unix](https://gradle-enterprise.elastic.co/s/bnlrax3m32txg)
- [elasticsearch-periodic-platform-support #5995 / amazonlinux-2_platform-support-aws](https://gradle-enterprise.elastic.co/s/qzzbrkj3jhmt4)
- [elasticsearch-periodic #6006 / openjdk23_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/psmmt5yugkoqu)
- [elasticsearch-periodic #6006 / graalvm-ce17_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/w7srxwvz2vjdq)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT.testEsqlSource"" -Dtests.seed=6C57DD0486AE54B5 -Dtests.locale=nmg -Dtests.timezone=America/Mexico_City -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StoredSourceLogsDbVersusReindexedLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testEsqlSource),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [0]. Source documents don't match for field [yjOTNlEeY.MdaxkeBZK.RNUrtXs]: Error [Lists do not match when ignoring sort order, actual: [1.0, 0.5572748, 0.27104914, 0.13549805, 0.101490855, 0.24916041, 0.8397343, 0.84317076, 0.32944965, 0.8132014], expected: [0.5572748, 0.27104914, 0.13552392, 0.101490855, 0.24916041, 0.9998697, 0.8397343, 0.84317076, 0.32944965, 0.8132014]] actual mappings [{""_doc"":{""properties"":{""AcX"":{""doc_values"":true,""index"":false,""scaling_factor"":100.5,""store"":false,""type"":""scaled_float""},""VKIboihC"":{""doc_values"":false,""index"":true,""store"":true,""synthetic_source_keep"":""none"",""type"":""unsigned_long""},""ZwiGr"":{""doc_values"":false,""index"":true,""store"":true,""synthetic_source_keep"":""all"",""type"":""long""},""host.name"":{""type"":""keyword""},""ib"":{""doc_values"":false,""index"":true,""store"":true,""type"":""half_float""},""kUTreamGb"":{""doc_values"":true,""index"":false,""store"":false,""type"":""integer""},""memory_usage_bytes"":{""type"":
[truncated]
```

**Issue Reasons:**
- [8.x] 6 failures in test testEsqlSource (3.4% fail rate in 177 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/120832,2025-01-24T19:29:15Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/120832,"{
  ""application_resource"": ""unsure""
}"
93,120831,[CI] StandardVersusLogsIndexModeRandomDataChallengeRestIT testEsqlSource failing,"**Build Scans:**
- [elasticsearch-periodic #6006 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/xapky6jgfbiuk)
- [elasticsearch-periodic-platform-support #5995 / debian-11_platform-support-unix](https://gradle-enterprise.elastic.co/s/bhvnur7ck33na)
- [elasticsearch-periodic-platform-support #5995 / ubuntu-2204_platform-support-unix](https://gradle-enterprise.elastic.co/s/bnlrax3m32txg)
- [elasticsearch-periodic-platform-support #5995 / amazonlinux-2_platform-support-aws](https://gradle-enterprise.elastic.co/s/qzzbrkj3jhmt4)
- [elasticsearch-periodic #6006 / openjdk23_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/psmmt5yugkoqu)
- [elasticsearch-periodic #6006 / graalvm-ce17_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/w7srxwvz2vjdq)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StandardVersusLogsIndexModeRandomDataChallengeRestIT.testEsqlSource"" -Dtests.seed=6C57DD0486AE54B5 -Dtests.locale=en-PK -Dtests.timezone=Etc/GMT -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StandardVersusLogsIndexModeRandomDataChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testEsqlSource),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [0]. Source documents don't match for field [yjOTNlEeY.MdaxkeBZK.RNUrtXs]: Error [Lists do not match when ignoring sort order, actual: [1.0, 0.5572748, 0.27104914, 0.13549805, 0.101490855, 0.24916041, 0.8397343, 0.84317076, 0.32944965, 0.8132014], expected: [0.5572748, 0.27104914, 0.13552392, 0.101490855, 0.24916041, 0.9998697, 0.8397343, 0.84317076, 0.32944965, 0.8132014]] actual mappings [{""_doc"":{""properties"":{""AcX"":{""doc_values"":true,""index"":false,""scaling_factor"":100.5,""store"":false,""type"":""scaled_float""},""VKIboihC"":{""doc_values"":false,""index"":true,""store"":true,""synthetic_source_keep"":""none"",""type"":""unsigned_long""},""ZwiGr"":{""doc_values"":false,""index"":true,""store"":true,""synthetic_source_keep"":""all"",""type"":""long""},""host.name"":{""type"":""keyword""},""ib"":{""doc_values"":false,""index"":true,""store"":true,""type"":""half_float""},""kUTreamGb"":{""doc_values"":true,""index"":false,""store"":false,""type"":""integer""},""memory_usage_bytes"":{""type"":
[truncated]
```

**Issue Reasons:**
- [8.x] 6 failures in test testEsqlSource (3.4% fail rate in 177 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'medium-risk', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/120831,2025-01-24T19:28:54Z,9,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/120831,"{
  ""application_resource"": ""unsure""
}"
94,120830,[CI] StandardVersusStandardReindexedIntoLogsDbChallengeRestIT testEsqlSource failing,"**Build Scans:**
- [elasticsearch-periodic #6006 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/xapky6jgfbiuk)
- [elasticsearch-periodic-platform-support #5995 / debian-11_platform-support-unix](https://gradle-enterprise.elastic.co/s/bhvnur7ck33na)
- [elasticsearch-periodic-platform-support #5995 / ubuntu-2204_platform-support-unix](https://gradle-enterprise.elastic.co/s/bnlrax3m32txg)
- [elasticsearch-periodic-platform-support #5995 / amazonlinux-2_platform-support-aws](https://gradle-enterprise.elastic.co/s/qzzbrkj3jhmt4)
- [elasticsearch-periodic #6006 / openjdk23_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/psmmt5yugkoqu)
- [elasticsearch-periodic #6006 / graalvm-ce17_checkpart2_java-matrix](https://gradle-enterprise.elastic.co/s/w7srxwvz2vjdq)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StandardVersusStandardReindexedIntoLogsDbChallengeRestIT.testEsqlSource"" -Dtests.seed=6C57DD0486AE54B5 -Dtests.locale=fo -Dtests.timezone=Africa/Bujumbura -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StandardVersusStandardReindexedIntoLogsDbChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testEsqlSource),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [0]. Source documents don't match for field [yjOTNlEeY.MdaxkeBZK.RNUrtXs]: Error [Lists do not match when ignoring sort order, actual: [1.0, 0.5572748, 0.27104914, 0.13549805, 0.101490855, 0.24916041, 0.8397343, 0.84317076, 0.32944965, 0.8132014], expected: [0.5572748, 0.27104914, 0.13552392, 0.101490855, 0.24916041, 0.9998697, 0.8397343, 0.84317076, 0.32944965, 0.8132014]] actual mappings [{""_doc"":{""properties"":{""AcX"":{""doc_values"":true,""index"":false,""scaling_factor"":100.5,""store"":false,""type"":""scaled_float""},""VKIboihC"":{""doc_values"":false,""index"":true,""store"":true,""synthetic_source_keep"":""none"",""type"":""unsigned_long""},""ZwiGr"":{""doc_values"":false,""index"":true,""store"":true,""synthetic_source_keep"":""all"",""type"":""long""},""host.name"":{""type"":""keyword""},""ib"":{""doc_values"":false,""index"":true,""store"":true,""type"":""half_float""},""kUTreamGb"":{""doc_values"":true,""index"":false,""store"":false,""type"":""integer""},""memory_usage_bytes"":{""type"":
[truncated]
```

**Issue Reasons:**
- [8.x] 6 failures in test testEsqlSource (3.4% fail rate in 177 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/120830,2025-01-24T19:28:31Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/120830,"{
  ""application_resource"": ""unsure""
}"
95,120499,max size virtual memory [-1] for user [1001030000] is too low,"### Elasticsearch Version

8.15.5

### Installed Plugins

_No response_

### Java Version

java --version openjdk 21.0.5 2024-10-15 LTS OpenJDK Runtime Environment (Red_Hat-21.0.5.0.11-1) (build 21.0.5+11-LTS) OpenJDK 64-Bit Server VM (Red_Hat-21.0.5.0.11-1) (build 21.0.5+11-LTS, mixed mode, sharing)

### OS Version

ubi9 container s390x (OpenShift)

### Problem Description

We built a s390x version with the patches from IBM:

https://github.com/linux-on-ibm-z/scripts/tree/master/Elasticsearch/8.15.2 

fixed issue:

https://github.com/elastic/elasticsearch/issues/113705

will not working for us.

### Steps to Reproduce

When start the Node in single node, evertyhing is fine. When we listening on 0.0.0.0 the checks will be failed. 

### Logs (if relevant)

[2025-01-20T09:36:37,160][INFO ][o.e.t.TransportService   ] [elasticsearch-0] publish_address {192.168.8.176:9300}, bound_addresses {[::]:9300}
[2025-01-20T09:36:37,255][INFO ][o.e.b.BootstrapChecks    ] [elasticsearch-0] bound or publishing to a non-loopback address, enforcing bootstrap checks
[2025-01-20T09:36:37,256][WARN ][o.e.n.NativeAccess       ] [elasticsearch-0] Cannot get process limits because native access is not available
[2025-01-20T09:36:37,257][WARN ][o.e.n.NativeAccess       ] [elasticsearch-0] Cannot get process limits because native access is not available
[2025-01-20T09:36:37,257][WARN ][o.e.n.NativeAccess       ] [elasticsearch-0] Cannot get process limits because native access is not available
[2025-01-20T09:36:37,257][WARN ][o.e.n.NativeAccess       ] [elasticsearch-0] Cannot get process limits because native access is not available
[2025-01-20T09:36:37,257][WARN ][o.e.n.NativeAccess       ] [elasticsearch-0] Cannot get process limits because native access is not available
[2025-01-20T09:36:37,257][WARN ][o.e.n.NativeAccess       ] [elasticsearch-0] Cannot get process limits because native access is not available
[2025-01-20T09:36:37,261][ERROR][o.e.b.Elasticsearch      ] [elasticsearch-0] node validation exception
[2] bootstrap checks failed. You must address the points described in the following [2] lines before starting Elasticsearch. For more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/bootstrap-checks.html]
bootstrap check failure [1] of [2]: max size virtual memory [-1] for user [1001030000] is too low, increase to [unlimited]; for more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/max-size-virtual-memory-check.html]
bootstrap check failure [2] of [2]: max file size [-1] for user [1001030000] is too low, increase to [unlimited]; for more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/_max_file_size_check.html]
ERROR: Elasticsearch did not exit normally - check the logs at /usr/share/elasticsearch/logs/elasticsearch-cluster.log
[2025-01-20T09:36:37,268][INFO ][o.e.n.Node               ] [elasticsearch-0] stopping ...
[2025-01-20T09:36:37,283][INFO ][o.e.n.Node               ] [elasticsearch-0] stopped
[2025-01-20T09:36:37,283][INFO ][o.e.n.Node               ] [elasticsearch-0] closing ...
[2025-01-20T09:36:37,336][INFO ][o.e.n.Node               ] [elasticsearch-0] closed",zausel23,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/120499,2025-01-21T08:57:25Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/120499,"{
  ""application_resource"": ""yes""
}"
96,120433,[CI] HeapAttackIT testAggTooManyMvLongs failing,"**Build Scans:**
- [elasticsearch-periodic #6061 / single-processor-node-tests](https://gradle-enterprise.elastic.co/s/lvoekzt2d37y2)
- [elasticsearch-periodic-platform-support #6050 / ubuntu-2404_platform-support-unix](https://gradle-enterprise.elastic.co/s/tpd2gfab673ci)
- [elasticsearch-periodic-platform-support #6040 / ubuntu-2004_platform-support-unix](https://gradle-enterprise.elastic.co/s/hh4wkcydgb7am)
- [elasticsearch-periodic-platform-support #6030 / ubuntu-1804_platform-support-unix](https://gradle-enterprise.elastic.co/s/7eu2x23jzzrpg)

**Reproduction Line:**
```
./gradlew "":test:external-modules:test-esql-heap-attack:javaRestTest"" --tests ""org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.testAggTooManyMvLongs"" -Dtests.seed=864E912505774F34 -Dtests.configure_test_clusters_with_one_processor=true -Dtests.locale=kw-GB -Dtests.timezone=Asia/Barnaul -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testAggTooManyMvLongs),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.Exception: Test abandoned because suite timeout was reached.
```

**Issue Reasons:**
- [8.x] 4 failures in test testAggTooManyMvLongs (1.4% fail rate in 294 executions)
- [8.x] 3 failures in pipeline elasticsearch-periodic-platform-support (60.0% fail rate in 5 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/120433,2025-01-18T06:58:05Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/120433,"{
  ""application_resource"": ""unsure""
}"
97,120432,[CI] StandardVersusLogsStoredSourceChallengeRestIT.testMatchAllQuery failing with OOME,"**Build Scans:**
- [elasticsearch-periodic #5899 / openjdk17_checkpart2_java-fips-matrix](https://gradle-enterprise.elastic.co/s/x7rp3jrgoaava)
- [elasticsearch-periodic #5859 / openjdk17_checkpart2_java-fips-matrix](https://gradle-enterprise.elastic.co/s/yqyaalckgmg7o)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StandardVersusLogsStoredSourceChallengeRestIT.testHistogramAggregation"" -Dtests.seed=4CAA7452D418406E -Dtests.locale=ff-Latn-SN -Dtests.timezone=Africa/Malabo -Druntime.java=17 -Dtests.fips.enabled=true
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StandardVersusLogsStoredSourceChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StandardVersusLogsStoredSourceChallengeRestIT),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.RuntimeException: Request execution cancelled
```

**Issue Reasons:**
- [8.17] 2 failures in class org.elasticsearch.xpack.logsdb.qa.StandardVersusLogsStoredSourceChallengeRestIT (0.8% fail rate in 244 executions)
- [8.17] 2 failures in step openjdk17_checkpart2_java-fips-matrix (22.2% fail rate in 9 executions)
- [8.17] 2 failures in pipeline elasticsearch-periodic (22.2% fail rate in 9 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Logs', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/120432,2025-01-18T06:01:39Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/120432,"{
  ""application_resource"": ""unsure""
}"
98,120176,Elasticsearch 8.17.0 failing to start in minikube with older manifests (used to work with 7.12.1),"### Elasticsearch Version

8.17.0

### Installed Plugins

kibana, istio

### Java Version

_bundled_

### OS Version

Darwin GGN-MAC-10089 24.2.0 Darwin Kernel Version 24.2.0: Fri Dec  6 18:41:43 PST 2024; root:xnu-11215.61.5~2/RELEASE_X86_64 x86_64

### Problem Description

I am using my existing manifests file (mentioned below) to deploy `elasticsearch` (along with `kibana`) new version `8.17.0` into my local minikube instance (which has `istio v1.24.2` deployed in it too). These manifests used to work perfectly with versions `7.12.1` of both `elasticsearch` and `kibana`. 

When the new docker image is used,`kibana` is up and running just fine (with response `200` for the command `curl https://kibana.minikube.me -kLs -o /dev/null -w ""%{http_code}\n""`).

But when I run the commad `curl https://elasticsearch.minikube.me -sk`, `elasticsearch` just responds with the following error:
```
upstream connect error or disconnect/reset before headers. retried and the latest reset reason: remote connection failure, transport failure reason: delayed connect error: Connection refused
```
_(Earlier, with `v 7.12.1`, a proper JSON response containing the tagline 'You know, for sure' was being sent)_

Here are the manifests that I am using (nothing else has changed apart from the image for `elasticsearch`):
```
apiVersion: apps/v1
kind: Deployment
metadata:
    name: elasticsearch

spec:
    selector:
        matchLabels:
            component: elasticsearch
    template:
        metadata:
            labels:
                component: elasticsearch
        spec:
            containers:
                - name: elasticsearch
                  image: docker.elastic.co/elasticsearch/elasticsearch:8.17.0 # earlier this was 7.12.1
                  env:
                      - name: discovery.type
                        value: single-node
                  ports:
                      - containerPort: 9200
                        name: http
                        protocol: TCP
                  resources:
                      limits:
                          cpu: 500m
                          memory: 1Gi
                      requests:
                          cpu: 500m
                          memory: 1Gi

---
apiVersion: v1
kind: Service
metadata:
    name: elasticsearch
    labels:
        service: elasticsearch

spec:
    type: ClusterIP
    selector:
        component: elasticsearch
    ports:
        - port: 9200
          targetPort: 9200

---
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
    name: elasticsearch-gateway
    namespace: logging

spec:
    selector:
        istio: ingressgateway
    servers:
        - hosts:
              - ""elasticsearch.minikube.me""
          port:
              number: 443
              name: https-elasticsearch
              protocol: HTTPS
          tls:
              mode: SIMPLE
              credentialName: my-certificate

---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
    name: elasticsearch-vs
    namespace: logging

spec:
    hosts:
        - ""elasticsearch.minikube.me""
    gateways:
        - elasticsearch-gateway
    http:
        - route:
              - destination:
                    host: elasticsearch
                    port:
                        number: 9200

---
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
    name: elasticsearch
    namespace: logging

spec:
    host: elasticsearch
    trafficPolicy:
        tls:
            mode: DISABLE
```

### Steps to Reproduce

Mentioned above in the problem description

### Logs (if relevant)

_No response_",dangerouspython,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/120176,2025-01-15T08:18:58Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/120176,"{
  ""application_resource"": ""no""
}"
99,120071,[CI] ClassificationIT testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsKeyword failing,"**Build Scans:**
- [elasticsearch-periodic #6068 / openjdk23_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/uw2y3crav7eva)
- [elasticsearch-pull-request #53649 / part-4](https://gradle-enterprise.elastic.co/s/jtjjgflxlya54)
- [elasticsearch-pull-request #52861 / part-4](https://gradle-enterprise.elastic.co/s/tcrx66xjwt7mm)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsKeyword"" -Dtests.seed=DFFCAD7EBFDCC68B -Dtests.locale=pis-Latn-SB -Dtests.timezone=Pacific/Ponape -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsKeyword),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_training_percent_is_50_keyword"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":84},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":150,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1738157265776,""peak_usage_bytes"":19080,""status"":""ok""},""node"":{""id"":""DC5ygAvfTtm6RgbgLCL2rQ"",""name"":""javaRestTest-1"",""ephemeral_id"":""QTExINPyQvmsXQNG-DNkmw"",""transport_address"":""127.0.0.1:35695"",""attributes"":{""ml.machine_memory"":""126604201984"",""testattr"":""test"",""xpack.installed"":""true"",""transform.config_version"":""10.0.0"",""ml.allocated_processors"":""32"",""ml.alloca
[truncated]
```

**Issue Reasons:**
- [main] 3 failures in test testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsKeyword (0.6% fail rate in 521 executions)
- [main] 2 failures in step part-4 (0.8% fail rate in 258 executions)
- [main] 2 failures in pipeline elasticsearch-pull-request (0.8% fail rate in 258 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/120071,2025-01-13T17:31:54Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/120071,"{
  ""application_resource"": ""unsure""
}"
100,120021,Enrich cache default can usage a ton of memory,"### Elasticsearch Version

8.16+

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

any

### Problem Description

In 8.16 we changed the default for `enrich.cache_size` from `1000` to `1%` which should allow us to more carefully cache. The trouble is that we don't account for a few things in the cache's weight:

1. The cache key. I'm seeing those in the 600 bytes size.
2. Empty results. 
3. Results use their serialized size but are then stored as `Map<String, Object>` which is usually much larger.
4. It sure *looks* like there isn't any intrinsic cost to a cache entry. Like, for the entry itself.

When you combine the first two, queries pointing to no documents in the enrich index cost 0 bytes. So, no matter the limit you configure, you *can* fill up memory with them.

But, yeah, I *think* we should include the size of the cache key. And Include an estimate of the cost of the List we store in the cache - even if it's empty. And, finally, I think we should uplift the cost of the exploded map. Or we should cache the serialized copy. I'm not entirely sure if it's worth a cost for the cache entry itself. That bit I don't know.

### Steps to Reproduce

See above.

### Logs (if relevant)

@nik9000 has a heap dump of a node the OOMed full of cache entries of empty results lists.",nik9000,closed,"['>bug', ':Data Management/Ingest Node', 'Team:Data Management', 'v8.16.0', 'v8.17.0']",https://github.com/elastic/elasticsearch/issues/120021,2025-01-12T12:17:53Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/120021,"{
  ""application_resource"": ""yes""
}"
101,119756,ESQL: isNotNullAndFoldable should not perform a fold,"This [helper method](https://github.com/elastic/elasticsearch/blob/12eb1cfda1e42f60945caea6b639b8dda47b8ed5/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/expression/TypeResolutions.java#L136) is used in type checks/resolutions and checks whether a value is not null.

This check really shouldn't happen at the time when we perform type resolutions - type resolutions shouldn't depend on individual values. 

More importantly, folding values can be expensive - we should only perform this in the `ConstantFolding` and `FoldNulls` steps of the logical optimizer.

We may be able to use the `Validatable` (update: now `PostOptimizationVerificationAware`) interface to perform the null-check after the logical optimizer step, when all foldables can be assumed to be already folded.

This is currently used in `Top`, `FullTextFunction` and `Match`.",alex-spies,closed,"['>bug', 'Team:Analytics', '>tech debt', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/119756,2025-01-08T13:23:00Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/119756,"{
  ""application_resource"": ""no""
}"
102,119333,Excessive CPU Usage During HNSW Merging Causes Data Node Eviction,"### Elasticsearch Version

8.13.4

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

aarch64 aarch64 aarch64 GNU/Linux

### Problem Description

In a Kubernetes environment with four data nodes, each configured with **14 cores and 26 GiB of memory**, consider the following scenario:

While indexing into Index A, the index.merge.scheduler.max_thread_count is set to its default value, and the embeddingVectorField is configured with m: 32 and ef_construction: 2000. The index has number_of_primary: 1 and number_of_replicas: 0. Once indexing is completed, the number of replicas is increased to 3.

During this process, as Luceneâ€™s ConcurrentMergeScheduler begins merging segments, the kNN vector merges trigger significant CPU load. This is because the merging process involves reprocessing indexed documents and performing computationally intensive tasks such as graph construction. As a result, all available threads become overloaded. This excessive resource consumption prevents the data nodes from processing cluster state updates sent by the master node, ultimately leading to the eviction of the affected data nodes from the cluster.



This issue poses a significant challenge to maintaining a stable cluster, as the IO load generated by segment merging during this process can disrupt the clusterâ€™s ability to serve search traffic reliably.

### Steps to Reproduce

1.	**Create an index with the following settings and mappings**
```
PUT test_doc
{
  ""settings"": {
    ""number_of_shards"": 1,
    ""number_of_replicas"": 0
  },
  ""mappings"": {
    ""properties"": {
      ""embeddingVector"": {
          ""type"": ""dense_vector"",
          ""dims"": 64,
          ""element_type"": ""float"",
          ""index"": true,
          ""similarity"": ""max_inner_product"",
          ""index_options"": {
            ""type"": ""hnsw"",
            ""m"": 32,
            ""ef_construction"": 1000
          }
       }
    }
  }
}
```

2. **Index Documents**
- Index 500,000 documents with embeddingVectorField values.

3. **Trigger replica creation**
- After completing the indexing, update the index settings to set number_of_replicas to 3
```
PUT test_doc/_settings
{
  ""index"": {
    ""number_of_replicas"": ""3""
  }
}
```

4. **Observe the behavior**
- Monitor the cluster during the replica creation process.
- Note if data nodes experience high CPU usage, fail to process cluster state updates, and are evicted from the cluster
  - can see elasticsearch log with `logger.org.elasticsearch.cluster : ""DEBUG""`
- Monitor Hot Threads named by Lucene Merge Thread

### Logs (if relevant)

**Attach related logs & metrics**

```
- Indexing Start Time : 15:55
- Indexing End Time : 16:04 
- Replica Creation Time: 16:04
```

- Data Node Cpu Usages (Red dot means 100%)
<img width=""1184"" alt=""Image"" src=""https://github.com/user-attachments/assets/6593ce8e-d630-408c-be03-18ba77493f78"" />

- Hot Threads Log
```
100.2% [cpu=100.2%, other=0.0%] (500.8ms out of 500ms) cpu usage by thread 'elasticsearch[xxx-3][[xxx][0]: Lucene Merge Thread #869]'
  10/10 snapshots sharing following 32 elements
    java.base@21.0.2/sun.nio.ch.UnixFileDispatcherImpl.pread0(Native Method)
    java.base@21.0.2/sun.nio.ch.UnixFileDispatcherImpl.pread(UnixFileDispatcherImpl.java:57)
    java.base@21.0.2/sun.nio.ch.IOUtil.readIntoNativeBuffer(IOUtil.java:338)
    java.base@21.0.2/sun.nio.ch.IOUtil.read(IOUtil.java:306)
    java.base@21.0.2/sun.nio.ch.IOUtil.read(IOUtil.java:283)
    java.base@21.0.2/sun.nio.ch.FileChannelImpl.readInternal(FileChannelImpl.java:984)
    java.base@21.0.2/sun.nio.ch.FileChannelImpl.read(FileChannelImpl.java:967)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.store.NIOFSDirectory$NIOFSIndexInput.readInternal(NIOFSDirectory.java:182)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.store.BufferedIndexInput.refill(BufferedIndexInput.java:356)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.store.BufferedIndexInput.readFloats(BufferedIndexInput.java:246)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.codecs.lucene95.OffHeapFloatVectorValues.vectorValue(OffHeapFloatVectorValues.java:65)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.codecs.lucene95.OffHeapFloatVectorValues$DenseOffHeapVectorValues.vectorValue(OffHeapFloatVectorValues.java:95)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.util.hnsw.RandomVectorScorerSupplier$FloatScoringSupplier$1.score(RandomVectorScorerSupplier.java:125)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.util.hnsw.HnswGraphSearcher.searchLevel(HnswGraphSearcher.java:237)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.util.hnsw.HnswGraphBuilder.addGraphNode(HnswGraphBuilder.java:247)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.util.hnsw.HnswGraphBuilder.addVectors(HnswGraphBuilder.java:179)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.util.hnsw.HnswGraphBuilder.addVectors(HnswGraphBuilder.java:187)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.util.hnsw.HnswGraphBuilder.build(HnswGraphBuilder.java:158)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.util.hnsw.IncrementalHnswGraphMerger.merge(IncrementalHnswGraphMerger.java:147)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.codecs.lucene99.Lucene99HnswVectorsWriter.mergeOneField(Lucene99HnswVectorsWriter.java:373)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.codecs.perfield.PerFieldKnnVectorsFormat$FieldsWriter.mergeOneField(PerFieldKnnVectorsFormat.java:122)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.codecs.KnnVectorsWriter.merge(KnnVectorsWriter.java:98)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.index.SegmentMerger.mergeVectorValues(SegmentMerger.java:255)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.index.SegmentMerger$$Lambda/0x0000005802813f88.merge(Unknown Source)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.index.SegmentMerger.mergeWithLogging(SegmentMerger.java:298)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:149)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5252)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4740)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.index.IndexWriter$IndexWriterMergeSource.merge(IndexWriter.java:6541)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:639)
    app/org.elasticsearch.server@8.13.4/org.elasticsearch.index.engine.ElasticsearchConcurrentMergeScheduler.doMerge(ElasticsearchConcurrentMergeScheduler.java:118)
    app/org.apache.lucene.core@9.10.0/org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:700)
```

- Master Node Kicked Data Node reason by lagging
```
node [{xxx-3}{xxx}{xxx}{xxx-3}{xxx}{xxx:9300}{dr}{8.13.4}{xxx}{xpack.installed=true, k8s_node_name=xxx, transform.config_version=10.0.0, ml.config_version=12.0.0, zone=ap-northeast-2a}] is lagging at cluster state version [46261], although publication of cluster state version [46262] completed [1.5m] ago
node [{xxx-1}{xxx}{xxx}{xxx-1}{xxx}{xxx:9300}{dr}{8.13.4}{xxx}{k8s_node_name=xxx, xpack.installed=true, transform.config_version=10.0.0, ml.config_version=12.0.0, zone=ap-northeast-2c}] is lagging at cluster state version [46261], although publication of cluster state version [46262] completed [1.5m] ago
node [{xxx-2}{xxx}{xxx}{xxx-2}{xxx}{xxx:9300}{dr}{8.13.4}{xxx}{xpack.installed=true, k8s_node_name=xxx, transform.config_version=10.0.0, ml.config_version=12.0.0, zone=ap-northeast-2a}] is lagging at cluster state version [46261], although publication of cluster state version [46262] completed [1.5m] ago

node-left[{xxx-1}{xxx}{xxx}{xxx-1}{xxx}{xxx:9300}{dr}{8.13.4}{xxx} reason: lagging, {xxx-2}{xxx}{xxx}{xxx-2}{xxx}{xxx:9300}{dr}{8.13.4}{xxx} reason: lagging], term: 12, version: 46264, delta: removed {{xxx-1}{xxx}{xxx}{xxx-1}{xxx}{xxx:9300}{dr}{8.13.4}{xxx}, {xxx-2}{xxx}{xxx}{xxx-2}{xxx}{xxx:9300}{dr}{8.13.4}{xxx}}
node-left[{xxx-3}{xxx}{xxx}{xxx-3}{xxx}{xxx:9300}{dr}{8.13.4}{xxx} reason: lagging], term: 12, version: 46263, delta: removed {{xxx-3}{xxx}{xxx}{xxx-3}{xxx}{xxx:9300}{dr}{8.13.4}{xxx}}
```

",Hoyaspark,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/119333,2024-12-28T16:47:10Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/119333,"{
  ""application_resource"": ""yes""
}"
103,119259,[CI] FullClusterRestartIT testWatcher {cluster=UPGRADED} failing,"**Build Scans:**
- [elasticsearch-periodic #5755 / 7.1.1_bwc](https://gradle-enterprise.elastic.co/s/ymhwm7mwcow2e)
- [elasticsearch-pull-request #49316 / 7.4.2_bwc](https://gradle-enterprise.elastic.co/s/nb4ovs34lnfdo)
- [elasticsearch-periodic #5735 / 7.4.2_bwc](https://gradle-enterprise.elastic.co/s/jknjjch3ipvua)
- [elasticsearch-periodic #5735 / 7.1.1_bwc](https://gradle-enterprise.elastic.co/s/szeh2teecea5e)
- [elasticsearch-periodic #5727 / 7.1.1_bwc](https://gradle-enterprise.elastic.co/s/5lrowlagahnhw)
- [elasticsearch-periodic #5727 / 7.4.2_bwc](https://gradle-enterprise.elastic.co/s/cxskf42wnn3vg)
- [elasticsearch-periodic #5722 / 7.2.1_bwc](https://gradle-enterprise.elastic.co/s/pet7lt2nxt6ck)
- [elasticsearch-periodic #5717 / 7.0.1_bwc](https://gradle-enterprise.elastic.co/s/txwvkxrvxqati)
- [elasticsearch-periodic #5702 / 7.3.2_bwc](https://gradle-enterprise.elastic.co/s/pds2fxxhkflwc)

**Reproduction Line:**
```
./gradlew "":x-pack:qa:full-cluster-restart:v7.1.1#bwcTest"" -Dtests.class=""org.elasticsearch.xpack.restart.FullClusterRestartIT"" -Dtests.method=""testWatcher {cluster=UPGRADED}"" -Dtests.seed=CD5C215BDFD2CF1B -Dtests.bwc=true -Dtests.locale=rof -Dtests.timezone=Australia/Currie -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.restart.FullClusterRestartIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testWatcher%20%7Bcluster%3DUPGRADED%7D),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.RuntimeException: An error occurred while checking cluster 'test-cluster' status.
```

**Issue Reasons:**
- [8.x] 3 consecutive failures in step 7.1.1_bwc
- [8.x] 3 consecutive failures in step 7.4.2_bwc
- [8.x] 9 failures in test testWatcher {cluster=UPGRADED} (1.0% fail rate in 884 executions)
- [8.x] 3 failures in step 7.1.1_bwc (100.0% fail rate in 3 executions)
- [8.x] 3 failures in step 7.4.2_bwc (100.0% fail rate in 3 executions)
- [8.x] 6 failures in pipeline elasticsearch-periodic (60.0% fail rate in 10 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':Security/Authentication', 'Team:Security', 'low-risk']",https://github.com/elastic/elasticsearch/issues/119259,2024-12-24T13:57:36Z,17,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/119259,"{
  ""application_resource"": ""unsure""
}"
104,119198,[CI] BootstrapCheckTests test10Install failing,"**Build Scans:**
- [elasticsearch-periodic-packaging #5246 / rhel-7_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/cw24bycc24sdi)
- [elasticsearch-periodic-packaging #5246 / ubuntu-2204_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/qc7jsnfp6lur2)
- [elasticsearch-periodic-packaging #5246 / opensuse-leap-15_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/npb24xli35sou)
- [elasticsearch-periodic-packaging #5246 / ubuntu-1804_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/3iswx5f63f3mm)
- [elasticsearch-periodic-packaging #5246 / rocky-8_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/zdpqh3k24ltmq)
- [elasticsearch-periodic-packaging #5246 / rhel-8_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/ehivfvhuh7h3q)
- [elasticsearch-periodic-packaging #5246 / ubuntu-2004_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/gghot2up324kq)
- [elasticsearch-periodic-packaging #5246 / almalinux-8_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/cvlbofd4nzgye)
- [elasticsearch-periodic-packaging #5246 / debian-11_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/2wrq4dpsmlnse)
- [elasticsearch-periodic-packaging #5246 / rocky-9_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/dzw2vgzuasqh2)

**Reproduction Line:**
```
null
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.packaging.test.BootstrapCheckTests),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(test10Install),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
org.elasticsearch.packaging.util.Shell$ShellException: Command was not successful: [bash -c docker run --detach --memory 2g --env ingest.geoip.downloader.enabled=""false"" --publish 9200:9200 --publish 9300:9300 elasticsearch-cloud-ess:test]
   result: exitCode = [127] stdout = [cc25d6e9c73dcb7cc9857489c80bb2ad9cf2e201fdacf3733916126753fac36d] stderr = [docker: Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: ""/sbin/tini"": stat /sbin/tini: no such file or directory: unknown.]
```

**Issue Reasons:**
- [8.17] 108 failures in test test10Install (12.1% fail rate in 893 executions)
- [8.17] 9 failures in step rhel-7_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step ubuntu-2204_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step opensuse-leap-15_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step ubuntu-1804_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step rocky-8_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step rhel-8_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step ubuntu-2004_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step almalinux-8_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step debian-11_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step rocky-9_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step rhel-9_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in step oraclelinux-8_packaging-tests-unix (100.0% fail rate in 9 executions)
- [8.17] 9 failures in pipeline elasticsearch-periodic-packaging (100.0% fail rate in 9 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"[':Delivery/Packaging', '>test-failure', 'Team:Delivery', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/119198,2024-12-22T00:48:34Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/119198,"{
  ""application_resource"": ""unsure""
}"
105,118896,[CI] DocsClientYamlTestSuiteIT test {yaml=reference/indices/shard-stores/line_150} failing,"### CI Link

https://gradle-enterprise.elastic.co/s/klaw6tlnkmvoy/tests/task/:docs:yamlRestTest/details/org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT/test%20%7Byaml=reference%2Findices%2Fshard-stores%2Fline_150%7D?top-execution=1

### Repro line

./gradlew "":docs:yamlRestTest"" --tests ""org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT.test {yaml=reference/indices/shard-stores/line_150}"" -Dtests.seed=BEA3F5065B8302E6 -Dtests.locale=sn-ZW -Dtests.timezone=Antarctica/Casey -Druntime.java=23	

### Does it reproduce?

Yes

### Applicable branches

main

### Failure history

_No response_

### Failure excerpt


Caused by: java.lang.AssertionError: Expected a map containing | Â 
-- | --
Â  | indices: a map containing | Â 
Â  | my-index-000001: a map containing | Â 
Â  | shards: a map containing | Â 
Â  | 0: a map containing | Â 
Â  | stores: a list containing | Â 
Â  | 0: a map containing | Â 
Â  | allocation: ""primary"" | Â 
Â  | allocation_id: ""BwBl8ClLRDCRRQHXZCWhhA"" | Â 
Â  | VNUzd9z2Tc-cd5tSzJt8UA: a map containing | Â 
Â  | min_read_only_index_version: <7000099> | Â 
Â  | transport_address: ""127.0.0.1:45133"" | Â 
Â  | roles: a list containing | Â 
Â  | 0: ""data"" | Â 
Â  | 1: ""data_cold"" | Â 
Â  | 2: ""data_content"" | Â 
Â  | 3: ""data_frozen"" | Â 
Â  | 4: ""data_hot"" | Â 
Â  | 5: ""data_warm"" | Â 
Â  | 6: ""ingest"" | Â 
Â  | 7: ""master"" | Â 
Â  | 8: ""ml"" | Â 
Â  | 9: ""remote_cluster_client"" | Â 
Â  | 10: ""transform"" | Â 
Â  | name: ""node-0"" | Â 
Â  | min_index_version: <8000099> | Â 
Â  | external_id: ""node-0"" | Â 
Â  | attributes: a map containing | Â 
Â  | ml.allocated_processors_double: ""32.0"" | Â 
Â  | ml.machine_memory: ""101237002240"" | Â 
Â  | ml.config_version: ""12.0.0"" | Â 
Â  | ml.max_jvm_size: ""536870912"" | Â 
Â  | ml.allocated_processors: ""32"" | Â 
Â  | xpack.installed: ""true"" | Â 
Â  | transform.config_version: ""10.0.0"" | Â 
Â  | testattr: ""test"" | Â 
Â  | max_index_version: expected <9004000> but was <9005000> | Â 
Â  | ephemeral_id: ""dIBCaphSRruA9wIncKFqBw"" | Â 
Â  | version: ""9.0.0""

",Mikep86,closed,"['>docs', '>test-failure', 'Team:Docs', 'low-risk']",https://github.com/elastic/elasticsearch/issues/118896,2024-12-17T21:49:15Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/118896,"{
  ""application_resource"": ""unsure""
}"
106,118623,Performance degradation after upgrading from 8.6.1 to 8.16.1,"### Elasticsearch Version

8.16.1

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

6.1.112-124.190.amzn2023.aarch64

### Problem Description

After starting an upgrade from 8.6.1 to 8.16.1 we noticed that data nodes running new version are performing worse.
Their CPU was significantly higher than on the data nodes with the old version:
<img width=""1594"" alt=""Image"" src=""https://github.com/user-attachments/assets/f5ca3899-ce46-49de-9587-9380e38bbefd"" />

We also noticed that new version nodes have much higher flush rate:
<img width=""1588"" alt=""Image"" src=""https://github.com/user-attachments/assets/d3cc7905-242e-42ae-8078-649831089b4d"" />

It doesn't matter whether an old node is upgraded to 8.16.1 or a brand new node spun up with 8.16.1 - they all show same symptoms of higher CPU and much higher flush rate degrading performance of the cluster as a whole.

We added more data nodes with the new 8.16.1 version and now have a cluster with 35 ""old"" nodes and 36 ""new"" nodes.
New nodes are consuming twice more CPU and have much higher flush rate:
<img width=""1587"" alt=""Image"" src=""https://github.com/user-attachments/assets/bfcc8d4b-eba9-47da-aaa1-7ab7a23253a4"" />
<img width=""1591"" alt=""Image"" src=""https://github.com/user-attachments/assets/b36c9483-028f-40da-a4f8-08ca44e10fe1"" />

Another notable difference is how new nodes have higher cache size:
<img width=""1174"" alt=""Image"" src=""https://github.com/user-attachments/assets/54ea3357-eeea-449f-9c6e-342050cf2ed9"" />

The reason why we were upgrading to 8.16.1 is to mitigate [this issue](https://github.com/elastic/elasticsearch/issues/100755)

We are running Elasticsearch on EC2 with ephemeral instance store on c7gd.16xlarge. Elasticsearch version aside no changes were made to the cluster infrastructure, JVM/Elasticsearch options, etc.

### Steps to Reproduce

Upgrade a 8.6.1 data node to 8.16.1

### Logs (if relevant)

_No response_

## None of the below has changed between the upgrade

### JVM options
```
## JVM configuration
-Xms30500m
-Xmx30500m
8-13:-XX:+UseConcMarkSweepGC
8-13:-XX:CMSInitiatingOccupancyFraction=75
8-13:-XX:+UseCMSInitiatingOccupancyOnly
8:-XX:+AlwaysPreTouch
8:-Xss1m
8:-Djava.awt.headless=true
8:-Dfile.encoding=UTF-8
8:-Djna.nosys=true
8:-XX:-OmitStackTraceInFastThrow
8:-Dio.netty.noUnsafe=true
8:-Dio.netty.noKeySetOptimization=true
8:-Dio.netty.recycler.maxCapacityPerThread=0
8:-Dlog4j.shutdownHookEnabled=false
8:-Dlog4j2.disable.jmx=true
8:-XX:+PrintGCDetails
8:-XX:+PrintGCDateStamps
8:-XX:+PrintTenuringDistribution
8:-XX:+PrintGCApplicationStoppedTime
8:-Xloggc:logs/gc.log
8:-XX:+UseGCLogFileRotation
8:-XX:NumberOfGCLogFiles=32
8:-XX:GCLogFileSize=64m
9-:-Djava.locale.providers=COMPAT
-Des.index.memory.max_index_buffer_size=10240m
14-:-XX:+UseG1GC
14-:-XX:G1ReservePercent=25
14-:-XX:InitiatingHeapOccupancyPercent=30
14-:-Djava.io.tmpdir=${ES_TMPDIR}
14-:-XX:+HeapDumpOnOutOfMemoryError
14-:-XX:HeapDumpPath=data
14-:-XX:ErrorFile=logs/hs_err_pid%p.log
-Dlog4j2.formatMsgNoLookups=true
```

### Elasticsearch static node config
```
cloud.node.auto_attributes: true
cluster.routing.allocation.awareness.attributes: aws_availability_zone
action.auto_create_index: false
indices.memory.index_buffer_size: 25%
network.host: 0.0.0.0
http.compression: true
action.destructive_requires_name: true
bootstrap.memory_lock: true
thread_pool.write.queue_size: 2500
script.max_compilations_rate: 30/1m
xpack.graph.enabled: false
xpack.ml.enabled: false
xpack.watcher.enabled: false
discovery.seed_providers: ec2
indices.breaker.request.limit: 1gb
indices.breaker.fielddata.limit: 1gb
xpack.security.enabled: true
xpack.security.http.ssl.enabled: false
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.client_authentication: required
xpack.security.transport.ssl.keystore.path: elastic-certificates.p12
xpack.security.transport.ssl.truststore.path: elastic-certificates.p12
transport.compress: true
transport.compression_scheme: lz4
cluster.name: CLUSTER_NAME
discovery.ec2.tag.elasticsearch_cluster_name: CLUSTER_NAME
node.name: NODE_NAME
path.data: ""/media/ephemeral""
path.logs: ""/var/log/elasticsearch""
reindex.remote.whitelist: 10.0.*.*:9200
node.roles:
- data
```

### Elasticsearch cluster settings
```json
{
  ""persistent"": {
    ""cluster"": {
      ""routing"": {
        ""allocation"": {
          ""cluster_concurrent_rebalance"": ""100"",
          ""node_concurrent_recoveries"": ""100"",
          ""disk"": {
            ""watermark"": {
              ""low"": ""75%"",
              ""high"": ""85%""
            }
          },
          ""node_initial_primaries_recoveries"": ""114""
        }
      }
    },
    ""indices"": {
      ""breaker"": {
        ""fielddata"": {
          ""limit"": ""1gb""
        },
        ""request"": {
          ""limit"": ""1gb""
        }
      },
      ""recovery"": {
        ""max_bytes_per_sec"": ""1000mb""
      }
    },
    ""search"": {
      ""default_search_timeout"": ""120s"",
      ""default_allow_partial_results"": ""false"",
      ""max_open_scroll_context"": ""500000""
    },
    ""ingest"": {
      ""geoip"": {
        ""downloader"": {
          ""enabled"": ""false""
        }
      }
    },
    ""logger"": {
      ""org"": {
        ""elasticsearch"": {
          ""deprecation"": ""ERROR""
        }
      }
    }
  },
  ""transient"": {}
}
```",gregolsen,closed,"['>bug', 'Team:Search Foundations', ':Search Foundations/Search']",https://github.com/elastic/elasticsearch/issues/118623,2024-12-12T21:38:03Z,21,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/118623,"{
  ""application_resource"": ""yes""
}"
107,118263,L2 norm not working properly for vectors indexed with Index API; [v >= 8.14 docker],"### Elasticsearch Version

8.14.x; 8.15.x; 8.16.x [docker]

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

macOS 14.7.1 - running with docker engine 25.0.2

### Problem Description

It seems that there is some issue with how vectors with `l2_norm` are added when using Index API. This is visible through returned scores and ranking. Score per vector document should be calculated as: `1 / (1 + l2_norm(query, vector)^2)` and the vector closest in Euclidean distance should be scored highest, which seems not to be the case for vectors indexed one by one with Index API. When indexing the same data with Index API and Bulk API, scores for the same vectors are different. Scores for Bulk API are correct.

Issue was found first in `v.8.15.x`, but is still present in `8.16.x`, also it seems it first appeared in `8.14`. Version `8.13.x` is working as expected.

I did not test for other similarities.


### Steps to Reproduce

For experiment purposes, ES was run with docker. Versions tested: `8.16.1`, `8.15.1`, `8.14.3`, `8.13.4`

Run everything in one go, on fresh empty ES docker instance. Sometimes on already running instance, issue is not visible. Probably something wrong is being initialised on empty instance.

```
docker run --rm \
        -p 9200:9200 -p 9300:9300 \
        -e ""discovery.type=single-node"" \
        -e ""xpack.security.enabled=false"" \
        elasticsearch:8.x.x
```

Creating index:

```
PUT single-test
{
    ""mappings"": { 
        ""properties"":{
            ""vector"": {
                ""type"": ""dense_vector"",
                ""index"": true,
                ""dims"": 2,
                ""similarity"": ""l2_norm""
            }
        }
    }
}
```

Populating index - requires sending vectors one by one, when indexing with bulk API results are correct. For comparison, adding the same vectors with both methods, to showcase different scores for the same vectors. 

```
PUT single-test/_doc/single-01
{""vector"": [0,1]}

PUT single-test/_doc/single-11
{""vector"": [10,10]}

PUT single-test/_doc/single-1
{ ""vector"": [1,1]}

POST single-test/_bulk
{""index"":{""_id"": ""bulk-01""}}
{""vector"": [0,1]}
{""index"":{""_id"": ""bulk-10""}}
{""vector"": [10,10]}
{""index"":{""_id"": ""bulk-1""}}
{ ""vector"": [1,1]}

```

Making search query:

```
POST single-test/_search
{
    ""knn"": {
        ""field"": ""vector"",
        ""query_vector"": [0,0],
        ""k"": 10,  
        ""num_candidates"": 10
    },
    ""size"": 10
}
```


### Logs (if relevant)

Results for `8.16.1`:

```
{
    ""took"": 11,
    ""timed_out"": false,
    ""_shards"": {
        ""total"": 1,
        ""successful"": 1,
        ""skipped"": 0,
        ""failed"": 0
    },
    ""hits"": {
        ""total"": {
            ""value"": 6,
            ""relation"": ""eq""
        },
        ""max_score"": 1.0,
        ""hits"": [
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-10"",
                ""_score"": 1.0,
                ""_source"": {
                    ""vector"": [
                        10,
                        10
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-1"",
                ""_score"": 1.0,
                ""_source"": {
                    ""vector"": [
                        1,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-01"",
                ""_score"": 0.5,
                ""_source"": {
                    ""vector"": [
                        0,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-01"",
                ""_score"": 0.48832846,
                ""_source"": {
                    ""vector"": [
                        0,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-1"",
                ""_score"": 0.32303873,
                ""_source"": {
                    ""vector"": [
                        1,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-10"",
                ""_score"": 0.0049751243,
                ""_source"": {
                    ""vector"": [
                        10,
                        10
                    ]
                }
            }
        ]
    }
}
```

Results for `8.15.3`:

```
{
    ""took"": 67,
    ""timed_out"": false,
    ""_shards"": {
        ""total"": 1,
        ""successful"": 1,
        ""skipped"": 0,
        ""failed"": 0
    },
    ""hits"": {
        ""total"": {
            ""value"": 6,
            ""relation"": ""eq""
        },
        ""max_score"": 1.0,
        ""hits"": [
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-10"",
                ""_score"": 1.0,
                ""_source"": {
                    ""vector"": [
                        10,
                        10
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-1"",
                ""_score"": 1.0,
                ""_source"": {
                    ""vector"": [
                        1,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-01"",
                ""_score"": 0.5,
                ""_source"": {
                    ""vector"": [
                        0,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-01"",
                ""_score"": 0.48832846,
                ""_source"": {
                    ""vector"": [
                        0,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-1"",
                ""_score"": 0.32303873,
                ""_source"": {
                    ""vector"": [
                        1,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-10"",
                ""_score"": 0.0049751243,
                ""_source"": {
                    ""vector"": [
                        10,
                        10
                    ]
                }
            }
        ]
    }
}
```

Results for `8.14.3`:

```
{
    ""took"": 53,
    ""timed_out"": false,
    ""_shards"": {
        ""total"": 1,
        ""successful"": 1,
        ""skipped"": 0,
        ""failed"": 0
    },
    ""hits"": {
        ""total"": {
            ""value"": 6,
            ""relation"": ""eq""
        },
        ""max_score"": 1.0,
        ""hits"": [
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-10"",
                ""_score"": 1.0,
                ""_source"": {
                    ""vector"": [
                        10,
                        10
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-1"",
                ""_score"": 1.0,
                ""_source"": {
                    ""vector"": [
                        1,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-01"",
                ""_score"": 0.5,
                ""_source"": {
                    ""vector"": [
                        0,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-01"",
                ""_score"": 0.48832846,
                ""_source"": {
                    ""vector"": [
                        0,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-1"",
                ""_score"": 0.32303873,
                ""_source"": {
                    ""vector"": [
                        1,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-10"",
                ""_score"": 0.0049751243,
                ""_source"": {
                    ""vector"": [
                        10,
                        10
                    ]
                }
            }
        ]
    }
}
```

Results for `8.13.4` [correct]:
```
{
    ""took"": 63,
    ""timed_out"": false,
    ""_shards"": {
        ""total"": 1,
        ""successful"": 1,
        ""skipped"": 0,
        ""failed"": 0
    },
    ""hits"": {
        ""total"": {
            ""value"": 6,
            ""relation"": ""eq""
        },
        ""max_score"": 0.5,
        ""hits"": [
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-01"",
                ""_score"": 0.5,
                ""_source"": {
                    ""vector"": [
                        0,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-01"",
                ""_score"": 0.5,
                ""_source"": {
                    ""vector"": [
                        0,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-1"",
                ""_score"": 0.33333334,
                ""_source"": {
                    ""vector"": [
                        1,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-1"",
                ""_score"": 0.33333334,
                ""_source"": {
                    ""vector"": [
                        1,
                        1
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""single-10"",
                ""_score"": 0.0049751243,
                ""_source"": {
                    ""vector"": [
                        10,
                        10
                    ]
                }
            },
            {
                ""_index"": ""single-test"",
                ""_id"": ""bulk-10"",
                ""_score"": 0.0049751243,
                ""_source"": {
                    ""vector"": [
                        10,
                        10
                    ]
                }
            }
        ]
    }
}
```",amfilipiak,closed,"['>bug', ':Search Relevance/Vectors', 'Team:Search Relevance']",https://github.com/elastic/elasticsearch/issues/118263,2024-12-09T13:20:05Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/118263,"{
  ""application_resource"": ""yes""
}"
108,118238,[CI] EsqlActionBreakerIT class failing,"**Build Scans:**
- [elasticsearch-intake #14241 / part3](https://gradle-enterprise.elastic.co/s/6hiyo3gonertm)
- [elasticsearch-intake #14200 / part3](https://gradle-enterprise.elastic.co/s/eg2ckbo6qptiq)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:esql:internalClusterTest"" --tests ""org.elasticsearch.xpack.esql.action.EsqlActionBreakerIT.testEvalWhere"" -Dtests.seed=56B8063E89FE55A1 -Dtests.locale=uk-UA -Dtests.timezone=Etc/GMT-12 -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.esql.action.EsqlActionBreakerIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(org.elasticsearch.xpack.esql.action.EsqlActionBreakerIT),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Leftover exchanges ExchangeService{sinks=[OkHnDwl5R6aapn8_w1-FTw:4566/29, OkHnDwl5R6aapn8_w1-FTw:4566/29[n]]} on node node_s3
```

**Issue Reasons:**
- [main] 2 failures in class org.elasticsearch.xpack.esql.action.EsqlActionBreakerIT (1.0% fail rate in 210 executions)
- [main] 2 failures in step part3 (5.3% fail rate in 38 executions)
- [main] 2 failures in pipeline elasticsearch-intake (5.3% fail rate in 38 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'medium-risk', 'Team:StorageEngine', ':StorageEngine/Mapping']",https://github.com/elastic/elasticsearch/issues/118238,2024-12-09T07:01:02Z,11,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/118238,"{
  ""application_resource"": ""yes""
}"
109,117877,[DOCS] Improve BBQ documentation: add examples and clarify knn memory formula,"### Overview

As per[ this Slack thread](https://elastic.slack.com/archives/C05MQ9EP6QP/p1733155932524059), the following improvements are needed for the BBQ documentation:

- Add examples for combining nested search, inner hits, and re-ranking with BBQ.

- Update the tune KNN guide to:- Address discrepancies in the memory formula.
Current formula:` num_vectors * (num_dimensions / 8 + 12)`
Observed formula: `num_vectors * (num_dimensions / 8 + 48)`

- Provide clarification on how pre-filters and query structure can impact memory requirements.
",kosabogi,closed,"['>docs', 'Team:Docs']",https://github.com/elastic/elasticsearch/issues/117877,2024-12-03T07:45:17Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/117877,"{
  ""application_resource"": ""unsure""
}"
110,117810,elasticsearch 7.5.1 Problematic frame: # C  0x0000000000000000,"### Elasticsearch Version

7.5.1

### Installed Plugins

analysis-ik , basic auth

### Java Version

OpenJDK Runtime Environment (13.0.1+9)

### OS Version

CentOS Linux release 7.8 64bit

### Problem Description

1ï¼ŒOperating environment: CentOS 7.8 with Elasticsearch 7.5.1 (OpenJDK Runtime Environment 13.0.1+9)
2ï¼ŒJVM crash occurred, with no indication of process termination in the system log. The cluster query load and server resources were normal before the exception.
3ï¼ŒBelow is the crash log.

### Steps to Reproduce

no

### Logs (if relevant)

#
# A fatal error has been detected by the Java Runtime Environment:
#
#  SIGSEGV (0xb) at pc=0x0000000000000000, pid=292920, tid=293688
#
# JRE version: OpenJDK Runtime Environment (13.0.1+9) (build 13.0.1+9)
# Java VM: OpenJDK 64-Bit Server VM (13.0.1+9, mixed mode, sharing, tiered, compressed oops, g1 gc, linux-amd64)
# Problematic frame:
# C  0x0000000000000000
#
# No core dump will be written. Core dumps have been disabled. To enable core dumping, try ""ulimit -c unlimited"" before starting Java again
#
# If you would like to submit a bug report, please visit:
#   https://github.com/AdoptOpenJDK/openjdk-build/issues
#

---------------  S U M M A R Y ------------

Command Line: -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dio.netty.allocator.numDirectArenas=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Djava.locale.providers=COMPAT -Xms24g -Xmx24g -XX:+UseG1GC -XX:G1ReservePercent=25 -XX:InitiatingHeapOccupancyPercent=30 -Djava.io.tmpdir=/tmp/elasticsearch-13805822619825575947 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m -XX:MaxDirectMemorySize=12884901888 -Des.path.home=/data/service/elasticsearch/crm-data-node1 -Des.path.conf=/data/service/elasticsearch/crm-data-node1/config -Des.distribution.flavor=default -Des.distribution.type=tar -Des.bundled_jdk=true org.elasticsearch.bootstrap.Elasticsearch -d

Host: Intel(R) Xeon(R) Gold 5220R CPU @ 2.20GHz, 96 cores, 125G, CentOS Linux release 7.8.2003 (Core)
Time: Fri Nov 29 22:01:52 2024 CST elapsed time: 9231912 seconds (106d 20h 25m 12s)

---------------  T H R E A D  ---------------

Current thread (0x00007f39cc056800):  GCTaskThread ""GC Thread#54"" [stack: 0x00007f39025ce000,0x00007f39026ce000] [id=293688]

Stack: [0x00007f39025ce000,0x00007f39026ce000],  sp=0x00007f39026cc928,  free space=1018k

siginfo: si_signo: 11 (SIGSEGV), si_code: 1 (SEGV_MAPERR), si_addr: 0x0000000000000000

Register to memory mapping:

RAX=0x00007f3a452978c0: <offset 0x00000000016758c0> in /data/service/elasticsearch/crm-data-node1/jdk/lib/server/libjvm.so at 0x00007f3a43c22000
RBX=0x0000000497d0afb8 points into unknown readable memory: 00 00 00 20 00 00 00 01
RCX=0x00000000000000e2 is an unknown value
RDX=0x0000000800000100 is pointing into metadata
RSP=0x00007f39026cc928 points into unknown readable memory: 04 fc 3e 44 3a 7f 00 00
RBP=0x00007f39026cc9b0 points into unknown readable memory: e0 c9 6c 02 39 7f 00 00
RSI=0x0000000497d0afb8 points into unknown readable memory: 00 00 00 20 00 00 00 01
RDI=0x00007f388c04f108 points into unknown readable memory: 08 08 17 45 3a 7f 00 00
R8 =0x0000000800000000 is pointing into metadata
R9 =0x0000000000000101 is an unknown value
R10=0x0000000000000009 is an unknown value
R11=0x0 is NULL
R12=0x0000000000000009 is an unknown value
R13=0x00007f388c04efa0 points into unknown readable memory: 48 08 17 45 3a 7f 00 00
R14=0x00000004590c6f00 is pointing into object: [J 
{0x0000000459000000} - klass: {type array long}
 - length: 191328
R15=0x0100000020000000 is an unknown value


Registers:
RAX=0x00007f3a452978c0, RBX=0x0000000497d0afb8, RCX=0x00000000000000e2, RDX=0x0000000800000100
RSP=0x00007f39026cc928, RBP=0x00007f39026cc9b0, RSI=0x0000000497d0afb8, RDI=0x00007f388c04f108
R8 =0x0000000800000000, R9 =0x0000000000000101, R10=0x0000000000000009, R11=0x0000000000000000
R12=0x0000000000000009, R13=0x00007f388c04efa0, R14=0x00000004590c6f00, R15=0x0100000020000000
RIP=0x0000000000000000, EFLAGS=0x0000000000010206, CSGSFS=0x0000000000000033, ERR=0x0000000000000014
  TRAPNO=0x000000000000000e

Top of Stack: (sp=0x00007f39026cc928)
0x00007f39026cc928:   00007f3a443efc04 0000000000000000
0x00007f39026cc938:   0000000000000218 00007f39026cc960
0x00007f39026cc948:   00007f3a44b4cf01 00007f3a00000000
0x00007f39026cc958:   0000000000000009 ffffffff026cc9d0 

Instructions: (pc=0x0000000000000000)
0xffffffffffffff00:   


Stack slot to memory mapping:
stack at sp + 0 slots: 0x00007f3a443efc04: <offset 0x00000000007cdc04> in /data/service/elasticsearch/crm-data-node1/jdk/lib/server/libjvm.so at 0x00007f3a43c22000
stack at sp + 1 slots: 0x0 is NULL
stack at sp + 2 slots: 0x0000000000000218 is an unknown value
stack at sp + 3 slots: 0x00007f39026cc960 points into unknown readable memory: d0 c9 6c 02 ff ff ff ff
stack at sp + 4 slots: 0x00007f3a44b4cf01: <offset 0x0000000000f2af01> in /data/service/elasticsearch/crm-data-node1/jdk/lib/server/libjvm.so at 0x00007f3a43c22000
stack at sp + 5 slots: 0x00007f3a00000000 points into unknown readable memory: 00 00 00 00 00 00 00 00
stack at sp + 6 slots: 0x0000000000000009 is an unknown value
stack at sp + 7 slots: 0xffffffff026cc9d0 is an unknown value

 
}

Java Threads: ( => current thread )
  0x00007f3a3dfd9800 JavaThread ""Reference Handler"" daemon [_thread_blocked, id=293123, stack(0x00007f39d6df8000,0x00007f39d6ef9000)]
  0x00007f3a3dfdb800 JavaThread ""Finalizer"" daemon [_thread_blocked, id=293124, stack(0x00007f39d6cf7000,0x00007f39d6df8000)]
  0x00007f3a3dfe1000 JavaThread ""Signal Dispatcher"" daemon [_thread_blocked, id=293125, stack(0x00007f39d6bf6000,0x00007f39d6cf7000)]
  0x00007f3a3dfe3000 JavaThread ""C2 CompilerThread0"" daemon [_thread_blocked, id=293126, stack(0x00007f39d6af5000,0x00007f39d6bf6000)]
  0x00007f3a3dfe5000 JavaThread ""C1 CompilerThread0"" daemon [_thread_blocked, id=293127, stack(0x00007f39d69f4000,0x00007f39d6af5000)]
  0x00007f3a3dfe7000 JavaThread ""Sweeper thread"" daemon [_thread_blocked, id=293128, stack(0x00007f39d68f3000,0x00007f39d69f4000)]
  0x00007f3a3e017000 JavaThread ""Service Thread"" daemon [_thread_blocked, id=293136, stack(0x00007f39d64ef000,0x00007f39d65f0000)]
  0x00007f3a3e01c800 JavaThread ""Common-Cleaner"" daemon [_thread_blocked, id=293140, stack(0x00007f39d62ec000,0x00007f39d63ed000)]
  0x00007f3a3e60c000 JavaThread ""process reaper"" daemon [_thread_in_native, id=293350, stack(0x00007f39e8001000,0x00007f39e8023000)]
  0x00007f3a3ee10000 JavaThread ""elasticsearch[bj-ucloud-0-52-crm-data-node1][[timer]]"" daemon [_thread_blocked, id=293725, stack(0x00007f39d5545000,0x00007f39d5646000)]
  0x00007f3a3fd56800 JavaThread ""elasticsearch[bj-ucloud-0-52-crm-data-node1][scheduler][T#1]"" daemon [_thread_blocked, id=293752, stack(0x00007f382faff000,0x00007f382fc00000)]
  0x00007f3a3febe000 JavaThread ""Connection evictor"" daemon [_thread_blocked, id=293779, stack(0x00007f3900099000,0x00007f390019a000)]
  0x00007f3a3ff26800 JavaThread ""elasticsearch[scheduler][T#1]"" daemon [_thread_blocked, id=293780, stack(0x00007f382edfe000,0x00007f382eeff000)]
  0x00007f3a3ff2e000 JavaThread ""ticker-schedule-trigger-engine"" daemon [_thread_blocked, id=293781, stack(0x00007f382ecfd000,0x00007f382edfe000)]
  0x00007f3a3ff6e000 JavaThread ""ml-cpp-log-tail-thread"" daemon [_thread_in_native, id=293783, stack(0x00007f39d5848000,0x00007f39d5949000)]
  0x00007f381cc09800 JavaThread ""elasticsearch[bj-ucloud-0-52-crm-data-node1][transport_worker][T#1]"" daemon [_thread_in_native, id=294112, stack(0x00007f39d5949000,0x00007f39d5a4a000)]
  0x00007f381cdc0800 JavaThread ""elasticsearch[bj-ucloud-0-52-crm-data-node1][clusterApplierService#updateTask][T#1]"" daemon [_thread_blocked, id=294177, stack(0x00007f382d1f4000,0x00007f382d2f5000)]
  0x00007f37ec003000 JavaThread ""elasticsearch[bj-ucloud-0-52-crm-data-node1][transport_worker][T#2]"" daemon [_thread_in_native, id=294181, stack(0x00007f382c9cf000,0x00007f382cad0000)]
  0x00007f37e8005000 JavaThread ""elasticsearch[bj-ucloud-0-52-crm-data-node1][transport_worker][T#3]"" daemon [_thread_blocked, 

.................

Card table byte_map: [0x00007f3a1d28a000,0x00007f3a2028a000] _byte_map_base: 0x00007f3a1c28a000

Marking Bits (Prev, Next): (CMBitMap*) 0x00007f3a3c07bdb8, (CMBitMap*) 0x00007f3a3c07bdf8
 Prev Bits: [0x00007f3a0228a000, 0x00007f3a1a28a000)
 Next Bits: [0x00007f39ea28a000, 0x00007f3a0228a000)

Polling page: 0x00007f3a4611e000

Metaspace:

Usage:
  Non-class:    103.94 MB capacity,    96.11 MB ( 92%) used,     7.03 MB (  7%) free+waste,   825.75 KB ( <1%) overhead. 
      Class:     16.75 MB capacity,    13.03 MB ( 78%) used,     3.29 MB ( 20%) free+waste,   438.75 KB (  3%) overhead. 
       Both:    120.70 MB capacity,   109.14 MB ( 90%) used,    10.32 MB (  9%) free+waste,     1.23 MB (  1%) overhead. 

Virtual space:
  Non-class space:      106.00 MB reserved,     104.20 MB ( 98%) committed 
      Class space:        1.00 GB reserved,      16.82 MB (  2%) committed 
             Both:        1.10 GB reserved,     121.03 MB ( 11%) committed 

Chunk freelists:
   Non-Class:  120.00 KB
       Class:  23.00 KB
        Both:  143.00 KB

MaxMetaspaceSize: unlimited
CompressedClassSpaceSize: 1.00 GB

CodeHeap 'non-profiled nmethods': size=118596Kb used=39966Kb max_used=41574Kb free=78629Kb
 bounds [0x00007f3a2c3ce000, 0x00007f3a2ec9e000, 0x00007f3a3379f000]
CodeHeap 'profiled nmethods': size=118596Kb used=4409Kb max_used=36865Kb free=114186Kb
 bounds [0x00007f3a24ffd000, 0x00007f3a274ad000, 0x00007f3a2c3ce000]
CodeHeap 'non-nmethods': size=8568Kb used=1708Kb max_used=4684Kb free=6859Kb
 bounds [0x00007f3a2479f000, 0x00007f3a24d1f000, 0x00007f3a24ffd000]
 total_blobs=2454648 nmethods=10855 adapters=993
 compilation: enabled
              stopped_count=0, restarted_count=0
 full_count=0

Compilation events (20 events):
Event: 9230640.900 Thread 0x00007f3a3dfe3000 963633       4       org.apache.lucene.index.IndexFileNames::segmentFileName (110 bytes)
Event: 9230640.946 Thread 0x00007f3a3dfe3000 nmethod 963633 0x00007f3a2c466910 code [0x00007f3a2c466b80, 0x00007f3a2c469230]
Event: 9230655.696 Thread 0x00007f3a3dfe3000 963634       4       org.apache.lucene.search.MatchAllDocsQuery::visit (6 bytes)
Event: 9230655.698 Thread 0x00007f3a3dfe3000 nmethod 963634 0x00007f3a2d52cf10 code [0x00007f3a2d52d0a0, 0x00007f3a2d52d178]
Event: 9230694.173 Thread 0x00007f3a3dfe3000 963635       4       java.util.stream.ForEachOps$ForEachOp::getOpFlags (15 bytes)
Event: 9230694.174 Thread 0x00007f3a3dfe3000 nmethod 963635 0x00007f3a2d226290 code [0x00007f3a2d226400, 0x00007f3a2d226498]
Event: 9230808.958 Thread 0x00007f3a3dfe3000 963636       4       java.lang.AbstractStringBuilder::append (54 bytes)
Event: 9230808.980 Thread 0x00007f3a3dfe3000 nmethod 963636 0x00007f3a2d551890 code [0x00007f3a2d551a80, 0x00007f3a2d5529b8]
Event: 9230863.234 Thread 0x00007f3a3dfe3000 963637       4       org.elasticsearch.index.mapper.MappedFieldType::docValueFormat (106 bytes)
Event: 9230863.236 Thread 0x00007f3a3dfe3000 nmethod 963637 0x00007f3a2d82f490 code [0x00007f3a2d82f620, 0x00007f3a2d82f718]
Event: 9230873.152 Thread 0x00007f3a3dfe3000 963638       4       org.apache.lucene.util.packed.DirectMonotonicWriter::add (97 bytes)
Event: 9230873.157 Thread 0x00007f3a3dfe3000 nmethod 963638 0x00007f3a2c417e90 code [0x00007f3a2c418020, 0x00007f3a2c4181c8]
Event: 9230905.637 Thread 0x00007f3a3dfe3000 963639       4       org.elasticsearch.index.mapper.KeywordFieldMapper$KeywordFieldType::fielddataBuilder (12 bytes)
Event: 9230905.641 Thread 0x00007f3a3dfe3000 nmethod 963639 0x00007f3a2c5c5a90 code [0x00007f3a2c5c5c20, 0x00007f3a2c5c5d58]
Event: 9231261.031 Thread 0x00007f3a3dfe3000 963640       4       org.elasticsearch.index.mapper.ParseContext$FilterParseContext::path (8 bytes)
Event: 9231261.034 Thread 0x00007f3a3dfe3000 nmethod 963640 0x00007f3a2c8b4690 code [0x00007f3a2c8b4820, 0x00007f3a2c8b4938]
Event: 9231796.637 Thread 0x00007f3a3dfe3000 963641       4       org.apache.lucene.codecs.lucene80.Lucene80DocValuesProducer$24::nextOrd (96 bytes)
Event: 9231796.650 Thread 0x00007f3a3dfe3000 nmethod 963641 0x00007f3a2c436010 code [0x00007f3a2c4361e0, 0x00007f3a2c436698]
Event: 9231834.793 Thread 0x00007f3a3dfe5000 963642       1       org.elasticsearch.common.lucene.Lucene$DirectoryReaderWithAllLiveDocs$LeafReaderWithLiveDocs::numDocs (5 bytes)
Event: 9231834.794 Thread 0x00007f3a3dfe5000 nmethod 963642 0x00007f3a2d02cb10 code [0x00007f3a2d02cca0, 0x00007f3a2d02cdd0]

GC Heap History (20 events):
Event: 9231836.040 GC heap after
{Heap after GC invocations=6020925 (full 0):
 garbage-first heap   total 25165824K, used 11093836K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 31 young (253952K), 31 survivors (253952K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231836.856 GC heap before
{Heap before GC invocations=6020926 (full 0):
 garbage-first heap   total 25165824K, used 11667276K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 103 young (843776K), 31 survivors (253952K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231836.901 GC heap after
{Heap after GC invocations=6020927 (full 0):
 garbage-first heap   total 25165824K, used 11071174K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 25 young (204800K), 25 survivors (204800K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231844.625 GC heap before
{Heap before GC invocations=6020928 (full 0):
 garbage-first heap   total 25165824K, used 16903878K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 732 young (5996544K), 25 survivors (204800K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231844.680 GC heap after
{Heap after GC invocations=6020929 (full 0):
 garbage-first heap   total 25165824K, used 11141211K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 34 young (278528K), 34 survivors (278528K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231852.853 GC heap before
{Heap before GC invocations=6020929 (full 0):
 garbage-first heap   total 25165824K, used 17145947K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 766 young (6275072K), 34 survivors (278528K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231852.923 GC heap after
{Heap after GC invocations=6020930 (full 0):
 garbage-first heap   total 25165824K, used 11195535K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 40 young (327680K), 40 survivors (327680K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231856.029 GC heap before
{Heap before GC invocations=6020930 (full 0):
 garbage-first heap   total 25165824K, used 12989583K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 261 young (2138112K), 40 survivors (327680K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231856.087 GC heap after
{Heap after GC invocations=6020931 (full 0):
 garbage-first heap   total 25165824K, used 11202756K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 41 young (335872K), 41 survivors (335872K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231863.427 GC heap before
{Heap before GC invocations=6020932 (full 0):
 garbage-first heap   total 25165824K, used 15855812K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 608 young (4980736K), 41 survivors (335872K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231863.488 GC heap after
{Heap after GC invocations=6020933 (full 0):
 garbage-first heap   total 25165824K, used 11189501K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 42 young (344064K), 42 survivors (344064K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231876.494 GC heap before
{Heap before GC invocations=6020933 (full 0):
 garbage-first heap   total 25165824K, used 16825597K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 723 young (5922816K), 42 survivors (344064K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231876.573 GC heap after
{Heap after GC invocations=6020934 (full 0):
 garbage-first heap   total 25165824K, used 11252914K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 46 young (376832K), 46 survivors (376832K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231890.395 GC heap before
{Heap before GC invocations=6020934 (full 0):
 garbage-first heap   total 25165824K, used 17077426K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 758 young (6209536K), 46 survivors (376832K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231890.447 GC heap after
{Heap after GC invocations=6020935 (full 0):
 garbage-first heap   total 25165824K, used 11140684K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 32 young (262144K), 32 survivors (262144K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231891.104 GC heap before
{Heap before GC invocations=6020935 (full 0):
 garbage-first heap   total 25165824K, used 11370060K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 62 young (507904K), 32 survivors (262144K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231891.161 GC heap after
{Heap after GC invocations=6020936 (full 0):
 garbage-first heap   total 25165824K, used 11151931K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 31 young (253952K), 31 survivors (253952K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231909.539 GC heap before
{Heap before GC invocations=6020937 (full 0):
 garbage-first heap   total 25165824K, used 17041979K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 754 young (6176768K), 31 survivors (253952K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231909.597 GC heap after
{Heap after GC invocations=6020938 (full 0):
 garbage-first heap   total 25165824K, used 11123164K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 29 young (237568K), 29 survivors (237568K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}
Event: 9231912.595 GC heap before
{Heap before GC invocations=6020938 (full 0):
 garbage-first heap   total 25165824K, used 12130780K [0x0000000200000000, 0x0000000800000000)
  region size 8192K, 153 young (1253376K), 29 survivors (237568K)
 Metaspace       used 111756K, capacity 123593K, committed 123932K, reserved 1157120K
  class space    used 13344K, capacity 17157K, committed 17228K, reserved 1048576K
}

Deoptimization events (20 events):
Event: 9231286.796 Thread 0x00007f3240002800 DEOPT PACKING pc=0x00007f3a2c826bdc sp=0x00007f1cab6e7280
Event: 9231286.796 Thread 0x00007f3240002800 DEOPT UNPACKING pc=0x00007f3a247a6f25 sp=0x00007f1cab6e6d40 mode 2
Event: 9231286.918 Thread 0x00007f3664108000 Uncommon trap: trap_request=0xfffffff7 fr.pc=0x00007f3a2c826bdc relative=0x00000000000022bc
Event: 9231286.918 Thread 0x00007f3664108000 Uncommon trap: reason=null_check action=none pc=0x00007f3a2c826bdc method=org.elasticsearch.painless.DefBootstrap$MIC.checkBoth(Ljava/lang/Class;Ljava/lang/Class;Ljava/lang/Object;Ljava/lang/Object;)Z @ 1 c2
Event: 9231286.918 Thread 0x00007f3664108000 DEOPT PACKING pc=0x00007f3a2c826bdc sp=0x00007f3191d38240
Event: 9231286.918 Thread 0x00007f3664108000 DEOPT UNPACKING pc=0x00007f3a247a6f25 sp=0x00007f3191d37d00 mode 2
Event: 9231796.637 Thread 0x00007f240000b800 Uncommon trap: trap_request=0xffffff0c fr.pc=0x00007f3a2d7a59d8 relative=0x00000000000002f8
Event: 9231796.637 Thread 0x00007f240000b800 Uncommon trap: reason=tenured action=make_not_entrant pc=0x00007f3a2d7a59d8 method=org.apache.lucene.codecs.lucene80.Lucene80DocValuesProducer$24.nextOrd()J @ 0 c2
Event: 9231796.637 Thread 0x00007f240000b800 DEOPT PACKING pc=0x00007f3a2d7a59d8 sp=0x00007f3203aa8290
Event: 9231796.637 Thread 0x00007f240000b800 DEOPT UNPACKING pc=0x00007f3a247a6f25 sp=0x00007f3203aa8268 mode 2
Event: 9231828.287 Thread 0x00007f37b8127000 DEOPT PACKING pc=0x00007f3a2cb96ca7 sp=0x00007f33dedec560
Event: 9231828.287 Thread 0x00007f37b8127000 DEOPT UNPACKING pc=0x00007f3a247e714a sp=0x00007f33dedeba20 mode 3
Event: 9231839.779 Thread 0x00007f36e0111000 Uncommon trap: trap_request=0xfffffff7 fr.pc=0x00007f3a2c826bdc relative=0x00000000000022bc
Event: 9231839.779 Thread 0x00007f36e0111000 Uncommon trap: reason=null_check action=none pc=0x00007f3a2c826bdc method=org.elasticsearch.painless.DefBootstrap$MIC.checkBoth(Ljava/lang/Class;Ljava/lang/Class;Ljava/lang/Object;Ljava/lang/Object;)Z @ 1 c2
Event: 9231839.779 Thread 0x00007f36e0111000 DEOPT PACKING pc=0x00007f3a2c826bdc sp=0x00007f1cbd047280
Event: 9231839.779 Thread 0x00007f36e0111000 DEOPT UNPACKING pc=0x00007f3a247a6f25 sp=0x00007f1cbd046d40 mode 2
Event: 9231839.780 Thread 0x00007f36e0111000 Uncommon trap: trap_request=0xfffffff7 fr.pc=0x00007f3a2c826bdc relative=0x00000000000022bc
Event: 9231839.780 Thread 0x00007f36e0111000 Uncommon trap: reason=null_check action=none pc=0x00007f3a2c826bdc method=org.elasticsearch.painless.DefBootstrap$MIC.checkBoth(Ljava/lang/Class;Ljava/lang/Class;Ljava/lang/Object;Ljava/lang/Object;)Z @ 1 c2
Event: 9231839.780 Thread 0x00007f36e0111000 DEOPT PACKING pc=0x00007f3a2c826bdc sp=0x00007f1cbd047280
Event: 9231839.780 Thread 0x00007f36e0111000 DEOPT UNPACKING pc=0x00007f3a247a6f25 sp=0x00007f1cbd046d40 mode 2

Classes unloaded (20 events):
Event: 8957504.722 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801a8d840 'java/lang/invoke/LambdaForm$MH'
Event: 8957504.722 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801b2b440 'java/lang/invoke/LambdaForm$MH'
Event: 8957504.722 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801a85440 'java/lang/invoke/LambdaForm$MH'
Event: 8957504.722 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801a00c40 'java/lang/invoke/LambdaForm$MH'
Event: 8957504.722 Thread 0x00007f3a3dfd7000 Unloading class 0x00000008019ec040 'java/lang/invoke/LambdaForm$MH'
Event: 8957504.722 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801ba1040 'java/lang/invoke/LambdaForm$MH'
Event: 8957504.722 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801ba6040 'java/lang/invoke/LambdaForm$MH'
Event: 8957504.722 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801ba6c40 'java/lang/invoke/LambdaForm$MH'
Event: 8957504.722 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801ba7040 'java/lang/invoke/LambdaForm$BMH'
Event: 8957504.722 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801ba2440 'java/lang/invoke/LambdaForm$MH'
Event: 9221934.795 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801a85440 'jdk/internal/reflect/GeneratedConstructorAccessor202'
Event: 9221934.795 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801b2b440 'jdk/internal/reflect/GeneratedConstructorAccessor200'
Event: 9221934.795 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801a8d840 'jdk/internal/reflect/GeneratedConstructorAccessor199'
Event: 9221934.795 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801add440 'jdk/internal/reflect/GeneratedConstructorAccessor198'
Event: 9221934.796 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801af7040 'jdk/internal/reflect/GeneratedConstructorAccessor203'
Event: 9221934.796 Thread 0x00007f3a3dfd7000 Unloading class 0x00000008019edc40 'jdk/internal/reflect/GeneratedConstructorAccessor201'
Event: 9221934.796 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801ba0c40 'jdk/internal/reflect/GeneratedConstructorAccessor196'
Event: 9221934.796 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801ae7040 'jdk/internal/reflect/GeneratedConstructorAccessor194'
Event: 9221934.796 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801ba8440 'jdk/internal/reflect/GeneratedConstructorAccessor192'
Event: 9221934.796 Thread 0x00007f3a3dfd7000 Unloading class 0x0000000801ba9c40 'jdk/internal/reflect/GeneratedConstructorAccessor191'

Classes redefined (0 events):
No events

Internal exceptions (20 events):
Event: 9231888.880 Thread 0x00007f37e8038800 Exception <a 'sun/nio/fs/UnixException'{0x00000006b0681c20}> (0x00000006b0681c20) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231888.881 Thread 0x00007f372c10f800 Exception <a 'sun/nio/fs/UnixException'{0x00000006b07cc7c8}> (0x00000006b07cc7c8) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231888.882 Thread 0x00007f37e8038800 Exception <a 'sun/nio/fs/UnixException'{0x00000006b06c8750}> (0x00000006b06c8750) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231888.883 Thread 0x00007f372c10f800 Exception <a 'sun/nio/fs/UnixException'{0x00000006af92b2e8}> (0x00000006af92b2e8) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231906.350 Thread 0x00007f3710101800 Exception <a 'sun/nio/fs/UnixException'{0x00000007d4e793f8}> (0x00000007d4e793f8) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231906.353 Thread 0x00007f3710101800 Exception <a 'sun/nio/fs/UnixException'{0x00000007d4f00e58}> (0x00000007d4f00e58) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231906.355 Thread 0x00007f37f4095800 Exception <a 'sun/nio/fs/UnixException'{0x00000006d74f8068}> (0x00000006d74f8068) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231906.356 Thread 0x00007f37f4095800 Exception <a 'sun/nio/fs/UnixException'{0x00000006d753eb98}> (0x00000006d753eb98) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231906.356 Thread 0x00007f37e8038800 Exception <a 'sun/nio/fs/UnixException'{0x00000006d6830058}> (0x00000006d6830058) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231906.358 Thread 0x00007f37e8038800 Exception <a 'sun/nio/fs/UnixException'{0x00000006d6876b38}> (0x00000006d6876b38) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231911.070 Thread 0x00007f372c10f800 Exception <a 'sun/nio/fs/UnixException'{0x00000007e3642c38}> (0x00000007e3642c38) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231911.072 Thread 0x00007f372c10f800 Exception <a 'sun/nio/fs/UnixException'{0x00000007e3777e68}> (0x00000007e3777e68) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231911.073 Thread 0x00007f3710101800 Exception <a 'sun/nio/fs/UnixException'{0x00000007e2841cc8}> (0x00000007e2841cc8) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231911.075 Thread 0x00007f3710101800 Exception <a 'sun/nio/fs/UnixException'{0x00000007e29a2358}> (0x00000007e29a2358) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231911.186 Thread 0x00007f37f4095800 Exception <a 'sun/nio/fs/UnixException'{0x00000007e2628410}> (0x00000007e2628410) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231911.188 Thread 0x00007f37f4095800 Exception <a 'sun/nio/fs/UnixException'{0x00000007e266ee48}> (0x00000007e266ee48) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231911.189 Thread 0x00007f37e8038800 Exception <a 'sun/nio/fs/UnixException'{0x00000007e2753f08}> (0x00000007e2753f08) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231911.190 Thread 0x00007f37e8038800 Exception <a 'sun/nio/fs/UnixException'{0x00000007e18467e8}> (0x00000007e18467e8) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231911.197 Thread 0x00007f3710101800 Exception <a 'sun/nio/fs/UnixException'{0x00000007e1b91ad0}> (0x00000007e1b91ad0) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]
Event: 9231911.200 Thread 0x00007f3710101800 Exception <a 'sun/nio/fs/UnixException'{0x00000007e1c73ff0}> (0x00000007e1c73ff0) 
thrown [/home/jenkins/workspace/build-scripts/jobs/jdk13u/jdk13u-linux-x64-hotspot/workspace/build/src/src/hotspot/share/prims/jni.cpp, line 598]

Events (20 events):
Event: 9231882.671 Thread 0x00007f3254021000 Thread added: 0x00007f3254021000
Event: 9231882.671 Protecting memory [0x00007f32039a9000,0x00007f32039ad000] with protection modes 0
Event: 9231882.785 Thread 0x00007f3254021000 Thread exited: 0x00007f3254021000
Event: 9231890.393 Executing VM operation: G1CollectForAllocation
Event: 9231890.447 Executing VM operation: G1CollectForAllocation done
Event: 9231891.101 Executing VM operation: G1CollectForAllocation
Event: 9231891.162 Executing VM operation: G1CollectForAllocation done
Event: 9231891.254 Executing VM operation: G1Concurrent
Event: 9231891.297 Executing VM operation: G1Concurrent done
Event: 9231891.377 Executing VM operation: G1Concurrent
Event: 9231891.381 Executing VM operation: G1Concurrent done
Event: 9231903.369 Thread 0x00007f39800c0800 Thread added: 0x00007f39800c0800
Event: 9231903.369 Protecting memory [0x00007f32039a9000,0x00007f32039ad000] with protection modes 0
Event: 9231903.593 Thread 0x00007f39800c0800 Thread exited: 0x00007f39800c0800
Event: 9231909.537 Executing VM operation: G1CollectForAllocation
Event: 9231909.598 Executing VM operation: G1CollectForAllocation done
Event: 9231909.714 Thread 0x00007f2994009000 Thread added: 0x00007f2994009000
Event: 9231909.714 Protecting memory [0x00007f32039a9000,0x00007f32039ad000] with protection modes 0
Event: 9231910.081 Thread 0x00007f2994009000 Thread exited: 0x00007f2994009000
Event: 9231912.591 Executing VM operation: G1CollectForAllocation


Dynamic libraries:
00400000-00401000 r-xp 00000000 08:04 3223411143                         /data/service/elasticsearch/crm-data-node1/jdk/bin/java
00600000-00601000 r--p 00000000 08:04 3223411143                         /data/service/elasticsearch/crm-data-node1/jdk/bin/java
00601000-00602000 rw-p 00001000 08:04 3223411143                         /data/service/elasticsearch/crm-data-node1/jdk/bin/java
00900000-00921000 rw-p 00000000 00:00 0                                  [heap]
200000000-7ff700000 rw-p 00000000 00:00 0 
7ff700000-7ff748000 rw-p 00b60000 08:04 430403                           /data/service/elasticsearch/crm-data-node1/jdk/lib/server/classes.jsa
7ff748000-7ff800000 rw-p 00000000 00:00 0 
7ff800000-7ff878000 rw-p 00ae8000 08:04 430403                           /data/service/elasticsearch/crm-data-node1/jdk/lib/server/classes.jsa
7ff878000-800000000 rw-p 00000000 00:00 0 
800000000-800003000 rwxp 00001000 08:04 430403                           /data/service/elasticsearch/crm-data-node1/jdk/lib/server/classes.jsa
800003000-8003d7000 rw-p 00004000 08:04 430403                           /data/service/elasticsearch/crm-data-node1/jdk/lib/server/classes.jsa
8003d7000-800ae6000 r--p 003d8000 08:04 430403                           /data/service/elasticsearch/crm-data-node1/jdk/lib/server/classes.jsa
800ae6000-800ae7000 rw-p 00ae7000 08:04 430403                           /data/service/elasticsearch/crm-data-node1/jdk/lib/server/classes.jsa

7f3a46113000-7f3a46114000 rwxp 00000000 00:00 0 
7f3a46114000-7f3a46115000 r--p 00000000 00:00 0 
7f3a46115000-7f3a46116000 r--s 00000000 08:04 3221998969                 /data/service/elasticsearch/crm-data-node1/data/nodes/0/indices/h6CyRcdURBKarGbY3klcbQ/1/index/_5pony_1_Lucene80_0.dvd
7f3a46116000-7f3a4611e000 rw-s 00000000 08:03 100835182                  /tmp/hsperfdata_ops/292920
7f3a4611e000-7f3a4611f000 ---p 00000000 00:00 0 
7f3a4611f000-7f3a46120000 r--p 00000000 00:00 0 
7f3a46120000-7f3a46121000 ---p 00000000 00:00 0 
7f3a46121000-7f3a46122000 rw-p 00000000 00:00 0 
7f3a46122000-7f3a46123000 r--p 00021000 08:03 35603790                   /usr/lib64/ld-2.17.so
7f3a46123000-7f3a46124000 rw-p 00022000 08:03 35603790                   /usr/lib64/ld-2.17.so
7f3a46124000-7f3a46125000 rw-p 00000000 00:00 0 
7ffc0d92f000-7ffc0d950000 rw-p 00000000 00:00 0                          [stack]
7ffc0d9bc000-7ffc0d9be000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]

.............

VM Arguments:
jvm_args: -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dio.netty.allocator.numDirectArenas=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Djava.locale.providers=COMPAT -Xms24g -Xmx24g -XX:+UseG1GC -XX:G1ReservePercent=25 -XX:InitiatingHeapOccupancyPercent=30 -Djava.io.tmpdir=/tmp/elasticsearch-13805822619825575947 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m -XX:MaxDirectMemorySize=12884901888 -Des.path.home=/data/service/elasticsearch/crm-data-node1 -Des.path.conf=/data/service/elasticsearch/crm-data-node1/config -Des.distribution.flavor=default -Des.distribution.type=tar -Des.bundled_jdk=true 
java_command: org.elasticsearch.bootstrap.Elasticsearch -d
java_class_path (initial): /data/service/elasticsearch/crm-data-node1/lib/HdrHistogram-2.1.9.jar:/data/service/elasticsearch/crm-data-node1/lib/elasticsearch-7.5.1.jar:/data/service/elasticsearch/crm-data-node1/lib/elasticsearch-cli-7.5.1.jar:/data/service/elasticsearch/crm-data-node1/lib/elasticsearch-core-7.5.1.jar:/data/service/elasticsearch/crm-data-node1/lib/elasticsearch-geo-7.5.1.jar:/data/service/elasticsearch/crm-data-node1/lib/elasticsearch-launchers-7.5.1.jar:/data/service/elasticsearch/crm-data-node1/lib/elasticsearch-plugin-classloader-7.5.1.jar:/data/service/elasticsearch/crm-data-node1/lib/elasticsearch-secure-sm-7.5.1.jar:/data/service/elasticsearch/crm-data-node1/lib/elasticsearch-x-content-7.5.1.jar:/data/service/elasticsearch/crm-data-node1/lib/hppc-0.8.1.jar:/data/service/elasticsearch/crm-data-node1/lib/jackson-core-2.8.11.jar:/data/service/elasticsearch/crm-data-node1/lib/jackson-dataformat-cbor-2.8.11.jar:/data/service/elasticsearch/crm-data-node1/lib/jackson-dataformat-smile-2.8.11.jar:/data/service/elasticsearch/crm-data-node1/lib/jackson-dataformat-yaml-2.8.11.jar:/data/service/elasticsearch/crm-data-node1/lib/java-version-checker-7.5.1.jar:/data/service/elasticsearch/crm-data-node1/lib/jna-4.5.1.jar:/data/service/elasticsearch/crm-data-node1/lib/joda-time-2.10.3.jar:/data/service/elasticsearch/crm-data-node1/lib/jopt-simple-5.0.2.jar:/data/service/elasticsearch/crm-data-node1/lib/jts-core-1.15.0.jar:/data/service/elasticsearch/crm-data-node1/lib/log4j-api-2.11.1.jar:/data/service/elasticsearch/crm-data-node1/lib/log4j-core-2.11.1.jar:/data/service/elasticsearch/crm-data-node1/lib/lucene-analyzers-common-8.3.0.jar:/data/service/elasticsearch/crm-data-node1/lib/lucene-backward-codecs-8.3.0.jar:/data/service/elasticsearch/crm-data-node1/lib/lucene-core-8.3.0.jar:/data/service/elasticsearch/crm-data-node1/lib/lucene-grouping-8.3.0.jar:/data/service/elasticsearch/crm-data-node1/lib/lucene-highlighter-8.3.0.jar:/data/service/elasticsearch/crm-
Launcher Type: SUN_STANDARD

[Global flags]
     bool AlwaysPreTouch                           = true                                      {product} {command line}
     intx CICompilerCount                          = 18                                        {product} {ergonomic}
     uint ConcGCThreads                            = 16                                        {product} {ergonomic}
    ccstr ErrorFile                                = logs/hs_err_pid%p.log                     {product} {command line}
     uint G1ConcRefinementThreads                  = 63                                        {product} {ergonomic}
   size_t G1HeapRegionSize                         = 8388608                                   {product} {ergonomic}
    uintx G1ReservePercent                         = 25                                        {product} {command line}
    uintx GCDrainStackTargetSize                   = 64                                        {product} {ergonomic}
     bool HeapDumpOnOutOfMemoryError               = true                                   {manageable} {command line}
    ccstr HeapDumpPath                             = data                                   {manageable} {command line}
   size_t InitialHeapSize                          = 25769803776                               {product} {command line}
    uintx InitiatingHeapOccupancyPercent           = 30                                        {product} {command line}
   size_t MarkStackSize                            = 4194304                                   {product} {ergonomic}
 uint64_t MaxDirectMemorySize                      = 12884901888                               {product} {command line}
   size_t MaxHeapSize                              = 25769803776                               {product} {command line}
   size_t MaxNewSize                               = 15460204544                               {product} {ergonomic}
   size_t MinHeapDeltaBytes                        = 8388608                                   {product} {ergonomic}
   size_t MinHeapSize                              = 25769803776                               {product} {command line}
    uintx NonNMethodCodeHeapSize                   = 8769992                                {pd product} {ergonomic}
    uintx NonProfiledCodeHeapSize                  = 121444124                              {pd product} {ergonomic}
     bool OmitStackTraceInFastThrow                = false                                     {product} {command line}
    uintx ProfiledCodeHeapSize                     = 121444124                              {pd product} {ergonomic}
    uintx ReservedCodeCacheSize                    = 251658240                              {pd product} {ergonomic}
     bool SegmentedCodeCache                       = true                                      {product} {ergonomic}
   size_t SoftMaxHeapSize                          = 25769803776                            {manageable} {ergonomic}
     intx ThreadStackSize                          = 1024                                   {pd product} {command line}
     bool UseCompressedClassPointers               = true                                 {lp64_product} {ergonomic}
     bool UseCompressedOops                        = true                                 {lp64_product} {ergonomic}
     bool UseG1GC                                  = true                                      {product} {command line}

Logging:
Log output configuration:
 #0: stdout all=warning uptime,level,tags
 #1: stderr all=off uptime,level,tags
 #2: file=logs/gc.log all=off,gc*=info,age*=trace,safepoint=info utctime,pid,tags filecount=32,filesize=65536K

Environment Variables:
JAVA_HOME=/data/service/elasticsearch/crm-data-node1/jdk
JRE_HOME=/usr/local/jdk_current/jre
CLASSPATH=.:/usr/local/jdk_current/lib:/usr/local/jdk_current/jre/lib:
PATH=/usr/local/jdk_current/bin:/usr/local/jdk_current/jre/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/ops/.local/bin:/home/ops/bin
SHELL=/bin/bash

Signal Handlers:
SIGSEGV: [libjvm.so+0xfe1a10], sa_mask[0]=11111111011111111101111111111110, sa_flags=SA_RESTART|SA_SIGINFO
SIGBUS: [libjvm.so+0xfe1a10], sa_mask[0]=11111111011111111101111111111110, sa_flags=SA_RESTART|SA_SIGINFO
SIGFPE: [libjvm.so+0xfe1a10], sa_mask[0]=11111111011111111101111111111110, sa_flags=SA_RESTART|SA_SIGINFO
SIGPIPE: [libjvm.so+0xc7cd40], sa_mask[0]=11111111011111111101111111111110, sa_flags=SA_RESTART|SA_SIGINFO
SIGXFSZ: [libjvm.so+0xc7cd40], sa_mask[0]=11111111011111111101111111111110, sa_flags=SA_RESTART|SA_SIGINFO
SIGILL: [libjvm.so+0xfe1a10], sa_mask[0]=11111111011111111101111111111110, sa_flags=SA_RESTART|SA_SIGINFO
SIGUSR2: [libjvm.so+0xc7cbe0], sa_mask[0]=00000000000000000000000000000000, sa_flags=SA_RESTART|SA_SIGINFO
SIGHUP: [libjvm.so+0xc7d1e0], sa_mask[0]=11111111011111111101111111111110, sa_flags=SA_RESTART|SA_SIGINFO
SIGINT: SIG_IGN, sa_mask[0]=00000000000000000000000000000000, sa_flags=none
SIGTERM: [libjvm.so+0xc7d1e0], sa_mask[0]=11111111011111111101111111111110, sa_flags=SA_RESTART|SA_SIGINFO
SIGQUIT: [libjvm.so+0xc7d1e0], sa_mask[0]=11111111011111111101111111111110, sa_flags=SA_RESTART|SA_SIGINFO


---------------  S Y S T E M  ---------------

OS:CentOS Linux release 7.8.2003 (Core)
uname:Linux 3.10.0-1160.102.1.el7.x86_64 #1 SMP Tue Oct 17 15:42:21 UTC 2023 x86_64
libc:glibc 2.17 NPTL 2.17 
rlimit: STACK 8192k, CORE 0k, NPROC 65535, NOFILE 65536, AS infinity, DATA infinity, FSIZE infinity
load average:2.27 1.91 2.08

/proc/meminfo:
MemTotal:       131429420 kB
MemFree:         1379648 kB
MemAvailable:   38763548 kB
Buffers:              20 kB
Cached:         36969684 kB
SwapCached:            0 kB
Active:         44173108 kB
Inactive:       15842932 kB
Active(anon):   24273444 kB
Inactive(anon):   125184 kB
Active(file):   19899664 kB
Inactive(file): 15717748 kB
Unevictable:    65156824 kB
Mlocked:        65157044 kB
SwapTotal:             0 kB
SwapFree:              0 kB
Dirty:              9792 kB
Writeback:             0 kB
AnonPages:      88203704 kB
Mapped:          7320200 kB
Shmem:            239616 kB
Slab:            2866764 kB
SReclaimable:    2392544 kB
SUnreclaim:       474220 kB
KernelStack:       73072 kB
PageTables:       314304 kB
NFS_Unstable:          0 kB
Bounce:                0 kB
WritebackTmp:          0 kB
CommitLimit:    65714708 kB
Committed_AS:   70593592 kB
VmallocTotal:   34359738367 kB
VmallocUsed:      575472 kB
VmallocChunk:   34290763772 kB
Percpu:            83200 kB
HardwareCorrupted:     0 kB
AnonHugePages:  42917888 kB
CmaTotal:              0 kB
CmaFree:               0 kB
HugePages_Total:       0
HugePages_Free:        0
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
DirectMap4k:      279552 kB
DirectMap2M:     7718912 kB
DirectMap1G:    127926272 kB


/proc/sys/kernel/threads-max (system-wide limit on the number of threads):
1024736


/proc/sys/vm/max_map_count (maximum number of memory map areas a process may have):
262144


/proc/sys/kernel/pid_max (system-wide limit on number of process identifiers):
327680



container (cgroup) information:
container_type: cgroupv1
cpu_cpuset_cpus: 0-95
cpu_memory_nodes: 0-1
active_processor_count: 96
cpu_quota: no quota
cpu_period: 100000
cpu_shares: no shares
memory_limit_in_bytes: unlimited
memory_and_swap_limit_in_bytes: unlimited
memory_soft_limit_in_bytes: unlimited
memory_usage_in_bytes: 128177926144
memory_max_usage_in_bytes: unlimited

Steal ticks since vm start: 0
Steal ticks percentage since vm start:  0.000

CPU:total 96 (initial active 96) (24 cores per cpu, 2 threads per core) family 6 model 85 stepping 7, cmov, cx8, fxsr, mmx, sse, sse2, sse3, ssse3, sse4.1, sse4.2, popcnt, avx, avx2, aes, clmul, erms, rtm, 3dnowpref, lzcnt, ht, tsc, tscinvbit, bmi1, bmi2, adx, evex, fma
CPU Model and flags from /proc/cpuinfo:
model name	: Intel(R) Xeon(R) Gold 5220R CPU @ 2.20GHz
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb cat_l3 cdp_l3 invpcid_single intel_ppin ssbd mba rsb_ctxsw ibrs ibpb stibp ibrs_enhanced tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm cqm mpx rdt_a avx512f avx512dq rdseed adx smap clflushopt clwb intel_pt avx512cd avx512bw avx512vl xsaveopt xsavec xgetbv1 cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local dtherm ida arat pln pts pku ospke avx512_vnni md_clear spec_ctrl intel_stibp flush_l1d arch_capabilities

Memory: 4k page, physical 131429420k(1379648k free), swap 0k(0k free)

vm_info: OpenJDK 64-Bit Server VM (13.0.1+9) for linux-amd64 JRE (13.0.1+9), built on Oct 26 2019 10:07:46 by ""jenkins"" with gcc 7.3.1 20180303 (Red Hat 7.3.1-5)

END.
",typuc,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/117810,2024-12-02T02:30:07Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/117810,"{
  ""application_resource"": ""yes""
}"
111,117374,Native controller process has stopped - no new native processes can be started,"Native controller process has stopped - no new native processes can be started
Operating system | AlmaLinux 9.5
elasticsearch 8.16.0
error log don't always write to /var/log/elasticsearch.log
",chongshengdz,closed,"[':Core/Infra/Core', ':ml', 'Team:Core/Infra', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/117374,2024-11-22T18:40:52Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/117374,"{
  ""application_resource"": ""yes""
}"
112,116564,[CI] ClassificationHousePricingIT testFeatureImportanceValues failing,"**Build Scans:**
- [elasticsearch-intake #15766 / part4](https://gradle-enterprise.elastic.co/s/jos4xy3r5j5j6)
- [elasticsearch-periodic #5850 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/clfmgzbq3baii)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationHousePricingIT.testFeatureImportanceValues"" -Dtests.seed=1572DE2E38E566FA -Dtests.locale=so-Latn-SO -Dtests.timezone=Europe/Andorra -Druntime.java=23
```

**Applicable branches:**
8.x

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationHousePricingIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testFeatureImportanceValues),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_house_pricing_test_feature_importance_values"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":100},{""phase"":""final_training"",""progress_percent"":100},{""phase"":""writing_results"",""progress_percent"":100},{""phase"":""inference"",""progress_percent"":70}],""data_counts"":{""training_docs_count"":510,""test_docs_count"":669,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1736895796099,""peak_usage_bytes"":572835,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1736895796099,""iteration"":0,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":0.05847558895962435,""downsample_factor"":0.23752714673596464,""eta"":0.02070965477416433,""eta_growth_rate_per_tree"":1.01035
[truncated]
```

**Issue Reasons:**
- [8.x] 2 failures in test testFeatureImportanceValues (1.4% fail rate in 146 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/116564,2024-11-11T08:37:47Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/116564,"{
  ""application_resource"": ""unsure""
}"
113,116536,[CI] StandardVersusLogsIndexModeRandomDataDynamicMappingChallengeRestIT testMatchAllQuery failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #4761 / sles-15_platform-support-unix](https://gradle-enterprise.elastic.co/s/tkdtgzdywrf5k)
- [elasticsearch-pull-request #39979 / part-2](https://gradle-enterprise.elastic.co/s/dygmxlunwq56a)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:logsdb:javaRestTest"" --tests ""org.elasticsearch.xpack.logsdb.qa.StandardVersusLogsIndexModeRandomDataDynamicMappingChallengeRestIT.testMatchAllQuery"" -Dtests.seed=C8F7D461A180B5E9 -Dtests.locale=szl-PL -Dtests.timezone=Europe/Athens -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.logsdb.qa.StandardVersusLogsIndexModeRandomDataDynamicMappingChallengeRestIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testMatchAllQuery),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.Exception: Test abandoned because suite timeout was reached.
```

**Issue Reasons:**
- [main] 2 failures in test testMatchAllQuery (0.3% fail rate in 622 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Logs', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/116536,2024-11-09T06:36:09Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/116536,"{
  ""application_resource"": ""unsure""
}"
114,116391,Data in a elasticsearch index is randomly getting deleted and the primary shard is getting unassigned,"### Elasticsearch Version

8.13.2

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

5.14.0-362.24.2.el9_3.x86_64

### Problem Description

I am using elasticsearch v8.13.2 with docker and single node. I have been facing loss of docs at random indices. this used to get resolved automatically earlier on increasing the ram size, but at current stage that is also not helping. Please let me know if you need any additional information to resolve this error.

I am using this command for docker -
```
docker run -d --restart unless-stopped \
  --name elasticsearch \
  --net elastic \
  -p 9200:9200 \
  -p 9300:9300 \
  -e ""discovery.type=single-node"" \
  -e ""xpack.security.enabled=false"" \
  -e ""xpack.security.audit.enabled=true"" \
  -e ""xpack.security.audit.logfile.events.emit_request_body=true"" \
  -e ""logger.org.elasticsearch.transport=TRACE"" \
  -m 2GB \
  -v elasticsearch-data:/usr/share/elasticsearch/data \
  -v /home/elasticsearch/backup:/home/elasticsearch/backup \
  -v /var/log/elasticsearch:/usr/share/elasticsearch/logs \
  --log-opt max-size=200m \
  --log-opt max-file=5 \
  docker.elastic.co/elasticsearch/elasticsearch:8.13.2
```

docker logs shows this type of exception -
```
{""@timestamp"":""2024-10-23T13:10:45.030Z"", ""log.level"": ""WARN"", ""message"":""Received response for a request that has timed out, sent [1.1m/69846ms] ago, timed out [54.8s/54836ms] ago, action [indices:monitor/stats[n]], node [{*****}{kn5WbDj1SNmnnzaEdYtAQA}{*****}{***}{172.18.0.2}{172.18.0.2:9300}{***}{8.13.2}{7000099-8503000}{ml.machine_memory=23622320128, ml.allocated_processors=32, ml.allocated_processors_double=32.0, ml.max_jvm_size=11811160064, ml.config_version=12.0.0, xpack.installed=true, transform.config_version=10.0.0}], id [105027]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[e6f71666ef1c][management][T#4]"",""log.logger"":""org.elasticsearch.transport.TransportService"",""elasticsearch.cluster.uuid"":""rFFNxXCdSuWNql4Ue33KCQ"",""elasticsearch.node.id"":""kn5WbDj1SNmnnzaEdYtAQA"",""elasticsearch.node.name"":""e6f71666ef1c"",""elasticsearch.cluster.name"":""docker-cluster""}
```



### Steps to Reproduce

I am not sure why this bug is occuring.

### Logs (if relevant)

Additional Logs related to this:

```
{
  ""index"" : ""sharedb"",
  ""node_allocation_decisions"" : [
    {
      ""node_name"" : ""e6f71666ef1c"",
      ""deciders"" : [
        {
          ""decider"" : ""max_retry"",
          ""decision"" : ""NO"",
          ""explanation"" : ""shard has exceeded the maximum number of retries [5] on failed allocation attempts - manually call [POST /_cluster/reroute?retry_failed&metric=none] to retry, [unassigned_info[[reason=ALLOCATION_FAILED], at[2024-10-30T11:06:31.920Z], failed_attempts[5], failed_nodes[[kn5WbDj1SNmnnzaEdYtAQA]], delayed=false, last_node[kn5WbDj1SNmnnzaEdYtAQA], details[failed shard on node [kn5WbDj1SNmnnzaEdYtAQA]: failed recovery, failure org.elasticsearch.indices.recovery.RecoveryFailedException: [sharedb][0]: Recovery failed on {e6f71666ef1c}{kn5WbDj1SNmnnzaEdYtAQA}{drcq8V_YQqmKLqImcGyrIA}{e6f71666ef1c}{172.18.0.2}{172.18.0.2:9300}{cdfhilmrstw}{8.13.2}{7000099-8503000}{ml.machine_memory=23622320128, ml.allocated_processors=32, ml.allocated_processors_double=32.0, ml.max_jvm_size=11811160064, ml.config_version=12.0.0, xpack.installed=true, transform.config_version=10.0.0}\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.IndexShard.lambda$executeRecovery$36(IndexShard.java:3313)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListener$2.onFailure(ActionListener.java:179)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.StoreRecovery.lambda$recoveryListener$9(StoreRecovery.java:394)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListener$2.onFailure(ActionListener.java:179)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations.safeOnFailure(ActionListenerImplementations.java:73)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.DelegatingActionListener.onFailure(DelegatingActionListener.java:31)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.StoreRecovery.lambda$internalRecoverFromStore$12(StoreRecovery.java:498)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations$DelegatingResponseActionListener.acceptException(ActionListenerImplementations.java:186)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations$DelegatingResponseActionListener.onFailure(ActionListenerImplementations.java:191)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations.safeOnFailure(ActionListenerImplementations.java:73)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.DelegatingActionListener.onFailure(DelegatingActionListener.java:31)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations$RunBeforeActionListener.onFailure(ActionListenerImplementations.java:317)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener$FailureResult.complete(SubscribableListener.java:378)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener.tryComplete(SubscribableListener.java:290)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener.addListener(SubscribableListener.java:189)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener.addListener(SubscribableListener.java:165)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:494)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:94)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:2449)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionRunnable$4.doRun(ActionRunnable.java:95)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:984)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: [sharedb/uYcf1bOUSgSEWY380No1JA][[sharedb][0]] org.elasticsearch.index.shard.IndexShardRecoveryException: failed to recover from gateway\n\t... 21 more\nCaused by: [sharedb/uYcf1bOUSgSEWY380No1JA][[sharedb][0]] org.elasticsearch.index.engine.EngineCreationFailureException: failed to create engine\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:274)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:224)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.IndexShard.createEngine(IndexShard.java:2125)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2098)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:2059)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.StoreRecovery.lambda$internalRecoverFromStore$10(StoreRecovery.java:485)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListenerImplementations$ResponseWrappingActionListener.onResponse(ActionListenerImplementations.java:245)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener$SuccessResult.complete(SubscribableListener.java:366)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener.tryComplete(SubscribableListener.java:286)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener.addListener(SubscribableListener.java:189)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener.lambda$andThen$0(SubscribableListener.java:437)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.ActionListener.run(ActionListener.java:356)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener.newForked(SubscribableListener.java:128)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener.andThen(SubscribableListener.java:437)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.action.support.SubscribableListener.andThen(SubscribableListener.java:411)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:417)\n\t... 8 more\nCaused by: org.apache.lucene.store.LockObtainFailedException: Lock held by another program: /usr/share/elasticsearch/data/indices/uYcf1bOUSgSEWY380No1JA/0/index/write.lock\n\tat org.apache.lucene.core@9.10.0/org.apache.lucene.store.NativeFSLockFactory.obtainFSLock(NativeFSLockFactory.java:117)\n\tat org.apache.lucene.core@9.10.0/org.apache.lucene.store.FSLockFactory.obtainLock(FSLockFactory.java:43)\n\tat org.apache.lucene.core@9.10.0/org.apache.lucene.store.BaseDirectory.obtainLock(BaseDirectory.java:44)\n\tat org.apache.lucene.core@9.10.0/org.apache.lucene.store.FilterDirectory.obtainLock(FilterDirectory.java:106)\n\tat org.apache.lucene.core@9.10.0/org.apache.lucene.store.FilterDirectory.obtainLock(FilterDirectory.java:106)\n\tat org.apache.lucene.core@9.10.0/org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:953)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.engine.InternalEngine.createWriter(InternalEngine.java:2662)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.engine.InternalEngine.createWriter(InternalEngine.java:2650)\n\tat org.elasticsearch.server@8.13.2/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:267)\n\t... 24 more\n], allocation_status[deciders_no]]]""
        }
      ]
    }
  ]
}
```",hariv0,closed,"['>bug', ':Distributed Coordination/Allocation', 'Team:Distributed Coordination']",https://github.com/elastic/elasticsearch/issues/116391,2024-11-07T10:05:46Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/116391,"{
  ""application_resource"": ""yes""
}"
115,116234,[CI] ClassificationIT testDeleteExpiredData_RemovesUnusedState failing,"**Build Scans:**
- [elasticsearch-periodic #6261 / openjdk17_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/47ar66a5jwxeq)
- [elasticsearch-pull-request #55174 / part-4](https://gradle-enterprise.elastic.co/s/bbhrqqs72lucm)
- [elasticsearch-periodic #6198 / openjdk21_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/3wxqpps5xt3qc)
- [elasticsearch-periodic #6149 / openjdk22_checkpart4_java-matrix](https://gradle-enterprise.elastic.co/s/a2c5pp4kh2gts)

**Reproduction Line:**
```
./gradlew "":x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest"" --tests ""org.elasticsearch.xpack.ml.integration.ClassificationIT.testDeleteExpiredData_RemovesUnusedState"" -Dtests.seed=80798C2AA7F34E40 -Dtests.locale=se-SE -Dtests.timezone=Iran -Druntime.java=17
```

**Applicable branches:**
8.18

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.ml.integration.ClassificationIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testDeleteExpiredData_RemovesUnusedState),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_delete_expired_data"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":99},{""phase"":""fine_tuning_parameters"",""progress_percent"":0},{""phase"":""final_training"",""progress_percent"":0},{""phase"":""writing_results"",""progress_percent"":0},{""phase"":""inference"",""progress_percent"":0}],""data_counts"":{""training_docs_count"":100,""test_docs_count"":0,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1738965736252,""peak_usage_bytes"":14691,""status"":""ok""},""node"":{""id"":""U4eNy60NQEKwrum5GYPKIQ"",""name"":""javaRestTest-1"",""ephemeral_id"":""4jnQhD-0Qm2_PMOa6N2Eww"",""transport_address"":""127.0.0.1:32923"",""attributes"":{""testattr"":""test"",""ml.allocated_processors"":""32"",""ml.max_jvm_size"":""536870912"",""ml.config_version"":""12.0.0"",""ml.machine_memory"":""126604197888"",""ml.allocated_processor
[truncated]
```

**Issue Reasons:**
- [8.18] 4 failures in test testDeleteExpiredData_RemovesUnusedState (0.6% fail rate in 619 executions)
- [8.18] 3 failures in pipeline elasticsearch-periodic (17.6% fail rate in 17 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/116234,2024-11-05T09:49:29Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/116234,"{
  ""application_resource"": ""unsure""
}"
116,116203,Shards did not rebalance immediately after hardware failure on data node,"### Elasticsearch Version

5.6.16

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux cluster-1-master-2 4.14.326-245.539.amzn2.x86_64 #1 SMP Tue Sep 26 09:59:02 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux

### Problem Description

We encountered an issue where Elasticsearch did not automatically rebalance shards after a hardware failure on one of our data nodes. This caused an extended period of degraded performance until manual intervention was performed.


EC2 instance went unhealthy on 2024-10-28 20:40 UTC 
EC2 instance became healthy back on 2024-10-28 21:10 UTC


Elastic search rebalanced the shards at 2024-10-28 21:10 UTC only.

Wanted to know the reason for high time to rebalance the shard. Have attached the master node logs


[es_oct_28.log](https://github.com/user-attachments/files/17622677/es_oct_28.log)



ES cluster settings

## Cluster level settings.
cluster.name: fc-use1-00-conversation-cluster-1

## Discovery settings.
discovery.zen.minimum_master_nodes: 2
discovery.zen.ping.unicast.hosts: [XXX]

# discovery.zen.ping.timeout: 15s
discovery.zen.fd.ping_interval: 10s
discovery.zen.fd.ping_timeout: 10s
discovery.zen.fd.ping_retries: 6


action.auto_create_index: true

indices.memory.index_buffer_size: 30%

indices.store.throttle.max_bytes_per_sec: 100mb

## Node level settings.
node.data: false
node.master: true
node.name: cluster-1-master-1



cluster.routing.allocation.awareness.force.zone.values: zone-a,zone-b,zone-c,zone-d,zone-e,zone-f
cluster.routing.allocation.awareness.attributes: zone

http.enabled: true

## Loopback interface


### Steps to Reproduce

Steps to Reproduce:

- Simulate a hardware failure on one of the data nodes by stopping or disconnecting the instance.
- Observe the state of shard allocation and rebalancing.
- Notice that Elasticsearch does not immediately initiate shard rebalancing across available nodes.

### Logs (if relevant)

_No response_",Harif-Rahman,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/116203,2024-11-04T19:01:12Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/116203,"{
  ""application_resource"": ""yes""
}"
117,116110,[CI] MixedClusterClientYamlTestSuiteIT test {p0=cat.shards/10_basic/Help} failing,"**Build Scans:**
- [elasticsearch-intake #12302 / 8.17.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/4gpylvctqsajq)
- [elasticsearch-pull-request #39545 / 8.17.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/ay63qqgzy6tkm)
- [elasticsearch-pull-request #39541 / 8.17.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/hitrowjr5k4oc)
- [elasticsearch-intake #12296 / 8.17.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/2bn7ixgqko6ti)

**Reproduction Line:**
```
./gradlew "":qa:mixed-cluster:v8.17.0#mixedClusterTest"" -Dtests.class=""org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=cat.shards/10_basic/Help}"" -Dtests.seed=9933C87666406E07 -Dtests.bwc=true -Dtests.locale=doi-Deva-IN -Dtests.timezone=EAT -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(test%20%7Bp0%3Dcat.shards%2F10_basic%2FHelp%7D),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Failure at [cat.shards/10_basic:10]: field [$body] was expected to match the provided regex but didn't
Expected: ^   index                            .+   \n
     shard                            .+   \n
     prirep                           .+   \n
     state                            .+   \n
     docs                             .+   \n
     store                            .+   \n
     dataset                          .+   \n
     ip                               .+   \n
     id                               .+   \n
     node                             .+   \n
     unassigned.reason                .+   \n
     unassigned.at                    .+   \n
     unassigned.for                   .+   \n
     unassigned.details               .+   \n
     recoverysource.type              .+   \n
     completion.size                  .+   \n
     fielddata.memory_size            .+   \n
     fielddata.evictions              .+   \n
     query_cache.memory_size          .+   \n
     query_cache.evictions            .+   \n
     flush.total                      .+   \n
     flush.total_time                 .+   \n
     get.current                      .+   \n
     get.time                         .+   \n
     get.total                        .+   \n
     get.exists_time                  .+   \n
     get.exists_total                 .+   \n
     get.missing_time                 .+   \n
     get.missing_total                .+   \n
     indexing.delete_current          .+   \n
     indexing.delete_time             .+   \n
     indexing.delete_total            .+   \n
     indexing.index_current           .+   \n
     indexing.index_time              .+   \n
     indexing.index_total             .+   \n
     indexing.index_failed            .+   \n
     merges.current                   .+   \n
     merges.current_docs              .+   \n
     merges.current_size              .+   \n
     merges.total                     .+   \n
     merges.total_docs                .+   \n
     merges.total_size                .+   \n
     merges.total_time                .+   \n
     refresh.total                    .+   \n
     refresh.time                     .+   \n
     refresh.external_total           .+   \n
     refresh.external_time            .+   \n
     refresh.listeners                .+   \n
     search.fetch_current             .+   \n
     search.fetch_time                .+   \n
     search.fetch_total               .+   \n
     search.open_contexts             .+   \n
     search.query_current             .+   \n
     search.query_time                .+   \n
     search.query_total               .+   \n
     search.scroll_current            .+   \n
     search.scroll_time               .+   \n
     search.scroll_total              .+   \n
     segments.count                   .+   \n
     segments.memory                  .+   \n
     segments.index_writer_memory     .+   \n
     segments.version_map_memory      .+   \n
     segments.fixed_bitset_memory     .+   \n
     seq_no.max                       .+   \n
     seq_no.local_checkpoint          .+   \n
     seq_no.global_checkpoint         .+   \n
     warmer.current                   .+   \n
     warmer.total                     .+   \n
     warmer.total_time                .+   \n
     path.data                        .+   \n
     path.state                       .+   \n
     bulk.total_operations            .+   \n
     bulk.total_time                  .+   \n
     bulk.total_size_in_bytes         .+   \n
     bulk.avg_time                    .+   \n
     bulk.avg_size_in_bytes           .+   \n
     dense_vector.value_count         .+   \n
     sparse_vector.value_count        .+   \n
$
     but: was ""index                        | i,idx                          | index name                                                                                                       \nshard                        | s,sh                           | shard name                                                                                                       \nprirep                       | p,pr,primaryOrReplica          | primary or replica                                                                                               \nstate                        | st                             | shard state                                                                                                      \ndocs                         | d,dc                           | number of docs in shard                                                                                          \nstore                        | sto                            | store size of shard (how much disk it uses)                                                                      \ndataset                      |                                | total size of dataset                                                                                            \nip                           |                                | ip of node where it lives                                                                                        \nid                           |                                | unique id of node where it lives                                                                                 \nnode                         | n                              | name of node where it lives                                                                                      \nsync_id                      | sync_id                        | sync id                                                                                                          \nunassigned.reason            | ur                             | reason shard became unassigned                                                                                   \nunassigned.at                | ua                             | time shard became unassigned (UTC)                                                                               \nunassigned.for               | uf                             | time has been unassigned                                                                                         \nunassigned.details           | ud                             | additional details as to why the shard became unassigned                                                         \nrecoverysource.type          | rs                             | recovery source type                                                                                             \ncompletion.size              | cs,completionSize              | size of completion                                                                                               \nfielddata.memory_size        | fm,fielddataMemory             | used fielddata cache                                                                                             \nfielddata.evictions          | fe,fielddataEvictions          | fielddata evictions                                                                                              \nquery_cache.memory_size      | qcm,queryCacheMemory           | used query cache                                                                                                 \nquery_cache.evictions        | qce,queryCacheEvictions        | query cache evictions                                                                                            \nflush.total                  | ft,flushTotal                  | number of flushes                                                                                                \nflush.total_time             | ftt,flushTotalTime             | time spent in flush                                                                                              \nget.current                  | gc,getCurrent                  | number of current get ops                                                                                        \nget.time                     | gti,getTime                    | time spent in get                                                                                                \nget.total                    | gto,getTotal                   | number of get ops                                                                                                \nget.exists_time              | geti,getExistsTime             | time spent in successful gets                                                                                    \nget.exists_total             | geto,getExistsTotal            | number of successful gets                                                                                        \nget.missing_time             | gmti,getMissingTime            | time spent in failed gets                                                                                        \nget.missing_total            | gmto,getMissingTotal           | number of failed gets                                                                                            \nindexing.delete_current      | idc,indexingDeleteCurrent      | number of current deletions                                                                                      \nindexing.delete_time         | idti,indexingDeleteTime        | time spent in deletions                                                                                          \nindexing.delete_total        | idto,indexingDeleteTotal       | number of delete ops                                                                                             \nindexing.index_current       | iic,indexingIndexCurrent       | number of current indexing ops                                                                                   \nindexing.index_time          | iiti,indexingIndexTime         | time spent in indexing                                                                                           \nindexing.index_total         | iito,indexingIndexTotal        | number of indexing ops                                                                                           \nindexing.index_failed        | iif,indexingIndexFailed        | number of failed indexing ops                                                                                    \nmerges.current               | mc,mergesCurrent               | number of current merges                                                                                         \nmerges.current_docs          | mcd,mergesCurrentDocs          | number of current merging docs                                                                                   \nmerges.current_size          | mcs,mergesCurrentSize          | size of current merges                                                                                           \nmerges.total                 | mt,mergesTotal                 | number of completed merge ops                                                                                    \nmerges.total_docs            | mtd,mergesTotalDocs            | docs merged                                                                                                      \nmerges.total_size            | mts,mergesTotalSize            | size merged                                                                                                      \nmerges.total_time            | mtt,mergesTotalTime            | time spent in merges                                                                                             \nrefresh.total                | rto,refreshTotal               | total refreshes                                                                                                  \nrefresh.time                 | rti,refreshTime                | time spent in refreshes                                                                                          \nrefresh.external_total       | rto,refreshTotal               | total external refreshes                                                                                         \nrefresh.external_time        | rti,refreshTime                | time spent in external refreshes                                                                                 \nrefresh.listeners            | rli,refreshListeners           | number of pending refresh listeners                                                                              \nsearch.fetch_current         | sfc,searchFetchCurrent         | current fetch phase ops                                                                                          \nsearch.fetch_time            | sfti,searchFetchTime           | time spent in fetch phase                                                                                        \nsearch.fetch_total           | sfto,searchFetchTotal          | total fetch ops                                                                                                  \nsearch.open_contexts         | so,searchOpenContexts          | open search contexts                                                                                             \nsearch.query_current         | sqc,searchQueryCurrent         | current query phase ops                                                                                          \nsearch.query_time            | sqti,searchQueryTime           | time spent in query phase                                                                                        \nsearch.query_total           | sqto,searchQueryTotal          | total query phase ops                                                                                            \nsearch.scroll_current        | scc,searchScrollCurrent        | open scroll contexts                                                                                             \nsearch.scroll_time           | scti,searchScrollTime          | time scroll contexts held open                                                                                   \nsearch.scroll_total          | scto,searchScrollTotal         | completed scroll contexts                                                                                        \nsegments.count               | sc,segmentsCount               | number of segments                                                                                               \nsegments.memory              | sm,segmentsMemory              | memory used by segments                                                                                          \nsegments.index_writer_memory | siwm,segmentsIndexWriterMemory | memory used by index writer                                                                                      \nsegments.version_map_memory  | svmm,segmentsVersionMapMemory  | memory used by version map                                                                                       \nsegments.fixed_bitset_memory | sfbm,fixedBitsetMemory         | memory used by fixed bit sets for nested object field types and type filters for types referred in _parent fields\nseq_no.max                   | sqm,maxSeqNo                   | max sequence number                                                                                              \nseq_no.local_checkpoint      | sql,localCheckpoint            | local checkpoint                                                                                                 \nseq_no.global_checkpoint     | sqg,globalCheckpoint           | global checkpoint                                                                                                \nwarmer.current               | wc,warmerCurrent               | current warmer ops                                                                                               \nwarmer.total                 | wto,warmerTotal                | total warmer ops                                                                                                 \nwarmer.total_time            | wtt,warmerTotalTime            | time spent in warmers                                                                                            \npath.data                    | pd,dataPath                    | shard data path                                                                                                  \npath.state                   | ps,statsPath                   | shard state path                                                                                                 \nbulk.total_operations        | bto,bulkTotalOperations        | number of bulk shard ops                                                                                         \nbulk.total_time              | btti,bulkTotalTime             | time spend in shard bulk                                                                                         \nbulk.total_size_in_bytes     | btsi,bulkTotalSizeInBytes      | total size in bytes of shard bulk                                                                                \nbulk.avg_time                | bati,bulkAvgTime               | average time spend in shard bulk                                                                                 \nbulk.avg_size_in_bytes       | basi,bulkAvgSizeInBytes        | avg size in bytes of shard bulk                                                                                  \ndense_vector.value_count     | dvc,denseVectorCount           | number of indexed dense vectors in shard                                                                         \nsparse_vector.value_count    | svc,sparseVectorCount          | number of indexed sparse vectors in shard                                                                        \n""
```

**Issue Reasons:**
- [main] 2 consecutive failures in test test {p0=cat.shards/10_basic/Help}
- [main] 2 consecutive failures in step 8.17.0_bwc-snapshots
- [main] 4 failures in test test {p0=cat.shards/10_basic/Help} (2.9% fail rate in 137 executions)
- [main] 4 failures in step 8.17.0_bwc-snapshots (3.2% fail rate in 124 executions)
- [main] 2 failures in pipeline elasticsearch-intake (4.8% fail rate in 42 executions)
- [main] 2 failures in pipeline elasticsearch-pull-request (2.4% fail rate in 83 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':Distributed Indexing/Engine', 'low-risk', 'Team:Distributed Indexing']",https://github.com/elastic/elasticsearch/issues/116110,2024-11-01T17:11:35Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/116110,"{
  ""application_resource"": ""no""
}"
118,116052,[CI] DesiredNodesUpgradeIT testUpgradeDesiredNodes {upgradedNodes=3} failing,"**Build Scans:**
- [elasticsearch-periodic #4665 / 8.13.4_bwc](https://gradle-enterprise.elastic.co/s/njskrxr4m3mzo)
- [elasticsearch-periodic #4660 / openjdk17_8.16.0_java-matrix-bwc](https://gradle-enterprise.elastic.co/s/eefoyopjmrrp4)

**Reproduction Line:**
```
./gradlew "":qa:rolling-upgrade:v8.13.4#bwcTest"" -Dtests.class=""org.elasticsearch.upgrades.DesiredNodesUpgradeIT"" -Dtests.method=""testUpgradeDesiredNodes {upgradedNodes=2}"" -Dtests.seed=B652AF7DB9AE97C9 -Dtests.bwc=true -Dtests.locale=es-NI -Dtests.timezone=GB -Druntime.java=23
```

**Applicable branches:**
8.16

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.upgrades.DesiredNodesUpgradeIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testUpgradeDesiredNodes%20%7BupgradedNodes%3D3%7D),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
org.elasticsearch.client.ResponseException: method [PUT], host [http://[::1]:36339], URI [/_internal/desired_nodes/upgrade_test/3], status line [HTTP/1.1 400 Bad Request]
{""error"":{""root_cause"":[{""type"":""illegal_argument_exception"",""reason"":""Some nodes contain the same setting value [test-cluster-0, test-cluster-1] for [node.external_id]""}],""type"":""illegal_argument_exception"",""reason"":""Some nodes contain the same setting value [test-cluster-0, test-cluster-1] for [node.external_id]""},""status"":400}
```

**Issue Reasons:**
- [8.16] 2 failures in test testUpgradeDesiredNodes {upgradedNodes=3} (2.2% fail rate in 91 executions)
- [8.16] 2 failures in pipeline elasticsearch-periodic (50.0% fail rate in 4 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':Distributed Coordination/Allocation', 'low-risk', 'Team:Distributed Coordination']",https://github.com/elastic/elasticsearch/issues/116052,2024-10-31T20:58:50Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/116052,"{
  ""application_resource"": ""yes""
}"
119,115867,[CI] RandomExceptionCircuitBreakerIT testBreakerWithRandomExceptions failing,"### CI Link

https://gradle-enterprise.elastic.co/s/c6s5xwlb4qzhe

### Repro line

./gradlew "":server:internalClusterTest"" --tests ""org.elasticsearch.indices.memory.breaker.RandomExceptionCircuitBreakerIT"" -Dtests.seed=A9617E1EDF4FAD00 -Dtests.locale=en -Dtests.timezone=Etc/UTC -Druntime.java=23

### Does it reproduce?

Didn't try

### Applicable branches

8.x

### Failure history

_No response_

### Failure excerpt

```
on.operations"":""756"",""index.unassigned.node_left.delayed_timeout"":""0""}]
  1> [2024-10-29T13:25:26,482][WARN ][o.e.d.c.s.Settings       ] [node_s2] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""index.bloom_filter_for_id_field.enabled"" message=""[index.bloom_filter_for_id_field.enabled] setting was deprecated in Elasticsearch and will be removed in a future release.""
  1> [2024-10-29T13:25:26,501][INFO ][o.e.c.m.MetadataCreateIndexService] [node_s2] [test] creating index, cause [api], templates [random_index_template], shards [7]/[1]
  1> [2024-10-29T13:25:26,538][WARN ][o.e.d.c.s.Settings       ] [node_s5] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""index.bloom_filter_for_id_field.enabled"" message=""[index.bloom_filter_for_id_field.enabled] setting was deprecated in Elasticsearch and will be removed in a future release.""
  1> [2024-10-29T13:25:26,546][WARN ][o.e.d.c.s.Settings       ] [node_s3] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""index.bloom_filter_for_id_field.enabled"" message=""[index.bloom_filter_for_id_field.enabled] setting was deprecated in Elasticsearch and will be removed in a future release.""
  1> [2024-10-29T13:25:26,555][WARN ][o.e.d.c.s.Settings       ] [node_s4] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""index.bloom_filter_for_id_field.enabled"" message=""[index.bloom_filter_for_id_field.enabled] setting was deprecated in Elasticsearch and will be removed in a future release.""
  1> [2024-10-29T13:25:27,153][INFO ][o.e.c.r.a.AllocationService] [node_s2] current.health=""GREEN"" message=""Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[test][4]]])."" previous.health=""YELLOW"" reason=""shards started [[test][4]]""
  1> [2024-10-29T13:25:27,289][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] Start Refresh
  1> [2024-10-29T13:25:27,492][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] Refresh failed: [false] numShardsFailed: [0], shardFailuresLength: [0], successfulShards: [14], totalShards: [14] 
  1> [2024-10-29T13:25:27,694][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:27,986][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:28,199][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:28,237][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:28,352][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:28,471][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:28,559][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:28,586][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:28,663][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:28,754][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:28,792][INFO ][o.e.i.m.b.RandomExceptionCircuitBreakerIT] [testBreakerWithRandomExceptions] expected SearchPhaseException: [all shards failed]
  1> [2024-10-29T13:25:34,140][ERROR][o.e.t.LeakTracker        ] [[Cleaner-0]] LEAK: resource was not cleaned up before it was garbage-collected.
  1> Recent access records: 
  1> Created at:
  1> 	in [TEST-RandomExceptionCircuitBreakerIT.testBreakerWithRandomExceptions-seed#[A9617E1EDF4FAD00]][testBreakerWithRandomExceptions]
  1> 	org.elasticsearch.action.search.ArraySearchPhaseResults.<init>(ArraySearchPhaseResults.java:28)
  1> 	org.elasticsearch.action.search.QueryPhaseResultConsumer.<init>(QueryPhaseResultConsumer.java:86)
  1> 	org.elasticsearch.action.search.SearchPhaseController.newSearchPhaseResults(SearchPhaseController.java:841)
  1> 	org.elasticsearch.action.search.TransportSearchAction$AsyncSearchActionProvider.newSearchPhase(TransportSearchAction.java:1500)
  1> 	org.elasticsearch.action.search.TransportSearchAction.executeSearch(TransportSearchAction.java:1305)
  1> 	org.elasticsearch.action.search.TransportSearchAction.executeLocalSearch(TransportSearchAction.java:1038)
  1> 	org.elasticsearch.action.search.TransportSearchAction.lambda$executeRequest$4(TransportSearchAction.java:365)
  1> 	org.elasticsearch.action.ActionListenerImplementations$ResponseWrappingActionListener.onResponse(ActionListenerImplementations.java:247)
  1> 	org.elasticsearch.index.query.Rewriteable.rewriteAndFetch(Rewriteable.java:109)
  1> 	org.elasticsearch.index.query.Rewriteable.rewriteAndFetch(Rewriteable.java:77)
  1> 	org.elasticsearch.action.search.TransportSearchAction.executeRequest(TransportSearchAction.java:531)
  1> 	org.elasticsearch.action.search.TransportSearchAction.doExecute(TransportSearchAction.java:316)
  1> 	org.elasticsearch.action.search.TransportSearchAction.doExecute(TransportSearchAction.java:121)
  1> 	org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:135)
  1> 	org.elasticsearch.action.support.TransportAction.handleExecution(TransportAction.java:96)
  1> 	org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:59)
  1> 	org.elasticsearch.tasks.TaskManager.registerAndExecute(TaskManager.java:197)
  1> 	org.elasticsearch.client.internal.node.NodeClient.executeLocally(NodeClient.java:106)
  1> 	org.elasticsearch.client.internal.node.NodeClient.doExecute(NodeClient.java:84)
  1> 	org.elasticsearch.client.internal.support.AbstractClient.execute(AbstractClient.java:140)
  1> 	org.elasticsearch.client.internal.FilterClient.doExecute(FilterClient.java:56)
  1> 	org.elasticsearch.client.internal.support.AbstractClient.execute(AbstractClient.java:140)
  1> 	org.elasticsearch.client.internal.support.AbstractClient.execute(AbstractClient.java:126)
```",Tim-Brooks,closed,"['>test-failure', 'needs:risk', 'Team:Search Foundations', ':Search Foundations/Search']",https://github.com/elastic/elasticsearch/issues/115867,2024-10-29T18:05:56Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/115867,"{
  ""application_resource"": ""yes""
}"
120,115711,[CI] JvmStatsTests testJvmStats failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #4712 / windows-2016_checkpart1_platform-support-windows](https://gradle-enterprise.elastic.co/s/hzfl3uwgoppt2)
- [elasticsearch-periodic #4725 / openjdk21_checkpart1_java-matrix](https://gradle-enterprise.elastic.co/s/biu3xcdl4hpcu)
- [elasticsearch-periodic-platform-support #4650 / oraclelinux-7_platform-support-unix](https://gradle-enterprise.elastic.co/s/isvygxhms37rg)

**Reproduction Line:**
```
gradlew "":server:test"" --tests ""org.elasticsearch.monitor.jvm.JvmStatsTests.testJvmStats"" -Dtests.seed=6AFCA2FBADE59C60 -Dtests.locale=bo-Tibt-CN -Dtests.timezone=Brazil/Acre -Druntime.java=23
```

**Applicable branches:**
8.16

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.monitor.jvm.JvmStatsTests),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(testJvmStats),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: 
Expected: a value greater than <0L>
     but: <0L> was equal to <0L>
```

**Issue Reasons:**
- [8.16] 3 failures in test testJvmStats (0.7% fail rate in 417 executions)
- [8.16] 2 failures in pipeline elasticsearch-periodic-platform-support (15.4% fail rate in 13 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"[':Core/Infra/Core', '>test-failure', 'Team:Core/Infra', 'low-risk']",https://github.com/elastic/elasticsearch/issues/115711,2024-10-26T04:56:30Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/115711,"{
  ""application_resource"": ""unsure""
}"
121,115221,[CI] GroupMappingIT class failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #5495 / almalinux-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/rckpsckouvq5c)
- [elasticsearch-periodic-platform-support #5490 / rocky-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/m4xjf7ro5zgom)
- [elasticsearch-periodic-platform-support #5490 / rhel-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/wx65usescfdzk)
- [elasticsearch-periodic-platform-support #5485 / rhel-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/6uviis2zykenm)
- [elasticsearch-periodic-platform-support #5485 / rocky-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/ljinccmxh3f32)
- [elasticsearch-periodic-platform-support #5480 / rocky-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/ty7r4yyvvtxwe)
- [elasticsearch-periodic-platform-support #5480 / rhel-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/lqdoogsxrucqu)
- [elasticsearch-periodic-platform-support #5475 / rocky-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/6e4lsy5ycim72)
- [elasticsearch-periodic-platform-support #5475 / rhel-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/o5zarj3grwuf2)
- [elasticsearch-periodic-platform-support #5470 / rhel-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/x35barcmj4oau)

**Reproduction Line:**
```
undefined
```

**Applicable branches:**
8.17

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.xpack.security.authc.ldap.GroupMappingIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(org.elasticsearch.xpack.security.authc.ldap.GroupMappingIT),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
undefined
```

**Issue Reasons:**
- [8.17] 19 consecutive failures in step rocky-9_platform-support-unix
- [8.17] 20 consecutive failures in step rhel-9_platform-support-unix
- [8.17] 40 failures in class org.elasticsearch.xpack.security.authc.ldap.GroupMappingIT (6.0% fail rate in 669 executions)
- [8.17] 19 failures in step rocky-9_platform-support-unix (100.0% fail rate in 19 executions)
- [8.17] 20 failures in step rhel-9_platform-support-unix (100.0% fail rate in 20 executions)
- [8.17] 21 failures in pipeline elasticsearch-periodic-platform-support (100.0% fail rate in 21 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"[':Delivery/Build', '>test-failure', 'Team:Delivery', 'low-risk']",https://github.com/elastic/elasticsearch/issues/115221,2024-10-21T12:55:45Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/115221,"{
  ""application_resource"": ""unsure""
}"
122,115170,[CI] UpgradeClusterClientYamlTestSuiteIT class failing,"**Build Scans:**
- [elasticsearch-periodic #4977 / 8.1.3_bwc](https://gradle-enterprise.elastic.co/s/h5uqet7qkjw3y)
- [elasticsearch-periodic #4971 / 8.1.3_bwc](https://gradle-enterprise.elastic.co/s/57mdxhvkqpcf6)
- [elasticsearch-periodic #4965 / 8.1.3_bwc](https://gradle-enterprise.elastic.co/s/icjhmm2ozuvow)
- [elasticsearch-periodic #4960 / 8.1.3_bwc](https://gradle-enterprise.elastic.co/s/ubrwsn4jd64m6)

**Reproduction Line:**
```
./gradlew "":x-pack:qa:rolling-upgrade:v8.1.3#twoThirdsUpgradedTest"" -Dtests.class=""org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=mixed_cluster/80_transform_jobs_crud/Test GET, start, and stop old cluster batch transforms}"" -Dtests.seed=D2241D3F9ECED5B0 -Dtests.bwc=true -Dtests.locale=ku-Latn-TR -Dtests.timezone=Atlantic/Reykjavik -Druntime.java=23
```

**Applicable branches:**
8.16

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupState:(initialChildControlState:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:task.keyword,order:0,selectedOptions:!(),title:'GradleTask',type:optionsListControl),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:className.keyword,order:1,selectedOptions:!(org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT),title:'Suite',type:optionsListControl),'144933da-5c1b-4257-a969-7f43455a7901':(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,fieldName:name.keyword,order:2,selectedOptions:!(org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT),title:'Test',type:optionsListControl)))))

**Failure Message:**
```
java.lang.AssertionError: Failure in test setup: Failed to initialize at least 3 watcher nodes
```

**Issue Reasons:**
- [8.16] 4 failures in class org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT (0.4% fail rate in 1000 executions)
- [8.16] 4 failures in step 8.1.3_bwc (100.0% fail rate in 4 executions)
- [8.16] 4 failures in pipeline elasticsearch-periodic (100.0% fail rate in 4 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/115170,2024-10-19T21:06:51Z,9,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/115170,"{
  ""application_resource"": ""unsure""
}"
123,115104,Elasticsearch 8.15 fails bootstrap check without additional dependencies,"### Elasticsearch Version

8.15.2

### Installed Plugins

_No response_

### Java Version

17.0.12

### OS Version

Amazon Linux 2 kernel 5.15.167-112.165.amzn2.x86_64 / Alpine Linux 3.2.0

### Problem Description

The 8.15 Elasticsearch upgrade seems to have changed the way bootstrap checks are done which results in startup failing without certain new dependencies which were not previously mandated ([this commit](https://github.com/elastic/elasticsearch/commit/bc499e7c830d55c94042f141e4c1501348f397aa) may be part of the issue). This is not documented in the Release Notes or Breaking Changes for 8.15 or 8.15.2 in particular. We have tried in docker containers with 2 types of OS's and the bootstrap check fails on both due to missing dependencies

- AL2: libzstd not found
- Alpine Linux: libsystemd not found

For AL2, installing libzstd did allow startup to continue. For Alpine Linux, there is no good solution since the libsystemd is not available for install at all. This has been reported in the forums where there has been no resolution - https://discuss.elastic.co/t/bootstrapcheck-using-a-non-available-library/365826

Moreover, this seems to be a bug or unintended side effect of the changes made for 8.15 and is blocking our upgrade since we cannot account for additional libraries being installed for a minor version bump. This should be addressed so that installs on 8.14 can continue using the same infrastructure.

A post was already made in Elastic forums which has not had any responses - https://discuss.elastic.co/t/bootstrap-check-failure-in-8-15-2/368660

### Steps to Reproduce

- Our setup includes a docker container based off Amazon Linux 2
- We install elasticsearch distribution from https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.15.2-windows-x86_64.zip and make some modifications to deploy it across multiple platforms
- We use our own Java 17 environment, not the one shipped with the distribution
- We attempt to start using the bin/elasticsearch binary but the bootstrap checks fail before we get to any further steps due to the libzstd dependency. This does not halt startup in 8.14

- In addition, we run automated tests on Alpine linux where startup fails due to libsystemd not being found and there does not seem to be a good way to work around this due to libsystemd not being supported on Alpine.

### Logs (if relevant)

**AL2**:
```
java.lang.UnsatisfiedLinkError: Unable to load library 'zstd':
libzstd.so: cannot open shared object file: No such file or directory
libzstd.so: cannot open shared object file: No such file or directory
Native library (linux-x86-64/libzstd.so) not found in resource path ()
........
........
[ERROR][org.elasticsearch.bootstrap.Elasticsearch] [server-deployment] node validation exception
[2] bootstrap checks failed. You must address the points described in the following [2] lines before starting Elasticsearch. For more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/bootstrap-checks.html]
bootstrap check failure [1] of [2]: max size virtual memory [-1] for user [<redacted>] is too low, increase to [unlimited]; for more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/max-size-virtual-memory-check.html]
bootstrap check failure [2] of [2]: max file size [-1] for user [<redacted>] is too low, increase to [unlimited]; for more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/_max_file_size_check.html]
```

**Alpine**:
```
java.lang.UnsatisfiedLinkError: Unable to load library 'libsystemd.so.0':
Error loading shared library libsystemd.so.0: No such file or directory
Error loading shared library libsystemd.so.0: No such file or directory
Native library (linux-x86-64/libsystemd.so.0) not found in resource path ()
........
........
[ERROR][org.elasticsearch.bootstrap.Elasticsearch] [localhost] node validation exception
[2] bootstrap checks failed. You must address the points described in the following [2] lines before starting Elasticsearch. For more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/bootstrap-checks.html]
bootstrap check failure [1] of [2]: max size virtual memory [-1] for user [<redacted>] is too low, increase to [unlimited]; for more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/max-size-virtual-memory-check.html]
bootstrap check failure [2] of [2]: max file size [-1] for user [<redacted>] is too low, increase to [unlimited]; for more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/_max_file_size_check.html]
```",mousumis,closed,"['>bug', ':Core/Infra/Core', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/115104,2024-10-18T14:00:23Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/115104,"{
  ""application_resource"": ""yes""
}"
124,114941,ES nodes OOM due to unbounded allocation's in Lucene90DocValuesProducer,"### Elasticsearch Version

8.15.1

### Installed Plugins

None

### Java Version

_bundled_

### OS Version

Ubuntu 20.04.6 LTS

### Problem Description

When we issue a search where the following two conditions are true, ES OOM's:
1. The index being searched contains documents with large geojson fields.
2. The query is an aggregation query and the buckets are geojson buckets using the field in 1.

In the referenced repro repository I:
1. Start ES in docker with 1GB of memory.
2. Create a new index.
3. Index some points.
4. Index a document with a large geometry.
5. Force merge (this seems to be necessary to get the right info on disk for the failure to happen).
6. Run an aggregation search against that index and geometry field.
7. OOM.

When I open up the head dump in VisualVM I see that most of the memory is taken by byte[]:
![image](https://github.com/user-attachments/assets/e55484be-7b77-42c1-8907-f18d6ca1bf77)

If I dig in a bit further, we've tried to initialize a bunch of these TwoPhaseFilterMatchingDisiWrapper objects.
![image](https://github.com/user-attachments/assets/b2dec7b6-61e7-4cad-935f-45d1053e3df0)

In each of those we're initializing these 30MB byte arrays that are all 0's inside of the `ShapeDocValuesQuery` via a `Lucene90DocValuesProducer`:
![image](https://github.com/user-attachments/assets/6da233c6-ece5-44c2-9f08-b8a79f5a1252)

Notably, these byte arrays hav 30,462,618 entries. That's the same number as `val$entry.maxLength`:
![image](https://github.com/user-attachments/assets/68d61b30-cf79-44b4-b1c2-d90d659cbfcf)

What I think is happening:
For each bucket in the aggregation:
Create a [`ShapeDocValuesQuery`](https://github.com/elastic/elasticsearch/blob/v8.15.1/server/src/main/java/org/elasticsearch/lucene/spatial/ShapeDocValuesQuery.java)
During scoring in either `getContainsWeight` or `getStandardWeight` a  `Lucene90DocValuesProducer` is created via:  
 https://github.com/elastic/elasticsearch/blob/v8.15.1/server/src/main/java/org/elasticsearch/lucene/spatial/ShapeDocValuesQuery.java#L124-L127

That then creates an array in one of these spots: 

https://github.com/apache/lucene/blob/releases/lucene/9.11.1/lucene/core/src/java/org/apache/lucene/codecs/lucene90/Lucene90DocValuesProducer.java#L766-L766

https://github.com/apache/lucene/blob/releases/lucene/9.11.1/lucene/core/src/java/org/apache/lucene/codecs/lucene90/Lucene90DocValuesProducer.java#L807-L808

The size of that array is `maxLength` of the entry.
That max length is equal to the size of the largest value that might be read out of the index via the producer.

If you have a (large number of buckets * large geometry) you OOM. There's no protection (ex. raise an error if too much memory would be used) or safety (ex. allocate memory just-in-time/few buckets at a time). I would be satisfied to see either of these added. Even just a check that raises an error if more than some threshold of bytes will be allocated would be sufficient because I'd then be able to find problem data and re-index it in another form. As is I can't easily find what indices have these large geometries.


### Steps to Reproduce

I have created a public repository with a repro here: https://github.com/peregrine-io/es8-oom/blob/main/README.md

To reproduce the error you will need docker and python installed then follow these steps.  
`git clone https://github.com/peregrine-io/es8-oom.git`  
`cd es8-oom/repro`  
`docker-compose up es8`  
`pip install -r requirements.txt`  
`python es_oom_repro` 

### Logs (if relevant)

This repro will take a few minutes to run as it indexes a very large document. After some time you will see an error from the script:
`elastic_transport.ConnectionError: Connection error caused by: ConnectionError(Connection error caused by: ProtocolError(('Connection aborted.', RemoteDisconnected('Remote end closed connection without response')`

The docker container will report an OOM:
```
repro-es8-1  | java.lang.OutOfMemoryError: Java heap space
repro-es8-1  | Dumping heap to data/java_pid67.hprof ...
repro-es8-1  | Terminating due to java.lang.OutOfMemoryError: Java heap space
repro-es8-1  |
repro-es8-1  | ERROR: Elasticsearch exited unexpectedly, with exit code 3
repro-es8-1 exited with code 3
```",wyattberlinic,closed,"['>bug', ':Analytics/Geo', ':Analytics/Aggregations', 'Team:Analytics']",https://github.com/elastic/elasticsearch/issues/114941,2024-10-16T17:53:45Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/114941,"{
  ""application_resource"": ""yes""
}"
125,114930,[ML] ML nodes autoscaling not down to 0 in stateful and serverless,"### Environment

- Stateful cloud (gcp-us-west2)
- Serverless QA

### build
```
  ""build"": {
    ""hash"": ""8ccfb227c2131c859033f409ee37a87023fada62"",
    ""date"": ""2024-10-16T05:50:43.944345200Z""
  }
```

### Step to reproduce
1. Deploy a serverless or stateful cluster, for stateful cluster, make sure ML autoscaling is ON
2.  Create an inference endpoint  with adaptive allocation ON
```
PUT _inference/sparse_embedding/elser-endpoint
{
  ""service"": ""elser"", 
  ""service_settings"": {""num_threads"": 4, ""adaptive_allocations"": {""enabled"": true}}
}
```
3. wait a few minutes for scaling up event, ml node available and allocated to that inference endpoint, you can confirm by running: `GET _ml/trained_models/elser-endpoint/_stats`
4. Run inference, you can follow the steps in this tutorial, https://www.elastic.co/guide/en/elasticsearch/reference/current/semantic-search-semantic-text.html
5. after that, wait at least 15 minutes for allocation to scale down to 0
```
{
  ""count"": 1,
  ""trained_model_stats"": [
    {
      ""model_id"": "".elser_model_2_linux-x86_64"",
      ""model_size_stats"": {
        ""model_size_bytes"": 274756282,
        ""required_native_memory_bytes"": 2101346304
      },
      ""pipeline_count"": 1,
      ""ingest"": {
        ""total"": {
          ""count"": 0,
          ""time_in_millis"": 0,
          ""current"": 0,
          ""failed"": 0
        },
        ""pipelines"": {
          "".kibana-elastic-ai-assistant-ingest-pipeline-knowledge-base"": {
            ""count"": 0,
            ""time_in_millis"": 0,
            ""current"": 0,
            ""failed"": 0,
            ""ingested_as_first_pipeline_in_bytes"": 0,
            ""produced_as_first_pipeline_in_bytes"": 0,
            ""processors"": [
              {
                ""inference"": {
                  ""type"": ""inference"",
                  ""stats"": {
                    ""count"": 0,
                    ""time_in_millis"": 0,
                    ""current"": 0,
                    ""failed"": 0
                  }
                }
              }
            ]
          }
        }
      },
      ""inference_stats"": {
        ""failure_count"": 0,
        ""inference_count"": 0,
        ""cache_miss_count"": 0,
        ""missing_all_fields_count"": 0,
        ""timestamp"": 1729097542245
      },
      ""deployment_stats"": {
        ""deployment_id"": ""elser-endpoint"",
        ""model_id"": "".elser_model_2_linux-x86_64"",
        ""threads_per_allocation"": 4,
        ""number_of_allocations"": 0,
        ""adaptive_allocations"": {
          ""enabled"": true
        },
        ""queue_capacity"": 1024,
        ""state"": ""started"",
        ""allocation_status"": {
          ""allocation_count"": 0,
          ""target_allocation_count"": 0,
          ""state"": ""fully_allocated""
        },
        ""cache_size"": ""262mb"",
        ""priority"": ""normal"",
        ""start_time"": 1729044099355,
        ""peak_throughput_per_minute"": 0,
        ""nodes"": []
      }
    }
  ]
}
```
7. after allocation scales down to 0, ml nodes autoscaling (down to 0) should happen in ~1 hour
**Observed:**

After hours wait, ml nodes autoscaling (down to 0) didnt happen

- for stateful, `GET /_autoscaling/capacity/` returns:

```
""ml"": {
      ""required_capacity"": {
        ""node"": {
          ""memory"": 0,
          ""processors"": 4
        },
        ""total"": {
          ""memory"": 0,
          ""processors"": 0
        }
      },
      ""current_capacity"": {
        ""node"": {
          ""storage"": 0,
          ""memory"": 8585740288,
          ""processors"": 4
        },
        ""total"": {
          ""storage"": 0,
          ""memory"": 17171480576,
          ""processors"": 8
        }
      },
      ""current_nodes"": [
        {
          ""name"": ""instance-0000000003""
        },
        {
          ""name"": ""instance-0000000004""
        }
      ],
      ""deciders"": {
        ""ml"": {
          ""required_capacity"": {
            ""node"": {
              ""memory"": 0,
              ""processors"": 4
            },
            ""total"": {
              ""memory"": 0,
              ""processors"": 0
            }
          },
          ""reason_summary"": ""[memory_decider] Requesting scale down as tier and/or node size could be smaller; [processor_decider] requesting scale down as tier and/or node size could be smaller"",
          ""reason_details"": {
            ""waiting_analytics_jobs"": [],
            ""waiting_anomaly_jobs"": [],
            ""waiting_models"": [],
            ""configuration"": {},
            ""perceived_current_capacity"": {
              ""node"": {
                ""memory"": 8585740288,
                ""processors"": 4
              },
              ""total"": {
                ""memory"": 17171480576,
                ""processors"": 8
              }
            },
            ""reason"": ""[memory_decider] Requesting scale down as tier and/or node size could be smaller; [processor_decider] requesting scale down as tier and/or node size could be smaller""
          }
        }
      }
    }
```

- for serverless, `GET /_internal/serverless/autoscaling` returns:
```
""ml"": {
    ""metrics"": {
      ""nodes"": {
        ""value"": 1,
        ""quality"": ""exact""
      },
      ""node_memory_in_bytes"": {
        ""value"": 34359738368,
        ""quality"": ""exact""
      },
      ""model_memory_in_bytes"": {
        ""value"": 0,
        ""quality"": ""exact""
      },
      ""min_nodes"": {
        ""value"": 0,
        ""quality"": ""exact""
      },
      ""extra_single_node_model_memory_in_bytes"": {
        ""value"": 2101346304,
        ""quality"": ""exact""
      },
      ""extra_single_node_processors"": {
        ""value"": 0,
        ""quality"": ""exact""
      },
      ""extra_model_memory_in_bytes"": {
        ""value"": 2101346304,
        ""quality"": ""exact""
      },
      ""extra_processors"": {
        ""value"": 0,
        ""quality"": ""exact""
      },
      ""remove_node_memory_in_bytes"": {
        ""value"": 0,
        ""quality"": ""exact""
      },
      ""per_node_memory_overhead_in_bytes"": {
        ""value"": 31457280,
        ""quality"": ""exact""
      }
    }
  }
```

",wwang500,closed,"['>bug', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/114930,2024-10-16T16:46:50Z,10,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/114930,"{
  ""application_resource"": ""yes""
}"
126,114483,"Reverse image search by elasticsearch, long time no result.","### Elasticsearch Version

8.15.2

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

docker

### Problem Description

I save the vector data in es, like below, and data is 200m records.
```json
PUT /item/_mapping
{
    ""properties"": {
        ""thumbs.thumb_vector"": {
            ""type"": ""dense_vector"",
            ""dims"": 2048,
            ""similarity"": ""l2_norm""
        }
    }
}
```
search 
```json
{
    ""_knn"": {
        ""field"": ""thumbs.thumb_vector"",
        ""query_vector"": [],
        ""k"": 10,
        ""num_candidates"": 100
    }
}
```


### Steps to Reproduce

none.

### Logs (if relevant)

_No response_",hetao29,closed,"['>bug', ':Search Relevance/Vectors', 'Team:Search Relevance']",https://github.com/elastic/elasticsearch/issues/114483,2024-10-10T08:17:39Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/114483,"{
  ""application_resource"": ""unsure""
}"
127,113705,Elasticsearch fails to startup with valid fsize and virtual memory limits,"### Elasticsearch Version

8.15

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux

### Problem Description

We have found a few issues with the Bootstrap checks on Linux/Unix machines.  The first is that a value of `-1` should be accepted along with `unlimited` and `infinity` based on [this](https://man.archlinux.org/man/limits.conf.5) documentation.

```
All items support the values -1, unlimited or infinity indicating no limit, except for priority, nice, and nonewprivs. If nofile is to be set to one of these values, it will be set to the contents of /proc/sys/fs/nr_open instead (see setrlimit(3)).
```

The second issue is that [this code](https://github.com/elastic/elasticsearch/blob/ee24f84df0265f5b8bc0baa3dadde6516cf3c073/server/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java#L429-L431) appears to be incorrect.

It should be checking for the max file size and **NOT** the max memory size

```java
long getMaxFileSize() {
    return NativeAccess.instance().getProcessLimits().maxFileSize();
}
```


### Steps to Reproduce

Set the `fsize` value to `-1` in the `/etc/security/limits.conf ` file then start up Elastic 8.15.x.

### Logs (if relevant)

```
[2024-09-25T17:00:39,398][ERROR][o.e.b.Elasticsearch ] [node-f41036c7-370b-4665-a0d0-679e2bedef84] node validation exception
[2] bootstrap checks failed. You must address the points described in the following [2] lines before starting Elasticsearch. For more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/bootstrap-checks.html]
bootstrap check failure [1] of [2]: max size virtual memory [-1] for user [###] is too low, increase to [unlimited]; for more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/max-size-virtual-memory-check.html]
bootstrap check failure [2] of [2]: max file size [-1] for user [###] is too low, increase to [unlimited]; for more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/_max_file_size_check.html]
```
",nathan-maves,closed,"['>bug', ':Core/Infra/Core', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/113705,2024-09-27T16:08:35Z,27,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/113705,"{
  ""application_resource"": ""yes""
}"
128,113694,[CI] DocsClientYamlTestSuiteIT test {yaml=reference/rest-api/usage/line_38} failing,"### CI Link

https://gradle-enterprise.elastic.co/s/apw47hfxw6oys

### Repro line

./gradlew "":docs:yamlRestTest"" --tests ""org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT.test {yaml=reference/rest-api/usage/line_38}"" -Dtests.seed=85086C0768E52FC -Dtests.locale=pt-PT -Dtests.timezone=America/Jamaica -Druntime.java=22

### Does it reproduce?

Didn't try

### Applicable branches

main

### Failure history

_No response_

### Failure excerpt

Happened in CI of https://github.com/elastic/elasticsearch/pull/113629 but should be related to main rather than that PR (as the SlicedInputStream changes there should be irrelevant to this I think.

```
REPRODUCE WITH: ./gradlew "":docs:yamlRestTest"" --tests ""org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT.test {yaml=reference/rest-api/usage/line_38}"" -Dtests.seed=85086C0768E52FC -Dtests.locale=pt-PT -Dtests.timezone=America/Jamaica -Druntime.java=22

DocsClientYamlTestSuiteIT > test {yaml=reference/rest-api/usage/line_38} FAILED
    java.lang.AssertionError: Failure at [reference/rest-api/usage:16]: Expected a map containing
                              eql: a map containing
                          available: <true>
                            enabled: <true>
                           features: a map containing
                                joins: a map containing
                     join_queries_three: <0>
                       join_queries_two: <0>
                             join_until: <0>
              join_queries_five_or_more: <0>
                      join_queries_four: <0>
                             sequence: <0>
                                 keys: a map containing
                          join_keys_two: <0>
                          join_keys_one: <0>
                        join_keys_three: <0>
                 join_keys_five_or_more: <0>
                         join_keys_four: <0>
                                 join: <0>
                            sequences: a map containing
                 sequence_queries_three: <0>
                  sequence_queries_four: <0>
                   sequence_queries_two: <0>
                         sequence_until: <0>
                       sequence_maxspan: <0>
          sequence_queries_five_or_more: <0>
                                event: <0>
                                pipes: a map containing
                              pipe_tail: <0>
                              pipe_head: <0>
                            queries: a map containing
                                  all: a map containing
                                  total: <0>
                                 failed: <0>
                                 _all: a map containing
                                  total: <0>
                                 failed: <0>
                        inference: a map containing
                             models: an empty list
                          available: <true>
                            enabled: <true>
                   frozen_indices: a map containing
                      indices_count: <0>
                          available: <true>
                            enabled: <true>
                              sql: a map containing
                           features: a map containing
                               having: <0>
                            subselect: <0>
                                limit: <0>
                              orderby: <1>
                                where: <0>
                                 join: <0>
                              groupby: <0>
                              command: <0>
                                local: <0>
                          available: <true>
                            queries: a map containing
                                 rest: a map containing
                                  total: <1>
                                 paging: <0>
                                 failed: <0>
                                  cli: a map containing
                                  total: <0>
                                 paging: <0>
                                 failed: <0>
                               canvas: a map containing
                                  total: <0>
                                 paging: <0>
                                 failed: <0>
                                 odbc: a map containing
                                  total: <0>
                                 paging: <0>
                                 failed: <0>
                                 jdbc: a map containing
                                  total: <0>
                                 paging: <0>
                                 failed: <0>
                               odbc32: a map containing
                                  total: <0>
                                 paging: <0>
                                 failed: <0>
                               odbc64: a map containing
                                  total: <0>
                                 paging: <0>
                                 failed: <0>
                                 _all: a map containing
                                  total: <1>
                                 paging: <0>
                                 failed: <0>
                            translate: a map containing
                                  count: <0>
                            enabled: <true>
                           rollup: a map containing
                          available: <true>
                            enabled: <true>
              number_of_rollup_jobs: <0>
             searchable_snapshots: a map containing
         shared_cache_indices_count: <0>
                      indices_count: <0>
                          available: <true>
            full_copy_indices_count: <0>
                            enabled: <true>
                        analytics: a map containing
                              stats: a map containing
                           rate_usage: <0>
                      normalize_usage: <0>
                        boxplot_usage: <1>
                    top_metrics_usage: <0>
                    multi_terms_usage: <0>
         cumulative_cardinality_usage: <0>
                   string_stats_usage: <1>
             moving_percentiles_usage: <1>
                         t_test_usage: <0>
                          available: <true>
                            enabled: <true>
                         logstash: a map containing
                          available: <true>
                            enabled: <true>
                         security: a map containing
                          available: <true>
                            enabled: <true>
                             realms: a map containing
                                 file: a map containing
                                   name: a list containing
                                        0: ""file""
                              available: <true>
                                  cache: a list containing
                                        0: a map containing
                                       size: <1>
                                   size: a list containing
                                        0: <2>
                                enabled: <true>
                                  order: a list containing
                                        0: <0>
                                 ldap: a map containing
                                enabled: <false>
                              available: <true>
                               native: a map containing
                                   name: a list containing
                                        0: ""native""
                              available: <true>
                                  cache: a list containing
                                        0: a map containing
                                       size: <0>
                                   size: a list containing
                                        0: <0>
                                enabled: <true>
                                  order: a list containing
                                        0: <1>
                                  jwt: a map containing
                                enabled: <false>
                              available: <true>
                                 saml: a map containing
                                   name: a list containing
                                        0: ""saml1""
                              available: <true>
                                enabled: <true>
                                  order: a list containing
                                        0: <4>
                             kerberos: a map containing
                                enabled: <false>
                              available: <true>
                                 oidc: a map containing
                                   name: a list containing
                                        0: ""oidc1""
                              available: <true>
                                enabled: <true>
                                  order: a list containing
                                        0: <2>
                     active_directory: a map containing
                                enabled: <false>
                              available: <true>
                                  pki: a map containing
                         has_truststore: a list containing
                                        0: <true>
            is_authentication_delegated: a list containing
                                        0: <true>
                                   name: a list containing
                                        0: ""pki1""
                              available: <true>
           has_default_username_pattern: a list containing
                                        0: <true>
                                enabled: <true>
                                  order: a list containing
                                        0: <3>
               has_authorization_realms: a list containing
                                        0: <false>
                              roles: a map containing
                                 file: a map containing
                         remote_indices: <0>
                                    dls: <false>
                                   size: <1>
                                    fls: <false>
                         remote_cluster: <0>
                               native: a map containing
                                    dls: <false>
                                   size: <0>
                                    fls: <false>
                                  dls: a map containing
                          bit_set_cache: a map containing
                          memory_in_bytes: <0>
                                   memory: ""0b""
                                    count: <0>
                       role_mapping: a map containing
                               native: a map containing
                                   size: <0>
                                enabled: <0>
                                ssl: a map containing
                remote_cluster_client: a map containing
                                enabled: <true>
                                 http: a map containing
                                enabled: <false>
                            transport: a map containing
                                enabled: <false>
                      token_service: a map containing
                              enabled: <true>
                    api_key_service: a map containing
                              enabled: <true>
                              audit: a map containing
                              enabled: <false>
                           ipfilter: a map containing
                                 http: <false>
                            transport: <false>
                          anonymous: a map containing
                              enabled: <false>
                           fips_140: a map containing
                              enabled: <false>
                operator_privileges: a map containing
                            available: <true>
                              enabled: <false>
                       user_profile: a map containing
                              enabled: <0>
                                total: <0>
                               recent: <0>
              remote_cluster_server: a map containing
                            available: <true>
                             api_keys: a map containing
                                  total: <0>
                                    ccs: <0>
                                    ccr: <0>
                                ccs_ccr: <0>
                              enabled: <false>
                        transform: a map containing
                          available: <true>
                            enabled: <true>
                              ccr: a map containing
         auto_follow_patterns_count: <0>
                          available: <true>
             follower_indices_count: <0>
                            enabled: <true>
                       health_api: a map containing
                          available: <true>
                            enabled: <true>
                        invocations: a map containing
                                total: <0>
                          spatial: a map containing
                          available: <true>
                            enabled: <true>
                               ml: a map containing
                             memory: a map containing
       anomaly_detectors_memory_bytes: <0>
       pytorch_inference_memory_bytes: <0>
    data_frame_analytics_memory_bytes: <0>
              total_used_memory_bytes: <0>
                          inference: a map containing
                          deployments: a map containing
                                time_ms: a map containing
                                      avg: <0.0>
                                  count: <0>
                         stats_by_model: an empty list
                      model_sizes_bytes: a map containing
                                    total: <0.0>
                                      min: <0.0>
                                      avg: <0.0>
                                      max: <0.0>
                       inference_counts: a map containing
                                    total: <0.0>
                                      min: <0.0>
                                      avg: <0.0>
                                      max: <0.0>
                       trained_models: a map containing
                       model_size_bytes: a map containing
                                    total: <0.0>
                                      min: <0.0>
                                      avg: <0.0>
                                      max: <0.0>
                   estimated_operations: a map containing
                                    total: <0.0>
                                      min: <0.0>
                                      avg: <0.0>
                                      max: <0.0>
                                  count: a map containing
                                    total: <1>
                              prepackaged: <1>
                                    other: <0>
                                   _all: a map containing
                                    count: <1>
                    ingest_processors: a map containing
                                   _all: a map containing
                                pipelines: a map containing
                                      count: <0>
                                  time_ms: a map containing
                                        min: <0>
                                        max: <0>
                                        sum: <0>
                       num_docs_processed: a map containing
                                        min: <0>
                                        max: <0>
                                        sum: <0>
                             num_failures: a map containing
                                        min: <0>
                                        max: <0>
                                        sum: <0>
          data_frame_analytics_jobs: a map containing
                         memory_usage: a map containing
                       peak_usage_bytes: a map containing
                                    total: <0.0>
                                      min: <0.0>
                                      avg: <0.0>
                                      max: <0.0>
                                 _all: a map containing
                                  count: <0>
                      analysis_counts: an empty map
                               jobs: a map containing
                                 _all: a map containing
                                  count: <0>
                              detectors: a map containing
                                    total: <0.0>
                                      min: <0.0>
                                      avg: <0.0>
                                      max: <0.0>
                             created_by: an empty map
                             model_size: a map containing
                                    total: <0.0>
                                      min: <0.0>
                                      avg: <0.0>
                                      max: <0.0>
                              forecasts: a map containing
                                    total: <0>
                          forecasted_jobs: <0>
                          available: <true>
                          datafeeds: a map containing
                                 _all: a map containing
                                  count: <0>
                         node_count: <1>
                            enabled: <true>
                          watcher: a map containing
                          execution: a map containing
                              actions: a map containing
                                   _all: a map containing
                                    total: <1>
                         total_time_in_ms: <197>
                              watch: a map containing
                                input: a map containing
                                   _all: a map containing
                                    total: <1>
                                   active: <1>
                                   http: <unexpected> but was <{total=1, active=1}>
                              trigger: a map containing
                                   _all: a map containing
                                    total: <1>
                                   active: <1>
                               schedule: <unexpected> but was <{total=1, active=1, interval={total=1, active=1}, _all={total=1, active=1}}>
                            condition: <unexpected> but was <{always={total=1, active=1}, _all={total=1, active=1}}>
                          available: <true>
                              count: a map containing
                                total: <1>
                               active: <1>
                            enabled: <true>
                enterprise_search: a map containing
                search_applications: a map containing
                                count: <0>
              analytics_collections: a map containing
                                count: <0>
                     query_rulesets: a map containing
                     total_rule_count: <0>
                          total_count: <0>
                       min_rule_count: <0>
                       max_rule_count: <0>
                          available: <true>
                            enabled: <true>
                             esql: a map containing
                           features: a map containing
                                 drop: <0>
                                 show: <0>
                                 sort: <1>
                                 eval: <0>
                                stats: <0>
                               rename: <0>
                            mv_expand: <0>
                                 meta: <0>
                              dissect: <0>
                                 grok: <0>
                                 keep: <1>
                                limit: <1>
                               enrich: <0>
                                where: <0>
                                 from: <1>
                                  row: <0>
                          available: <true>
                            queries: a map containing
                                 rest: a map containing
                                  total: <1>
                                 failed: <0>
                               kibana: a map containing
                                  total: <0>
                                 failed: <0>
                                 _all: a map containing
                                  total: <1>
                                 failed: <0>
                            enabled: <true>
                          archive: a map containing
                      indices_count: <0>
                          available: <true>
                            enabled: <true>
                              ilm: a map containing
                       policy_count: <26>
                       policy_stats: a list containing
                                    0: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <172800000>
                                    actions: a list containing
                                            0: ""shrink""
                                            1: ""forcemerge""
                                            2: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                       shrink: a map containing
                               number_of_shards: <1>
                                     cold: a map containing
                                    min_age: <2592000000L>
                                    actions: a list containing
                                            0: ""migrate""
                             configurations: an empty map
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <31536000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                    1: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""10gb""
                   max_primary_shard_size_bytes: <10737418240L>
                                   delete: a map containing
                                    min_age: <7776000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                    2: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                        indices_managed: <0>
                                    3: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""10gb""
                   max_primary_shard_size_bytes: <10737418240L>
                                   delete: a map containing
                                    min_age: <7776000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                    4: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <172800000>
                                    actions: a list containing
                                            0: ""shrink""
                                            1: ""forcemerge""
                                            2: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                       shrink: a map containing
                               number_of_shards: <1>
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <2592000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                    5: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                                            1: ""forcemerge""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <7776000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                    6: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""7d""
                                 max_age_millis: <604800000>
                         max_primary_shard_size: ""10gb""
                   max_primary_shard_size_bytes: <10737418240L>
                                   delete: a map containing
                                    min_age: <604800000>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                    7: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""10gb""
                   max_primary_shard_size_bytes: <10737418240L>
                                   delete: a map containing
                                    min_age: <2592000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                    8: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                        indices_managed: <0>
                                    9: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <172800000>
                                    actions: a list containing
                                            0: ""shrink""
                                            1: ""forcemerge""
                                            2: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                       shrink: a map containing
                               number_of_shards: <1>
                                     cold: a map containing
                                    min_age: <2592000000L>
                                    actions: a list containing
                                            0: ""migrate""
                             configurations: an empty map
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <15552000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   10: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                        indices_managed: <0>
                                   11: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <172800000>
                                    actions: a list containing
                                            0: ""shrink""
                                            1: ""forcemerge""
                                            2: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                       shrink: a map containing
                               number_of_shards: <1>
                                     cold: a map containing
                                    min_age: <2592000000L>
                                    actions: a list containing
                                            0: ""migrate""
                             configurations: an empty map
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <7776000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   12: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""3d""
                                 max_age_millis: <259200000>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <345600000>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   13: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <172800000>
                                    actions: a list containing
                                            0: ""shrink""
                                            1: ""forcemerge""
                                            2: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                       shrink: a map containing
                               number_of_shards: <1>
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <2592000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   14: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                        indices_managed: <0>
                                   15: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <172800000>
                                    actions: a list containing
                                            0: ""shrink""
                                            1: ""forcemerge""
                                            2: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                       shrink: a map containing
                               number_of_shards: <1>
                                     cold: a map containing
                                    min_age: <2592000000L>
                                    actions: a list containing
                                            0: ""migrate""
                             configurations: an empty map
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <7776000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   16: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""forcemerge""
                                            1: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""3d""
                                 max_age_millis: <259200000>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <259200000>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   17: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <172800000>
                                    actions: a list containing
                                            0: ""shrink""
                                            1: ""forcemerge""
                                            2: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                       shrink: a map containing
                               number_of_shards: <1>
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""7d""
                                 max_age_millis: <604800000>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <604800000>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   18: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""300gb""
                   max_primary_shard_size_bytes: <322122547200L>
                                   delete: a map containing
                                    min_age: <7776000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   19: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                        indices_managed: <0>
                                   20: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <172800000>
                                    actions: a list containing
                                            0: ""shrink""
                                            1: ""forcemerge""
                                            2: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                       shrink: a map containing
                               number_of_shards: <1>
                                     cold: a map containing
                                    min_age: <2592000000L>
                                    actions: a list containing
                                            0: ""migrate""
                             configurations: an empty map
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <31536000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   21: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <172800000>
                                    actions: a list containing
                                            0: ""shrink""
                                            1: ""forcemerge""
                                            2: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                       shrink: a map containing
                               number_of_shards: <1>
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""7d""
                                 max_age_millis: <604800000>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <604800000>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   22: a map containing
                                 phases: a map containing
                                     warm: a map containing
                                    min_age: <172800000>
                                    actions: a list containing
                                            0: ""shrink""
                                            1: ""forcemerge""
                                            2: ""migrate""
                             configurations: a map containing
                                   forcemerge: a map containing
                               max_num_segments: <1>
                                       shrink: a map containing
                               number_of_shards: <1>
                                     cold: a map containing
                                    min_age: <2592000000L>
                                    actions: a list containing
                                            0: ""migrate""
                             configurations: an empty map
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                                   delete: a map containing
                                    min_age: <15552000000L>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   23: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                        indices_managed: <0>
                                   24: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""14d""
                                 max_age_millis: <1209600000>
                         max_primary_shard_size: ""10gb""
                   max_primary_shard_size_bytes: <10737418240L>
                                   delete: a map containing
                                    min_age: <2073600000>
                                    actions: a list containing
                                            0: ""delete""
                             configurations: an empty map
                        indices_managed: <0>
                                   25: a map containing
                                 phases: a map containing
                                      hot: a map containing
                                    min_age: <0>
                                    actions: a list containing
                                            0: ""rollover""
                             configurations: a map containing
                                     rollover: a map containing
                                        max_age: ""30d""
                                 max_age_millis: <2592000000L>
                         max_primary_shard_size: ""50gb""
                   max_primary_shard_size_bytes: <53687091200L>
                        indices_managed: <0>
                       monitoring: a map containing
                 collection_enabled: <false>
                          available: <true>
                  enabled_exporters: a map containing
                                local: <1>
                            enabled: <true>
                            graph: a map containing
                          available: <true>
                            enabled: <true>
                 aggregate_metric: a map containing
                          available: <true>
                            enabled: <true>
                       data_tiers: a map containing
                          data_warm: a map containing
      primary_shard_size_median_bytes: <0>
                  primary_shard_count: <0>
                            doc_count: <0>
         primary_shard_size_avg_bytes: <0>
                   primary_size_bytes: <0>
                     total_size_bytes: <0>
                    total_shard_count: <0>
         primary_shard_size_mad_bytes: <0>
                           node_count: <1>
                          index_count: <0>
                        data_frozen: a map containing
      primary_shard_size_median_bytes: <0>
                  primary_shard_count: <0>
                            doc_count: <0>
         primary_shard_size_avg_bytes: <0>
                   primary_size_bytes: <0>
                     total_size_bytes: <0>
                    total_shard_count: <0>
         primary_shard_size_mad_bytes: <0>
                           node_count: <1>
                          index_count: <0>
                          data_cold: a map containing
      primary_shard_size_median_bytes: <0>
                  primary_shard_count: <0>
                            doc_count: <0>
         primary_shard_size_avg_bytes: <0>
                   primary_size_bytes: <0>
                     total_size_bytes: <0>
                    total_shard_count: <0>
         primary_shard_size_mad_bytes: <0>
                           node_count: <1>
                          index_count: <0>
                          available: <true>
                       data_content: a map containing
      primary_shard_size_median_bytes: <0>
                  primary_shard_count: <0>
                            doc_count: <0>
         primary_shard_size_avg_bytes: <0>
                   primary_size_bytes: <0>
                     total_size_bytes: <0>
                    total_shard_count: <0>
         primary_shard_size_mad_bytes: <0>
                           node_count: <1>
                          index_count: <0>
                            enabled: <true>
                           data_hot: a map containing
      primary_shard_size_median_bytes: <0>
                  primary_shard_count: <0>
                            doc_count: <0>
         primary_shard_size_avg_bytes: <0>
                   primary_size_bytes: <0>
                     total_size_bytes: <0>
                    total_shard_count: <0>
         primary_shard_size_mad_bytes: <0>
                           node_count: <1>
                          index_count: <0>
                              slm: a map containing
                          available: <true>
                            enabled: <true>
              universal_profiling: a map containing
                          available: <true>
                            enabled: <true>
                      voting_only: a map containing
                          available: <true>
                            enabled: <true>
                     data_streams: a map containing
                          available: <true>
                            enabled: <true>
                       data_streams: <0>
                      indices_count: <0>
                      failure_store: a map containing
                        enabled_count: <0>
                failure_indices_count: <0>
                   data_lifecycle: a map containing
                   global_retention: a map containing
                              default: a map containing
                                defined: <false>
                                  max: a map containing
                                defined: <false>
                          available: <true>
                              count: <0>
                     data_retention: a map containing
              configured_data_streams: <0>
              default_rollover_used: <true>
                            enabled: <true>
                effective_retention: a map containing
                retained_data_streams: <0>
                  remote_clusters: a map containing
                               mode: a map containing
                                proxy: <0>
                                sniff: <0>
                           security: a map containing
                              api_key: <0>
                                 cert: <0>
                               size: <0>
        at __randomizedtesting.SeedInfo.seed([85086C0768E52FC:8004B91AD8723F04]:0)
        at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:611)
        at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:554)
        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
        at java.base/java.lang.reflect.Method.invoke(Method.java:580)
        at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at org.junit.rules.RunRules.evaluate(RunRules.java:20)
        at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
        at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
        at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
        at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
        at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
        at org.junit.rules.RunRules.evaluate(RunRules.java:20)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
        at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
        at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
        at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
        at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
        at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
        at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
        at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
        at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
        at org.junit.rules.RunRules.evaluate(RunRules.java:20)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
        at java.base/java.lang.Thread.run(Thread.java:1570)
```",kingherc,closed,"['>docs', '>test-failure', ':Data Management/Watcher', 'Team:Data Management', 'Team:Docs', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/113694,2024-09-27T14:58:37Z,10,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/113694,"{
  ""application_resource"": ""unsure""
}"
129,113666,app-misc/elasticsearch-8.15+ is not working on system without libsystemd,"### Elasticsearch Version

8.15

### Installed Plugins

_No response_

### Java Version

openjdk version ""21.0.3"" 2024-04-16 LTS

### OS Version

gentoo linux 6.9.12 with openrc without systemd

### Problem Description

on linux distribution without systemd (with openrc) and systemd libraries (libsystemd), elasticsearch will not start, because bootstrap checks uses only libsystemd and fails.

even with native access lib turned off, bootstrap checks fails:
ES_JAVA_OPTS=""$ES_JAVA_OPTS -Dorg.elasticsearch.nativeaccess.enableVectorLibrary=false""

limits are set ok, and versions before 8.15 are working ok. 

/etc/conf.d/elasticsearch:
MAX_OPEN_FILES=65536
MAX_LOCKED_MEMORY=unlimited
MAX_THREADS=4096




### Steps to Reproduce

- install version 8.15+ (8.15, 8.15.1, 8.15.2)
- start service
- service is stopped after failed bootstrap checks

### Logs (if relevant)

[2024-09-27T09:48:16,694][WARN ][o.e.n.NativeAccess       ] host] Unable to load native provider. Native methods will be disabled.
java.lang.UnsatisfiedLinkError: Could not find libsystemd in java.library.path: /usr/share/elasticsearch/lib/platform/linux-x64:/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib
at org.elasticsearch.nativeaccess.jdk.JdkSystemdLibrary.<clinit>(JdkSystemdLibrary.java:43) ~[elasticsearch-native-8.15.1.jar:?]
at org.elasticsearch.nativeaccess.lib.NativeLibraryProvider.getLibrary(NativeLibraryProvider.java:58) ~[elasticsearch-native-8.15.1.jar:?]
at org.elasticsearch.nativeaccess.LinuxNativeAccess.<init>(LinuxNativeAccess.java:20) ~[elasticsearch-native-8.15.1.jar:?]
at org.elasticsearch.nativeaccess.NativeAccessHolder.<clinit>(NativeAccessHolder.java:28) ~[elasticsearch-native-8.15.1.jar:?]
at org.elasticsearch.nativeaccess.NativeAccess.instance(NativeAccess.java:22) ~[elasticsearch-native-8.15.1.jar:?]
at org.elasticsearch.bootstrap.Elasticsearch.initializeNatives(Elasticsearch.java:285) ~[elasticsearch-8.15.1.jar:?]
at org.elasticsearch.bootstrap.Elasticsearch.initPhase2(Elasticsearch.java:170) ~[elasticsearch-8.15.1.jar:?]
at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:75) ~[elasticsearch-8.15.1.jar:?]
[2024-09-27T09:48:16,753][WARN ][o.e.n.NativeAccess       ] host] Cannot check if running as root because native access is not available

    
[2024-09-27T09:46:04,056][INFO ][o.e.b.BootstrapChecks    ] host] bound or publishing to a non-loopback address, enforcing bootstrap checks
[2024-09-27T09:46:04,062][WARN ][o.e.n.NativeAccess       ] host] Cannot get process limits because native access is not available
[2024-09-27T09:46:04,063][WARN ][o.e.n.NativeAccess       ] host] Cannot get process limits because native access is not available
[2024-09-27T09:46:04,064][WARN ][o.e.n.NativeAccess       ] host] Cannot get process limits because native access is not available
[2024-09-27T09:46:04,064][WARN ][o.e.n.NativeAccess       ] host] Cannot get process limits because native access is not available
[2024-09-27T09:46:04,066][WARN ][o.e.n.NativeAccess       ] host] Cannot get process limits because native access is not available
[2024-09-27T09:46:04,066][WARN ][o.e.n.NativeAccess       ] host] Cannot get process limits because native access is not available
[2024-09-27T09:46:04,079][ERROR][o.e.b.Elasticsearch      ] host] node validation exception
[2] bootstrap checks failed. You must address the points described in the following [2] lines before starting Elasticsearch. For more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/bootstrap-check
s.html]
bootstrap check failure [1] of [2]: max size virtual memory [-1] for user [elasticsearch] is too low, increase to [unlimited]; for more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/max-size-virt
ual-memory-check.html]
bootstrap check failure [2] of [2]: max file size [-1] for user [elasticsearch] is too low, increase to [unlimited]; for more information see [https://www.elastic.co/guide/en/elasticsearch/reference/8.15/_max_file_size_check.ht
ml]
[2024-09-27T09:46:04,095][INFO ][o.e.n.Node               ] host] stopping ...
[2024-09-27T09:46:04,148][INFO ][o.e.n.Node               ] host] stopped
[2024-09-27T09:46:04,149][INFO ][o.e.n.Node               ] host] closing ...
[2024-09-27T09:46:04,182][INFO ][o.e.n.Node               ] host] closed
",j4Hu,closed,"['>bug', ':Core/Infra/Core', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/113666,2024-09-27T08:14:41Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/113666,"{
  ""application_resource"": ""yes""
}"
130,113532,Rewrite Elasticsearch in OCaml,"# Proposal: Rewriting Elasticsearch in OCaml

## Summary

I propose we explore rewriting Elasticsearch in **OCaml** to leverage its strong static typing, performance benefits, and functional programming features. Compared to languages like Rust, Java, or C++, OCaml offers a unique balance of expressiveness, safety, and efficiency that could enhance the robustness and maintainability of our search engine.

## Benefits

### Strong Static Typing and Compile-Time Safety

OCaml's powerful type system catches many errors at compile time, reducing runtime exceptions and improving reliabilityâ€”crucial for a complex system like Elasticsearch.

**Why OCaml over Java, C++, or Rust:**

- **OCaml vs. Java**: OCaml's type inference leads to less verbose code than Java, allowing for faster development and a cleaner codebase.
- **OCaml vs. C++**: Offers memory safety without manual memory management, reducing risks of memory leaks and segmentation faults common in C++.
- **OCaml vs. Rust**: While Rust provides strong safety guarantees, OCaml has a simpler learning curve due to less complex ownership semantics, which can speed up development.

**Example:**

```ocaml
type document = {
  id : string;
  content : string;
  timestamp : float;
}

let index_document (doc : document) : unit =
  (* Indexing logic here *)
  ()
```

### High Performance

OCaml compiles to efficient native code, offering performance comparable to C and C++. This can lead to faster indexing and query processing times.

**Why OCaml over Java, C++, or Rust:**

- **OCaml vs. Java**: Native code compilation can outperform Java's JVM bytecode, especially for compute-intensive tasks.
- **OCaml vs. C++**: Provides similar performance but with safer abstractions and quicker development cycles.
- **OCaml vs. Rust**: While Rust may offer performance advantages, OCaml's faster compile times and simpler syntax can improve developer productivity.

**Example:**

```ocaml
let rec binary_search arr target low high =
  if high < low then None
  else
    let mid = (low + high) / 2 in
    if arr.(mid) = target then Some mid
    else if arr.(mid) > target then
      binary_search arr target low (mid - 1)
    else
      binary_search arr target (mid + 1) high
```

### Functional Programming Paradigms

Immutability and first-class functions make it easier to reason about code and avoid side effects, reducing bugs and improving concurrency.

**Why OCaml over Java, C++, or Rust:**

- **OCaml vs. Java/C++**: Functional programming is more naturally expressed in OCaml, whereas Java and C++ require more boilerplate or lack certain features.
- **OCaml vs. Rust**: Rust supports functional programming, but its ownership model can add complexity. OCaml offers functional paradigms with less overhead.

**Example:**

```ocaml
let update_index index doc =
  let new_index = Map.add doc.id doc index in
  new_index  (* Returns a new index with the document added *)
```

### Concurrency and Asynchronous I/O

Libraries like **Lwt** and **Async** enable efficient non-blocking I/O and concurrency, essential for handling multiple search queries and indexing operations simultaneously.

**Why OCaml over Java, C++, or Rust:**

- **OCaml vs. Java**: While Java has concurrency support, OCaml's lightweight threads and functional style can result in more efficient and easier-to-manage asynchronous code.
- **OCaml vs. C++**: Concurrency in C++ can be error-prone due to manual memory management and lack of built-in high-level abstractions.
- **OCaml vs. Rust**: Rust's concurrency model is safe but can be complex due to strict ownership rules. OCaml offers simpler concurrency models with cooperative threading.

**Example with Lwt:**

```ocaml
open Lwt.Infix

let handle_request request =
  process_request request >>= fun response ->
  Lwt.return response
```

### Memory Safety and Garbage Collection

Automatic memory management helps prevent memory leaks and segmentation faults, enhancing system stability over long uptimes.

**Why OCaml over C++ or Rust:**

- **OCaml vs. C++**: Eliminates the need for manual memory management, reducing the risk of errors.
- **OCaml vs. Rust**: Rust's ownership model ensures safety but adds complexity. OCaml's garbage collector manages memory with less developer overhead.

### Maintainability and Readability

OCaml's concise syntax and module system promote clean and modular code, making the codebase easier to understand and maintain over time.

**Why OCaml over Java, C++, or Rust:**

- **OCaml vs. Java**: Less boilerplate and more expressive code lead to improved developer efficiency.
- **OCaml vs. C++**: Simpler language features reduce the learning curve and potential for misuse.
- **OCaml vs. Rust**: OCaml's syntax is often more concise, aiding readability and maintenance.

## Resources

- [OCaml Official Documentation](https://ocaml.org/docs/)
- [Real World OCaml](https://dev.realworldocaml.org/)
- [Lwt - Cooperative Threads Library](https://ocsigen.org/lwt/latest/manual/)

## Considerations

- **Learning Curve**: The team will need time to become proficient in OCaml and its functional programming paradigms.
- **Ecosystem Maturity**: Evaluate the availability of libraries and tools needed for full-text search capabilities.
- **Interoperability**: Assess how OCaml can interoperate with existing components or whether a gradual migration is feasible.

I'm keen to discuss this idea further and hear your thoughts, especially regarding how OCaml could provide advantages over other languages like Rust, Java, or C++ in our context.",seeker296,closed,['needs:triage'],https://github.com/elastic/elasticsearch/issues/113532,2024-09-25T13:07:17Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/113532,"{
  ""application_resource"": ""no""
}"
131,113256,The same search statement multiple times gets different total results,"### One sentence description

When I search using the following statement, the search gets different total hits multiple times.

### For example:

""hits"": {
        ""total"": {
            ""value"": 6000000(This value is unstable and may change occasionally, but in fact the data in this index will never change from a business perspective),
            ""relation"": ""eq""
        },
        ...
}

### Basic Information:

Elasticsearch version: 7.17.1
Cpu architecture: aarch64
Jdk version: 1.8

Cluster overview: 9 nodes, including 6 data nodes and 3 master nodes(Server resources and jvm resources are absolutely sufficient.)
Index(my_index) overview: 9 primary shards, 1 replica shard

### Search statement

**http://:9200/my_index/_search?request_cache=false&explain=true&track_total_hits=true&q=***

In the above search statement, I used three key parameters, corresponding to different purposes:
track_total_hits=true: to get an accurate hits total value
request_cache=false: disable query cache, eliminate the impact of cache
explain=true: explain the search, used to assist query

In actual applications, the query has some conditions. I am using q=* to check for unstable total doc counts. And again, the data in these problematic indexes will never change.

In addition, when checking some basic status through /_cluster/health and /_cat/shards, they are all GREEN and STARTED

It is worth mentioning that I have carefully analyzed this issue in combination with the sharing in this article: https://www.elastic.co/guide/en/elasticsearch/reference/7.17/consistent-scoring.html#_scores_are_not_reproducible

When I search using preference=_shards:0,1,2,3,4,5,6,7,8, the problem still recurs randomly

My current conclusion is that the committed status of some segments of the shards allocated on the datanode03 node of the cluster is false

When I use preference=_shards:0,1,2,3,4,5 to filter out the three shards 6,7,8 allocated on datanode03 (use /cat/shards/my_index to get this information), the hits total value becomes stable

But the most incomprehensible situation is that when observing all parameters such as os, jvm, mem, etc. through /nodes/datanode03/_stats, no possible abnormal information is found. They all look normal.

But the most incomprehensible situation is that I observed all the parameters such as os, jvm, mem, etc. through /nodes/datanode03/_stats, and no possible abnormal information was found. They all looked normal. I currently only have some segments that are not committed and the shards where these segments are located are coincidentally allocated on the datanode03 node. This is a valuable piece of information.

I want to get three help or discussion:
1. Is /_flush necessary? I initially judged that this action can solve this problem, but it is difficult to reproduce the phenomenon of why some segments are difficult to commit in other environments. In other words, if we donâ€™t know why this situation occurs, we canâ€™t avoid the problem from happening again in the future
2. From the server level and node level, we have analyzed that the datanode03 server does not have any abnormal information, logs, etc. How can I judge whether this node really has problems? From the phenomenon of all problematic indexes, all of them are segments in the shard allocated to this node
3. Will committed=false and searchable=false in the segment really affect the simplest query statement of _search?request_cache=false&explain=true&track_total_hits=true&q=*?",killersteps,closed,"['Team:Search Foundations', ':Search Foundations/Search']",https://github.com/elastic/elasticsearch/issues/113256,2024-09-20T10:28:11Z,21,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/113256,"{
  ""application_resource"": ""yes""
}"
132,113197,new hardware profile for memory-optimized machines,"### Description

The [current offerings](https://www.elastic.co/guide/en/cloud/current/ec-gcp-configuration-choose.html) do not have an option for applications that need more memory over storage / CPU.",thequinto,closed,"['>enhancement', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/113197,2024-09-19T16:03:19Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/113197,"{
  ""application_resource"": ""no""
}"
133,113030,Lucene memory segment input regression caused by JDK 23,"**ES version**:
main / lucene_snapshot

**JDK**: 
openjdk version ""23"" 2024-09-17
OpenJDK Runtime Environment (build 23+37-2369)
OpenJDK 64-Bit Server VM (build 23+37-2369, mixed mode, sharing)

**OS**:
* bare metal, Ubuntu 18.04 LTS, kernel 5.4.0-65-generic x86_64, 8 cores, 32 GiB RAM - reproducible occasionally
* GCP, Ubuntu 22.04 LTS, kernel 6.5.0-1025-gcp x86_64, 8 cores, 8 GiB RAM - reproducible every time
* GCP, Ubuntu 22.04 LTS, kernel 5.15.0-1025-gcp x86_64, 8 cores, 8 GiB RAM - reproducible every time

**Bug**:
Lucene memory segment input slows down with JDK 23. This applies to both Lucene 9.11.1 as well as most recent 9.12.0 snapshot. The regression was noticed in nightly benchmarks when switched temporarily to JDK 23 on September 4th (rolled back on September 6th).

For example nightly benchmark for [Nested](https://github.com/elastic/rally-tracks/tree/master/nested) Rally track regressed as follows for `nested-date-histo` query ([src](https://github.com/elastic/rally-tracks/blob/54d3433dcca0f239ddedd3d26b8cbefed9eeb44f/nested/operations/default.json#L45-L66)) latency:

([dashboard](https://elasticsearch-benchmarks.elastic.co/#tracks/nested/nightly/default/90d))

![Image](https://github.com/user-attachments/assets/5c0ada1a-ceef-4768-bffe-f0180cbba2fe)

Wall clock profiles collected when running this query continuously show that ES spends way more time in methods such as `org.apache.lucene.store.MemorySegmentIndexInput.readLong()`.

JDK 22:

![Image](https://github.com/user-attachments/assets/c664ca3e-8f20-4353-aa34-9bdc08fc62da)

![Image](https://github.com/user-attachments/assets/6dcf21c3-fb3b-4393-9292-7d02f863edd9)

JDK 23:

![Image](https://github.com/user-attachments/assets/1703395d-6fdf-41b2-bdb2-b842bcf5ea15)

![Image](https://github.com/user-attachments/assets/111ce6d4-a4ba-4d12-974f-915141c903b2)

[wall-clock-profiles.zip](https://github.com/user-attachments/files/17030845/wall-clock-profiles.zip)
",gbanasiak,closed,"[':Search/Search', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/113030,2024-09-17T15:36:24Z,12,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/113030,"{
  ""application_resource"": ""yes""
}"
134,112980,[CI] MLModelDeploymentFullClusterRestartIT testDeploymentSurvivesRestart {cluster=UPGRADED} failing,"**Build Scans:**
- [elasticsearch-periodic #4230 / 8.0.1_bwc](https://gradle-enterprise.elastic.co/s/j6lny66ep3vbc)
- [elasticsearch-pull-request #33411 / 8.16.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/rxjnwydgtff4g)
- [elasticsearch-pull-request #33411 / 8.15.3_bwc-snapshots](https://gradle-enterprise.elastic.co/s/3wrxmua5wwo6s)
- [elasticsearch-pull-request #33319 / 8.16.0_bwc-snapshots](https://gradle-enterprise.elastic.co/s/634s5wyqss5dy)

**Reproduction Line:**
```
./gradlew "":x-pack:qa:full-cluster-restart:v8.0.1#bwcTest"" -Dtests.class=""org.elasticsearch.xpack.restart.MLModelDeploymentFullClusterRestartIT"" -Dtests.method=""testDeploymentSurvivesRestart {cluster=UPGRADED}"" -Dtests.seed=A7BE2CA36E251E1E -Dtests.bwc=true -Dtests.locale=af-ZA -Dtests.timezone=Antarctica/South_Pole -Druntime.java=22
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testDeploymentSurvivesRestart%20%7Bcluster%3DUPGRADED%7D'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.xpack.restart.MLModelDeploymentFullClusterRestartIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))

**Failure Message:**
```
java.lang.AssertionError: {pipeline_count=0, inference_stats={inference_count=0, missing_all_fields_count=0, cache_miss_count=0, failure_count=0, timestamp=1727583532879}, model_size_stats={model_size_bytes=1630, required_native_memory_bytes=251661500}, model_id=trained-model-full-cluster-restart, deployment_stats={start_time=1727583330770, nodes=[{routing_state={routing_state=started}, node={CGZLJvqlRLSEr-HrhzHFwA={transport_address=127.0.0.1:44015, roles=[data, data_cold, data_content, data_frozen, data_hot, data_warm, ingest, master, ml, remote_cluster_client, transform], name=test-cluster-1, min_index_version=8000099, external_id=test-cluster-1, attributes={ml.allocated_processors_double=32.0, ml.machine_memory=126604148736, xpack.installed=true, transform.config_version=10.0.0, testattr=test, ml.config_version=12.0.0, ml.max_jvm_size=536870912, ml.allocated_processors=32}, max_index_version=8515000, ephemeral_id=ml2aiQ73QZigNycsBzN2nw, version=9.0.0}}, start_time=1727583442708, inference_cache_hit_count=0, inference_count=0, throughput_last_minute=0, threads_per_allocation=1, number_of_allocations=1, number_of_pending_requests=0, inference_cache_hit_count_last_minute=0, peak_throughput_per_minute=0}], threads_per_allocation=1, allocation_status={target_allocation_count=1, state=starting, allocation_count=0}, deployment_id=trained-model-full-cluster-restart, model_id=trained-model-full-cluster-restart, state=started, number_of_allocations=1, priority=normal, queue_capacity=1024, peak_throughput_per_minute=0}}
Expected: ""fully_allocated""
     but: was ""starting""
```

**Issue Reasons:**
- [main] 4 failures in test testDeploymentSurvivesRestart {cluster=UPGRADED} (1.1% fail rate in 357 executions)
- [main] 2 failures in step 8.16.0_bwc-snapshots (2.7% fail rate in 74 executions)
- [main] 2 failures in pipeline elasticsearch-pull-request (3.5% fail rate in 57 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', ':ml', 'Team:ML', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/112980,2024-09-17T04:28:42Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/112980,"{
  ""application_resource"": ""yes""
}"
135,112892,Permission Error When Installing Plugins on an Elasticsearch Cluster Deployed with ECK on Kubernetes,"### Elasticsearch Version

8.12.2

### Installed Plugins

analysis-ik

### Java Version

_bundled_

### OS Version

Ubuntu 22.04

### Problem Description

Installation plugin error:
```sh
bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/8.12.2
...
...
Exception in thread ""main"" java.nio.file.FileSystemException: /usr/share/elasticsearch/config/analysis-ik: Operation not permitted
```

### Steps to Reproduce

Kubernetes partial configuration file:
```yaml
initContainers:
  - name: install-plugins
    securityContext:
      privileged: true
      runAsUser: 0
    command:
      - sh
      - -c
      - |
        bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/8.12.2
```

The pod init failed, part of the pod describe output:
```sh
Back-off restarting failed container install-plugins in pod elastic-search-es-default-1_elastic
```

Modified the configuration to not install the plugin automatically, and redeployed the pod:
```yaml
initContainers:
  - name: install-plugins
    securityContext:
      privileged: true
      runAsUser: 0
    command:
      - sh
      - -c
      - |
        echo ""hello""
```

Used `kubectl exec` to enter the pod and manually install the plugin:
```sh
bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/8.12.2
```

Encountered the following error:
```sh
Exception in thread ""main"" java.nio.file.FileSystemException: 
     /usr/share/elasticsearch/config/analysis-ik: Operation not permitted
```

Even after adding permissions for the `config/analysis-ik` directory in the Kubernetes configuration, the error still persists:
```yaml
initContainers:
  - name: install-plugins
    securityContext:
      privileged: true
      runAsUser: 0
    command:
      - sh
      - -c
      - |
        mkdir -p config/analysis-ik
        chmod -R 777 config/analysis-ik
        bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/8.12.2
```

Full Kubernetes configuration:
```yaml
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: elastic-search
  namespace: elastic
spec:
  version: 8.12.2
  nodeSets:
    - name: default
      count: 2
      config:
        node.store.allow_mmap: false
        node.roles: [""master"", ""data"", ""ingest""]
      volumeClaimTemplates:
        - metadata:
            name: elasticsearch-data
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 20Gi
            storageClassName: sc-es
      podTemplate:
        spec:
          containers:
            - name: elasticsearch
              resources:
                requests:
                  memory: 8Gi
                  cpu: 4
                limits:
                  memory: 8Gi
                  cpu: 4
          initContainers:
            - name: install-plugins
              securityContext:
                privileged: true
                runAsUser: 0
              command:
                - sh
                - -c
                - |
                  bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/8.12.2

  transport:
    service:
      metadata:
        name: elastic
      spec:
        type: NodePort
```

`sc-es` StorageClass contents:
```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
provisioner: nfs.csi.k8s.io
metadata:
  name: sc-es
allowVolumeExpansion: true
reclaimPolicy: Retain
parameters:
  server: 10.10.10.110
  share: /nfs/elastic/search
```

NFS directory permissions:
```sh
ls -ld /nfs/elastic/search/
drwxrwxrwx 6 root root 4096 Sep 14 12:03 /nfs/elastic/search/
```

Kubernetes `v1.30.5`

### Logs (if relevant)

_No response_",yancy-hong,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/112892,2024-09-14T08:39:15Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/112892,"{
  ""application_resource"": ""yes""
}"
136,112725,"Error in fleet-server, kibana, elastic search","### Elasticsearch Version

8.15

### Installed Plugins

elasticsearch, kibana, elastic agent

### Java Version

_bundled_

### OS Version

Linux Ubuntu Docker

### Problem Description

I am setting up an Elastic Stack environment in Docker, which includes containers for Elasticsearch, Kibana, and Elastic Agent with Fleet Server enabled. However, Iâ€™ve encountered an issue where Fleet Server is not connecting properly to Elasticsearch, and the logs show several errors.

Iâ€™m using certificates issued by Letâ€™s Encrypt, and both Elasticsearch and Kibana are working correctly. However, Fleet Server is still unable to establish a connection, and Iâ€™ve been debugging the issue all week without finding a solution.

Could anyone provide guidance or suggestions on what might be going wrong?

### Steps to Reproduce


### Container Configuration

Here is the relevant configuration for my containers (credentials and tokens replaced for security reasons):

Container


```
elasticsearch:
  container_name: ""elasticsearch""
  image: docker.elastic.co/elasticsearch/elasticsearch:8.15.0
  environment:
    - discovery.type=single-node
    - ""ES_JAVA_OPTS=-Xms512m -Xmx512m""
    - ELASTIC_PASSWORD=<replace>
  ports:
    - ""9200:9200""
  volumes:
    - elasticsearch-service-data:/usr/share/elasticsearch/data
    - elasticsearch-service-certs:/usr/share/elasticsearch/config/certs
    - ./elasticsearch/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
  networks:
    - bridge-net

kibana:
  image: docker.elastic.co/kibana/kibana:8.15.0
  container_name: kibana
  environment:
    - SERVERNAME=kibana
    - ELASTICSEARCH_HOSTS=[""https://elasticsearch:9200""]
    - ELASTIC_USERNAME=kibana_user
    - ELASTICSEARCH_PASSWORD=<replace>
  volumes:
    - kibana-data:/usr/share/kibana/data
    - kibana-certs:/usr/share/kibana/config/certs
    - ./kibana/kibana.yml:/usr/share/kibana/config/kibana.yml
  ports:
    - ""5601:5601""
  networks:
    - bridge-net

elastic-agent:
  image: docker.elastic.co/beats/elastic-agent-complete:8.15.1
  container_name: elastic-agent
  environment:
    - URL=https://kibana:8220
    - FLEET_ENROLLMENT_TOKEN=<replace>
    - CERTIFICATE_AUTHORITIES=/usr/share/elastic-agent/config/certs/chain.pem
    - FLEET_CA=/usr/share/elastic-agent/config/certs/fullchain.pem
    - FLEET_SERVER_ENABLE=true
    - FLEET_SERVER_PORT=8220
    - FLEET_SERVER_ES=https://dominio.com:9200
    - FLEET_SERVER_ES_CA=/usr/share/elastic-agent/config/certs/chain.pem
    - FLEET_SERVER_CERT=/usr/share/elastic-agent/config/certs/fullchain.pem
    - FLEET_SERVER_CERT_KEY=/usr/share/elastic-agent/config/certs/privkey.pem

   - FLEET_SERVER_ES_CERT=/usr/share/elastic-agent/config/certs/fullchain.pem
   - FLEET_SERVER_ES_CERT_KEY=/usr/share/elastic-agent/config/certs/privkey.pem
   - FLEET_SERVER_CLIENT_AUTH=required
      
   - KIBANA_FLEET_SETUP=1
   - KIBANA_FLEET_HOST=https://dominio.com:5601
   - KIBANA_FLEET_USERNAME=""elastic""
   - KIBANA_FLEET_PASSWORD=""PASS""
   - KIBANA_FLEET_CA=/usr/share/elastic-agent/config/certs/chain.pem

   - KIBANA_HOST=https://dominio.com:5601
   - KIBANA_USERNAME=""elastic""
   - KIBANA_PASSWORD=""PASS""
   - KIBANA_CA=/usr/share/elastic-agent/config/certs/chain.pem

   - ELASTICSEARCH_HOST=https://dominio:9200
   - ELASTICSEARCH_USERNAME=""kibana_user""
   - ELASTICSEARCH_PASSWORD=""PASS""
   - ELASTICSEARCH_CA=/usr/share/elastic-agent/config/certs/chain.pem
  volumes:
    - ./fleet/config/certs/:/usr/share/elastic-agent/config/certs/
  ports:
    - ""8220:8220""
  networks:
    - bridge-net
```

Errors Encountered

Logs in Kibana:

`[2024-09-10T22:46:31.887+00:00][INFO ][plugins.fleet] Secrets storage is disabled as minimum fleet server version has not been met`

Logs in Elastic Agent (Fleet Server):


```
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:57.648Z"",""log.logger"":""api"",""log.origin"":{""function"":""github.com/elastic/elastic-agent-libs/api.(*Server).Start.func1"",""file.name"":""api/server.go"",""file.line"":90},""message"":""Stats endpoint (127.0.0.1:6791) finished: accept tcp 127.0.0.1:6791: use of closed network connection"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
Error: context canceled
{""log.level"":""error"",""@timestamp"":""2024-09-10T23:23:28.840Z"",""message"":""Fleet Server failed"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""error.message"":""failed version compatibility check with elasticsearch: dial tcp 209.126.6.195:9200: i/o timeout"",""@timestamp"":""2024-09-10T23:23:28.84Z"",""ecs.version"":""1.6.0""}
{""log.level"":""error"",""@timestamp"":""2024-09-10T23:23:28.841Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/coordinator.(*Coordinator).watchRuntimeComponents"",""file.name"":""coordinator/coordinator.go"",""file.line"":665},""message"":""Unit state changed fleet-server-default-fleet-server (STARTING->FAILED): Error - failed version compatibility check with elasticsearch: dial tcp 209.126.6.195:9200: i/o timeout"",""log"":{""source"":""elastic-agent""},""component"":{""id"":""fleet-server-default"",""state"":""HEALTHY""},""unit"":{""id"":""fleet-server-default-fleet-server"",""type"":""input"",""state"":""FAILED"",""old_state"":""STARTING""},""ecs.version"":""1.6.0""}
{""log.level"":""error"",""@timestamp"":""2024-09-10T23:23:28.841Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/coordinator.(*Coordinator).watchRuntimeComponents"",""file.name"":""coordinator/coordinator.go"",""file.line"":665},""message"":""Unit state changed fleet-server-default (STARTING->FAILED): Error - failed version compatibility check with elasticsearch: dial tcp 209.126.6.195:9200: i/o timeout"",""log"":{""source"":""elastic-agent""},""component"":{""id"":""fleet-server-default"",""state"":""HEALTHY""},""unit"":{""id"":""fleet-server-default"",""type"":""output"",""state"":""FAILED"",""old_state"":""STARTING""},""ecs.version"":""1.6.0""}
```

# kibana.yml


```
elasticsearch.hosts: ""https://temp-elasticsearch-url:9200""
elasticsearch.username: ""elastic""
elasticsearch.password: ""TEMPORARY_PASSWORD""

monitoring.ui.container.elasticsearch.enabled: true

server.publicBaseUrl: ""https://temp-kibana-url""
server.name: temp-kibana

elasticsearch.ssl:
  verificationMode: certificate
  key: /usr/share/kibana/config/certs/privkey.pem # issued by Let's Encrypt
  certificate: /usr/share/kibana/config/certs/fullchain.pem # issued by Let's Encrypt
  certificateAuthorities: /usr/share/kibana/config/certs/chain.pem

server.ssl:
  enabled: true
  key: /usr/share/kibana/config/certs/privkey.pem # issued by Let's Encrypt
  certificate: /usr/share/kibana/config/certs/fullchain.pem # issued by Let's Encrypt
  certificateAuthorities: /usr/share/kibana/config/certs/chain.pem

xpack.reporting.encryptionKey: ""TEMPORARY_ENCRYPTION_KEY""
xpack.security.encryptionKey: ""TEMPORARY_ENCRYPTION_KEY""
xpack.encryptedSavedObjects.encryptionKey: ""TEMPORARY_ENCRYPTION_KEY""
xpack.screenshotting.browser.chromium.disableSandbox: false
xpack.reporting.roles.enabled: false
xpack.fleet.enabled: true

telemetry.enabled: false

server.port: 5601
server.host: ""0.0.0.0""
```

# elasticsearch.yml


```
http.port: 9200

cluster.name: name
node.name: name-1
network.host: ""0.0.0.0""
discovery.type: single-node

xpack.security.enabled: true
xpack.security.enrollment.enabled: true
xpack.security.authc.api_key.enabled: true
xpack.security.transport.ssl.enabled: true

xpack.security.transport.ssl:
  enabled: true
  verification_mode: certificate
  key: /usr/share/elasticsearch/config/certs/privkey.pem
  certificate: /usr/share/elasticsearch/config/certs/fullchain.pem
  certificate_authorities: /usr/share/elasticsearch/config/certs/chain.pem

xpack.security.http.ssl:
  enabled: true
  verification_mode: certificate
  key: /usr/share/elasticsearch/config/certs/privkey.pem
  certificate: /usr/share/elasticsearch/config/certs/fullchain.pem
  certificate_authorities: /usr/share/elasticsearch/config/certs/chain.pem

ingest.geoip.downloader.enabled: false
```

I have also checked the status of elastic-agent


```
elastic-agent@7e798926c7ce:~$ ./elastic-agent status
â”Œâ”€ fleet
â”‚  â””â”€ status: (STARTING) 
â””â”€ elastic-agent
   â”œâ”€ status: (HEALTHY) Running
   â””â”€ fleet-server-default
      â”œâ”€ status: (HEALTHY) Healthy: communicating with pid '23'
      â”œâ”€ fleet-server-default
      â”‚  â””â”€ status: (STARTING) Starting
      â””â”€ fleet-server-default-fleet-server
         â””â”€ status: (STARTING) Starting
```

![Image](https://github.com/user-attachments/assets/a23cbcad-d6e1-4aa2-aa2c-b61a0dc3a2b1)

![Image](https://github.com/user-attachments/assets/0f10e107-189b-4d65-8657-05adca358b2e)

![Image](https://github.com/user-attachments/assets/2d243e4f-bb19-4ef2-b140-f161140c9593)

## But the process never leaves this point.

![Image](https://github.com/user-attachments/assets/cd702e77-de99-4d76-a333-7f43503a5b85)


### Logs (if relevant)

**Kibana**

```
[2024-09-10T23:36:01.382+00:00][INFO ][plugins.fleet] Secrets storage is disabled as minimum fleet server version has not been met
[2024-09-10T23:36:10.690+00:00][INFO ][plugins.fleet] Fleet Usage: {""agents_enabled"":true,""agents"":{""total_enrolled"":0,""healthy"":0,""unhealthy"":0,""offline"":0,""inactive"":0,""unenrolled"":0,""total_all_statuses"":0,""updating"":0},""fleet_server"":{""total_enrolled"":0,""healthy"":0,""unhealthy"":0,""offline"":0,""updating"":0,""inactive"":0,""unenrolled"":0,""total_all_statuses"":0,""num_host_urls"":1},""license_issued_to"":""increci""}
[2024-09-10T23:36:15.803+00:00][INFO ][plugins.fleet] Secrets storage is disabled as minimum fleet server version has not been met
[2024-09-10T23:47:17.740+00:00][INFO ][plugins.fleet] Secrets storage is disabled as minimum fleet server version has not been met
[2024-09-10T23:47:29.657+00:00][INFO ][plugins.fleet] Secrets storage is disabled as minimum fleet server version has not been met
[2024-09-10T23:47:40.815+00:00][INFO ][plugins.fleet] Secrets storage is disabled as minimum fleet server version has not been met
[2024-09-10T23:47:59.830+00:00][INFO ][plugins.fleet] Secrets storage is disabled as minimum fleet server version has not been met
```

**Elastic Agent**


```
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:57.446Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/cmd.runElasticAgent"",""file.name"":""cmd/run.go"",""file.line"":383},""message"":""signal \""terminated\"" received"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:57.446Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/cmd.runElasticAgent"",""file.name"":""cmd/run.go"",""file.line"":395},""message"":""Shutting down Elastic Agent and sending last events..."",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:57.447Z"",""message"":""On signal"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""sig"":""terminated"",""ecs.version"":""1.6.0""}
{""log.level"":""error"",""@timestamp"":""2024-09-10T23:34:57.447Z"",""message"":""failed to fetch elasticsearch version"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""error.message"":""context canceled"",""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:57.447Z"",""message"":""Stopping"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""state"":""STOPPING"",""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:57.647Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/cmd.runElasticAgent"",""file.name"":""cmd/run.go"",""file.line"":404},""message"":""Shutting down completed."",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:57.648Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/monitoring/reload.(*ServerReloader).Stop"",""file.name"":""reload/reload.go"",""file.line"":74},""message"":""Stopping monitoring server"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:57.648Z"",""log.logger"":""api"",""log.origin"":{""function"":""github.com/elastic/elastic-agent-libs/api.(*Server).Start.func1"",""file.name"":""api/server.go"",""file.line"":90},""message"":""Stats endpoint (127.0.0.1:6791) finished: accept tcp 127.0.0.1:6791: use of closed network connection"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
Error: context canceled
For help, please see our troubleshooting guide at https://www.elastic.co/guide/en/fleet/8.15/fleet-troubleshooting.html
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:59.753Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/cmd.runElasticAgent"",""file.name"":""cmd/run.go"",""file.line"":195},""message"":""Elastic Agent started"",""log"":{""source"":""elastic-agent""},""process.pid"":7,""agent.version"":""8.15.1"",""agent.unprivileged"":true,""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:59.961Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/upgrade.InvokeWatcher"",""file.name"":""upgrade/rollback.go"",""file.line"":144},""message"":""agent is not upgradable, not starting watcher"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:59.964Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/cmd.runElasticAgent"",""file.name"":""cmd/run.go"",""file.line"":284},""message"":""APM instrumentation disabled"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:59.966Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application.New"",""file.name"":""application/application.go"",""file.line"":65},""message"":""Gathered system information"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:59.982Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application.New"",""file.name"":""application/application.go"",""file.line"":71},""message"":""Detected available inputs and outputs"",""log"":{""source"":""elastic-agent""},""inputs"":[""endpoint"",""audit/system"",""cel"",""entity-analytics"",""cloudbeat"",""cloudbeat/cis_eks"",""kafka"",""redis/metrics"",""stan/metrics"",""synthetics/tcp"",""kibana/metrics"",""postgresql/metrics"",""pf-elastic-collector"",""kubernetes/metrics"",""iis/metrics"",""statsd/metrics"",""cloudbeat/asset_inventory_aws"",""etw"",""http_endpoint"",""o365audit"",""synthetics/browser"",""osquery"",""cloud_defend/control"",""pf-host-agent"",""cloudbeat/cis_aws"",""log"",""etcd/metrics"",""kafka/metrics"",""elasticsearch/metrics"",""syncgateway/metrics"",""audit/auditd"",""audit/file_integrity"",""benchmark"",""gcs"",""synthetics/icmp"",""mysql/metrics"",""cloudbeat/cis_azure"",""aws-s3"",""container"",""lumberjack"",""enterprisesearch/metrics"",""unix"",""synthetics/http"",""beat/metrics"",""mssql/metrics"",""jolokia/metrics"",""nats/metrics"",""sql/metrics"",""cloudbeat/cis_k8s"",""cloudbeat/cis_gcp"",""cloudbeat/vuln_mgmt_aws"",""azure-eventhub"",""docker"",""journald"",""system/metrics"",""cloudfoundry/metrics"",""http/metrics"",""syslog"",""haproxy/metrics"",""rabbitmq/metrics"",""vsphere/metrics"",""packet"",""apm"",""azure-blob-storage"",""mqtt"",""websocket"",""aws/metrics"",""nginx/metrics"",""zookeeper/metrics"",""pf-elastic-symbolizer"",""cloudfoundry"",""redis"",""apache/metrics"",""gcp/metrics"",""memcached/metrics"",""awsfargate/metrics"",""oracle/metrics"",""activemq/metrics"",""fleet-server"",""salesforce"",""udp"",""winlog"",""linux/metrics"",""traefik/metrics"",""containerd/metrics"",""aws-cloudwatch"",""cometd"",""tcp"",""docker/metrics"",""windows/metrics"",""mongodb/metrics"",""uwsgi/metrics"",""azure/metrics"",""gcp-pubsub"",""httpjson"",""netflow"",""filestream"",""logstash/metrics"",""prometheus/metrics""],""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:59.982Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/capabilities.LoadFile"",""file.name"":""capabilities/capabilities.go"",""file.line"":48},""message"":""Capabilities file not found in /usr/share/elastic-agent/state/capabilities.yml"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:59.982Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application.New"",""file.name"":""application/application.go"",""file.line"":77},""message"":""Determined allowed capabilities"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:34:59.982Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application.New"",""file.name"":""application/application.go"",""file.line"":92},""message"":""Loading baseline config from /usr/share/elastic-agent/state/elastic-agent.yml"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.030Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/pkg/component/runtime.NewManager"",""file.name"":""runtime/manager.go"",""file.line"":180},""message"":""GRPC comms socket listening at localhost:6789"",""log"":{""source"":""elastic-agent""},""address"":""localhost:6789"",""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.039Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application.New"",""file.name"":""application/application.go"",""file.line"":167},""message"":""Parsed configuration and determined agent is in Fleet Server bootstrap mode"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.041Z"",""log.logger"":""control"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/pkg/control/v2/server.(*Server).Start"",""file.name"":""server/server.go"",""file.line"":88},""message"":""GRPC control socket listening at unix:///usr/share/elastic-agent/state/data/Td8I7R-Zby36_zF_IOd9QVNlFblNEro3.sock"",""log"":{""source"":""elastic-agent""},""address"":""unix:///usr/share/elastic-agent/state/data/Td8I7R-Zby36_zF_IOd9QVNlFblNEro3.sock"",""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.041Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/pkg/component/runtime.(*Manager).Run"",""file.name"":""runtime/manager.go"",""file.line"":246},""message"":""Starting grpc control protocol listener on port 6789 with max_message_size 104857600"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.042Z"",""log.logger"":""composable.providers.docker"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/composable/providers/docker.(*dynamicProvider).Run"",""file.name"":""docker/docker.go"",""file.line"":44},""message"":""Docker provider skipped, unable to connect: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.042Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/upgrade.(*Upgrader).Reload"",""file.name"":""upgrade/upgrade.go"",""file.line"":123},""message"":""Source URI changed from \""https://artifacts.elastic.co/downloads/\"" to \""https://artifacts.elastic.co/downloads/\"""",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.042Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/monitoring/reload.(*ServerReloader).Start"",""file.name"":""reload/reload.go"",""file.line"":54},""message"":""Starting monitoring server with cfg &config.MonitoringConfig{Enabled:true, MonitorLogs:true, MonitorMetrics:true, MetricsPeriod:\""\"", LogMetrics:true, HTTP:(*config.MonitoringHTTPConfig)(0xc001766c90), Namespace:\""default\"", Pprof:(*config.PprofConfig)(nil), MonitorTraces:false, APM:config.APMConfig{Environment:\""\"", APIKey:\""\"", SecretToken:\""\"", Hosts:[]string(nil), GlobalLabels:map[string]string(nil), TLS:config.APMTLS{SkipVerify:false, ServerCertificate:\""\"", ServerCA:\""\""}}, Diagnostics:config.Diagnostics{Uploader:config.Uploader{MaxRetries:10, InitDur:1000000000, MaxDur:600000000000}, Limit:config.Limit{Interval:60000000000, Burst:1}}}"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.042Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/monitoring.NewServer.exposeMetricsEndpoint.func1"",""file.name"":""monitoring/server.go"",""file.line"":90},""message"":""creating monitoring API with cfg api.Config{Enabled:true, Host:\""http://localhost:6791\"", Port:6791, User:\""\"", SecurityDescriptor:\""\"", Timeout:5000000000}"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.042Z"",""log.logger"":""api"",""log.origin"":{""function"":""github.com/elastic/elastic-agent-libs/api.(*Server).Start"",""file.name"":""api/server.go"",""file.line"":85},""message"":""Starting stats endpoint"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.042Z"",""log.logger"":""api"",""log.origin"":{""function"":""github.com/elastic/elastic-agent-libs/api.(*Server).Start.func1"",""file.name"":""api/server.go"",""file.line"":87},""message"":""Metrics endpoint listening on: 127.0.0.1:6791 (configured: http://localhost:6791)"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.152Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/coordinator.(*Coordinator).refreshComponentModel"",""file.name"":""coordinator/coordinator.go"",""file.line"":1272},""message"":""Updating running component model"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.233Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/coordinator.(*Coordinator).watchRuntimeComponents"",""file.name"":""coordinator/coordinator.go"",""file.line"":627},""message"":""Spawned new component fleet-server-default: Starting: spawned pid '22'"",""log"":{""source"":""elastic-agent""},""component"":{""id"":""fleet-server-default"",""state"":""STARTING""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.233Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/coordinator.(*Coordinator).watchRuntimeComponents"",""file.name"":""coordinator/coordinator.go"",""file.line"":634},""message"":""Spawned new unit fleet-server-default-fleet-server: Starting: spawned pid '22'"",""log"":{""source"":""elastic-agent""},""component"":{""id"":""fleet-server-default"",""state"":""STARTING""},""unit"":{""id"":""fleet-server-default-fleet-server"",""type"":""input"",""state"":""STARTING""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.233Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/coordinator.(*Coordinator).watchRuntimeComponents"",""file.name"":""coordinator/coordinator.go"",""file.line"":634},""message"":""Spawned new unit fleet-server-default: Starting: spawned pid '22'"",""log"":{""source"":""elastic-agent""},""component"":{""id"":""fleet-server-default"",""state"":""STARTING""},""unit"":{""id"":""fleet-server-default"",""type"":""output"",""state"":""STARTING""},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.262Z"",""message"":""Boot fleet-server"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""commit"":""13e2f247"",""pid"":22,""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""version"":""8.15.1"",""ppid"":7,""exe"":""/usr/share/elastic-agent/data/elastic-agent-ecab0c/components/fleet-server"",""args"":[""--agent-mode"",""-E"",""logging.level=debug"",""-E"",""logging.to_stderr=true"",""-E"",""path.data=/usr/share/elastic-agent/state/data/run/fleet-server-default""],""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.263Z"",""message"":""starting communication connection back to Elastic Agent"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.269Z"",""log.logger"":""component.runtime.fleet-server-default"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/pkg/component/runtime.(*Manager).CheckinV2"",""file.name"":""runtime/manager.go"",""file.line"":715},""message"":""control checkin v2 protocol has chunking enabled"",""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.269Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/coordinator.(*Coordinator).watchRuntimeComponents"",""file.name"":""coordinator/coordinator.go"",""file.line"":647},""message"":""Component state changed fleet-server-default (STARTING->HEALTHY): Healthy: communicating with pid '22'"",""log"":{""source"":""elastic-agent""},""component"":{""id"":""fleet-server-default"",""state"":""HEALTHY"",""old_state"":""STARTING""},""ecs.version"":""1.6.0""}
{""log.level"":""error"",""@timestamp"":""2024-09-10T23:35:00.272Z"",""message"":""failed to fetch elasticsearch version"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""error.message"":""dial tcp [::1]:9200: connect: connection refused"",""ecs.version"":""1.6.0""}
{""log.level"":""warn"",""@timestamp"":""2024-09-10T23:35:00.272Z"",""message"":""Failed Elasticsearch output configuration test, using bootstrap values."",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""output"":{""hosts"":[""localhost:9200""],""protocol"":""https"",""proxy_disable"":false,""proxy_headers"":{},""service_token"":""AAEAAWVsYXN0aWMvZmxlZXQtc2VydmVyL3Rva2VuLTE3MjU5NjMxMzMzMDk6elBSZWhmV01TUmlfaWpDZUFjNng2UQ"",""ssl"":{""certificate"":""/usr/share/elastic-agent/config/certs/fullchain.pem"",""certificate_authorities"":[""/usr/share/elastic-agent/config/certs/chain.pem""],""key"":""/usr/share/elastic-agent/config/certs/privkey.pem"",""verification_mode"":""full""},""type"":""elasticsearch""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""error.message"":""dial tcp [::1]:9200: connect: connection refused"",""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.273Z"",""message"":""Found settings with recommended ram."",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""memory_mb"":24027,""recommended_mb"":16192,""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.273Z"",""message"":""Setting cache config options"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""cfg"":{""APIKeyJitter"":300000000000,""APIKeyTTL"":900000000000,""ActionTTL"":300000000000,""ArtifactTTL"":86400000000000,""EnrollKeyTTL"":60000000000,""MaxCost"":268435456,""NumCounters"":1600000},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.275Z"",""message"":""Starting"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""state"":""STARTING"",""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.275Z"",""message"":""Found settings with recommended ram."",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""memory_mb"":24027,""recommended_mb"":16192,""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.276Z"",""message"":""initial server configuration"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""new"":{""Fleet"":{""Agent"":{""ID"":"""",""Logging"":{""Level"":""""},""Version"":""8.15.1""},""Host"":{""ID"":"""",""Name"":""""}},""HTTP"":{""Enabled"":false,""Host"":""localhost"",""Port"":5066,""SecurityDescriptor"":"""",""User"":""""},""Inputs"":[{""Cache"":{""APIKeyJitter"":0,""APIKeyTTL"":0,""ActionTTL"":0,""ArtifactTTL"":0,""EnrollKeyTTL"":0,""MaxCost"":0,""NumCounters"":0},""Monitor"":{""FetchSize"":0,""PolicyDebounceTime"":0,""PollTimeout"":0},""Policy"":{""ID"":""""},""Server"":{""Bulk"":{""FlushInterval"":250000000,""FlushMaxPending"":8,""FlushThresholdCount"":2048,""FlushThresholdSize"":1048576},""CompressionLevel"":1,""CompressionThresh"":1024,""GC"":{""CleanupAfterExpiredInterval"":""30d"",""ScheduleInterval"":3600000000000},""Host"":""0.0.0.0"",""Instrumentation"":{""APIKey"":"""",""APIKeyPath"":"""",""Enabled"":false,""Environment"":"""",""GlobalLabels"":"""",""Hosts"":null,""SecretToken"":"""",""SecretTokenPath"":"""",""TLS"":{""ServerCA"":"""",""ServerCertificate"":"""",""SkipVerify"":false},""TransactionSampleRate"":""""},""InternalPort"":8221,""Limits"":{""AckLimit"":{""Burst"":4000,""Interval"":500000,""Max"":8000,""MaxBody"":2097152},""ActionLimit"":{""Burst"":100,""Interval"":500000,""Max"":0,""MaxBody"":0},""ArtifactLimit"":{""Burst"":4000,""Interval"":500000,""Max"":8000,""MaxBody"":0},""CheckinLimit"":{""Burst"":4000,""Interval"":500000,""Max"":40000,""MaxBody"":1048576},""DeliverFileLimit"":{""Burst"":40,""Interval"":100000000,""Max"":80,""MaxBody"":0},""EnrollLimit"":{""Burst"":100,""Interval"":10000000,""Max"":200,""MaxBody"":524288},""GetPGPKey"":{""Burst"":25,""Interval"":5000000,""Max"":50,""MaxBody"":0},""MaxAgents"":0,""MaxConnections"":0,""MaxHeaderByteSize"":8192,""PolicyLimit"":{""Burst"":1,""Interval"":2000000,""Max"":0,""MaxBody"":0},""PolicyThrottle"":0,""StatusLimit"":{""Burst"":200,""Interval"":5000000,""Max"":400,""MaxBody"":0},""UploadChunkLimit"":{""Burst"":40,""Interval"":3000000,""Max"":80,""MaxBody"":4194304},""UploadEndLimit"":{""Burst"":40,""Interval"":2000000000,""Max"":80,""MaxBody"":1024},""UploadStartLimit"":{""Burst"":40,""Interval"":2000000000,""Max"":80,""MaxBody"":5242880}},""PGP"":{""Dir"":""/usr/share/elastic-agent/data/elastic-agent-ecab0c/components/elastic-agent-upgrade-keys"",""UpstreamURL"":""https://artifacts.elastic.co/GPG-KEY-elastic-agent""},""Port"":8220,""Profiler"":{""Bind"":""localhost:6060"",""Enabled"":false},""Runtime"":{""GCPercent"":0,""MemoryLimit"":0},""StaticPolicyTokens"":{""Enabled"":false,""PolicyTokens"":null},""TLS"":{""CASha256"":null,""CAs"":[""/usr/share/elastic-agent/config/certs/fullchain.pem""],""Certificate"":{""Certificate"":""/usr/share/elastic-agent/config/certs/fullchain.pem"",""Key"":""[redacted]"",""Passphrase"":"""",""PassphrasePath"":""""},""CipherSuites"":null,""ClientAuth"":""required"",""CurveTypes"":null,""Enabled"":null,""VerificationMode"":""full"",""Versions"":null},""Timeouts"":{""CheckinJitter"":30000000000,""CheckinLongPoll"":300000000000,""CheckinMaxPoll"":3600000000000,""CheckinTimestamp"":30000000000,""Drain"":10000000000,""Idle"":30000000000,""Read"":60000000000,""ReadHeader"":5000000000,""Write"":600000000000}},""Type"":""""}],""Logging"":{""Files"":null,""Level"":""info"",""Pretty"":false,""ToFiles"":true,""ToStderr"":true},""Output"":{""Elasticsearch"":{""Headers"":null,""Hosts"":[""increci-kibana.opperweb.com:9200""],""MaxConnPerHost"":128,""MaxContentLength"":104857600,""MaxRetries"":3,""Path"":"""",""Protocol"":""https"",""ProxyDisable"":false,""ProxyHeaders"":{},""ProxyURL"":"""",""ServiceToken"":""[redacted]"",""ServiceTokenPath"":"""",""TLS"":{""CASha256"":null,""CATrustedFingerprint"":"""",""CAs"":[""/usr/share/elastic-agent/config/certs/chain.pem""],""Certificate"":{""Certificate"":""/usr/share/elastic-agent/config/certs/fullchain.pem"",""Key"":""[redacted]"",""Passphrase"":"""",""PassphrasePath"":""""},""CipherSuites"":null,""CurveTypes"":null,""Enabled"":null,""Renegotiation"":""never"",""VerificationMode"":""full"",""Versions"":null},""Timeout"":90000000000},""Extra"":null}},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.276Z"",""message"":""starting server on configuration change"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.276Z"",""message"":""Run bulker with options"",""component"":{""binary"":""fleet-server"",""dataset"":""elastic_agent.fleet_server"",""id"":""fleet-server-default"",""type"":""fleet-server""},""log"":{""source"":""fleet-server-default""},""ecs.version"":""1.6.0"",""service.name"":""fleet-server"",""service.type"":""fleet-server"",""opts"":{""apikeyMaxParallel"":120,""apikeyMaxReqSize"":104857600,""blockQueueSz"":32,""flushInterval"":250,""flushThresholdCnt"":2048,""flushThresholdSz"":1048576,""maxPending"":8},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.358Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/coordinator.(*Coordinator).checkAndLogUpdate"",""file.name"":""coordinator/coordinator.go"",""file.line"":1478},""message"":""component model updated"",""log"":{""source"":""elastic-agent""},""changes"":{""components"":{""count"":1},""outputs"":{}},""ecs.version"":""1.6.0""}
{""log.level"":""info"",""@timestamp"":""2024-09-10T23:35:00.359Z"",""log.origin"":{""function"":""github.com/elastic/elastic-agent/internal/pkg/agent/application/coordinator.(*Coordinator).refreshComponentModel"",""file.name"":""coordinator/coordinator.go"",""file.line"":1272},""message"":""Updating running component model"",""log"":{""source"":""elastic-agent""},""ecs.version"":""1.6.0""}
```",soularius,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/112725,2024-09-10T23:50:24Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/112725,"{
  ""application_resource"": ""yes""
}"
137,112462,[CI] StandardVersusLogsIndexModeRandomDataChallengeRestIT testTermsQuery failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #4059 / windows-2016_checkpart1_platform-support-windows](https://gradle-enterprise.elastic.co/s/2a43j6nfbt7ig)
- [elasticsearch-periodic-platform-support #4059 / windows-2019_checkpart1_platform-support-windows](https://gradle-enterprise.elastic.co/s/fpk5ux4yzgz5m)
- [elasticsearch-periodic-platform-support #4059 / amazonlinux-2023_platform-support-aws](https://gradle-enterprise.elastic.co/s/32duzgnjqr72c)
- [elasticsearch-periodic-platform-support #4059 / oraclelinux-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/omr4josrhdggw)
- [elasticsearch-periodic-platform-support #4059 / rhel-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/2nwtix7zdwblu)
- [elasticsearch-intake #9712 / part1](https://gradle-enterprise.elastic.co/s/ry5pg4ei6dl22)
- [elasticsearch-pull-request #31009 / part-1](https://gradle-enterprise.elastic.co/s/aaifufk3kbqcu)

**Reproduction Line:**
```
gradlew "":modules:data-streams:javaRestTest"" --tests ""org.elasticsearch.datastreams.logsdb.qa.StandardVersusLogsIndexModeRandomDataChallengeRestIT.testTermsQuery"" -Dtests.seed=1DD73563DAA4F54D -Dtests.locale=ar-QA -Dtests.timezone=Etc/GMT-8 -Druntime.java=22
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testTermsQuery'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.datastreams.logsdb.qa.StandardVersusLogsIndexModeRandomDataChallengeRestIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [3]. Source documents don't match for field [H.fodEaJOUDO.vjnoObhz]: Error [List lengths do not match, actual: [-97, -36, -116, -86, 41, -122, -27, -91, -125, -127, -32], expected: [-97, 33, -36, 41, 107, -116, -86, 23, 24, -122, -27, -91, -125, -127, -32]] actual mappings [{""_doc"":{""subobjects"":""false"",""properties"":{""host.name"":{""type"":""keyword""},""method"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""Y"":{""type"":""unsigned_long"",""index"":false,""store"":true,""doc_values"":false},""pCWQdU"":{""type"":""short"",""index"":true,""store"":true,""doc_values"":false},""zDcZQqbhuq"":{""type"":""byte"",""index"":true,""store"":true,""doc_values"":true},""Hx"":{""type"":""float"",""index"":false,""store"":false,""doc_values"":true},""x"":{""type"":""short"",""index"":true,""store"":true,""doc_values"":false},""fMy"":{""type"":""short"",""index"":true,""store"":true,""doc_values"":false},""K"":{""type"":""byte"",""index"":true,""store"":false,""doc_values"":true},""JiFOsNzgWw"":{""type"":""integer"",""index"":true,""store"":true,""doc_values"":false},""tL"":{""type"":""short"",""index"":false,""store"":true,""doc_values"":true},""IkgzUHHwV"":{""type"":""keyword"",""index"":false,""store"":false,""doc_values"":true},""knlVpxuV"":{""enabled"":""true"",""subobjects"":""false"",""properties"":{""jsAd"":{""type"":""half_float"",""index"":false,""store"":false,""doc_values"":false},""nZtdPEzhUR"":{""type"":""short"",""index"":true,""store"":false,""doc_values"":false},""OdGGGeu"":{""type"":""half_float"",""index"":false,""store"":true,""doc_values"":true},""yV"":{""type"":""integer"",""index"":true,""store"":false,""doc_values"":false},""wiy"":{""type"":""unsigned_long"",""index"":true,""store"":true,""doc_values"":false},""KgWHUNV"":{""dynamic"":""true"",""subobjects"":""false"",""properties"":{""DZMioIUdJ"":{""type"":""short"",""index"":false,""store"":true,""doc_values"":false},""hxljlgy"":{""type"":""unsigned_long"",""index"":true,""store"":false,""doc_values"":false},""oCkrATP"":{""type"":""keyword"",""index"":true,""store"":false,""doc_values"":true},""i"":{""type"":""short"",""index"":true,""store"":false,""doc_values"":true},""oGksLAbo"":{""type"":""float"",""index"":false,""store"":false,""doc_values"":false}}},""TV"":{""type"":""byte"",""index"":false,""store"":true,""doc_values"":true},""pKNhCsdt"":{""type"":""unsigned_long"",""index"":true,""store"":true,""doc_values"":false},""GFjhpCRr"":{""type"":""scaled_float"",""index"":true,""store"":true,""scaling_factor"":10,""doc_values"":true}}},""r"":{""type"":""half_float"",""index"":true,""store"":false,""doc_values"":true},""SsHsgTpOpU"":{""type"":""scaled_float"",""index"":false,""store"":false,""scaling_factor"":100000,""doc_values"":true},""zFDW"":{""type"":""keyword"",""index"":true,""store"":false,""doc_values"":true},""pGDizkHW"":{""type"":""long"",""index"":true,""store"":true,""doc_values"":false},""qqZiSrIAC"":{""type"":""float"",""index"":true,""store"":true,""doc_values"":false},""rtWFa"":{""type"":""short"",""index"":false,""store"":true,""doc_values"":false},""CSTL"":{""type"":""unsigned_long"",""index"":true,""store"":false,""doc_values"":true},""pGByPLmCK"":{""type"":""float"",""index"":false,""store"":true,""doc_values"":true},""RvaIXcmv"":{""type"":""double"",""index"":false,""store"":true,""doc_values"":true},""rgz"":{""type"":""scaled_float"",""index"":true,""store"":true,""scaling_factor"":10,""doc_values"":true},""FtsjUByoB"":{""type"":""scaled_float"",""index"":true,""store"":true,""scaling_factor"":100000,""doc_values"":false}}}}] actual settings [{""index"":{""mode"":""logsdb"",""mapping"":{""synthetic_source_keep"":""arrays"",""total_fields"":{""limit"":""5000""}}}}] expected mappings [{""_doc"":{""subobjects"":""false"",""properties"":{""host.name"":{""type"":""keyword""},""method"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""Y"":{""type"":""unsigned_long"",""index"":false,""store"":true,""doc_values"":false},""pCWQdU"":{""type"":""short"",""index"":true,""store"":true,""doc_values"":false},""zDcZQqbhuq"":{""type"":""byte"",""index"":true,""store"":true,""doc_values"":true},""Hx"":{""type"":""float"",""index"":false,""store"":false,""doc_values"":true},""x"":{""type"":""short"",""index"":true,""store"":true,""doc_values"":false},""fMy"":{""type"":""short"",""index"":true,""store"":true,""doc_values"":false},""K"":{""type"":""byte"",""index"":true,""store"":false,""doc_values"":true},""JiFOsNzgWw"":{""type"":""integer"",""index"":true,""store"":true,""doc_values"":false},""tL"":{""type"":""short"",""index"":false,""store"":true,""doc_values"":true},""IkgzUHHwV"":{""type"":""keyword"",""index"":false,""store"":false,""doc_values"":true},""knlVpxuV"":{""enabled"":""true"",""subobjects"":""false"",""properties"":{""jsAd"":{""type"":""half_float"",""index"":false,""store"":false,""doc_values"":false},""nZtdPEzhUR"":{""type"":""short"",""index"":true,""store"":false,""doc_values"":false},""OdGGGeu"":{""type"":""half_float"",""index"":false,""store"":true,""doc_values"":true},""yV"":{""type"":""integer"",""index"":true,""store"":false,""doc_values"":false},""wiy"":{""type"":""unsigned_long"",""index"":true,""store"":true,""doc_values"":false},""KgWHUNV"":{""dynamic"":""true"",""subobjects"":""false"",""properties"":{""DZMioIUdJ"":{""type"":""short"",""index"":false,""store"":true,""doc_values"":false},""hxljlgy"":{""type"":""unsigned_long"",""index"":true,""store"":false,""doc_values"":false},""oCkrATP"":{""type"":""keyword"",""index"":true,""store"":false,""doc_values"":true},""i"":{""type"":""short"",""index"":true,""store"":false,""doc_values"":true},""oGksLAbo"":{""type"":""float"",""index"":false,""store"":false,""doc_values"":false}}},""TV"":{""type"":""byte"",""index"":false,""store"":true,""doc_values"":true},""pKNhCsdt"":{""type"":""unsigned_long"",""index"":true,""store"":true,""doc_values"":false},""GFjhpCRr"":{""type"":""scaled_float"",""index"":true,""store"":true,""scaling_factor"":10,""doc_values"":true}}},""r"":{""type"":""half_float"",""index"":true,""store"":false,""doc_values"":true},""SsHsgTpOpU"":{""type"":""scaled_float"",""index"":false,""store"":false,""scaling_factor"":100000,""doc_values"":true},""zFDW"":{""type"":""keyword"",""index"":true,""store"":false,""doc_values"":true},""pGDizkHW"":{""type"":""long"",""index"":true,""store"":true,""doc_values"":false},""qqZiSrIAC"":{""type"":""float"",""index"":true,""store"":true,""doc_values"":false},""rtWFa"":{""type"":""short"",""index"":false,""store"":true,""doc_values"":false},""CSTL"":{""type"":""unsigned_long"",""index"":true,""store"":false,""doc_values"":true},""pGByPLmCK"":{""type"":""float"",""index"":false,""store"":true,""doc_values"":true},""RvaIXcmv"":{""type"":""double"",""index"":false,""store"":true,""doc_values"":true},""rgz"":{""type"":""scaled_float"",""index"":true,""store"":true,""scaling_factor"":10,""doc_values"":true},""FtsjUByoB"":{""type"":""scaled_float"",""index"":true,""store"":true,""scaling_factor"":100000,""doc_values"":false}}}}] expected settings [{""index"":{""mapping"":{""total_fields"":{""limit"":""5000""}}}}] 
```

**Issue Reasons:**
- [main] 2 consecutive failures in test testTermsQuery
- [main] 7 failures in test testTermsQuery (1.2% fail rate in 561 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Logs', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/112462,2024-09-03T13:18:29Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/112462,"{
  ""application_resource"": ""yes""
}"
138,112417,[CI] StandardVersusLogsIndexModeRandomDataChallengeRestIT testTermsQuery failing,"**Build Scans:**
- [elasticsearch-periodic-platform-support #3905 / debian-10_platform-support-unix](https://gradle-enterprise.elastic.co/s/jaybaxgmo2yw6)
- [elasticsearch-periodic-platform-support #3902 / oraclelinux-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/v2nxvverchorg)
- [elasticsearch-periodic-platform-support #3890 / windows-2016_checkpart1_platform-support-windows](https://gradle-enterprise.elastic.co/s/6aokxzm2rmlti)
- [elasticsearch-periodic #3914 / encryption-at-rest](https://gradle-enterprise.elastic.co/s/stzabjhe44vge)

**Reproduction Line:**
```
./gradlew "":modules:data-streams:javaRestTest"" --tests ""org.elasticsearch.datastreams.logsdb.qa.StandardVersusLogsIndexModeRandomDataChallengeRestIT.testTermsQuery"" -Dtests.seed=AE33B0C0B3BE3EDB -Dtests.locale=mt -Dtests.timezone=GMT0 -Druntime.java=22
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testTermsQuery'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.datastreams.logsdb.qa.StandardVersusLogsIndexModeRandomDataChallengeRestIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [57]. Source documents don't match for field [zACVxnssv.SRMxPwX.FVaem]: Error [List lengths do not match, actual: [-7890180293076636485], expected: [-7890180293076636485, 8141491844980708000]] actual mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword"",""store"":false,""index"":true},""method"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""TeoIbzhMv"":{""type"":""nested"",""dynamic"":""true"",""properties"":{""A"":{""type"":""unsigned_long"",""store"":true,""index"":true},""gIfwP"":{""type"":""nested"",""dynamic"":""true"",""properties"":{""svpVT"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":false}}}}},""uZZx"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":true},""IwdD"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":true},""fdJfY"":{""type"":""unsigned_long"",""store"":false,""index"":false},""gpvsIlv"":{""type"":""long"",""store"":false,""doc_values"":false,""index"":true},""x"":{""type"":""nested"",""properties"":{""v"":{""type"":""nested"",""properties"":{""SYzuZdT"":{""type"":""keyword"",""store"":true,""index"":false},""aYthzfg"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":false,""index"":false},""sCM"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":true},""ryMrIOkJK"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""ZRK"":{""type"":""long"",""store"":false,""doc_values"":false,""index"":true},""JUzxdT"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""EqJVpqV"":{""type"":""unsigned_long"",""store"":false,""index"":false},""RID"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":true},""SvtClm"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""xTh"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":true},""NxiWNkl"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":true},""QnxQg"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":true,""index"":true},""IR"":{""type"":""unsigned_long"",""store"":false,""index"":true},""GBaqYf"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""HZZNwkLtb"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":false}}},""i"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":false},""yvn"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":false},""vCWK"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":true,""index"":true},""aQedOFGZu"":{""type"":""byte"",""store"":false,""doc_values"":true,""index"":false},""yqYZSu"":{""type"":""unsigned_long"",""store"":false,""index"":false},""C"":{""type"":""nested"",""properties"":{""Iy"":{""type"":""keyword"",""store"":false,""index"":false},""xx"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":true},""uAoFANsWrb"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""MTyCOlnOa"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":true},""n"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""sBHm"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""xvphT"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":false},""DCVGrEy"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":true},""bLRh"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":false,""index"":false},""ndar"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":false},""kzXO"":{""type"":""half_float"",""store"":true,""doc_values"":false,""index"":true},""zJtyCvu"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":false},""sboFYq"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":false,""index"":false},""p"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""q"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":false},""EvaYq"":{""type"":""unsigned_long"",""store"":true,""index"":false},""ZCCf"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":true},""pVBtBx"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""zoo"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":false},""YVZssfVA"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":false},""yJlRtmkrUg"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":false},""DXcOZ"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":true}}}}},""yPQ"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""VJ"":{""dynamic"":""true"",""properties"":{}},""zACVxnssv"":{""enabled"":""true"",""properties"":{""ro"":{""type"":""unsigned_long"",""store"":false,""index"":true},""yguGy"":{""type"":""unsigned_long"",""store"":false,""index"":false},""SRMxPwX"":{""dynamic"":""runtime"",""properties"":{""ED"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":false},""BN"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":false},""eFAfhAMLWQ"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true},""hxjYzV"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":true},""ofHvWB"":{""type"":""unsigned_long"",""store"":false,""index"":true},""uRigz"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":true},""qKmfwqtBI"":{""type"":""unsigned_long"",""store"":false,""index"":true},""fpILvp"":{""type"":""unsigned_long"",""store"":true,""index"":true},""CiOIFtN"":{""type"":""double"",""store"":false,""doc_values"":false,""index"":false},""biz"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""vseyrfpRID"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":false},""lsfHJQrv"":{""type"":""unsigned_long"",""store"":true,""index"":true},""TVnkmTBbl"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":false},""whfu"":{""type"":""keyword"",""store"":true,""index"":true},""Cfq"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":false}}},""n"":{""properties"":{""gvu"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":false}}},""R"":{""type"":""unsigned_long"",""store"":false,""index"":false},""NuCDCQPy"":{""type"":""nested"",""properties"":{}},""TsPmL"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":true},""J"":{""type"":""double"",""store"":false,""doc_values"":false,""index"":false}}},""qYQGdhrcAD"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true},""BezxCmKCo"":{""type"":""nested"",""properties"":{""EAGW"":{""type"":""long"",""store"":false,""doc_values"":false,""index"":false},""B"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":true},""M"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":true},""nizxuUaYsr"":{""type"":""nested"",""dynamic"":""true"",""properties"":{""qeUwmUziff"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":true},""WsAYkNwxvo"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""fTyf"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":false},""yLYnb"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":true},""YwIteB"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":true},""OKsVH"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":true}}}}},""NeXtCaS"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":true},""lxqFJZuy"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":false},""UzfB"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":false},""iSfQgpXR"":{""type"":""nested"",""dynamic"":""false"",""properties"":{""CvaI"":{""type"":""keyword"",""store"":true,""index"":true},""B"":{""dynamic"":""false"",""properties"":{""GPJIOJTp"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":false},""ZoeyETU"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":false,""index"":false},""Upv"":{""type"":""keyword"",""store"":true,""index"":true},""NXmH"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":true}}},""DXiyRy"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":true},""JX"":{""type"":""unsigned_long"",""store"":true,""index"":false},""Lob"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":false,""index"":false},""Y"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":true},""CRrwm"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":true},""zvncu"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":false},""fhQ"":{""type"":""nested"",""properties"":{""OOaBVhgS"":{""type"":""unsigned_long"",""store"":false,""index"":false}}},""kqEREUyZL"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":true,""index"":true},""bFQwBeDc"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""GwNxwBlyH"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":true},""T"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":false},""ljd"":{""type"":""nested"",""dynamic"":""true"",""properties"":{""rdEZNRzz"":{""type"":""unsigned_long"",""store"":true,""index"":true},""BodPiz"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":false},""r"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":false},""TdjV"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":true},""kStuhO"":{""type"":""unsigned_long"",""store"":false,""index"":true},""RbNhL"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":false},""O"":{""type"":""unsigned_long"",""store"":false,""index"":true},""iasAlcgZ"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":true},""CHooRMvMPd"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""TEHYII"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":false},""UmFRLNVlT"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":false},""NfPVfk"":{""type"":""long"",""store"":false,""doc_values"":false,""index"":false},""If"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":true},""vpFulzwTwf"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":true},""OTBaQpZu"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":true},""qkpz"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":false},""gnamEXtIOE"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""TbCWjQ"":{""type"":""byte"",""store"":false,""doc_values"":true,""index"":true},""IxgxbaXgx"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":false,""index"":false}}},""CqencoSyu"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":false},""PEZyYs"":{""dynamic"":""false"",""enabled"":""true"",""properties"":{""HtpPcz"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":true},""NSGxV"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":false},""NeOrKmgmLo"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":true}}},""ZGKc"":{""properties"":{""Hqrklawbe"":{""type"":""keyword"",""store"":true,""index"":false},""qYnVcQZNBC"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":false},""lhA"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":false},""ooaoIqyJl"":{""type"":""keyword"",""store"":false,""index"":true},""xk"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":true},""zCzEEm"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":false}}},""X"":{""dynamic"":""false"",""properties"":{""EoLiTQuh"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":false},""VRY"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":true},""bSittewsG"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":true},""yYCDB"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":false,""index"":false},""sPVcVXVHPn"":{""type"":""keyword"",""store"":true,""index"":true},""JdK"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true},""QClALVhaTE"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":false},""QdAvBqLrOV"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":true}}},""GUIN"":{""type"":""unsigned_long"",""store"":false,""index"":false},""S"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":false,""index"":false},""Pr"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":false},""tuaKgENNyP"":{""type"":""nested"",""properties"":{""F"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":false,""index"":false},""LPdMhgA"":{""type"":""unsigned_long"",""store"":true,""index"":false},""BlVFDDNekg"":{""type"":""keyword"",""store"":true,""index"":true}}},""WVGHeBgQUb"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":true},""FT"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""Tvi"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":true},""TATQ"":{""properties"":{""OKByVAZWwg"":{""type"":""keyword"",""store"":true,""index"":false},""NEUBK"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""hHst"":{""type"":""keyword"",""store"":false,""index"":true},""gqvB"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":false,""index"":true},""pyeKeo"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":false},""UR"":{""type"":""unsigned_long"",""store"":true,""index"":false},""tSrUeBoXY"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":false},""agDrPxhx"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":false},""vNm"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":false},""QErsZ"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""dV"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":false},""rZdTuLw"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":false},""lnN"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":false},""yVmXo"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":true},""KK"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":false},""c"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":true},""gM"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":true},""CkK"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""XxvEhha"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""FmysDahFS"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":true,""index"":false},""DUZg"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""vdNT"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":true},""vgYdPmAUti"":{""type"":""keyword"",""store"":false,""index"":false}}},""r"":{""dynamic"":""true"",""enabled"":""true"",""properties"":{""nfnqilUZgX"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":true,""index"":false},""IiHEWRCbJ"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":true},""PJVjPHqB"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":false},""mrIDoo"":{""type"":""unsigned_long"",""store"":true,""index"":true},""awHVeAT"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":false}}},""SuCcGkt"":{""type"":""long"",""store"":false,""doc_values"":false,""index"":true},""GeX"":{""enabled"":""true"",""properties"":{""YAMDVxDViT"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":false},""eRMqH"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":false,""index"":false},""XyHfp"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":false},""DSGEtJ"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":true},""serL"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":true,""index"":false},""Las"":{""type"":""keyword"",""store"":false,""index"":false},""fSzUwfDcOZ"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":true},""FOZbFSmuUN"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""yBUQor"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":true},""Dcxnz"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":true},""mvG"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":false},""iMGQ"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":false},""lNOSnLEt"":{""type"":""keyword"",""store"":true,""index"":false}}},""audHPEdAll"":{""type"":""unsigned_long"",""store"":false,""index"":true},""mNEkFqfO"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""CEzw"":{""type"":""unsigned_long"",""store"":true,""index"":false},""Z"":{""type"":""keyword"",""store"":true,""index"":false},""bkGscV"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":true}}},""OlZevsHHP"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":true},""n"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":false},""Evzsoo"":{""type"":""keyword"",""store"":true,""index"":false}}}}] actual settings [{""index"":{""mode"":""logsdb"",""number_of_replicas"":""1"",""mapping"":{""total_fields"":{""limit"":""5000""}}}}] expected mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword"",""store"":false,""index"":true},""method"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""TeoIbzhMv"":{""type"":""nested"",""dynamic"":""true"",""properties"":{""A"":{""type"":""unsigned_long"",""store"":true,""index"":true},""gIfwP"":{""type"":""nested"",""dynamic"":""true"",""properties"":{""svpVT"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":false}}}}},""uZZx"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":true},""IwdD"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":true},""fdJfY"":{""type"":""unsigned_long"",""store"":false,""index"":false},""gpvsIlv"":{""type"":""long"",""store"":false,""doc_values"":false,""index"":true},""x"":{""type"":""nested"",""properties"":{""v"":{""type"":""nested"",""properties"":{""SYzuZdT"":{""type"":""keyword"",""store"":true,""index"":false},""aYthzfg"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":false,""index"":false},""sCM"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":true},""ryMrIOkJK"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""ZRK"":{""type"":""long"",""store"":false,""doc_values"":false,""index"":true},""JUzxdT"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""EqJVpqV"":{""type"":""unsigned_long"",""store"":false,""index"":false},""RID"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":true},""SvtClm"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""xTh"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":true},""NxiWNkl"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":true},""QnxQg"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":true,""index"":true},""IR"":{""type"":""unsigned_long"",""store"":false,""index"":true},""GBaqYf"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""HZZNwkLtb"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":false}}},""i"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":false},""yvn"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":false},""vCWK"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":true,""index"":true},""aQedOFGZu"":{""type"":""byte"",""store"":false,""doc_values"":true,""index"":false},""yqYZSu"":{""type"":""unsigned_long"",""store"":false,""index"":false},""C"":{""type"":""nested"",""properties"":{""Iy"":{""type"":""keyword"",""store"":false,""index"":false},""xx"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":true},""uAoFANsWrb"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""MTyCOlnOa"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":true},""n"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""sBHm"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""xvphT"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":false},""DCVGrEy"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":true},""bLRh"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":false,""index"":false},""ndar"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":false},""kzXO"":{""type"":""half_float"",""store"":true,""doc_values"":false,""index"":true},""zJtyCvu"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":false},""sboFYq"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":false,""index"":false},""p"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""q"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":false},""EvaYq"":{""type"":""unsigned_long"",""store"":true,""index"":false},""ZCCf"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":true},""pVBtBx"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""zoo"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":false},""YVZssfVA"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":false},""yJlRtmkrUg"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":false},""DXcOZ"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":true}}}}},""yPQ"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""VJ"":{""dynamic"":""true"",""properties"":{}},""zACVxnssv"":{""enabled"":""true"",""properties"":{""ro"":{""type"":""unsigned_long"",""store"":false,""index"":true},""yguGy"":{""type"":""unsigned_long"",""store"":false,""index"":false},""SRMxPwX"":{""dynamic"":""runtime"",""properties"":{""ED"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":false},""BN"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":false},""eFAfhAMLWQ"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true},""hxjYzV"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":true},""ofHvWB"":{""type"":""unsigned_long"",""store"":false,""index"":true},""uRigz"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":true},""qKmfwqtBI"":{""type"":""unsigned_long"",""store"":false,""index"":true},""fpILvp"":{""type"":""unsigned_long"",""store"":true,""index"":true},""CiOIFtN"":{""type"":""double"",""store"":false,""doc_values"":false,""index"":false},""biz"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""vseyrfpRID"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":false},""lsfHJQrv"":{""type"":""unsigned_long"",""store"":true,""index"":true},""TVnkmTBbl"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":false},""whfu"":{""type"":""keyword"",""store"":true,""index"":true},""Cfq"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":false}}},""n"":{""properties"":{""gvu"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":false}}},""R"":{""type"":""unsigned_long"",""store"":false,""index"":false},""NuCDCQPy"":{""type"":""nested"",""properties"":{}},""TsPmL"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":true},""J"":{""type"":""double"",""store"":false,""doc_values"":false,""index"":false}}},""qYQGdhrcAD"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true},""BezxCmKCo"":{""type"":""nested"",""properties"":{""EAGW"":{""type"":""long"",""store"":false,""doc_values"":false,""index"":false},""B"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":true},""M"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":true},""nizxuUaYsr"":{""type"":""nested"",""dynamic"":""true"",""properties"":{""qeUwmUziff"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":true},""WsAYkNwxvo"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""fTyf"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":false},""yLYnb"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":true},""YwIteB"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":true},""OKsVH"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":true}}}}},""NeXtCaS"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":true},""lxqFJZuy"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":false},""UzfB"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":false},""iSfQgpXR"":{""type"":""nested"",""dynamic"":""false"",""properties"":{""CvaI"":{""type"":""keyword"",""store"":true,""index"":true},""B"":{""dynamic"":""false"",""properties"":{""GPJIOJTp"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":false},""ZoeyETU"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":false,""index"":false},""Upv"":{""type"":""keyword"",""store"":true,""index"":true},""NXmH"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":true}}},""DXiyRy"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":true},""JX"":{""type"":""unsigned_long"",""store"":true,""index"":false},""Lob"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":false,""index"":false},""Y"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":true},""CRrwm"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":true},""zvncu"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":false},""fhQ"":{""type"":""nested"",""properties"":{""OOaBVhgS"":{""type"":""unsigned_long"",""store"":false,""index"":false}}},""kqEREUyZL"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":true,""index"":true},""bFQwBeDc"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""GwNxwBlyH"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":true},""T"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":false},""ljd"":{""type"":""nested"",""dynamic"":""true"",""properties"":{""rdEZNRzz"":{""type"":""unsigned_long"",""store"":true,""index"":true},""BodPiz"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":false},""r"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":false},""TdjV"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":true},""kStuhO"":{""type"":""unsigned_long"",""store"":false,""index"":true},""RbNhL"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":false},""O"":{""type"":""unsigned_long"",""store"":false,""index"":true},""iasAlcgZ"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":true},""CHooRMvMPd"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""TEHYII"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":false},""UmFRLNVlT"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":false},""NfPVfk"":{""type"":""long"",""store"":false,""doc_values"":false,""index"":false},""If"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":true},""vpFulzwTwf"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":true},""OTBaQpZu"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":true},""qkpz"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":false},""gnamEXtIOE"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""TbCWjQ"":{""type"":""byte"",""store"":false,""doc_values"":true,""index"":true},""IxgxbaXgx"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":false,""index"":false}}},""CqencoSyu"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":false},""PEZyYs"":{""dynamic"":""false"",""enabled"":""true"",""properties"":{""HtpPcz"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":true},""NSGxV"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":false},""NeOrKmgmLo"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":true}}},""ZGKc"":{""properties"":{""Hqrklawbe"":{""type"":""keyword"",""store"":true,""index"":false},""qYnVcQZNBC"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":false},""lhA"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":false},""ooaoIqyJl"":{""type"":""keyword"",""store"":false,""index"":true},""xk"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":true},""zCzEEm"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":false}}},""X"":{""dynamic"":""false"",""properties"":{""EoLiTQuh"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":false},""VRY"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":true},""bSittewsG"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":true},""yYCDB"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":false,""index"":false},""sPVcVXVHPn"":{""type"":""keyword"",""store"":true,""index"":true},""JdK"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true},""QClALVhaTE"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":false},""QdAvBqLrOV"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":true}}},""GUIN"":{""type"":""unsigned_long"",""store"":false,""index"":false},""S"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":false,""index"":false},""Pr"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":false},""tuaKgENNyP"":{""type"":""nested"",""properties"":{""F"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":false,""index"":false},""LPdMhgA"":{""type"":""unsigned_long"",""store"":true,""index"":false},""BlVFDDNekg"":{""type"":""keyword"",""store"":true,""index"":true}}},""WVGHeBgQUb"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":true},""FT"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""Tvi"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":true},""TATQ"":{""properties"":{""OKByVAZWwg"":{""type"":""keyword"",""store"":true,""index"":false},""NEUBK"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""hHst"":{""type"":""keyword"",""store"":false,""index"":true},""gqvB"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":false,""index"":true},""pyeKeo"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":false},""UR"":{""type"":""unsigned_long"",""store"":true,""index"":false},""tSrUeBoXY"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":false},""agDrPxhx"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":false},""vNm"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":false},""QErsZ"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""dV"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":false},""rZdTuLw"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":false},""lnN"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":false},""yVmXo"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":true},""KK"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":false},""c"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":true},""gM"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":true},""CkK"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""XxvEhha"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""FmysDahFS"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":true,""index"":false},""DUZg"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""vdNT"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":true},""vgYdPmAUti"":{""type"":""keyword"",""store"":false,""index"":false}}},""r"":{""dynamic"":""true"",""enabled"":""true"",""properties"":{""nfnqilUZgX"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":true,""index"":false},""IiHEWRCbJ"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":true},""PJVjPHqB"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":false},""mrIDoo"":{""type"":""unsigned_long"",""store"":true,""index"":true},""awHVeAT"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":false}}},""SuCcGkt"":{""type"":""long"",""store"":false,""doc_values"":false,""index"":true},""GeX"":{""enabled"":""true"",""properties"":{""YAMDVxDViT"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":false},""eRMqH"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":false,""index"":false},""XyHfp"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":false},""DSGEtJ"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":true},""serL"":{""type"":""scaled_float"",""scaling_factor"":100000,""store"":true,""index"":false},""Las"":{""type"":""keyword"",""store"":false,""index"":false},""fSzUwfDcOZ"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":true},""FOZbFSmuUN"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""yBUQor"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":true},""Dcxnz"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":true},""mvG"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":false},""iMGQ"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":false},""lNOSnLEt"":{""type"":""keyword"",""store"":true,""index"":false}}},""audHPEdAll"":{""type"":""unsigned_long"",""store"":false,""index"":true},""mNEkFqfO"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""CEzw"":{""type"":""unsigned_long"",""store"":true,""index"":false},""Z"":{""type"":""keyword"",""store"":true,""index"":false},""bkGscV"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":true}}},""OlZevsHHP"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":true},""n"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":false},""Evzsoo"":{""type"":""keyword"",""store"":true,""index"":false}}}}] expected settings [{""index"":{""number_of_replicas"":""1"",""mapping"":{""total_fields"":{""limit"":""5000""}}}}] 
```

**Issue Reasons:**
- [main] 4 failures in test testTermsQuery (1.7% fail rate in 239 executions)
- [main] 3 failures in pipeline elasticsearch-periodic-platform-support (42.9% fail rate in 7 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>test-failure', 'Team:StorageEngine', ':StorageEngine/Logs', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/112417,2024-09-01T04:33:14Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/112417,"{
  ""application_resource"": ""yes""
}"
139,112374,Missing array element in synthetic source,"**Build Scans:**
- [elasticsearch-intake #9259 / part1](https://gradle-enterprise.elastic.co/s/lydlaac26lr7w)
- [elasticsearch-periodic-platform-support #3833 / rocky-9_platform-support-unix](https://gradle-enterprise.elastic.co/s/g2sysd7e2gr66)
- [elasticsearch-periodic-platform-support #3824 / oraclelinux-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/4xolz3abzue7o)

**Reproduction Line:**
```
./gradlew "":modules:data-streams:javaRestTest"" --tests ""org.elasticsearch.datastreams.logsdb.qa.StandardVersusLogsIndexModeRandomDataChallengeRestIT.testMatchAllQuery"" -Dtests.seed=2F4149D43B0C80C5 -Dtests.locale=it-IT -Dtests.timezone=America/Montserrat -Druntime.java=22
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testMatchAllQuery'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.datastreams.logsdb.qa.StandardVersusLogsIndexModeRandomDataChallengeRestIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))

**Failure Message:**
```
java.lang.AssertionError: Source matching failed at document id [43]. Source documents don't match for field [tNn.ZEywrdmLZJ.ffawMqzc]: Error [Values of type [half_float] don't match after normalization, normalized actual: [13590, 14167, 14174, 15151], expected: [14178, 13827, 14933, 13590, 14167, 13833, 14174, 15151]] actual mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword"",""index"":true,""store"":false},""method"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""HAjmUxU"":{""type"":""keyword"",""index"":false,""store"":true},""hlr"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":false},""Ao"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":false},""wKO"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":true},""UJSaAjUPc"":{""type"":""keyword"",""index"":true,""store"":false},""aoYZCwl"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":false},""PIgCpxJpZ"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""svNd"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true},""wrJdNMvTq"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":false},""Rgvuve"":{""properties"":{""tv"":{""type"":""nested"",""properties"":{""aYsQYeu"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":false},""QFTlgi"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":true},""WCFnskUCMA"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":true},""QOE"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":false},""Z"":{""type"":""keyword"",""index"":true,""store"":false},""uAAkQEVM"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":false},""pLndJrwmja"":{""type"":""unsigned_long"",""index"":false,""store"":true},""rGw"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":true},""rMoIX"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":true},""nihDo"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":true},""Li"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true}}},""NuMJsavEN"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":true},""pLVo"":{""type"":""nested"",""properties"":{""ScCqfppdm"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":true},""AMKIfRn"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":true,""index"":true},""XEvbnhG"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":false},""jfgysrP"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""wEgYMFo"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":false}}},""nubHKsCZ"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":true},""PngIJdvV"":{""type"":""unsigned_long"",""index"":false,""store"":true},""edb"":{""type"":""byte"",""store"":false,""doc_values"":true,""index"":false},""WbiyBQSWh"":{""type"":""nested"",""properties"":{""OyORxBpbs"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":false},""QjOysZ"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""Cw"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":true},""LBqoeSXcx"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":true,""index"":false},""OCtVSm"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":true},""SzpHpw"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":true},""otWaFw"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""vIX"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":false,""index"":false},""Gl"":{""type"":""unsigned_long"",""index"":true,""store"":true},""TbGTSXv"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":false},""blOsA"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""eUkzQ"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":true},""HCSXEqHVeS"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":true},""dDMWrf"":{""type"":""unsigned_long"",""index"":true,""store"":false},""kJVmrQ"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":true},""eTQBTRQ"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":false},""lsvBGo"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":true},""VUNQgFZ"":{""type"":""keyword"",""index"":false,""store"":true},""Sh"":{""type"":""unsigned_long"",""index"":false,""store"":false},""kqLkrgK"":{""type"":""keyword"",""index"":false,""store"":false},""xbmzAYEzM"":{""type"":""unsigned_long"",""index"":true,""store"":true},""peTP"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":true},""wICKuqMvz"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":false},""g"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":true},""bLeBAkon"":{""type"":""double"",""store"":false,""doc_values"":false,""index"":false}}},""gYaGtZlcFF"":{""type"":""unsigned_long"",""index"":false,""store"":false}}},""kAlytdgatY"":{""type"":""keyword"",""index"":false,""store"":true},""saRatS"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true},""aQ"":{""type"":""unsigned_long"",""index"":false,""store"":true},""ao"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":true},""NGytynfBBN"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""pNDj"":{""type"":""keyword"",""index"":false,""store"":true},""jaJwKyyyVX"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":false},""dXFWe"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":false},""LmGLdI"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":false},""tM"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""tNn"":{""enabled"":""true"",""properties"":{""D"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":true},""pcQEF"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":false},""Abfqcm"":{""type"":""byte"",""store"":false,""doc_values"":true,""index"":true},""gwrOcgI"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":false},""ZEywrdmLZJ"":{""dynamic"":""runtime"",""enabled"":""true"",""properties"":{""kt"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":true,""index"":false},""DQorqr"":{""type"":""unsigned_long"",""index"":false,""store"":false},""oqi"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""ffawMqzc"":{""type"":""half_float"",""store"":true,""doc_values"":false,""index"":true},""fRUy"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":true},""rebd"":{""type"":""half_float"",""store"":true,""doc_values"":false,""index"":true}}},""BT"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":true},""OJctkrs"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":false},""DRtp"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""edqSuEC"":{""type"":""nested"",""dynamic"":""strict"",""properties"":{""Go"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":true},""mDqPg"":{""type"":""keyword"",""index"":true,""store"":false},""eTCwmHSGM"":{""type"":""keyword"",""index"":true,""store"":false},""WWzX"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":false},""SjUGie"":{""type"":""unsigned_long"",""index"":false,""store"":true},""zZIHIlA"":{""type"":""keyword"",""index"":false,""store"":true},""FzKfbqHm"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":false},""iJtbxmPci"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":true,""index"":true},""trnVXsEl"":{""type"":""keyword"",""index"":false,""store"":false},""JOryAozJs"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":false},""fKzZ"":{""type"":""unsigned_long"",""index"":true,""store"":false},""Is"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""jqJAz"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":false},""JsAdHxKsVk"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":true},""Xso"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":false},""sTPrejriAK"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":false},""DhfE"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""apN"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":false},""Mw"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""WoxgfCbb"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":true},""LY"":{""type"":""keyword"",""index"":false,""store"":false},""JF"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":true},""iV"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""fYlAQ"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":false},""YZ"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":true},""ADsYyXLQ"":{""type"":""keyword"",""index"":false,""store"":false},""WAFUh"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":false},""ZLkUreU"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""IDEU"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":false,""index"":false},""Ak"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":true},""WJrCvFpo"":{""type"":""unsigned_long"",""index"":false,""store"":true},""lDzA"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":false},""tQAePQuqIz"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""DtFOJN"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":true},""koNwnFEBtI"":{""type"":""keyword"",""index"":true,""store"":false},""SRdCYJovk"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":false},""FSkucPy"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""uYHcYLCG"":{""type"":""unsigned_long"",""index"":true,""store"":true},""eLLuFiEQUI"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""MvcDOJ"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false}}},""qL"":{""type"":""double"",""store"":false,""doc_values"":false,""index"":true},""HO"":{""type"":""byte"",""store"":false,""doc_values"":true,""index"":false},""e"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":false},""DqRaybhGqd"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":true},""LRImYYRp"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""xMPC"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":false},""UkG"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":false},""Sm"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":true}}},""yIHE"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":true},""pjrqXRZ"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":true},""toLl"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":true},""mLvKGH"":{""type"":""unsigned_long"",""index"":false,""store"":true},""MbDuF"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":false},""wXTTbMIF"":{""type"":""keyword"",""index"":false,""store"":false},""voxgAIyLP"":{""type"":""unsigned_long"",""index"":true,""store"":false},""qY"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":false},""JCPGPGGbWe"":{""type"":""keyword"",""index"":false,""store"":true}}}}] actual settings [{""index"":{""mode"":""logsdb"",""mapping"":{""total_fields"":{""limit"":""5000""}}}}] expected mappings [{""_doc"":{""properties"":{""host.name"":{""type"":""keyword"",""index"":true,""store"":false},""method"":{""type"":""keyword""},""memory_usage_bytes"":{""type"":""long""},""HAjmUxU"":{""type"":""keyword"",""index"":false,""store"":true},""hlr"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":false},""Ao"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":false},""wKO"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":true},""UJSaAjUPc"":{""type"":""keyword"",""index"":true,""store"":false},""aoYZCwl"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":false},""PIgCpxJpZ"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""svNd"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true},""wrJdNMvTq"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":false},""Rgvuve"":{""properties"":{""tv"":{""type"":""nested"",""properties"":{""aYsQYeu"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":false},""QFTlgi"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":true},""WCFnskUCMA"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":true},""QOE"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":false},""Z"":{""type"":""keyword"",""index"":true,""store"":false},""uAAkQEVM"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":false},""pLndJrwmja"":{""type"":""unsigned_long"",""index"":false,""store"":true},""rGw"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":true},""rMoIX"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":true},""nihDo"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":true},""Li"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true}}},""NuMJsavEN"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":true},""pLVo"":{""type"":""nested"",""properties"":{""ScCqfppdm"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":true},""AMKIfRn"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":true,""index"":true},""XEvbnhG"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":false},""jfgysrP"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""wEgYMFo"":{""type"":""long"",""store"":true,""doc_values"":false,""index"":false}}},""nubHKsCZ"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":true},""PngIJdvV"":{""type"":""unsigned_long"",""index"":false,""store"":true},""edb"":{""type"":""byte"",""store"":false,""doc_values"":true,""index"":false},""WbiyBQSWh"":{""type"":""nested"",""properties"":{""OyORxBpbs"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":false},""QjOysZ"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""Cw"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":true},""LBqoeSXcx"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":true,""index"":false},""OCtVSm"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":true},""SzpHpw"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":true},""otWaFw"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""vIX"":{""type"":""scaled_float"",""scaling_factor"":1000,""store"":false,""index"":false},""Gl"":{""type"":""unsigned_long"",""index"":true,""store"":true},""TbGTSXv"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":false},""blOsA"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":true},""eUkzQ"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":true},""HCSXEqHVeS"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":true},""dDMWrf"":{""type"":""unsigned_long"",""index"":true,""store"":false},""kJVmrQ"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":true},""eTQBTRQ"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":false},""lsvBGo"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":false,""index"":true},""VUNQgFZ"":{""type"":""keyword"",""index"":false,""store"":true},""Sh"":{""type"":""unsigned_long"",""index"":false,""store"":false},""kqLkrgK"":{""type"":""keyword"",""index"":false,""store"":false},""xbmzAYEzM"":{""type"":""unsigned_long"",""index"":true,""store"":true},""peTP"":{""type"":""integer"",""store"":false,""doc_values"":false,""index"":true},""wICKuqMvz"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":false},""g"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":true},""bLeBAkon"":{""type"":""double"",""store"":false,""doc_values"":false,""index"":false}}},""gYaGtZlcFF"":{""type"":""unsigned_long"",""index"":false,""store"":false}}},""kAlytdgatY"":{""type"":""keyword"",""index"":false,""store"":true},""saRatS"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":true},""aQ"":{""type"":""unsigned_long"",""index"":false,""store"":true},""ao"":{""type"":""double"",""store"":false,""doc_values"":true,""index"":true},""NGytynfBBN"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""pNDj"":{""type"":""keyword"",""index"":false,""store"":true},""jaJwKyyyVX"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":false},""dXFWe"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":false},""LmGLdI"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":false},""tM"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""tNn"":{""enabled"":""true"",""properties"":{""D"":{""type"":""float"",""store"":false,""doc_values"":true,""index"":true},""pcQEF"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":false},""Abfqcm"":{""type"":""byte"",""store"":false,""doc_values"":true,""index"":true},""gwrOcgI"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":false},""ZEywrdmLZJ"":{""dynamic"":""runtime"",""enabled"":""true"",""properties"":{""kt"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":true,""index"":false},""DQorqr"":{""type"":""unsigned_long"",""index"":false,""store"":false},""oqi"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""ffawMqzc"":{""type"":""half_float"",""store"":true,""doc_values"":false,""index"":true},""fRUy"":{""type"":""long"",""store"":false,""doc_values"":true,""index"":true},""rebd"":{""type"":""half_float"",""store"":true,""doc_values"":false,""index"":true}}},""BT"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":true},""OJctkrs"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":false},""DRtp"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""edqSuEC"":{""type"":""nested"",""dynamic"":""strict"",""properties"":{""Go"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":true},""mDqPg"":{""type"":""keyword"",""index"":true,""store"":false},""eTCwmHSGM"":{""type"":""keyword"",""index"":true,""store"":false},""WWzX"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":false},""SjUGie"":{""type"":""unsigned_long"",""index"":false,""store"":true},""zZIHIlA"":{""type"":""keyword"",""index"":false,""store"":true},""FzKfbqHm"":{""type"":""integer"",""store"":true,""doc_values"":true,""index"":false},""iJtbxmPci"":{""type"":""scaled_float"",""scaling_factor"":10,""store"":true,""index"":true},""trnVXsEl"":{""type"":""keyword"",""index"":false,""store"":false},""JOryAozJs"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":false},""fKzZ"":{""type"":""unsigned_long"",""index"":true,""store"":false},""Is"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""jqJAz"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":false},""JsAdHxKsVk"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":true},""Xso"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":false},""sTPrejriAK"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":false},""DhfE"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""apN"":{""type"":""long"",""store"":true,""doc_values"":true,""index"":false},""Mw"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""WoxgfCbb"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":true,""index"":true},""LY"":{""type"":""keyword"",""index"":false,""store"":false},""JF"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":true},""iV"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":true},""fYlAQ"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":false},""YZ"":{""type"":""half_float"",""store"":true,""doc_values"":true,""index"":true},""ADsYyXLQ"":{""type"":""keyword"",""index"":false,""store"":false},""WAFUh"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":false},""ZLkUreU"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""IDEU"":{""type"":""scaled_float"",""scaling_factor"":100.5,""store"":false,""index"":false},""Ak"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":true},""WJrCvFpo"":{""type"":""unsigned_long"",""index"":false,""store"":true},""lDzA"":{""type"":""double"",""store"":true,""doc_values"":false,""index"":false},""tQAePQuqIz"":{""type"":""float"",""store"":false,""doc_values"":false,""index"":false},""DtFOJN"":{""type"":""integer"",""store"":true,""doc_values"":false,""index"":true},""koNwnFEBtI"":{""type"":""keyword"",""index"":true,""store"":false},""SRdCYJovk"":{""type"":""byte"",""store"":false,""doc_values"":false,""index"":false},""FSkucPy"":{""type"":""byte"",""store"":true,""doc_values"":false,""index"":true},""uYHcYLCG"":{""type"":""unsigned_long"",""index"":true,""store"":true},""eLLuFiEQUI"":{""type"":""float"",""store"":true,""doc_values"":true,""index"":false},""MvcDOJ"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false}}},""qL"":{""type"":""double"",""store"":false,""doc_values"":false,""index"":true},""HO"":{""type"":""byte"",""store"":false,""doc_values"":true,""index"":false},""e"":{""type"":""float"",""store"":true,""doc_values"":false,""index"":false},""DqRaybhGqd"":{""type"":""integer"",""store"":false,""doc_values"":true,""index"":true},""LRImYYRp"":{""type"":""double"",""store"":true,""doc_values"":true,""index"":false},""xMPC"":{""type"":""short"",""store"":false,""doc_values"":false,""index"":false},""UkG"":{""type"":""half_float"",""store"":false,""doc_values"":false,""index"":false},""Sm"":{""type"":""short"",""store"":true,""doc_values"":true,""index"":true}}},""yIHE"":{""type"":""short"",""store"":false,""doc_values"":true,""index"":true},""pjrqXRZ"":{""type"":""byte"",""store"":true,""doc_values"":true,""index"":true},""toLl"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":true},""mLvKGH"":{""type"":""unsigned_long"",""index"":false,""store"":true},""MbDuF"":{""type"":""short"",""store"":true,""doc_values"":false,""index"":false},""wXTTbMIF"":{""type"":""keyword"",""index"":false,""store"":false},""voxgAIyLP"":{""type"":""unsigned_long"",""index"":true,""store"":false},""qY"":{""type"":""half_float"",""store"":false,""doc_values"":true,""index"":false},""JCPGPGGbWe"":{""type"":""keyword"",""index"":false,""store"":true}}}}] expected settings [{""index"":{""mapping"":{""total_fields"":{""limit"":""5000""}}}}] 
```

**Issue Reasons:**
- [main] 3 failures in test testMatchAllQuery (0.3% fail rate in 970 executions)
- [main] 2 failures in pipeline elasticsearch-periodic-platform-support (10.5% fail rate in 19 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"['>bug', '>test-failure', 'medium-risk', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/112374,2024-08-29T20:10:41Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/112374,"{
  ""application_resource"": ""yes""
}"
140,112306,Batch query phase shard level requests per data node,"The query phase fans out to all shards, sending as many shard level requests as the number of shards involved to the relevant data nodes. Years ago we have reworked the can match phase (as part of the many shards effort) to group shard level requests per data node, in order to decrease the number of roundtrips required (including authorization) and the overhead at the transport level. We would like to do the same for the query phase. We want to start small and scope this to only query phase (no DFS or query after DFS, no scroll), and only when there are aggs in the provided search request. That is because this is the type of requests that go through potentially many shards, and use quite a bit of memory on the coordinating node. 

We expect that changing the execution model will provide better stability ,as well as better resource usage. In fact, currently the coordinating node throttles to 5 (configurable) concurrent shard requests per data node. If we group shard level requests to a single request per data node, each data node is going to be able to have more context about the portion of the search request it is requested to execute, and may execute its shard level requests at its own pace, depending on current load etc. We have seen that the current throttling mechanism can be a bottleneck, that prevents maximizing resource usage on data node. At the same time, this improvement would drastically reduce the network roundtrips from being a factor of the number of shards for the query phase, to a factor of the number of data nodes involved in the search request.
 
",javanna,closed,"['>feature', 'Meta', 'Team:Search Foundations', ':Search Foundations/Search']",https://github.com/elastic/elasticsearch/issues/112306,2024-08-28T18:36:34Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/112306,"{
  ""application_resource"": ""yes""
}"
141,112138,[ML] Cannot start model deployment in Docker,"### Elasticsearch Version

Tested on 8.15 and 8.14

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

any

### Problem Description

Following the [instructions](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html) for running Elasticsearch in Docker I found deploying the ELSER model failed with the message: 

`Could not start deployment because no ML nodes with sufficient capacity were found`

The error comes from the model assignment code which does not think there is not enough memory to deploy the model even though the docker image has 4GB of memory - which is plenty. 

The fix is to set `xpack.ml.use_auto_machine_memory_percent` to `true`.

```
PUT _cluster/settings
{
  ""persistent"": {
    ""xpack.ml.use_auto_machine_memory_percent"": ""true""
  }
}
```

If `xpack.ml.use_auto_machine_memory_percent == false` then the maximum about of memory that ml can use is governed by `xpack.ml.max_machine_memory_percent` which defaults to 30% of the available memory. 30% is not enough to deploy the model on a 4GB node. When running in a container all the memory should be available to ml, this is what happens when `xpack.ml.use_auto_machine_memory_percent == true`. In Elastic cloud `xpack.ml.use_auto_machine_memory_percent` is set to `true`. 


The ml settings are documented at https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-settings.html



### Steps to Reproduce

Follow the instructions to run Elasticsearch in docker (https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html), download the `.elser_model_2` model and try to deploy it. 

### Logs (if relevant)

_No response_",davidkyle,closed,"['>bug', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/112138,2024-08-23T09:52:39Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/112138,"{
  ""application_resource"": ""yes""
}"
142,111964,ESQL: unused union type attributes can use a lot of memory,"Relates https://github.com/elastic/elasticsearch/issues/107330

In simple queries like `FROM logs-* | LIMIT 10`, many indices and fields can be involved. In particular, fields mapped to different types in different indices are just passed through, even though we do nothing with them (their values are always `null`).

Multi-typed fields internally create attributes which contain an error message string with the different types they're mapped to in different indices, e.g. `line 1:32: Cannot use field [some_field] due to ambiguities being mapped as [2] incompatible types: [double] in [logs-1, logs-2, logs-3], [float] in [logs-4]`. (More specifically: When multi-typed fields are passed through, they get internally represented as `UnsupportedAttribute`s, whose error message is constructed from `InvalidMappedField`s [here](https://github.com/elastic/elasticsearch/blob/06d09fc7aa3248595f4068fb68259f50f1754bac/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/analysis/Analyzer.java#L1229-L1238).)

These messages can get long; additionally, they get serialized as part of their respective attributes and are being sent to data nodes, although we _likely_ do not need the error string in the data nodes.

Let's reduce that overhead during planning and when serializing the plan.",alex-spies,closed,"['>enhancement', 'Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/111964,2024-08-19T10:12:05Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/111964,"{
  ""application_resource"": ""no""
}"
143,111847,Elasticsearch 8.15 fails to start on Windows with bootstrap.memory_lock,"### Elasticsearch Version

8.15

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Windows Server 2019

### Problem Description

When Elasticsearch is installed on Windows 2019 with bootstrap.memory_lock it fails to load with the error.

AssertionError: java.lang.invoke.WrongMethodTypeException: handle's method type (MemorySegment,long,long)MemorySegment but found (MemorySegment,MemorySegment,long,long)boolean
at org.elasticsearch.nativeaccess.jdk.JdkKernel32Library.SetProcessWorkingSetSize(JdkKernel32Library.java:228) elasticsearch-native-8.15.0.jar


### Steps to Reproduce

Install Elasticsearch on Windows and set bootstrap.memory_lock to true.

### Logs (if relevant)

AssertionError: java.lang.invoke.WrongMethodTypeException: handle's method type (MemorySegment,long,long)MemorySegment but found (MemorySegment,MemorySegment,long,long)boolean
at org.elasticsearch.nativeaccess.jdk.JdkKernel32Library.SetProcessWorkingSetSize(JdkKernel32Library.java:228) elasticsearch-native-8.15.0.jar",cstack89,closed,"['>bug', ':Core/Infra/Core', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/111847,2024-08-13T17:36:04Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/111847,"{
  ""application_resource"": ""yes""
}"
144,111132,[CI] DockerTests test600Interrupt failing,"**Build Scans:**
- [elasticsearch-periodic-packaging #3172 / rhel-7_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/fexh4gdsq7uki)
- [elasticsearch-periodic-packaging #3172 / ubuntu-2204_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/7xv7rpj3l63dq)
- [elasticsearch-periodic-packaging #3172 / oraclelinux-8_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/b6yhmoxtb7i3k)
- [elasticsearch-periodic-packaging #3172 / centos-7_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/wetp4bh6thxeo)
- [elasticsearch-periodic-packaging #3172 / sles-15_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/zrpv72fagatok)
- [elasticsearch-periodic-packaging #3172 / oraclelinux-8_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/b6yhmoxtb7i3k)
- [elasticsearch-periodic-packaging #3172 / rhel-9_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/uojgbgroc4zyq)
- [elasticsearch-periodic-packaging #3172 / opensuse-leap-15_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/3gmu5uw6btjhm)
- [elasticsearch-periodic-packaging #3172 / almalinux-8_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/p6dlucwiz7ph6)
- [elasticsearch-periodic-packaging #3172 / rocky-8_packaging-tests-unix](https://gradle-enterprise.elastic.co/s/tiy3rrnd2llmo)

**Reproduction Line:**
```
null
```

**Applicable branches:**
8.15

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('test600Interrupt'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.packaging.test.DockerTests'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))

**Failure Message:**
```
java.lang.AssertionError: Container logs should contain stopping ...
Expected: a string containing ""stopping ...""
     but: was ""Created elasticsearch keystore in /usr/share/elasticsearch/config/elasticsearch.keystore
{""@timestamp"":""2024-07-23T23:42:24.690Z"", ""log.level"": ""INFO"", ""message"":""Using native vector library; to disable start with -Dorg.elasticsearch.nativeaccess.enableVectorLibrary=false"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.nativeaccess.NativeAccess"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:24.798Z"", ""log.level"": ""INFO"", ""message"":""Using [jdk] native provider and native methods for [Linux]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.nativeaccess.NativeAccess"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:25.172Z"", ""log.level"": ""INFO"", ""message"":""Java vector incubator API enabled; uses preferredBitSize=256; FMA enabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.apache.lucene.internal.vectorization.PanamaVectorizationProvider"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:26.293Z"", ""log.level"": ""INFO"", ""message"":""version[8.15.0-SNAPSHOT], pid[315], build[docker/c9af95cc9eb2bf27ce98047cd4a17f036cc2add2/2024-07-23T20:15:30.662792919Z], OS[Linux/3.10.0-1160.119.1.el7.x86_64/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/22.0.1/22.0.1+8-16]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.node.Node"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:26.294Z"", ""log.level"": ""INFO"", ""message"":""JVM home [/usr/share/elasticsearch/jdk], using bundled JDK [true]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.node.Node"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:26.294Z"", ""log.level"": ""INFO"", ""message"":""JVM arguments [-Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -Djava.security.manager=allow, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Dlog4j2.formatMsgNoLookups=true, -Djava.locale.providers=SPI,COMPAT, --add-opens=java.base/java.io=org.elasticsearch.preallocate, --enable-native-access=org.elasticsearch.nativeaccess,org.apache.lucene.core, -Des.cgroups.hierarchy.override=/, -XX:ReplayDataFile=logs/replay_pid%p.log, -Djava.library.path=/usr/share/elasticsearch/lib/platform/linux-x64:/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib, -Djna.library.path=/usr/share/elasticsearch/lib/platform/linux-x64:/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib, -Des.distribution.type=docker, -XX:+UnlockDiagnosticVMOptions, -XX:G1NumCollectionsKeepPinned=10000000, -XX:+UseG1GC, -Djava.io.tmpdir=/tmp/elasticsearch-13018149644747155157, --add-modules=jdk.incubator.vector, -XX:+HeapDumpOnOutOfMemoryError, -XX:+ExitOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,level,pid,tags:filecount=32,filesize=64m, -Xms1024m, -Xmx1024m, -XX:MaxDirectMemorySize=536870912, -XX:G1HeapRegionSize=4m, -XX:InitiatingHeapOccupancyPercent=30, -XX:G1ReservePercent=15, --module-path=/usr/share/elasticsearch/lib, --add-modules=jdk.net, --add-modules=ALL-MODULE-PATH, -Djdk.module.main=org.elasticsearch.server]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.node.Node"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:26.295Z"", ""log.level"": ""INFO"", ""message"":""Default Locale [en_US]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.node.Node"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:26.295Z"", ""log.level"": ""WARN"", ""message"":""version [8.15.0-SNAPSHOT] is a pre-release version of Elasticsearch and is not suitable for production"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.node.Node"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.146Z"", ""log.level"": ""INFO"", ""message"":""loaded module [repository-url]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.146Z"", ""log.level"": ""INFO"", ""message"":""loaded module [rest-root]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.147Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-core]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.147Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-redact]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.147Z"", ""log.level"": ""INFO"", ""message"":""loaded module [ingest-user-agent]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.147Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-async-search]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.148Z"", ""log.level"": ""INFO"", ""message"":""loaded module [test-error-query]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.148Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-monitoring]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.148Z"", ""log.level"": ""INFO"", ""message"":""loaded module [repository-s3]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.148Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-analytics]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.149Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-esql-core]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.149Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-ent-search]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.149Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-autoscaling]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.149Z"", ""log.level"": ""INFO"", ""message"":""loaded module [lang-painless]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.149Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-ml]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.150Z"", ""log.level"": ""INFO"", ""message"":""loaded module [test-die-with-dignity]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.150Z"", ""log.level"": ""INFO"", ""message"":""loaded module [lang-mustache]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.150Z"", ""log.level"": ""INFO"", ""message"":""loaded module [legacy-geo]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.150Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-ql]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.150Z"", ""log.level"": ""INFO"", ""message"":""loaded module [rank-rrf]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.151Z"", ""log.level"": ""INFO"", ""message"":""loaded module [analysis-common]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.151Z"", ""log.level"": ""INFO"", ""message"":""loaded module [health-shards-availability]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.151Z"", ""log.level"": ""INFO"", ""message"":""loaded module [transport-netty4]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.151Z"", ""log.level"": ""INFO"", ""message"":""loaded module [aggregations]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.151Z"", ""log.level"": ""INFO"", ""message"":""loaded module [ingest-common]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.152Z"", ""log.level"": ""INFO"", ""message"":""loaded module [frozen-indices]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.152Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-identity-provider]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.152Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-shutdown]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.152Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-text-structure]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.152Z"", ""log.level"": ""INFO"", ""message"":""loaded module [snapshot-repo-test-kit]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.153Z"", ""log.level"": ""INFO"", ""message"":""loaded module [ml-package-loader]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.153Z"", ""log.level"": ""INFO"", ""message"":""loaded module [test-delayed-aggs]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.153Z"", ""log.level"": ""INFO"", ""message"":""loaded module [kibana]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.153Z"", ""log.level"": ""INFO"", ""message"":""loaded module [test-esql-heap-attack]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.153Z"", ""log.level"": ""INFO"", ""message"":""loaded module [constant-keyword]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.154Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-logstash]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.154Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-ccr]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.154Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-graph]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.155Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-esql]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.155Z"", ""log.level"": ""INFO"", ""message"":""loaded module [parent-join]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.155Z"", ""log.level"": ""INFO"", ""message"":""loaded module [counted-keyword]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.155Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-enrich]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.155Z"", ""log.level"": ""INFO"", ""message"":""loaded module [repositories-metering-api]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.156Z"", ""log.level"": ""INFO"", ""message"":""loaded module [transform]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.156Z"", ""log.level"": ""INFO"", ""message"":""loaded module [repository-azure]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.156Z"", ""log.level"": ""INFO"", ""message"":""loaded module [repository-gcs]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.156Z"", ""log.level"": ""INFO"", ""message"":""loaded module [spatial]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.156Z"", ""log.level"": ""INFO"", ""message"":""loaded module [apm]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.156Z"", ""log.level"": ""INFO"", ""message"":""loaded module [mapper-extras]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.157Z"", ""log.level"": ""INFO"", ""message"":""loaded module [mapper-version]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.157Z"", ""log.level"": ""INFO"", ""message"":""loaded module [test-jvm-crash]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.157Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-rollup]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.157Z"", ""log.level"": ""INFO"", ""message"":""loaded module [percolator]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.158Z"", ""log.level"": ""INFO"", ""message"":""loaded module [data-streams]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.158Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-stack]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.158Z"", ""log.level"": ""INFO"", ""message"":""loaded module [rank-eval]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.158Z"", ""log.level"": ""INFO"", ""message"":""loaded module [reindex]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.158Z"", ""log.level"": ""INFO"", ""message"":""loaded module [test-apm-integration]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.159Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-security]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.159Z"", ""log.level"": ""INFO"", ""message"":""loaded module [blob-cache]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.159Z"", ""log.level"": ""INFO"", ""message"":""loaded module [searchable-snapshots]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.159Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-slm]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.159Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-geoip-enterprise-downloader]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.160Z"", ""log.level"": ""INFO"", ""message"":""loaded module [snapshot-based-recoveries]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.160Z"", ""log.level"": ""INFO"", ""message"":""loaded module [test-latency-simulating-directory]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.160Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-watcher]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.160Z"", ""log.level"": ""INFO"", ""message"":""loaded module [old-lucene-versions]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.160Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-ilm]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.161Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-inference]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.161Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-voting-only-node]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.161Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-deprecation]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.161Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-fleet]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.162Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-aggregate-metric]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.162Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-downsample]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.162Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-profiling]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.162Z"", ""log.level"": ""INFO"", ""message"":""loaded module [ingest-geoip]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.162Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-write-load-forecaster]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.163Z"", ""log.level"": ""INFO"", ""message"":""loaded module [search-business-rules]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.163Z"", ""log.level"": ""INFO"", ""message"":""loaded module [ingest-attachment]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.163Z"", ""log.level"": ""INFO"", ""message"":""loaded module [wildcard]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.163Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-apm-data]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.163Z"", ""log.level"": ""INFO"", ""message"":""loaded module [unsigned-long]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.164Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-sql]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.164Z"", ""log.level"": ""INFO"", ""message"":""loaded module [runtime-fields-common]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.164Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-async]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.164Z"", ""log.level"": ""INFO"", ""message"":""loaded module [vector-tile]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.164Z"", ""log.level"": ""INFO"", ""message"":""loaded module [lang-expression]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.164Z"", ""log.level"": ""INFO"", ""message"":""loaded module [x-pack-eql]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.plugins.PluginsService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:31.406Z"", ""log.level"": ""INFO"", ""message"":""The current build is a snapshot, feature flag [failure_store] is enabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.common.util.FeatureFlag"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:32.613Z"", ""log.level"": ""INFO"", ""message"":""The current build is a snapshot, feature flag [madv_random] is enabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.common.util.FeatureFlag"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:32.942Z"", ""log.level"": ""INFO"", ""message"":""using [1] data paths, mounts [[/ (overlay)]], net usable_space [261.3gb], net total_space [349.7gb], types [overlay]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.env.NodeEnvironment"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:32.942Z"", ""log.level"": ""INFO"", ""message"":""heap size [1gb], compressed ordinary object pointers [true]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.env.NodeEnvironment"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:32.954Z"", ""log.level"": ""INFO"", ""message"":""node name [078c56155cc0], node ID [EJGhdb6WS9SQZiTVfDI8TQ], cluster name [docker-cluster], roles [data_frozen, ingest, data_cold, data, remote_cluster_client, master, data_warm, data_content, transform, data_hot, ml]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.node.Node"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:36.875Z"", ""log.level"": ""INFO"", ""message"":""The current build is a snapshot, feature flag [connector_secrets] is enabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.common.util.FeatureFlag"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:38.828Z"", ""log.level"": ""INFO"", ""message"":""using rate limit [40mb] with [default=40mb, read=0b, write=0b, max=0b]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.indices.recovery.RecoverySettings"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:39.030Z"", ""log.level"": ""INFO"", ""message"":""Registered local node features [data_stream.auto_sharding, data_stream.lifecycle.global_retention, data_stream.rollover.lazy, desired_node.version_deprecated, esql.agg_values, esql.async_query, esql.base64_decode_encode, esql.casting_operator, esql.counter_types, esql.disable_nullable_opts, esql.from_options, esql.metadata_fields, esql.metrics_counter_fields, esql.metrics_syntax, esql.mv_ordering_sorted_ascending, esql.mv_sort, esql.spatial_points_from_source, esql.spatial_shapes, esql.st_centroid_agg, esql.st_contains_within, esql.st_disjoint, esql.st_intersects, esql.st_x_y, esql.string_literal_auto_casting, esql.string_literal_auto_casting_extended, esql.timespan_abbreviations, features_supported, file_settings, geoip.downloader.database.configuration, health.dsl.info, health.extended_repository_indicator, knn_retriever_supported, license-trial-independent-version, mapper.index_sorting_on_nested, mapper.keyword_dimension_ignore_above, mapper.pass_through_priority, mapper.range.null_values_off_by_one_fix, mapper.source.synthetic_source_fallback, mapper.track_ignored_source, mapper.vectors.bit_vectors, mapper.vectors.int4_quantization, rest.capabilities_action, retrievers_supported, rrf_retriever_supported, script.hamming, search.vectors.k_param_supported, security.migration_framework, security.roles_metadata_flattened, standard_retriever_supported, stats.include_disk_thresholds, text_similarity_reranker_retriever_supported, unified_highlighter_matched_fields, usage.data_tiers.precalculate_stats]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.features.FeatureService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:39.684Z"", ""log.level"": ""INFO"", ""message"":""[controller/355] [Main.cc@123] controller (64 bit): Version 8.15.0-SNAPSHOT (Build 64f00009177815) Copyright (c) 2024 Elasticsearch BV"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""ml-cpp-log-tail-thread"",""log.logger"":""org.elasticsearch.xpack.ml.process.logging.CppLogMessageHandler"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:39.981Z"", ""log.level"": ""INFO"", ""message"":""Sending apm metrics is disabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.telemetry.apm.APM"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:39.982Z"", ""log.level"": ""INFO"", ""message"":""Sending apm tracing is disabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.telemetry.apm.APM"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:40.031Z"", ""log.level"": ""INFO"", ""message"":""Security is enabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.xpack.security.Security"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:40.588Z"", ""log.level"": ""INFO"", ""message"":""parsed [0] roles from file [/usr/share/elasticsearch/config/roles.yml]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.xpack.security.authz.store.FileRolesStore"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:40.850Z"", ""log.level"": ""INFO"", ""message"":""Auto-configuration will not generate a password for the elastic built-in superuser, as we cannot  determine if there is a terminal attached to the elasticsearch process. You can use the `bin/elasticsearch-reset-password` tool to set the password for the elastic user."", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.xpack.security.InitialNodeSecurityAutoConfiguration"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:41.225Z"", ""log.level"": ""INFO"", ""message"":""Watcher initialized components at 2024-07-23T23:42:41.225Z"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.xpack.watcher.Watcher"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:41.337Z"", ""log.level"": ""INFO"", ""message"":""Profiling is enabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.xpack.profiling.ProfilingPlugin"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:41.366Z"", ""log.level"": ""INFO"", ""message"":""profiling index templates will not be installed or reinstalled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.xpack.profiling.ProfilingPlugin"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:41.373Z"", ""log.level"": ""INFO"", ""message"":""APM ingest plugin is enabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.xpack.apmdata.APMPlugin"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:41.422Z"", ""log.level"": ""INFO"", ""message"":""APM index template registry is enabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.xpack.apmdata.APMIndexTemplateRegistry"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:41.785Z"", ""log.level"": ""INFO"", ""message"":""The current build is a snapshot, feature flag [connector_api] is enabled"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.common.util.FeatureFlag"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:42.191Z"", ""log.level"": ""INFO"", ""message"":""creating NettyAllocator with the following configs: [name=unpooled, suggested_max_allocation_size=1mb, factors={es.unsafe.use_unpooled_allocator=null, g1gc_enabled=true, g1gc_region_size=4mb, heap_size=1gb}]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.transport.netty4.NettyAllocator"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:42.268Z"", ""log.level"": ""INFO"", ""message"":""using discovery type [multi-node] and seed hosts providers [settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.discovery.DiscoveryModule"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:43.864Z"", ""log.level"": ""INFO"", ""message"":""initialized"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.node.Node"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:43.865Z"", ""log.level"": ""INFO"", ""message"":""starting ..."", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.node.Node"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:43.887Z"", ""log.level"": ""INFO"", ""message"":""persistent cache index loaded"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.xpack.searchablesnapshots.cache.full.PersistentCache"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:43.887Z"", ""log.level"": ""INFO"", ""message"":""deprecation component started"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.xpack.deprecation.logging.DeprecationIndexingComponent"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:43.993Z"", ""log.level"": ""INFO"", ""message"":""publish_address {172.17.0.3:9300}, bound_addresses {[::]:9300}"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.transport.TransportService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.128Z"", ""log.level"": ""INFO"", ""message"":""bound or publishing to a non-loopback address, enforcing bootstrap checks"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.bootstrap.BootstrapChecks"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.133Z"", ""log.level"": ""INFO"", ""message"":""this node has not joined a bootstrapped cluster yet; [cluster.initial_master_nodes] is set to [078c56155cc0]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.cluster.coordination.ClusterBootstrapService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.142Z"", ""log.level"": ""INFO"", ""message"":""setting initial configuration to VotingConfiguration{EJGhdb6WS9SQZiTVfDI8TQ}"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.cluster.coordination.Coordinator"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.330Z"", ""log.level"": ""INFO"", ""message"":""elected-as-master ([1] nodes joined in term 1)[_FINISH_ELECTION_, {078c56155cc0}{EJGhdb6WS9SQZiTVfDI8TQ}{2_judpfGQHuXc-nkAtVScg}{078c56155cc0}{172.17.0.3}{172.17.0.3:9300}{cdfhilmrstw}{8.15.0}{7000099-8512000} completing election], term: 1, version: 1, delta: master node changed {previous [], current [{078c56155cc0}{EJGhdb6WS9SQZiTVfDI8TQ}{2_judpfGQHuXc-nkAtVScg}{078c56155cc0}{172.17.0.3}{172.17.0.3:9300}{cdfhilmrstw}{8.15.0}{7000099-8512000}]}"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.service.MasterService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.373Z"", ""log.level"": ""INFO"", ""message"":""cluster UUID set to [k7ezh5GJSFK-XGURJVQrTQ]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][cluster_coordination][T#1]"",""log.logger"":""org.elasticsearch.cluster.coordination.CoordinationState"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.399Z"", ""log.level"": ""INFO"", ""message"":""master node changed {previous [], current [{078c56155cc0}{EJGhdb6WS9SQZiTVfDI8TQ}{2_judpfGQHuXc-nkAtVScg}{078c56155cc0}{172.17.0.3}{172.17.0.3:9300}{cdfhilmrstw}{8.15.0}{7000099-8512000}]}, term: 1, version: 1, reason: Publication{term=1, version=1}"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][clusterApplierService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.service.ClusterApplierService"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.460Z"", ""log.level"": ""INFO"", ""message"":""publish_address {172.17.0.3:9200}, bound_addresses {[::]:9200}"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.http.AbstractHttpServerTransport"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.460Z"", ""log.level"": ""INFO"", ""message"":""node-join: [{078c56155cc0}{EJGhdb6WS9SQZiTVfDI8TQ}{2_judpfGQHuXc-nkAtVScg}{078c56155cc0}{172.17.0.3}{172.17.0.3:9300}{cdfhilmrstw}{8.15.0}{7000099-8512000}] with reason [completing election]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.coordination.NodeJoinExecutor"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.490Z"", ""log.level"": ""INFO"", ""message"":""started {078c56155cc0}{EJGhdb6WS9SQZiTVfDI8TQ}{2_judpfGQHuXc-nkAtVScg}{078c56155cc0}{172.17.0.3}{172.17.0.3:9300}{cdfhilmrstw}{8.15.0}{7000099-8512000}{ml.allocated_processors=8, ml.machine_memory=2147483648, transform.config_version=10.0.0, xpack.installed=true, ml.config_version=12.0.0, ml.max_jvm_size=1073741824, ml.allocated_processors_double=8.0}"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""main"",""log.logger"":""org.elasticsearch.node.Node"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.692Z"", ""log.level"": ""INFO"", ""message"":""starting file watcher ..."", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][clusterApplierService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.common.file.AbstractFileWatchingService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.698Z"", ""log.level"": ""INFO"", ""message"":""file settings service up and running [tid=90]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[file-watcher[/usr/share/elasticsearch/config/operator/settings.json]]"",""log.logger"":""org.elasticsearch.common.file.AbstractFileWatchingService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.698Z"", ""log.level"": ""INFO"", ""message"":""setting file [/usr/share/elasticsearch/config/operator/settings.json] not found, initializing [file_settings] as empty"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[file-watcher[/usr/share/elasticsearch/config/operator/settings.json]]"",""log.logger"":""org.elasticsearch.reservedstate.service.FileSettingsService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.699Z"", ""log.level"": ""INFO"", ""message"":""recovered [0] indices into cluster_state"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.gateway.GatewayService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.941Z"", ""log.level"": ""INFO"", ""message"":""adding template [.monitoring-es] for index patterns [.monitoring-es-7-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.954Z"", ""log.level"": ""INFO"", ""message"":""adding template [.monitoring-alerts-7] for index patterns [.monitoring-alerts-7]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.968Z"", ""log.level"": ""INFO"", ""message"":""adding template [.monitoring-kibana] for index patterns [.monitoring-kibana-7-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:44.996Z"", ""log.level"": ""INFO"", ""message"":""adding template [.monitoring-beats] for index patterns [.monitoring-beats-7-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.013Z"", ""log.level"": ""INFO"", ""message"":""adding template [.monitoring-logstash] for index patterns [.monitoring-logstash-7-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.079Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.monitoring-es-mb] for index patterns [.monitoring-es-8-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.101Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.monitoring-logstash-mb] for index patterns [.monitoring-logstash-8-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.126Z"", ""log.level"": ""INFO"", ""message"":""adding component template [behavioral_analytics-events-mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.144Z"", ""log.level"": ""INFO"", ""message"":""adding component template [elastic-connectors-mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.163Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.monitoring-ent-search-mb] for index patterns [.monitoring-ent-search-8-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.170Z"", ""log.level"": ""INFO"", ""message"":""adding component template [elastic-connectors-settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.192Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.monitoring-kibana-mb] for index patterns [.monitoring-kibana-8-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.228Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.monitoring-beats-mb] for index patterns [.monitoring-beats-8-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.260Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.ml-anomalies-] for index patterns [.ml-anomalies-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.274Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.ml-stats] for index patterns [.ml-stats-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.283Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.ml-state] for index patterns [.ml-state*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.293Z"", ""log.level"": ""INFO"", ""message"":""adding component template [elastic-connectors-sync-jobs-mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.306Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.ml-notifications-000002] for index patterns [.ml-notifications-000002]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.315Z"", ""log.level"": ""INFO"", ""message"":""adding index template [search-acl-filter] for index patterns [.search-acl-filter-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.322Z"", ""log.level"": ""INFO"", ""message"":""adding component template [elastic-connectors-sync-jobs-settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.334Z"", ""log.level"": ""INFO"", ""message"":""adding component template [logs-mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.341Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics-tsdb-settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.348Z"", ""log.level"": ""INFO"", ""message"":""adding component template [synthetics-mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.355Z"", ""log.level"": ""INFO"", ""message"":""adding component template [synthetics-settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.360Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics-settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.373Z"", ""log.level"": ""INFO"", ""message"":""adding component template [data-streams-mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.382Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics-mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.392Z"", ""log.level"": ""INFO"", ""message"":""adding component template [ecs@dynamic_templates]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.399Z"", ""log.level"": ""INFO"", ""message"":""adding component template [synthetics@settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.409Z"", ""log.level"": ""INFO"", ""message"":""adding component template [ecs@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.418Z"", ""log.level"": ""INFO"", ""message"":""adding component template [data-streams@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.425Z"", ""log.level"": ""INFO"", ""message"":""adding component template [logs@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.432Z"", ""log.level"": ""INFO"", ""message"":""adding component template [synthetics@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.441Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.447Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics@tsdb-settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.452Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics@settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.470Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.watch-history-16] for index patterns [.watcher-history-16*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.482Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.slm-history-7] for index patterns [.slm-history-7*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.492Z"", ""log.level"": ""INFO"", ""message"":""adding index template [ilm-history-7] for index patterns [ilm-history-7*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.499Z"", ""log.level"": ""INFO"", ""message"":""adding component template [.deprecation-indexing-settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.510Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.fleet-fileds-fromhost-data] for index patterns [.fleet-fileds-fromhost-data-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.520Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.fleet-fileds-fromhost-meta] for index patterns [.fleet-fileds-fromhost-meta-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.530Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.fleet-fileds-tohost-meta] for index patterns [.fleet-fileds-tohost-meta-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.540Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.fleet-fileds-tohost-data] for index patterns [.fleet-fileds-tohost-data-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.546Z"", ""log.level"": ""INFO"", ""message"":""adding component template [.deprecation-indexing-mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.551Z"", ""log.level"": ""INFO"", ""message"":""adding component template [kibana-reporting@settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.556Z"", ""log.level"": ""INFO"", ""message"":""adding component template [traces@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.568Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics-apm.service_transaction@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.574Z"", ""log.level"": ""INFO"", ""message"":""adding component template [apm@settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.578Z"", ""log.level"": ""INFO"", ""message"":""adding component template [apm-10d@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.583Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics-apm.service_destination@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.587Z"", ""log.level"": ""INFO"", ""message"":""adding component template [apm-180d@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.592Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics-apm.transaction@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.596Z"", ""log.level"": ""INFO"", ""message"":""adding component template [logs-apm@settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.637Z"", ""log.level"": ""INFO"", ""message"":""adding component template [logs-apm.error@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.641Z"", ""log.level"": ""INFO"", ""message"":""adding component template [apm-390d@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.646Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics-apm.service_summary@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.650Z"", ""log.level"": ""INFO"", ""message"":""adding component template [apm-90d@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.655Z"", ""log.level"": ""INFO"", ""message"":""adding component template [traces-apm.rum@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.659Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics-apm@settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.664Z"", ""log.level"": ""INFO"", ""message"":""adding component template [apm@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.672Z"", ""log.level"": ""INFO"", ""message"":""adding component template [metrics-apm@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.679Z"", ""log.level"": ""INFO"", ""message"":""adding component template [traces-apm@mappings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.809Z"", ""log.level"": ""INFO"", ""message"":""adding index template [elastic-connectors] for index patterns [.elastic-connectors-v1]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.819Z"", ""log.level"": ""INFO"", ""message"":""adding index template [elastic-connectors-sync-jobs] for index patterns [.elastic-connectors-sync-jobs-v1]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.828Z"", ""log.level"": ""INFO"", ""message"":""adding index template [synthetics] for index patterns [synthetics-*-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.837Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics] for index patterns [metrics-*-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.846Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.deprecation-indexing-template] for index patterns [.logs-deprecation.*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.856Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.kibana-reporting] for index patterns [.kibana-reporting*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.872Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.service_transaction.60m@template] for index patterns [metrics-apm.service_transaction.60m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.883Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.service_transaction.1m@template] for index patterns [metrics-apm.service_transaction.1m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.892Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.internal@template] for index patterns [metrics-apm.internal-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.902Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.service_destination.1m@template] for index patterns [metrics-apm.service_destination.1m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.912Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.service_destination.60m@template] for index patterns [metrics-apm.service_destination.60m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.922Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.service_summary.1m@template] for index patterns [metrics-apm.service_summary.1m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.932Z"", ""log.level"": ""INFO"", ""message"":""adding index template [logs-apm.error@template] for index patterns [logs-apm.error-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.940Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.app@template] for index patterns [metrics-apm.app.*-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.949Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.transaction.1m@template] for index patterns [metrics-apm.transaction.1m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.958Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.transaction.10m@template] for index patterns [metrics-apm.transaction.10m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.968Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.service_summary.60m@template] for index patterns [metrics-apm.service_summary.60m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.977Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.service_transaction.10m@template] for index patterns [metrics-apm.service_transaction.10m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.986Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.transaction.60m@template] for index patterns [metrics-apm.transaction.60m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:45.995Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.service_destination.10m@template] for index patterns [metrics-apm.service_destination.10m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.005Z"", ""log.level"": ""INFO"", ""message"":""adding index template [traces-apm.rum@template] for index patterns [traces-apm.rum-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.023Z"", ""log.level"": ""INFO"", ""message"":""adding index template [traces-apm.sampled@template] for index patterns [traces-apm.sampled-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.033Z"", ""log.level"": ""INFO"", ""message"":""adding index template [traces-apm@template] for index patterns [traces-apm-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.041Z"", ""log.level"": ""INFO"", ""message"":""adding index template [logs-apm.app@template] for index patterns [logs-apm.app.*-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.050Z"", ""log.level"": ""INFO"", ""message"":""adding index template [metrics-apm.service_summary.10m@template] for index patterns [metrics-apm.service_summary.10m-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.083Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [.monitoring-8-ilm-policy]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.183Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline behavioral_analytics-events-final_pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.184Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline logs-default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.184Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline logs@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.184Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline metrics-apm.service_destination@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.185Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline logs-apm.app@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.185Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline traces-apm@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.185Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline metrics-apm.transaction@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.185Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline metrics-apm.app@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.186Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline traces-apm.rum@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.186Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline apm@pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.186Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline metrics-apm.service_transaction@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.186Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline metrics-apm.service_summary@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.186Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline logs-apm.error@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.187Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline search-default-ingestion"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.187Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline ent-search-generic-ingestion"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.187Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline logs@json-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.187Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline logs@json-message"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.193Z"", ""log.level"": ""INFO"", ""message"":""adding component template [behavioral_analytics-events-settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.199Z"", ""log.level"": ""INFO"", ""message"":""adding component template [logs-settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.204Z"", ""log.level"": ""INFO"", ""message"":""adding component template [logs@settings]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.268Z"", ""log.level"": ""INFO"", ""message"":""adding index template [logs] for index patterns [logs-*-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.313Z"", ""log.level"": ""INFO"", ""message"":""adding index template [behavioral_analytics-events-default] for index patterns [behavioral_analytics-events-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.348Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [ml-size-based-ilm-policy]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.383Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [logs]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.417Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [synthetics]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.449Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [7-days-default]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.491Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [metrics@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.523Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [synthetics@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.556Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [logs@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.589Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [7-days@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.623Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [30-days@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.656Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [90-days@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.689Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [365-days@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.721Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [180-days-default]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.752Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [180-days@lifecycle]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.784Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [slm-history-ilm-policy]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.813Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [ilm-history-ilm-policy]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.844Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [watch-history-ilm-policy-16]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.876Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [90-days-default]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.906Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [.fleet-file-tohost-meta-ilm-policy]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.942Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [.fleet-file-tohost-data-ilm-policy]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:46.975Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [.fleet-actions-results-ilm-policy]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.008Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [.deprecation-indexing-ilm-policy]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.046Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [365-days-default]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.077Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [.fleet-file-fromhost-meta-ilm-policy]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.109Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [.fleet-file-fromhost-data-ilm-policy]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.140Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [metrics]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.210Z"", ""log.level"": ""INFO"", ""message"":""Node [{078c56155cc0}{EJGhdb6WS9SQZiTVfDI8TQ}] is selected as the current health node."", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][management][T#2]"",""log.logger"":""org.elasticsearch.health.node.selection.HealthNodeTaskExecutor"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.211Z"", ""log.level"": ""INFO"", ""message"":""adding index lifecycle policy [30-days-default]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.ilm.action.TransportPutLifecycleAction"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.348Z"", ""log.level"": ""INFO"", ""message"":""license mode is [basic], currently licensed security realms are [reserved/reserved,file/default_file,native/default_native]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][clusterApplierService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.security.authc.Realms"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.352Z"", ""log.level"": ""INFO"", ""message"":""license [5148ee1a-9f32-4357-a870-dabe49671086] mode [basic] - valid"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][clusterApplierService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.license.ClusterStateLicenseService"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.391Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline metrics-apm.internal@default-pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.391Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline traces-apm@pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}
{""@timestamp"":""2024-07-23T23:42:47.392Z"", ""log.level"": ""INFO"", ""message"":""adding ingest pipeline metrics-apm@pipeline"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[078c56155cc0][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.xpack.core.template.IndexTemplateRegistry"",""elasticsearch.cluster.uuid"":""k7ezh5GJSFK-XGURJVQrTQ"",""elasticsearch.node.id"":""EJGhdb6WS9SQZiTVfDI8TQ"",""elasticsearch.node.name"":""078c56155cc0"",""elasticsearch.cluster.name"":""docker-cluster""}""
```

**Issue Reasons:**
- [8.15] 42 failures in test test600Interrupt (13.3% fail rate in 315 executions)
- [8.15] 2 failures in step rhel-7_packaging-tests-unix (50.0% fail rate in 4 executions)
- [8.15] 2 failures in step centos-7_packaging-tests-unix (50.0% fail rate in 4 executions)
- [8.15] 2 failures in step rhel-8_packaging-tests-unix (50.0% fail rate in 4 executions)
- [8.15] 3 failures in step debian-11_packaging-tests-unix (75.0% fail rate in 4 executions)
- [8.15] 2 failures in step almalinux-8_packaging-tests-unix (50.0% fail rate in 4 executions)
- [8.15] 4 failures in step opensuse-leap-15_packaging-tests-unix (100.0% fail rate in 4 executions)
- [8.15] 3 failures in step rocky-8_packaging-tests-unix (75.0% fail rate in 4 executions)
- [8.15] 2 failures in step sles-15_packaging-tests-unix (50.0% fail rate in 4 executions)
- [8.15] 3 failures in step rhel-9_packaging-tests-unix (75.0% fail rate in 4 executions)
- [8.15] 3 failures in step ubuntu-2204_packaging-tests-unix (75.0% fail rate in 4 executions)
- [8.15] 2 failures in step oraclelinux-8_packaging-tests-unix (50.0% fail rate in 4 executions)
- [8.15] 2 failures in step ubuntu-2004_destructivedistrotest.docker_packaging-tests-unix-sample (40.0% fail rate in 5 executions)
- [8.15] 2 failures in step ubuntu-2004_packaging-tests-unix (66.7% fail rate in 3 executions)
- [8.15] 4 failures in pipeline elasticsearch-periodic-packaging (100.0% fail rate in 4 executions)

**Note:**
This issue was created using new test triage automation. Please report issues or feedback to es-delivery.",elasticsearchmachine,closed,"[':Delivery/Build', '>test-failure', 'Team:Delivery', 'low-risk']",https://github.com/elastic/elasticsearch/issues/111132,2024-07-20T13:54:18Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/111132,"{
  ""application_resource"": ""unsure""
}"
145,111009,LogsDB - Rally `elastic/logs` dataset generation,"### Description

We need to generate a suitable dataset to be used in our logging experiments with LogsDB. The dataset should be crafted so to resemble a real-world logging use-case.

The `elastic/logs` Rally track includes a ""Data Generation"" stage which has parameters that can be tweaked to generate a dataset with specific characteristics and a set of queries whose data access pattern can also be configured. The goal behind this issue is to find suitable parameters for this data generation stage and generate such a dataset resembling as closely as possible a logging real-world use-case.

Ideally we would like to work with a very large dataset so to have disks filled up enough so to benchmark querying in a real-world scenario.

Once we have such dataset we will use it to run experiments and understand how our deployments react when resources are scaled up or down and, to be more precise, how query latency is affect and if we have any error when running queries (especially out of memory errors).

Hardware expected to be used for such profile: https://instances.vantage.sh/aws/ec2/im4gn.4xlarge",salvatore-campagna,closed,"['>enhancement', '>test', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/111009,2024-07-18T07:46:15Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/111009,"{
  ""application_resource"": ""no""
}"
146,110962,Search responses with large size can cause OOMs,"### Elasticsearch Version

7.17.x - 8.x

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

N/A

### Problem Description

Search responses that include a high number of hits and/or hits with considerable size can OOM a node, with the following stacktrace:

```
elasticsearch[node_name][transport_worker][T#XXXX]
  at java.lang.OutOfMemoryError.<init>()V (OutOfMemoryError.java:48)
  at org.elasticsearch.common.io.stream.StreamInput.readBytesReference(I)Lorg/elasticsearch/common/bytes/BytesReference; (StreamInput.java:161)
  at org.elasticsearch.common.io.stream.StreamInput.readBytesReference()Lorg/elasticsearch/common/bytes/BytesReference; (StreamInput.java:127)
  at org.elasticsearch.search.SearchHit.<init>(Lorg/elasticsearch/common/io/stream/StreamInput;)V (SearchHit.java:150)
  at org.elasticsearch.search.SearchHits.<init>(Lorg/elasticsearch/common/io/stream/StreamInput;)V (SearchHits.java:90)
  at org.elasticsearch.search.fetch.FetchSearchResult.<init>(Lorg/elasticsearch/common/io/stream/StreamInput;)V (FetchSearchResult.java:42)
  at org.elasticsearch.search.fetch.QueryFetchSearchResult.<init>(Lorg/elasticsearch/common/io/stream/StreamInput;)V (QueryFetchSearchResult.java:28)
  at org.elasticsearch.action.search.SearchTransportService$$Lambda$6076+0x0000000801b1cc88.read(Lorg/elasticsearch/common/io/stream/StreamInput;)Ljava/lang/Object; ()
  at org.elasticsearch.action.ActionListenerResponseHandler.read(Lorg/elasticsearch/common/io/stream/StreamInput;)Lorg/elasticsearch/transport/TransportResponse; (ActionListenerResponseHandler.java:58)
  at org.elasticsearch.action.ActionListenerResponseHandler.read(Lorg/elasticsearch/common/io/stream/StreamInput;)Ljava/lang/Object; (ActionListenerResponseHandler.java:25)
  at org.elasticsearch.transport.TransportService$4.read(Lorg/elasticsearch/common/io/stream/StreamInput;)Lorg/elasticsearch/transport/TransportResponse; (TransportService.java:863)
  at org.elasticsearch.transport.TransportService$4.read(Lorg/elasticsearch/common/io/stream/StreamInput;)Ljava/lang/Object; (TransportService.java:843)
  at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.read(Lorg/elasticsearch/common/io/stream/StreamInput;)Lorg/elasticsearch/transport/TransportResponse; (TransportService.java:1462)
  at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.read(Lorg/elasticsearch/common/io/stream/StreamInput;)Ljava/lang/Object; (TransportService.java:1449)
  at org.elasticsearch.transport.InboundHandler.handleResponse(Ljava/net/InetSocketAddress;Lorg/elasticsearch/common/io/stream/StreamInput;Lorg/elasticsearch/transport/TransportResponseHandler;)V (InboundHandler.java:311)
  at org.elasticsearch.transport.InboundHandler.messageReceived(Lorg/elasticsearch/transport/TcpChannel;Lorg/elasticsearch/transport/InboundMessage;J)V (InboundHandler.java:134)
```

Large search responses should not OOM a node, but be cancelled.

### Steps to Reproduce

This was observed in production and we don't have a reproducible script.

### Logs (if relevant)

_No response_",carlosdelest,closed,"['>bug', 'Team:Search Foundations', ':Search Foundations/Search']",https://github.com/elastic/elasticsearch/issues/110962,2024-07-17T09:52:42Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/110962,"{
  ""application_resource"": ""yes""
}"
147,110826,ES shard allocation bug,"### Elasticsearch Version

Version: 7.17.18, Build: default/tar/8682172c2130b9a411b1bd5ff37c9792367de6b0/2024-02-02T12:04:59.691750271Z, JVM: 11.0.20

### Installed Plugins

_No response_

### Java Version

11.0.20

### OS Version

Linux bsa5295 3.10.0-1160.108.1.el7.x86_64 #1 SMP Thu Jan 25 16:17:31 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux

### Problem Description

When the path.data length of the es data node exceeds 20, all shards of the same index will be allocated to one path. Causes disk io skew when writing. 


### Steps to Reproduce

My test steps are as follows
1. elasticsearch.yml
```
cluster.name: ISOP_1720490318878
http.port: 19399
network.host: bsa5295
node.name: bsa5295
bootstrap.memory_lock: false
bootstrap.system_call_filter: false
node.master: true
node.data: true
path.logs: /home/worker/elasticsearch/logs
path.data: /home/sdf/elasticsearch/data,/home/sdg/elasticsearch/data,/home/sdh/elasticsearch/data,/home/sdi/elasticsearch/data,/home/sdb/elasticsearch/data,/home/sdc/elasticsearch/data,/home/sdd/elasticsearch/data,/home/sde/elasticsearch/data,/home/sdj/elasticsearch/data,/home/sdk/elasticsearch/data,/home/sdf/elasticsearch_1/data,/home/sdg/elasticsearch_1/data,/home/sdh/elasticsearch_1/data,/home/sdi/elasticsearch_1/data,/home/sdb/elasticsearch_1/data,/home/sdc/elasticsearch_1/data,/home/sdd/elasticsearch_1/data,/home/sde/elasticsearch_1/data,/home/sdj/elasticsearch_1/data,/home/sdk/elasticsearch_1/data,/home/sdf/elasticsearch_2/data,/home/sdg/elasticsearch_2/data
transport.tcp.port: 9300
gateway.expected_nodes: 1
action.auto_create_index: .watches,.triggered_watches,.watcher-history-*,.kibana*,.security,.monitoring*
discovery.seed_hosts: [bsa5295]
cluster.initial_master_nodes: [bsa5295]
thread_pool.write.queue_size: 2000
indices.recovery.max_bytes_per_sec: 200mb
cluster.routing.allocation.node_concurrent_recoveries: 10
cluster.max_shards_per_node: 5000
cluster.routing.allocation.same_shard.host: true
cluster.routing.allocation.disk.watermark.low: 90%
cluster.routing.allocation.disk.watermark.high: 95%
cluster.fault_detection.follower_check.timeout: 180s
cluster.fault_detection.follower_check.retry_count: 10
cluster.fault_detection.follower_check.interval: 10s
cluster.publish.timeout: 1800s
indices.fielddata.cache.size: 10%
indices.memory.index_buffer_size: 10%
xpack.ml.enabled: false
cluster.election.duration: 30s
cluster.join.timeout: 360s
node.processors: 80
```
2. Create index my_index1
```
curl -X PUT ""bsa5295:19399/my_index1"" -H 'Content-Type: application/json' -d'
{
  ""settings"": {
    ""number_of_shards"": 25,
    ""number_of_replicas"": 0
  }
}'
```
3. View index uuid
```
[worker@bsa5295 ~]$ curl bsa5295:19399/_cat/indices | grep my_index1
green open  my_index1                                 fI4auV0lRtmxeYN8XrXf8g 25 0         0      0   5.5kb   5.5kb
```
4. View the path corresponding to the shard
![ä¼ä¸šå¾®ä¿¡æˆªå›¾_b672c602-b73c-49ad-8cb5-76ce64d5fd38](https://github.com/user-attachments/assets/bbf838e1-4046-47d5-aa6b-59d1dae93cba)

5. You can see that all shards are allocated under `/home/sdj/elasticsearch`

6. expected behavior: 

-    When the path.data configured on the data node is multi-path, it is expected that all shards of a single index can be distributed nearly evenly to each path.
-   Almost all shards take the same path, which is not in line with our expectations. Because when writing and querying the index data, only a few disk IO resources can be utilized at the same time.


### Logs (if relevant)

_No response_",LuPan92,closed,"['>bug', ':Distributed Coordination/Allocation', 'Team:Distributed (Obsolete)']",https://github.com/elastic/elasticsearch/issues/110826,2024-07-12T13:11:40Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/110826,"{
  ""application_resource"": ""yes""
}"
148,110530,[ML] pytorch_inference OOM,"### Elasticsearch Version

8.13.0 and forward

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

We've mainly seen this for x86_64 architectures because cloud prefers that version. We don't have any information to indicate that it's exclusive to x86_64 though.

### Problem Description

We have observed that the `pytorch_inference` can consume a large amount of memory on an ML node to the point where the OS will kill the process to regain memory.

The `pytorch_inference` process is used to run models like ELSER or ones uploaded via eland etc.

This issue will usually cause logs like the following:

```
[instance-00000000123] [controller/319] [CDetachedProcessSpawner.cc@193] Child process with PID 725 was terminated by signal 9 | repeated [3]
```

```
pytorch_inference/1164 process stopped unexpectedly
```

```
machine learning model task cancelled [http channel [Netty4HttpChannel{localAddress]
```

### Steps to Reproduce

Getting a reliable reproduction is somewhat difficult. We've see memory increase using a small subset of a wikipedia dataset. Generally to get the memory leak to occur, deploy the `elser_model_2_linux-x86_64` model and repeatedly perform inference.

### Cause

In 8.13.0 we [upgraded pytorch to version 2.1.2](https://github.com/elastic/ml-cpp/commit/e8a44b7c4fe79d1c5ea07c6114ce7c0a65a9164f). We believe this is the cause of the memory leak and we are investigating upgrading to a new version of pytorch.",jonathan-buttner,closed,"['>bug', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/110530,2024-07-05T14:58:36Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/110530,"{
  ""application_resource"": ""yes""
}"
149,110255,LogsDB - Indexing overhead performance testing of `ignore_malformed`,"### Description

LogsDB uses stored fields under the hood to deal with malformed field values and as a fallback mechanism in situations where doc values are not available. This behaviour favours user experience at the expense of performance, especially indexing performance (CPU/memory overhead). A significant factor is that supporting `ignore_malformed` needs some copying of different data structures involved in the parsing logic. These copy operations occur whenever `ignore_malformed` is enabled for complex field types where the entire field content must be preserved to handle potential parsing issues with nested values. In such scenarios, the copied data structures are used to capture and store malformed values.

We need to evaluate the performance penalty introduced by this logic and understand its impact especially on indexing throughput. Ideally we would like run two tests using the same index mode but with and without `ignore_malformed` enabled. Note also that standard log templates enable `ignore_malformed` by default in order to avoid data loss.

The outcome of this benchmarking activity is crucial for planning any necessary actions to mitigate performance issues in the event of unacceptable overhead.",salvatore-campagna,closed,"['>enhancement', 'Team:StorageEngine', ':StorageEngine/Logs']",https://github.com/elastic/elasticsearch/issues/110255,2024-06-28T09:38:17Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/110255,"{
  ""application_resource"": ""yes""
}"
150,109904,[CI] AutodetectMemoryLimitIT testManyDistinctOverFields failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/4mjzlpvjgoxe4/tests/:x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest/org.elasticsearch.xpack.ml.integration.AutodetectMemoryLimitIT/testManyDistinctOverFields


**Reproduction line:**
```
./gradlew ':x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest' --tests ""org.elasticsearch.xpack.ml.integration.AutodetectMemoryLimitIT.testManyDistinctOverFields"" -Dtests.seed=663AC0EA907BB5C8 -Dtests.locale=sv-SE -Dtests.timezone=Europe/Dublin -Druntime.java=22
```

**Applicable branches:**
8.14

**Reproduces locally?:**
Didn't try

**Failure history:**
[Failure dashboard for `org.elasticsearch.xpack.ml.integration.AutodetectMemoryLimitIT#testManyDistinctOverFields`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testManyDistinctOverFields'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.xpack.ml.integration.AutodetectMemoryLimitIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.AssertionError: 
Expected: a value greater than <90000000L>
     but: <0L> was less than <90000000L>

  at __randomizedtesting.SeedInfo.seed([663AC0EA907BB5C8:D3E2EB14F6C1A44D]:0)
  at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
  at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:6)
  at org.elasticsearch.test.ESTestCase.assertThat(ESTestCase.java:2151)
  at org.elasticsearch.xpack.ml.integration.AutodetectMemoryLimitIT.testManyDistinctOverFields(AutodetectMemoryLimitIT.java:229)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1570)

```",ywangd,closed,"['>test-failure', ':ml', 'Team:ML', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/109904,2024-06-19T06:05:06Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/109904,"{
  ""application_resource"": ""unsure""
}"
151,109903,[CI] UpgradeClusterClientYamlTestSuiteIT test {p0=old_cluster/30_ml_jobs_crud/Put job on the old cluster with the default model memory limit and post some data} failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/obw3crqc27qqi/tests/:x-pack:qa:rolling-upgrade:v8.14.2%23oldClusterTest/org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT/test%20%7Bp0=old_cluster%2F30_ml_jobs_crud%2FPut%20job%20on%20the%20old%20cluster%20with%20the%20default%20model%20memory%20limit%20and%20post%20some%20data%7D


**Reproduction line:**
```
./gradlew ':x-pack:qa:rolling-upgrade:v8.14.2#oldClusterTest' -Dtests.class=""org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=old_cluster/30_ml_jobs_crud/Put job on the old cluster with the default model memory limit and post some data}"" -Dtests.seed=BF521E7AC11912F8 -Dtests.bwc=true -Dtests.locale=en-MT -Dtests.timezone=Atlantic/Stanley -Druntime.java=22
```

**Applicable branches:**
8.14

**Reproduces locally?:**
Didn't try

**Failure history:**
[Failure dashboard for `org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT#test {p0=old_cluster/30_ml_jobs_crud/Put job on the old cluster with the default model memory limit and post some data}`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('test%20%7Bp0%3Dold_cluster/30_ml_jobs_crud/Put%20job%20on%20the%20old%20cluster%20with%20the%20default%20model%20memory%20limit%20and%20post%20some%20data%7D'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.AssertionError: Failure at [old_cluster/30_ml_jobs_crud:193]: 
Expected: <201>
     but: was <1>

  at __randomizedtesting.SeedInfo.seed([BF521E7AC11912F8:370621A06FE57F00]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:610)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:553)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1570)

  Caused by: java.lang.AssertionError: 
  Expected: <201>
       but: was <1>

    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
    at org.junit.Assert.assertThat(Assert.java:964)
    at org.junit.Assert.assertThat(Assert.java:930)
    at org.elasticsearch.test.rest.yaml.section.MatchAssertion.doAssert(MatchAssertion.java:99)
    at org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:65)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:590)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:553)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
    at java.lang.reflect.Method.invoke(Method.java:580)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.junit.rules.RunRules.evaluate(RunRules.java:20)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.junit.rules.RunRules.evaluate(RunRules.java:20)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at org.junit.rules.RunRules.evaluate(RunRules.java:20)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1570)

```",ywangd,closed,"['>test-failure', ':ml', 'Team:ML', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/109903,2024-06-19T06:00:04Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/109903,"{
  ""application_resource"": ""unsure""
}"
152,109697,"[CI] MvSliceTests testEvaluateBlockWithoutNulls {TestCase=<cartesian_shape>, <integer>, <integer>} failing","**Build scan:**
https://gradle-enterprise.elastic.co/s/ye7bsq425nanw/tests/:x-pack:plugin:esql:test/org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvSliceTests/testEvaluateBlockWithoutNulls%20%7BTestCase=%3Ccartesian_shape%3E,%20%3Cinteger%3E,%20%3Cinteger%3E%7D


**Reproduction line:**
```
./gradlew ':x-pack:plugin:esql:test' --tests ""org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvSliceTests.testEvaluateBlockWithoutNulls {TestCase=<cartesian_shape>, <integer>, <integer>}"" -Dtests.seed=37D4236681F6ADC5 -Dtests.locale=en-GB -Dtests.timezone=Asia/Famagusta -Druntime.java=22
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
[Failure dashboard for `org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvSliceTests#testEvaluateBlockWithoutNulls {TestCase=<cartesian_shape>, <integer>, <integer>}`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testEvaluateBlockWithoutNulls%20%7BTestCase%3D%3Ccartesian_shape%3E,%20%3Cinteger%3E,%20%3Cinteger%3E%7D'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvSliceTests'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.AssertionError: Test data is too large to fit in the memory

  at __randomizedtesting.SeedInfo.seed([37D4236681F6ADC5:7DCA888B28BE3A71]:0)
  at org.junit.Assert.fail(Assert.java:89)
  at org.junit.Assert.assertTrue(Assert.java:42)
  at org.junit.Assert.assertFalse(Assert.java:65)
  at org.elasticsearch.xpack.esql.expression.function.AbstractFunctionTestCase.testEvaluateBlockWithoutNulls(AbstractFunctionTestCase.java:313)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1570)

```",dnhatn,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/109697,2024-06-13T18:28:30Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/109697,"{
  ""application_resource"": ""yes""
}"
153,109576,"async ESQL and _search: add search_id, is_running and is_complete to response headers","### Description

In order to be able to use cbor response format in kibana and avoid decoding the body on kibana server, we would need search_id, is_running and is_complete to be returned as part of response headers (on top of returning them in body as today)

",ppisljar,closed,"['>enhancement', 'Team:Analytics', ':Analytics/ES|QL', 'Team:Search Foundations', ':Search Foundations/Search']",https://github.com/elastic/elasticsearch/issues/109576,2024-06-11T13:00:03Z,14,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/109576,"{
  ""application_resource"": ""no""
}"
154,109461,"Data too large, data for [<http_request>] would be [4542266196/4.2gb], which is larger than the limit of [4509715660/4.1gb","### Elasticsearch Version

7.17.14

### Installed Plugins

_No response_

### Java Version

openjdk version ""21"" 2023-09-19

### OS Version

centos 7.9

### Problem Description

The Java heap memory of ES is full, and a request error occurs, but there will be no GC. After using external tools to assist it in executing GC, everything returns to normal.

### Steps to Reproduce

This is an error message

```
[parent] Data too large, data for [<http_request>] would be [4542266196/4.2gb], which is larger than the limit of [4509715660/4.1gb], real usage: [4542265928/4.2gb], new bytes reserved: [268/268b], usages [request=0/0b, fielddata=0/0b, in_flight_requests=268/268b, model_inference=0/0b, eql_sequence=0/0b, accounting=240580/234.9kb
```

startup jvm parameter
```
/data/elasticsearch/elasticsearch-7.17.14/jdk/bin/java -Xshare:auto -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djav.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -XX:+ShowCodeDetailsInExceptionMessages -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dio.netty.allocator.numDirectArenas=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Dlog4j2.formatMsgNoLookups=true -Djava.locale.providers=SPI,COMPAT --add-opens=java.base/java.io=ALL-UNNAMED -Djava.security.manager=allow -XX:+UseG1GC -Djava.io.tmpdir=/tmp/elasticsearch-1620762326664537413 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=/data/elasticsearch/eslogs/hs_err_pid%p.log -Xlog:gc*,gc+age=trace,safepoint:file=/data/elasticsearch/eslogs/gc.log:utctime,pid,tags:filecount=6,filesize=128m -Xms6g -Xmx6g -XX:MaxDirectMemorySize=3221225472 -XX:G1HeapRegionSize=4m -XX:InitiatingHeapOccupancyPercent=30 -XX:G1ReservePercent=15 -Des.path.home=/data/elasticsearch/elasticsearch-7.17.14 -Des.path.conf=/data/elasticsearch/elasticsearch-7.17.14/config -Des.distribution.flavor=default -Des.distribution.type=tar -Des.bundled_jdk=true -cp /data/elasticsearch/elasticsearch-7.17.14/lib/* org.elasticsearch.bootstrap.Elasticsearch -d
```

startup es parameter
```
indices.breaker.total.limit: 80%
indices.memory.index_buffer_size: 20%
cluster.max_shards_per_node: 10000
```

jhsdb jmap --heap --pid 49150

```
Debugger attached successfully.
Server compiler detected.
JVM version is 21+35-2513

using thread-local object allocation.
Garbage-First (G1) GC with 4 thread(s)

Heap Configuration:
   MinHeapFreeRatio         = 40
   MaxHeapFreeRatio         = 70
   MaxHeapSize              = 6442450944 (6144.0MB)
   NewSize                  = 1363144 (1.2999954223632812MB)
   MaxNewSize               = 3862953984 (3684.0MB)
   OldSize                  = 5452592 (5.1999969482421875MB)
   NewRatio                 = 2
   SurvivorRatio            = 8
   MetaspaceSize            = 22020096 (21.0MB)
   CompressedClassSpaceSize = 1073741824 (1024.0MB)
   MaxMetaspaceSize         = 17592186044415 MB
   G1HeapRegionSize         = 4194304 (4.0MB)

Heap Usage:
G1 Heap:
   regions  = 1536
   capacity = 6442450944 (6144.0MB)
   used     = 4554717080 (4343.716697692871MB)
   free     = 1887733864 (1800.283302307129MB)
   70.6985139598449% used
G1 Young Generation:
Eden Space:
   regions  = 2
   capacity = 1140850688 (1088.0MB)
   used     = 8388608 (8.0MB)
   free     = 1132462080 (1080.0MB)
   0.7352941176470589% used
Survivor Space:
   regions  = 0
   capacity = 0 (0.0MB)
   used     = 0 (0.0MB)
   free     = 0 (0.0MB)
   0.0% used
G1 Old Generation:
   regions  = 1123
   capacity = 5301600256 (5056.0MB)
   used     = 4546328472 (4335.716697692871MB)
   free     = 755271784 (720.2833023071289MB)
   85.75389038158369% used
```

I use tools to assist ES in executing GCï¼Œ Everything is okay
```
./jcmd pid GC.run
```

```
G1 Old Generation:
   regions  = 53
   capacity = 2382364672 (2272.0MB)
   used     = 212700864 (202.84735107421875MB)
   free     = 2169663808 (2069.1526489257812MB)
   8.928140452210332% used
```





### Logs (if relevant)

_No response_",xhrg,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/109461,2024-06-07T03:10:26Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/109461,"{
  ""application_resource"": ""yes""
}"
155,109455,[CI] MappingIT testMapperDynamicIndexSetting failing,"This looks to be a new test added in https://github.com/elastic/elasticsearch/pull/109301

**Build scan:**
https://gradle-enterprise.elastic.co/s/hoxn5f3dd54hk/tests/:qa:rolling-upgrade:v7.13.4%23oneThirdUpgradedTest/org.elasticsearch.upgrades.MappingIT/testMapperDynamicIndexSetting


**Reproduction line:**
```
./gradlew ':qa:rolling-upgrade:v7.13.4#oneThirdUpgradedTest' -Dtests.class=""org.elasticsearch.upgrades.MappingIT"" -Dtests.method=""testMapperDynamicIndexSetting"" -Dtests.seed=272DB9A7614B8058 -Dtests.bwc=true -Dtests.locale=es-CO -Dtests.timezone=Asia/Baghdad -Druntime.java=22
```

**Applicable branches:**
7.17

**Reproduces locally?:**
Didn't try

**Failure history:**
[Failure dashboard for `org.elasticsearch.upgrades.MappingIT#testMapperDynamicIndexSetting`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testMapperDynamicIndexSetting'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.upgrades.MappingIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.AssertionError: timed out waiting for green state for index [my-index] cluster state [{
  ""cluster_name"" : ""v7.13.4"",
  ""cluster_uuid"" : ""jdJyCc9nRbK52Z3qrblQrA"",
  ""version"" : 387,
  ""state_uuid"" : ""ugOc_dkoSqu0CeTWhRysTw"",
  ""master_node"" : ""5SaXoi7LQv-rMGdQWoEcsg"",
  ""blocks"" : {
    ""indices"" : {
      ""closed_index_created_on_old"" : {
        ""4"" : {
          ""description"" : ""index closed"",
          ""retryable"" : false,
          ""levels"" : [
            ""read"",
            ""write""
          ]
        }
      },
      ""index_old_7130499"" : {
        ""4"" : {
          ""description"" : ""index closed"",
          ""retryable"" : false,
          ""levels"" : [
            ""read"",
            ""write""
          ]
        }
      },
      ""closed_index_replica_allocation"" : {
        ""4"" : {
          ""description"" : ""index closed"",
          ""retryable"" : false,
          ""levels"" : [
            ""read"",
            ""write""
          ]
        }
      }
    }
  },
  ""nodes"" : {
    ""DN1nowVMRZeeiWTNpNoxxQ"" : {
      ""name"" : ""v7.13.4-2"",
      ""ephemeral_id"" : ""bC1AVhnJSeaCCm5qK9AI4g"",
      ""transport_address"" : ""127.0.0.1:42289"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""ml.machine_memory"" : ""126604300288"",
        ""ml.max_open_jobs"" : ""512"",
        ""xpack.installed"" : ""true"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""transform.node"" : ""true""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    },
    ""5SaXoi7LQv-rMGdQWoEcsg"" : {
      ""name"" : ""v7.13.4-1"",
      ""ephemeral_id"" : ""qDGsIvPzSc2cfALfpe0psA"",
      ""transport_address"" : ""127.0.0.1:34839"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""ml.machine_memory"" : ""126604300288"",
        ""ml.max_open_jobs"" : ""512"",
        ""xpack.installed"" : ""true"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""transform.node"" : ""true""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    },
    ""vz9cOsqBRGSQfSLU8TOO0w"" : {
      ""name"" : ""v7.13.4-0"",
      ""ephemeral_id"" : ""dHnz-_AlSn6QKeLPjJyrVA"",
      ""transport_address"" : ""127.0.0.1:43783"",
      ""attributes"" : {
        ""ml.machine_memory"" : ""126604300288"",
        ""upgraded"" : ""true"",
        ""xpack.installed"" : ""true"",
        ""transform.node"" : ""true"",
        ""testattr"" : ""test"",
        ""ml.max_open_jobs"" : ""512"",
        ""ml.max_jvm_size"" : ""536870912""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    }
  },
  ""metadata"" : {
    ""cluster_uuid"" : ""jdJyCc9nRbK52Z3qrblQrA"",
    ""cluster_uuid_committed"" : true,
    ""cluster_coordination"" : {
      ""term"" : 1,
      ""last_committed_config"" : [
        ""DN1nowVMRZeeiWTNpNoxxQ"",
        ""vz9cOsqBRGSQfSLU8TOO0w"",
        ""5SaXoi7LQv-rMGdQWoEcsg""
      ],
      ""last_accepted_config"" : [
        ""DN1nowVMRZeeiWTNpNoxxQ"",
        ""vz9cOsqBRGSQfSLU8TOO0w"",
        ""5SaXoi7LQv-rMGdQWoEcsg""
      ],
      ""voting_config_exclusions"" : [ ]
    },
    ""templates"" : {
      "".ml-stats"" : {
        ""order"" : 0,
        ""version"" : 7130499,
        ""index_patterns"" : [
          "".ml-stats-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""lifecycle"" : {
              ""name"" : ""ml-size-based-ilm-policy"",
              ""rollover_alias"" : "".ml-stats-write""
            },
            ""hidden"" : ""true"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""_meta"" : {
              ""version"" : ""7.13.4""
            },
            ""dynamic"" : false,
            ""properties"" : {
              ""skipped_docs_count"" : {
                ""type"" : ""long""
              },
              ""validation_loss"" : {
                ""properties"" : {
                  ""fold_values"" : {
                    ""properties"" : {
                      ""fold"" : {
                        ""type"" : ""integer""
                      },
                      ""values"" : {
                        ""type"" : ""double""
                      }
                    }
                  },
                  ""loss_type"" : {
                    ""type"" : ""keyword""
                  }
                }
              },
              ""cache_miss_count"" : {
                ""type"" : ""long""
              },
              ""timing_stats"" : {
                ""properties"" : {
                  ""iteration_time"" : {
                    ""type"" : ""long""
                  },
                  ""elapsed_time"" : {
                    ""type"" : ""long""
                  }
                }
              },
              ""failure_count"" : {
                ""type"" : ""long""
              },
              ""model_id"" : {
                ""type"" : ""keyword""
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""training_docs_count"" : {
                ""type"" : ""long""
              },
              ""inference_count"" : {
                ""type"" : ""long""
              },
              ""job_id"" : {
                ""type"" : ""keyword""
              },
              ""missing_all_fields_count"" : {
                ""type"" : ""long""
              },
              ""peak_usage_bytes"" : {
                ""type"" : ""long""
              },
              ""iteration"" : {
                ""type"" : ""integer""
              },
              ""hyperparameters"" : {
                ""properties"" : {
                  ""max_attempts_to_add_tree"" : {
                    ""type"" : ""integer""
                  },
                  ""downsample_factor"" : {
                    ""type"" : ""double""
                  },
                  ""eta_growth_rate_per_tree"" : {
                    ""type"" : ""double""
                  },
                  ""soft_tree_depth_tolerance"" : {
                    ""type"" : ""double""
                  },
                  ""max_trees"" : {
                    ""type"" : ""integer""
                  },
                  ""lambda"" : {
                    ""type"" : ""double""
                  },
                  ""max_optimization_rounds_per_hyperparameter"" : {
                    ""type"" : ""integer""
                  },
                  ""eta"" : {
                    ""type"" : ""double""
                  },
                  ""soft_tree_depth_limit"" : {
                    ""type"" : ""double""
                  },
                  ""alpha"" : {
                    ""type"" : ""double""
                  },
                  ""class_assignment_objective"" : {
                    ""type"" : ""keyword""
                  },
                  ""feature_bag_fraction"" : {
                    ""type"" : ""double""
                  },
                  ""num_splits_per_feature"" : {
                    ""type"" : ""integer""
                  },
                  ""gamma"" : {
                    ""type"" : ""double""
                  },
                  ""num_folds"" : {
                    ""type"" : ""integer""
                  }
                }
              },
              ""parameters"" : {
                ""properties"" : {
                  ""compute_feature_influence"" : {
                    ""type"" : ""boolean""
                  },
                  ""feature_influence_threshold"" : {
                    ""type"" : ""double""
                  },
                  ""outlier_fraction"" : {
                    ""type"" : ""double""
                  },
                  ""method"" : {
                    ""type"" : ""keyword""
                  },
                  ""standardization_enabled"" : {
                    ""type"" : ""boolean""
                  },
                  ""n_neighbors"" : {
                    ""type"" : ""integer""
                  }
                }
              },
              ""test_docs_count"" : {
                ""type"" : ""long""
              },
              ""node_id"" : {
                ""type"" : ""keyword""
              },
              ""timestamp"" : {
                ""type"" : ""date""
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-alerts-7"" : {
        ""order"" : 0,
        ""version"" : 7120099,
        ""index_patterns"" : [
          "".monitoring-alerts-7""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""metadata"" : {
                ""properties"" : {
                  ""severity"" : {
                    ""type"" : ""short""
                  },
                  ""cluster_uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""watch"" : {
                    ""type"" : ""keyword""
                  },
                  ""link"" : {
                    ""type"" : ""keyword""
                  },
                  ""type"" : {
                    ""type"" : ""keyword""
                  },
                  ""version"" : {
                    ""type"" : ""keyword""
                  }
                }
              },
              ""update_timestamp"" : {
                ""type"" : ""date""
              },
              ""prefix"" : {
                ""type"" : ""text""
              },
              ""message"" : {
                ""type"" : ""text""
              },
              ""suffix"" : {
                ""type"" : ""text""
              },
              ""resolved_timestamp"" : {
                ""type"" : ""date""
              },
              ""timestamp"" : {
                ""type"" : ""date""
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-logstash"" : {
        ""order"" : 0,
        ""version"" : 7120099,
        ""index_patterns"" : [
          "".monitoring-logstash-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""logstash_state"" : {
                ""properties"" : {
                  ""pipeline"" : {
                    ""properties"" : {
                      ""batch_size"" : {
                        ""type"" : ""integer""
                      },
                      ""format"" : {
                        ""type"" : ""keyword""
                      },
                      ""id"" : {
                        ""type"" : ""keyword""
                      },
                      ""ephemeral_id"" : {
                        ""type"" : ""keyword""
                      },
                      ""workers"" : {
                        ""type"" : ""short""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      },
                      ""representation"" : {
                        ""enabled"" : false
                      },
                      ""hash"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""http_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""ephemeral_id"" : {
                    ""type"" : ""keyword""
                  },
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""version"" : {
                    ""type"" : ""keyword""
                  },
                  ""snapshot"" : {
                    ""type"" : ""boolean""
                  },
                  ""status"" : {
                    ""type"" : ""keyword""
                  }
                }
              },
              ""logstash_stats"" : {
                ""type"" : ""object"",
                ""properties"" : {
                  ""jvm"" : {
                    ""properties"" : {
                      ""mem"" : {
                        ""properties"" : {
                          ""heap_used_percent"" : {
                            ""type"" : ""long""
                          },
                          ""heap_max_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""heap_used_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""uptime_in_millis"" : {
                        ""type"" : ""long""
                      },
                      ""gc"" : {
                        ""properties"" : {
                          ""collectors"" : {
                            ""properties"" : {
                              ""young"" : {
                                ""properties"" : {
                                  ""collection_count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""collection_time_in_millis"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""old"" : {
                                ""properties"" : {
                                  ""collection_count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""collection_time_in_millis"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  ""logstash"" : {
                    ""properties"" : {
                      ""pipeline"" : {
                        ""properties"" : {
                          ""batch_size"" : {
                            ""type"" : ""long""
                          },
                          ""workers"" : {
                            ""type"" : ""short""
                          }
                        }
                      },
                      ""http_address"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""ephemeral_id"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      },
                      ""snapshot"" : {
                        ""type"" : ""boolean""
                      },
                      ""status"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""process"" : {
                    ""properties"" : {
                      ""open_file_descriptors"" : {
                        ""type"" : ""long""
                      },
                      ""max_file_descriptors"" : {
                        ""type"" : ""long""
                      },
                      ""cpu"" : {
                        ""properties"" : {
                          ""percent"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""pipelines"" : {
                    ""type"" : ""nested"",
                    ""properties"" : {
                      ""vertices"" : {
                        ""type"" : ""nested"",
                        ""properties"" : {
                          ""events_out"" : {
                            ""type"" : ""long""
                          },
                          ""pipeline_ephemeral_id"" : {
                            ""type"" : ""keyword""
                          },
                          ""events_in"" : {
                            ""type"" : ""long""
                          },
                          ""double_gauges"" : {
                            ""type"" : ""nested"",
                            ""properties"" : {
                              ""name"" : {
                                ""type"" : ""keyword""
                              },
                              ""value"" : {
                                ""type"" : ""double""
                              }
                            }
                          },
                          ""queue_push_duration_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""duration_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""id"" : {
                            ""type"" : ""keyword""
                          },
                          ""long_counters"" : {
                            ""type"" : ""nested"",
                            ""properties"" : {
                              ""name"" : {
                                ""type"" : ""keyword""
                              },
                              ""value"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      },
                      ""id"" : {
                        ""type"" : ""keyword""
                      },
                      ""ephemeral_id"" : {
                        ""type"" : ""keyword""
                      },
                      ""hash"" : {
                        ""type"" : ""keyword""
                      },
                      ""events"" : {
                        ""properties"" : {
                          ""filtered"" : {
                            ""type"" : ""long""
                          },
                          ""in"" : {
                            ""type"" : ""long""
                          },
                          ""queue_push_duration_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""duration_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""out"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""queue"" : {
                        ""properties"" : {
                          ""events_count"" : {
                            ""type"" : ""long""
                          },
                          ""max_queue_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""queue_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""type"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""reloads"" : {
                        ""properties"" : {
                          ""failures"" : {
                            ""type"" : ""long""
                          },
                          ""successes"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""batch_size"" : {
                    ""type"" : ""integer""
                  },
                  ""os"" : {
                    ""properties"" : {
                      ""cpu"" : {
                        ""properties"" : {
                          ""load_average"" : {
                            ""properties"" : {
                              ""5m"" : {
                                ""type"" : ""half_float""
                              },
                              ""15m"" : {
                                ""type"" : ""half_float""
                              },
                              ""1m"" : {
                                ""type"" : ""half_float""
                              }
                            }
                          }
                        }
                      },
                      ""cgroup"" : {
                        ""properties"" : {
                          ""cpu"" : {
                            ""properties"" : {
                              ""stat"" : {
                                ""properties"" : {
                                  ""number_of_elapsed_periods"" : {
                                    ""type"" : ""long""
                                  },
                                  ""number_of_times_throttled"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time_throttled_nanos"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""control_group"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          },
                          ""cpuacct"" : {
                            ""properties"" : {
                              ""control_group"" : {
                                ""type"" : ""keyword""
                              },
                              ""usage_nanos"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  ""workers"" : {
                    ""type"" : ""short""
                  },
                  ""events"" : {
                    ""properties"" : {
                      ""filtered"" : {
                        ""type"" : ""long""
                      },
                      ""in"" : {
                        ""type"" : ""long""
                      },
                      ""duration_in_millis"" : {
                        ""type"" : ""long""
                      },
                      ""out"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""queue"" : {
                    ""properties"" : {
                      ""events_count"" : {
                        ""type"" : ""long""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""type"" : ""date""
                  },
                  ""reloads"" : {
                    ""properties"" : {
                      ""failures"" : {
                        ""type"" : ""long""
                      },
                      ""successes"" : {
                        ""type"" : ""long""
                      }
                    }
                  }
                }
              },
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""format"" : ""date_time"",
                    ""type"" : ""date""
                  }
                }
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""timestamp"" : {
                ""format"" : ""date_time"",
                ""type"" : ""date""
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".transform-notifications-000002"" : {
        ""order"" : 0,
        ""version"" : 7130499,
        ""index_patterns"" : [
          "".transform-notifications-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""hidden"" : ""true"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""_meta"" : {
              ""version"" : ""7.13.4""
            },
            ""dynamic"" : ""false"",
            ""properties"" : {
              ""level"" : {
                ""type"" : ""keyword""
              },
              ""transform_id"" : {
                ""type"" : ""keyword""
              },
              ""node_name"" : {
                ""type"" : ""keyword""
              },
              ""message"" : {
                ""type"" : ""text"",
                ""fields"" : {
                  ""raw"" : {
                    ""ignore_above"" : 1024,
                    ""type"" : ""keyword""
                  }
                }
              },
              ""timestamp"" : {
                ""type"" : ""date""
              }
            }
          }
        },
        ""aliases"" : {
          "".transform-notifications-read"" : {
            ""is_hidden"" : true
          }
        }
      },
      "".monitoring-beats"" : {
        ""order"" : 0,
        ""version"" : 7120099,
        ""index_patterns"" : [
          "".monitoring-beats-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  }
                }
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""beats_stats"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""metrics"" : {
                    ""properties"" : {
                      ""system"" : {
                        ""properties"" : {
                          ""load"" : {
                            ""properties"" : {
                              ""1"" : {
                                ""type"" : ""double""
                              },
                              ""15"" : {
                                ""type"" : ""double""
                              },
                              ""5"" : {
                                ""type"" : ""double""
                              },
                              ""norm"" : {
                                ""properties"" : {
                                  ""1"" : {
                                    ""type"" : ""double""
                                  },
                                  ""15"" : {
                                    ""type"" : ""double""
                                  },
                                  ""5"" : {
                                    ""type"" : ""double""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""beat"" : {
                        ""properties"" : {
                          ""handles"" : {
                            ""properties"" : {
                              ""limit"" : {
                                ""properties"" : {
                                  ""hard"" : {
                                    ""type"" : ""long""
                                  },
                                  ""soft"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""open"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""cpu"" : {
                            ""properties"" : {
                              ""total"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""value"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""system"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""user"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""memstats"" : {
                            ""properties"" : {
                              ""rss"" : {
                                ""type"" : ""long""
                              },
                              ""gc_next"" : {
                                ""type"" : ""long""
                              },
                              ""memory_alloc"" : {
                                ""type"" : ""long""
                              },
                              ""memory_total"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""cgroup"" : {
                            ""properties"" : {
                              ""memory"" : {
                                ""properties"" : {
                                  ""mem"" : {
                                    ""properties"" : {
                                      ""usage"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""limit"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  }
                                }
                              },
                              ""cpu"" : {
                                ""properties"" : {
                                  ""cfs"" : {
                                    ""properties"" : {
                                      ""period"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""quota"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""stats"" : {
                                    ""properties"" : {
                                      ""periods"" : {
                                        ""type"" : ""long""
                                      },
                                      ""throttled"" : {
                                        ""properties"" : {
                                          ""ns"" : {
                                            ""type"" : ""long""
                                          },
                                          ""periods"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  }
                                }
                              },
                              ""cpuacct"" : {
                                ""properties"" : {
                                  ""total"" : {
                                    ""properties"" : {
                                      ""ns"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  }
                                }
                              }
                            }
                          },
                          ""info"" : {
                            ""properties"" : {
                              ""ephemeral_id"" : {
                                ""type"" : ""keyword""
                              },
                              ""uptime"" : {
                                ""properties"" : {
                                  ""ms"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""libbeat"" : {
                        ""properties"" : {
                          ""output"" : {
                            ""properties"" : {
                              ""read"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""type"" : {
                                ""type"" : ""keyword""
                              },
                              ""write"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""events"" : {
                                ""properties"" : {
                                  ""batches"" : {
                                    ""type"" : ""long""
                                  },
                                  ""duplicates"" : {
                                    ""type"" : ""long""
                                  },
                                  ""total"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""toomany"" : {
                                    ""type"" : ""long""
                                  },
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""pipeline"" : {
                            ""properties"" : {
                              ""clients"" : {
                                ""type"" : ""long""
                              },
                              ""events"" : {
                                ""properties"" : {
                                  ""total"" : {
                                    ""type"" : ""long""
                                  },
                                  ""filtered"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""published"" : {
                                    ""type"" : ""long""
                                  },
                                  ""retry"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""queue"" : {
                                ""properties"" : {
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""config"" : {
                            ""properties"" : {
                              ""module"" : {
                                ""properties"" : {
                                  ""running"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stops"" : {
                                    ""type"" : ""long""
                                  },
                                  ""starts"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reloads"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      },
                      ""apm-server"" : {
                        ""properties"" : {
                          ""server"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""concurrency"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""concurrent"" : {
                                ""properties"" : {
                                  ""wait"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""acm"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""notmodified"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""request"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""unset"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unavailable"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      },
                                      ""notfound"" : {
                                        ""type"" : ""long""
          ...
```",mark-vieira,closed,"['>test-failure', 'low-risk', 'Team:StorageEngine', ':StorageEngine/Mapping']",https://github.com/elastic/elasticsearch/issues/109455,2024-06-06T20:57:08Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/109455,"{
  ""application_resource"": ""yes""
}"
156,109454,[CI] SearchWithMinCompatibleSearchNodeIT testMinVersionAsOldVersion failing,"This and other tests in `SearchWithMinCompatibleSearchNodeIT` are failing consistently on Java 23. The underlying error looks to be a date parsing issue related to changes in Java 23.

**Build scan:**
https://gradle-enterprise.elastic.co/s/zpuwiiomt72u4/tests/:qa:mixed-cluster:v7.17.22%23mixedClusterTest/org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT/testMinVersionAsOldVersion


**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v7.17.22#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT"" -Dtests.method=""testMinVersionAsOldVersion"" -Dtests.seed=5DBDE67B8A1D2A3D -Dtests.bwc=true -Dtests.locale=ar-JO -Dtests.timezone=Etc/GMT -Druntime.java=23
```

**Applicable branches:**
main

**Reproduces locally?:**
Yes

**Failure history:**
[Failure dashboard for `org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT#testMinVersionAsOldVersion`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testMinVersionAsOldVersion'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.AssertionError: timed out waiting for green state for index [test_min_version] cluster state [{
  ""cluster_name"" : ""v7.17.22"",
  ""cluster_uuid"" : ""upGvfBNWRviN_O8sn9-pJg"",
  ""version"" : 20502,
  ""state_uuid"" : ""O9zoiGd0ROG-vW7sQjjfVw"",
  ""master_node"" : ""snTotwKFQZ6zXVHyCSOMIw"",
  ""blocks"" : { },
  ""nodes"" : {
    ""L-A50_QORHaisFrnjXNHwg"" : {
      ""name"" : ""v7.17.22-0"",
      ""ephemeral_id"" : ""1lsPVfVuRZSK_UPXSOJbUQ"",
      ""transport_address"" : ""127.0.0.1:36557"",
      ""attributes"" : {
        ""ml.allocated_processors_double"" : ""32.0"",
        ""upgraded"" : ""true"",
        ""ml.machine_memory"" : ""126604296192"",
        ""xpack.installed"" : ""true"",
        ""transform.config_version"" : ""10.0.0"",
        ""testattr"" : ""test"",
        ""ml.config_version"" : ""12.0.0"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""ml.allocated_processors"" : ""32""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    },
    ""snTotwKFQZ6zXVHyCSOMIw"" : {
      ""name"" : ""v7.17.22-2"",
      ""ephemeral_id"" : ""MEXPuMTbSqqQyMRjTSzXRA"",
      ""transport_address"" : ""127.0.0.1:33727"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""ml.machine_memory"" : ""126604296192"",
        ""ml.max_open_jobs"" : ""512"",
        ""xpack.installed"" : ""true"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""transform.node"" : ""true""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    },
    ""aJOu_q1aTuy_bkCdMteq6g"" : {
      ""name"" : ""v7.17.22-3"",
      ""ephemeral_id"" : ""ItxWXuamR--qLUh94s410A"",
      ""transport_address"" : ""127.0.0.1:37087"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""ml.machine_memory"" : ""126604296192"",
        ""ml.max_open_jobs"" : ""512"",
        ""xpack.installed"" : ""true"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""transform.node"" : ""true""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    }
  },
  ""metadata"" : {
    ""cluster_uuid"" : ""upGvfBNWRviN_O8sn9-pJg"",
    ""cluster_uuid_committed"" : true,
    ""cluster_coordination"" : {
      ""term"" : 3,
      ""last_committed_config"" : [
        ""snTotwKFQZ6zXVHyCSOMIw"",
        ""L-A50_QORHaisFrnjXNHwg"",
        ""aJOu_q1aTuy_bkCdMteq6g""
      ],
      ""last_accepted_config"" : [
        ""snTotwKFQZ6zXVHyCSOMIw"",
        ""L-A50_QORHaisFrnjXNHwg"",
        ""aJOu_q1aTuy_bkCdMteq6g""
      ],
      ""voting_config_exclusions"" : [ ]
    },
    ""templates"" : {
      "".monitoring-beats"" : {
        ""order"" : 0,
        ""version"" : 7140099,
        ""index_patterns"" : [
          "".monitoring-beats-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  }
                }
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""beats_stats"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""metrics"" : {
                    ""properties"" : {
                      ""system"" : {
                        ""properties"" : {
                          ""load"" : {
                            ""properties"" : {
                              ""1"" : {
                                ""type"" : ""double""
                              },
                              ""15"" : {
                                ""type"" : ""double""
                              },
                              ""5"" : {
                                ""type"" : ""double""
                              },
                              ""norm"" : {
                                ""properties"" : {
                                  ""1"" : {
                                    ""type"" : ""double""
                                  },
                                  ""15"" : {
                                    ""type"" : ""double""
                                  },
                                  ""5"" : {
                                    ""type"" : ""double""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""beat"" : {
                        ""properties"" : {
                          ""handles"" : {
                            ""properties"" : {
                              ""limit"" : {
                                ""properties"" : {
                                  ""hard"" : {
                                    ""type"" : ""long""
                                  },
                                  ""soft"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""open"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""cpu"" : {
                            ""properties"" : {
                              ""total"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""value"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""system"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""user"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""memstats"" : {
                            ""properties"" : {
                              ""rss"" : {
                                ""type"" : ""long""
                              },
                              ""gc_next"" : {
                                ""type"" : ""long""
                              },
                              ""memory_alloc"" : {
                                ""type"" : ""long""
                              },
                              ""memory_total"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""cgroup"" : {
                            ""properties"" : {
                              ""memory"" : {
                                ""properties"" : {
                                  ""mem"" : {
                                    ""properties"" : {
                                      ""usage"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""limit"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  }
                                }
                              },
                              ""cpu"" : {
                                ""properties"" : {
                                  ""cfs"" : {
                                    ""properties"" : {
                                      ""period"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""quota"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""stats"" : {
                                    ""properties"" : {
                                      ""periods"" : {
                                        ""type"" : ""long""
                                      },
                                      ""throttled"" : {
                                        ""properties"" : {
                                          ""ns"" : {
                                            ""type"" : ""long""
                                          },
                                          ""periods"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  }
                                }
                              },
                              ""cpuacct"" : {
                                ""properties"" : {
                                  ""total"" : {
                                    ""properties"" : {
                                      ""ns"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  }
                                }
                              }
                            }
                          },
                          ""info"" : {
                            ""properties"" : {
                              ""ephemeral_id"" : {
                                ""type"" : ""keyword""
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              },
                              ""uptime"" : {
                                ""properties"" : {
                                  ""ms"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""libbeat"" : {
                        ""properties"" : {
                          ""output"" : {
                            ""properties"" : {
                              ""read"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""type"" : {
                                ""type"" : ""keyword""
                              },
                              ""write"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""events"" : {
                                ""properties"" : {
                                  ""batches"" : {
                                    ""type"" : ""long""
                                  },
                                  ""duplicates"" : {
                                    ""type"" : ""long""
                                  },
                                  ""total"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""toomany"" : {
                                    ""type"" : ""long""
                                  },
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""pipeline"" : {
                            ""properties"" : {
                              ""clients"" : {
                                ""type"" : ""long""
                              },
                              ""events"" : {
                                ""properties"" : {
                                  ""total"" : {
                                    ""type"" : ""long""
                                  },
                                  ""filtered"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""published"" : {
                                    ""type"" : ""long""
                                  },
                                  ""retry"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""queue"" : {
                                ""properties"" : {
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""config"" : {
                            ""properties"" : {
                              ""module"" : {
                                ""properties"" : {
                                  ""running"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stops"" : {
                                    ""type"" : ""long""
                                  },
                                  ""starts"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reloads"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      },
                      ""apm-server"" : {
                        ""properties"" : {
                          ""server"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""concurrency"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""concurrent"" : {
                                ""properties"" : {
                                  ""wait"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""acm"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""notmodified"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""request"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""unset"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unavailable"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      },
                                      ""notfound"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""invalidquery"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""decoder"" : {
                            ""properties"" : {
                              ""deflate"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reader"" : {
                                ""properties"" : {
                                  ""size"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""gzip"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""uncompressed"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""missing-content-length"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""processor"" : {
                            ""properties"" : {
                              ""metric"" : {
                                ""properties"" : {
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""sourcemap"" : {
                                ""properties"" : {
                                  ""counter"" : {
                                    ""type"" : ""long""
                                  },
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""error"" : {
                                ""properties"" : {
                                  ""stacktraces"" : {
                                    ""type"" : ""long""
                                  },
                                  ""frames"" : {
                                    ""type"" : ""long""
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""transaction"" : {
                                ""properties"" : {
                                  ""stacktraces"" : {
                                    ""type"" : ""long""
                                  },
                                  ""spans"" : {
                                    ""type"" : ""long""
                                  },
                                  ""frames"" : {
                                    ""type"" : ""long""
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""transactions"" : {
                                    ""type"" : ""long""
                                  },
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""span"" : {
                                ""properties"" : {
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  ""tags"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""format"" : ""date_time"",
                    ""type"" : ""date""
                  }
                }
              },
              ""beats_state"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""state"" : {
                    ""properties"" : {
                      ""output"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""input"" : {
                        ""properties"" : {
                          ""names"" : {
                            ""type"" : ""keyword""
                          },
                          ""count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""service"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""id"" : {
                            ""type"" : ""keyword""
                          },
                          ""version"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""module"" : {
                        ""properties"" : {
                          ""names"" : {
                            ""type"" : ""keyword""
                          },
                          ""count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""beat"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""host"" : {
                        ""properties"" : {
                          ""hostname"" : {
                            ""type"" : ""keyword""
                          },
                          ""os"" : {
                            ""properties"" : {
                              ""build"" : {
                                ""type"" : ""keyword""
                              },
                              ""family"" : {
                                ""type"" : ""keyword""
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              },
                              ""platform"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""architecture"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""format"" : ""date_time"",
                    ""type"" : ""date""
                  }
                }
              },
              ""timestamp"" : {
                ""format"" : ""date_time"",
                ""type"" : ""date""
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-es"" : {
        ""order"" : 0,
        ""version"" : 7140099,
        ""index_patterns"" : [
          "".monitoring-es-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""date_detection"" : false,
            ""properties"" : {
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""enrich_coordinator_stats"" : {
                ""properties"" : {
                  ""executed_searches_total"" : {
                    ""type"" : ""long""
                  },
                  ""queue_size"" : {
                    ""type"" : ""integer""
                  },
                  ""remote_requests_current"" : {
                    ""type"" : ""long""
                  },
                  ""remote_requests_total"" : {
                    ""type"" : ""long""
                  },
                  ""node_id"" : {
                    ""type"" : ""keyword""
                  }
                }
              },
              ""ccr_auto_follow_stats"" : {
                ""properties"" : {
                  ""number_of_failed_remote_cluster_state_requests"" : {
                    ""type"" : ""long""
                  },
                  ""recent_auto_follow_errors"" : {
                    ""type"" : ""nested"",
                    ""properties"" : {
                      ""auto_follow_exception"" : {
                        ""type"" : ""object"",
                        ""properties"" : {
                          ""reason"" : {
                            ""type"" : ""text""
                          },
                          ""type"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""leader_index"" : {
                        ""type"" : ""keyword""
                      },
                      ""timestamp"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""number_of_failed_follow_indices"" : {
                    ""type"" : ""long""
                  },
                  ""number_of_successful_follow_indices"" : {
                    ""type"" : ""long""
                  },
                  ""auto_followed_clusters"" : {
                    ""type"" : ""nested"",
                    ""properties"" : {
                      ""cluster_name"" : {
                        ""type"" : ""keyword""
                      },
                      ""last_seen_metadata_version"" : {
                        ""type"" : ""long""
                      },
                      ""time_since_last_check_millis"" : {
                        ""type"" : ""long""
                      }
                    }
                  }
                }
              },
              ""ccr_stats"" : {
                ""properties"" : {
                  ""write_buffer_size_in_bytes"" : {
                    ""type"" : ""long""
                  },
                  ""leader_global_checkpoint"" : {
                    ""type"" : ""long""
                  },
                  ""read_exceptions"" : {
                    ""type"" : ""nested"",
                    ""properties"" : {
                      ""exception"" : {
                        ""type"" : ""object"",
                        ""properties"" : {
                          ""reason"" : {
                            ""type"" : ""text""
                          },
                          ""type"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""retries"" : {
                        ""type"" : ""integer""
                      },
                      ""from_seq_no"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""follower_index"" : {
                    ""type"" : ""keyword""
                  },
                  ""leader_max_seq_no"" : {
                    ""type"" : ""long""
                  },
                  ""last_requested_seq_no"" : {
                    ""type"" : ""long""
                  },
                  ""follower_settings_version"" : {
                    ""type"" : ""long""
                  },
                  ""successful_write_requests"" : {
                    ""type"" : ""long""
                  },
                  ""remote_cluster"" : {
                    ""type"" : ""keyword""
                  },
                  ""outstanding_write_requests"" : {
                    ""type"" : ""long""
                  },
                  ""total_read_time_millis"" : {
                    ""type"" : ""long""
                  },
                  ""outstanding_read_requests"" : {
                    ""type"" : ""long""
                  },
                  ""total_write_time_millis"" : {
                    ""type"" : ""long""
                  },
                  ""failed_write_requests"" : {
                    ""type"" : ""long""
                  },
                  ""failed_read_requests"" : {
                    ""type"" : ""long""
                  },
                  ""fatal_exception"" : {
                    ""type"" : ""object"",
                    ""properties"" : {
                      ""reason"" : {
                        ""type"" : ""text""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""bytes_read"" : {
                    ""type"" : ""long""
                  },
                  ""leader_index"" : {
                    ""type"" : ""keyword""
                  },
                  ""follower_max_seq_no"" : {
                    ""type"" : ""long""
                  },
                  ""operations_written"" : {
                    ""type"" : ""long""
                  },
                  ""write_buffer_operation_count"" : {
                    ""type"" : ""long""
                  },
                  ""successful_read_requests"" : {
                    ""type"" : ""long""
                  },
                  ""shard_id"" : {
                    ""type"" : ""integer""
                  },
                  ""follower_mapping_version"" : {
                    ""type"" : ""long""
                  },
                  ""follower_aliases_version"" : {
                    ""type"" : ""long""
                  },
                  ""follower_global_checkpoint"" : {
                    ""type"" : ""long""
                  },
                  ""total_read_remote_exec_time_millis"" : {
                    ""type"" : ""long""
                  },
                  ""operations_read"" : {
                    ""type"" : ""long""
                  },
                  ""time_since_last_read_millis"" : {
                    ""type"" : ""long""
                  }
                }
              },
              ""cluster_state"" : {
                ""properties"" : {
                  ""shards"" : {
                    ""type"" : ""object""
                  },
                  ""nodes_hash"" : {
                    ""type"" : ""integer""
                  },
                  ""nodes"" : {
                    ""type"" : ""object""
                  },
                  ""master_node"" : {
                    ""type"" : ""keyword""
                  },
                  ""state_uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""version"" : {
                    ""type"" : ""long""
                  },
                  ""status"" : {
                    ""type"" : ""keyword""
                  }
                }
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""indices_stats"" : {
                ""properties"" : {
                  ""_all"" : {
                    ""properties"" : {
                      ""primaries"" : {
                        ""properties"" : {
                          ""search"" : {
                            ""properties"" : {
                              ""query_total"" : {
                                ""type"" : ""long""
                              },
                              ""query_time_in_millis"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""docs"" : {
                            ""properties"" : {
                              ""count"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""indexing"" : {
                            ""properties"" : {
                              ""index_time_in_millis"" : {
                                ""type"" : ""long""
                              },
                              ""index_total"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      },
                      ""total"" : {
                        ""properties"" : {
                          ""search"" : {
                            ""properties"" : {
                              ""query_total"" : {
                                ""type"" : ""long""
                              },
                              ""query_time_in_millis"" : {
                                ""type"" : ""long""
                              }
                    ...
```",mark-vieira,closed,"[':Core/Infra/Core', '>test-failure', 'Team:Core/Infra', 'low-risk']",https://github.com/elastic/elasticsearch/issues/109454,2024-06-06T20:52:07Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/109454,"{
  ""application_resource"": ""yes""
}"
157,109409,"[CI] MvAppendTests testEvaluateBlockWithoutNulls {TestCase=<cartesian_shape>, <cartesian_shape>} failing","**Build Scans:**
- [elasticsearch-periodic #3030 / graalvm-ce17_checkpart3_java-matrix](https://gradle-enterprise.elastic.co/s/kspmf5tnfasba)
- [elasticsearch-pull-request #21515 / part-3](https://gradle-enterprise.elastic.co/s/4yfw7myjrplly)
- [elasticsearch-pull-request #21509 / part-3](https://gradle-enterprise.elastic.co/s/esrcdz2zlez5m)
- [elasticsearch-periodic-platform-support #2993 / rhel-8_platform-support-unix](https://gradle-enterprise.elastic.co/s/pfhes247y2coe)

**Reproduction Line:**
```
./gradlew ':x-pack:plugin:esql:test' --tests ""org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvAppendTests.testEvaluateBlockWithoutNulls {TestCase=<cartesian_shape>, <cartesian_shape>}"" -Dtests.seed=B4578B401A674D28 -Dtests.locale=es-UY -Dtests.timezone=SystemV/AST4 -Druntime.java=17
```

**Applicable branches:**
main

**Reproduces locally?:**
N/A

**Failure History:**
[See dashboard](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testEvaluateBlockWithoutNulls%20%7BTestCase%3D%3Ccartesian_shape%3E%2C%20%3Ccartesian_shape%3E%7D'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvAppendTests'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))

**Failure Message:**
```
java.lang.AssertionError: Test data is too large to fit in the memory
```

**Mute Reasons:**
- [main] 4 failures in test testEvaluateBlockWithoutNulls {TestCase=<cartesian_shape>, <cartesian_shape>} (3.1% fail rate)
- [main] 3.1% failure rate in test testEvaluateBlockWithoutNulls {TestCase=<cartesian_shape>, <cartesian_shape>} (3.1% fail rate)

**Note:**
This issue was created using new, in-development muting automation. Please mind any issues.",elasticsearchmachine,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'low-risk']",https://github.com/elastic/elasticsearch/issues/109409,2024-06-05T21:14:10Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/109409,"{
  ""application_resource"": ""yes""
}"
158,109373,MV_APPEND tests failing on geo_shape,"### CI Link

local

### Repro line

./gradlew ':x-pack:plugin:esql:test' --tests ""org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvAppendTests.testEvaluateBlockWithoutNulls {TestCase=<geo_shape>, <geo_shape>}"" -Dtests.seed=D9F77BE783139D12 -Dtests.locale=es-SV -Dtests.timezone=Europe/Riga -Druntime.java=22

### Does it reproduce?

Yes

### Applicable branches

main

### Failure history

_No response_

### Failure excerpt

```
  1> [2024-06-05T01:09:31,200][INFO ][o.e.x.e.e.f.s.m.MvAppendTests] [testEvaluateBlockWithoutNulls] [TestCase=<geo_shape>, <geo_shape>] after test
  2> REPRODUCE WITH: ./gradlew ':x-pack:plugin:esql:test' --tests ""org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvAppendTests.testEvaluateBlockWithoutNulls {TestCase=<geo_shape>, <geo_shape>}"" -Dtests.seed=D9F77BE783139D12 -Dtests.locale=es-SV -Dtests.timezone=Europe/Riga -Druntime.java=22
  2> java.lang.AssertionError: Test data is too large to fit in the memory
        at __randomizedtesting.SeedInfo.seed([D9F77BE783139D12:93E9D00A2A5B0AA6]:0)
        at org.junit.Assert.fail(Assert.java:89)
        at org.junit.Assert.assertTrue(Assert.java:42)
        at org.junit.Assert.assertFalse(Assert.java:65)
        at org.elasticsearch.xpack.esql.expression.function.AbstractFunctionTestCase.testEvaluateBlockWithoutNulls(AbstractFunctionTestCase.java:313)
        at java.base/jdk.internal.reflect.DirectMethodHandl
```

I think we need to limit the size of the shape a bit.",nik9000,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'low-risk']",https://github.com/elastic/elasticsearch/issues/109373,2024-06-04T22:11:02Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/109373,"{
  ""application_resource"": ""yes""
}"
159,109308,[Transform] Page search size does not increase when resources become available,"The fix for this has been released into 8.14.1+ and 8.15.0+

### Description

Transforms supports `max_page_search_size` during the search request.  While the Transform is encountering a circuit breaker exception due to out of memory, it will automatically lower the `max_page_search_size` and retry the request until it succeeds.  Transforms will then reuse that lowered search size until the node is restarted or the user updates the `max_page_search_size` setting.

We need to determine if it's wise to have the Transform try to raise the search size back up to the user's configured `max_page_search_size` after some amount of time, risking another round of circuit breaker exceptions.

1. What is the impact of causing a circuit breaker exception?
2. How much time does it add to the checkpoint to try to increase the search size to `max_page_search_size`?
3. Do we increase it to the configured `max_page_search_size` or to some value less than that on each checkpoint?
4. Do we instead want to save the lowered search size and/or inform the user that the transform is running under a lowered configured value?  

----------------------------------

As a workaround to this issue, there is a deprecated setting that the Transform will still read from at the end of a checkpoint:
```
""pivot"": {
    ""group_by"": {
        ...groups
    },
    ""aggregations"": {
        ...aggs
    },
    ""max_page_search_size"": 10000
}
```

Setting this configuration value will produce warnings during initiation, but the `max_page_search_size`  will reset to this value.

#109449 will reuse this code to reset to the specified value in the Transform Settings.  If you plan to use the deprecated value, then you should make sure it is the same as the value in `settings.max_page_search_size`.",prwhelan,closed,"['>bug', ':ml/Transform', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/109308,2024-06-03T16:13:02Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/109308,"{
  ""application_resource"": ""yes""
}"
160,108842,failed to create engine,"### Elasticsearch Version

7.17.13

### Installed Plugins

_No response_

### Java Version

openjdk 20.0.2 2023-07-18 OpenJDK Runtime Environment (build 20.0.2+9-78) OpenJDK 64-Bit Server VM (build 20.0.2+9-78, mixed mode, sharing)

### OS Version

centOS 7.8

### Problem Description

{""type"": ""server"", ""timestamp"": ""2024-05-21T01:32:09,968Z"", ""level"": ""WARN"", ""component"": ""o.e.i.t.Translog"", ""cluster.name"": ""docker-cluster"", ""node.name"": ""elasticsearch-bf9ddf677-x2m42"", ""message"": "" [records-all-20240521][0] failed to delete temp file /usr/share/elasticsearch/data/nodes/0/indices/KTLY3cJkR5CWKQvVKUeFEg/0/translog/translog-10626317916496319544.ckp"", ""cluster.uuid"": ""3ryH_a0PQUGfor5v_I8cTA"", ""node.id"": ""_6YccP_mRDaSZKx5UaR1PQ"" , 
""stacktrace"": [""java.nio.file.NoSuchFileException: /usr/share/elasticsearch/data/nodes/0/indices/KTLY3cJkR5CWKQvVKUeFEg/0/translog/translog-10626317916496319544.ckp"",
""at sun.nio.fs.UnixException.translateToIOException(UnixException.java:92) ~[?:?]"",
""at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:106) ~[?:?]"",
""at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111) ~[?:?]"",
""at sun.nio.fs.UnixFileSystemProvider.implDelete(UnixFileSystemProvider.java:291) ~[?:?]"",
""at sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:104) ~[?:?]"",
""at java.nio.file.Files.delete(Files.java:1151) ~[?:?]"",
""at org.elasticsearch.index.translog.Translog.copyCheckpointTo(Translog.java:310) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.translog.Translog.recoverFromFiles(Translog.java:282) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.translog.Translog.<init>(Translog.java:188) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.openTranslog(InternalEngine.java:546) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:226) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:199) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2064) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:2028) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:472) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:90) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:436) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:88) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:2361) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:62) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:777) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) [elasticsearch-7.17.13.jar:7.17.13]"",
""at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) [?:?]"",
""at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) [?:?]"",
""at java.lang.Thread.run(Thread.java:1623) [?:?]""] }
{""type"": ""server"", ""timestamp"": ""2024-05-21T01:32:10,046Z"", ""level"": ""WARN"", ""component"": ""o.e.i.c.IndicesClusterStateService"", ""cluster.name"": ""docker-cluster"", ""node.name"": ""elasticsearch-bf9ddf677-x2m42"", ""message"": ""[records-all-20240521][3] marking and sending shard failed due to [failed recovery]"", ""cluster.uuid"": ""3ryH_a0PQUGfor5v_I8cTA"", ""node.id"": ""_6YccP_mRDaSZKx5UaR1PQ"" , 
""stacktrace"": [""org.elasticsearch.indices.recovery.RecoveryFailedException: [sw_records-all-20240521][3]: Recovery failed on {elasticsearch-bf9ddf677-x2m42}{_6YccP_mRDaSZKx5UaR1PQ}{DM4GX44TSqu_35UFlD2iAQ}{10.42.0.34}{10.42.0.34:9300}{cdfhilmrstw}{ml.machine_memory=6442450944, xpack.installed=true, transform.node=true, ml.max_open_jobs=512, ml.max_jvm_size=2147483648}"",
""at org.elasticsearch.index.shard.IndexShard.lambda$executeRecovery$21(IndexShard.java:3246) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:144) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.lambda$recoveryListener$6(StoreRecovery.java:385) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:144) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:439) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:88) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:2361) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:62) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:777) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) [elasticsearch-7.17.13.jar:7.17.13]"",
""at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) [?:?]"",
""at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) [?:?]"",
""at java.lang.Thread.run(Thread.java:1623) [?:?]"",
""Caused by: org.elasticsearch.index.shard.IndexShardRecoveryException: failed to recover from gateway"",
""at org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:477) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:90) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:436) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""... 8 more"",
""Caused by: org.elasticsearch.index.engine.EngineCreationFailureException: failed to create engine"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:251) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:199) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2064) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:2028) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:472) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:90) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:436) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""... 8 more"",
""Caused by: java.io.IOException: Operation not supported"",
""at sun.nio.fs.LinuxNativeDispatcher.directCopy0(Native Method) ~[?:?]"",
""at sun.nio.fs.LinuxFileSystem.directCopy(LinuxFileSystem.java:159) ~[?:?]"",
""at sun.nio.fs.UnixFileSystem.copyFile(UnixFileSystem.java:683) ~[?:?]"",
""at sun.nio.fs.UnixFileSystem.copy(UnixFileSystem.java:1061) ~[?:?]"",
""at sun.nio.fs.UnixFileSystemProvider.copy(UnixFileSystemProvider.java:300) ~[?:?]"",
""at java.nio.file.Files.copy(Files.java:1303) ~[?:?]"",
""at org.elasticsearch.index.translog.Translog.copyCheckpointTo(Translog.java:301) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.translog.Translog.recoverFromFiles(Translog.java:282) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.translog.Translog.<init>(Translog.java:188) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.openTranslog(InternalEngine.java:546) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:226) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:199) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2064) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:2028) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:472) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:90) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:436) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""... 8 more""] }

### Steps to Reproduce

""type"": ""server"", ""timestamp"": ""2024-05-21T01:27:20,854Z"", ""level"": ""INFO"", ""component"": ""o.e.e.NodeEnvironment"", ""cluster.name"": ""docker-cluster"", ""node.name"": ""elasticsearch-bf9ddf677-x2m42"", ""message"": ""using [1] data paths, mounts [[/usr/share/elasticsearch/data (nfs-server-hostname:/var/nfs-share/elasticsearch-data-volume-pvc-2a8071cb-73a4-46d3-9bd1-1b32a45dcd55)]], net usable_space [151.9gb], net total_space [165.8gb], types [nfs4]"" }

### Logs (if relevant)

{""type"": ""server"", ""timestamp"": ""2024-05-21T01:32:09,968Z"", ""level"": ""WARN"", ""component"": ""o.e.i.t.Translog"", ""cluster.name"": ""docker-cluster"", ""node.name"": ""elasticsearch-bf9ddf677-x2m42"", ""message"": "" [records-all-20240521][0] failed to delete temp file /usr/share/elasticsearch/data/nodes/0/indices/KTLY3cJkR5CWKQvVKUeFEg/0/translog/translog-10626317916496319544.ckp"", ""cluster.uuid"": ""3ryH_a0PQUGfor5v_I8cTA"", ""node.id"": ""_6YccP_mRDaSZKx5UaR1PQ"" , 
""stacktrace"": [""java.nio.file.NoSuchFileException: /usr/share/elasticsearch/data/nodes/0/indices/KTLY3cJkR5CWKQvVKUeFEg/0/translog/translog-10626317916496319544.ckp"",
""at sun.nio.fs.UnixException.translateToIOException(UnixException.java:92) ~[?:?]"",
""at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:106) ~[?:?]"",
""at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111) ~[?:?]"",
""at sun.nio.fs.UnixFileSystemProvider.implDelete(UnixFileSystemProvider.java:291) ~[?:?]"",
""at sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:104) ~[?:?]"",
""at java.nio.file.Files.delete(Files.java:1151) ~[?:?]"",
""at org.elasticsearch.index.translog.Translog.copyCheckpointTo(Translog.java:310) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.translog.Translog.recoverFromFiles(Translog.java:282) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.translog.Translog.<init>(Translog.java:188) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.openTranslog(InternalEngine.java:546) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:226) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:199) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2064) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:2028) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:472) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:90) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:436) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:88) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:2361) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:62) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:777) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) [elasticsearch-7.17.13.jar:7.17.13]"",
""at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) [?:?]"",
""at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) [?:?]"",
""at java.lang.Thread.run(Thread.java:1623) [?:?]""] }
{""type"": ""server"", ""timestamp"": ""2024-05-21T01:32:10,046Z"", ""level"": ""WARN"", ""component"": ""o.e.i.c.IndicesClusterStateService"", ""cluster.name"": ""docker-cluster"", ""node.name"": ""elasticsearch-bf9ddf677-x2m42"", ""message"": ""[records-all-20240521][3] marking and sending shard failed due to [failed recovery]"", ""cluster.uuid"": ""3ryH_a0PQUGfor5v_I8cTA"", ""node.id"": ""_6YccP_mRDaSZKx5UaR1PQ"" , 
""stacktrace"": [""org.elasticsearch.indices.recovery.RecoveryFailedException: [sw_records-all-20240521][3]: Recovery failed on {elasticsearch-bf9ddf677-x2m42}{_6YccP_mRDaSZKx5UaR1PQ}{DM4GX44TSqu_35UFlD2iAQ}{10.42.0.34}{10.42.0.34:9300}{cdfhilmrstw}{ml.machine_memory=6442450944, xpack.installed=true, transform.node=true, ml.max_open_jobs=512, ml.max_jvm_size=2147483648}"",
""at org.elasticsearch.index.shard.IndexShard.lambda$executeRecovery$21(IndexShard.java:3246) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:144) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.lambda$recoveryListener$6(StoreRecovery.java:385) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:144) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:439) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:88) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:2361) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:62) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:777) [elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) [elasticsearch-7.17.13.jar:7.17.13]"",
""at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) [?:?]"",
""at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) [?:?]"",
""at java.lang.Thread.run(Thread.java:1623) [?:?]"",
""Caused by: org.elasticsearch.index.shard.IndexShardRecoveryException: failed to recover from gateway"",
""at org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:477) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:90) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:436) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""... 8 more"",
""Caused by: org.elasticsearch.index.engine.EngineCreationFailureException: failed to create engine"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:251) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:199) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2064) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:2028) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:472) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:90) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:436) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""... 8 more"",
""Caused by: java.io.IOException: Operation not supported"",
""at sun.nio.fs.LinuxNativeDispatcher.directCopy0(Native Method) ~[?:?]"",
""at sun.nio.fs.LinuxFileSystem.directCopy(LinuxFileSystem.java:159) ~[?:?]"",
""at sun.nio.fs.UnixFileSystem.copyFile(UnixFileSystem.java:683) ~[?:?]"",
""at sun.nio.fs.UnixFileSystem.copy(UnixFileSystem.java:1061) ~[?:?]"",
""at sun.nio.fs.UnixFileSystemProvider.copy(UnixFileSystemProvider.java:300) ~[?:?]"",
""at java.nio.file.Files.copy(Files.java:1303) ~[?:?]"",
""at org.elasticsearch.index.translog.Translog.copyCheckpointTo(Translog.java:301) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.translog.Translog.recoverFromFiles(Translog.java:282) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.translog.Translog.<init>(Translog.java:188) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.openTranslog(InternalEngine.java:546) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:226) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:199) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2064) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:2028) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:472) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:90) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:436) ~[elasticsearch-7.17.13.jar:7.17.13]"",
""... 8 more""] }",Sic9527,closed,"['>bug', ':Distributed Indexing/Recovery', 'Team:Distributed (Obsolete)']",https://github.com/elastic/elasticsearch/issues/108842,2024-05-21T06:09:51Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/108842,"{
  ""application_resource"": ""yes""
}"
161,108659,Boolean query performance regression after upgrading to 8.13.2 (from 8.7.1),"### Elasticsearch Version

8.13.2

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

official docker image

### Problem Description

After upgrading from 8.7.1 to 8.13.2, some of our queries got slower.

After digging, I've identified that a simple boolean query is getting slower on 8.13.2. It seems `create_weight` step is taking about 2x-5x duration as you can see in the profiles I've shared the below. The difference may seem tiny but it makes my production query about 5x times slower as my query has nearly a hundred ""should"" clauses.

We are running ES on K8S using ECK but it can be reproducible with docker environments.

I've tested with several ES versions (w/ docker) and I'm assuming that this issue was introduced at 8.12.0. I also confirmed this issue is not fixed with the latest 8.13.4.

8.7.1 profile output
```
--- 1st RUN ---
{
  ""took"" : 36,
  ""timed_out"" : false,
  ""_shards"" : {
    ""total"" : 1,
    ""successful"" : 1,
    ""skipped"" : 0,
    ""failed"" : 0
  },
  ""hits"" : {
    ""total"" : {
      ""value"" : 0,
      ""relation"" : ""eq""
    },
    ""max_score"" : null,
    ""hits"" : [ ]
  },
  ""profile"" : {
    ""shards"" : [
      {
        ""id"" : ""[_4V8ixH1R_yrjsWYEDhRwQ][test_index][0]"",
        ""searches"" : [
          {
            ""query"" : [
              {
                ""type"" : ""TermQuery"",
                ""description"" : ""test_text:ewobzemoud"",
                ""time_in_nanos"" : 890916,
                ""breakdown"" : {
                  ""set_min_competitive_score_count"" : 0,
                  ""match_count"" : 0,
                  ""shallow_advance_count"" : 0,
                  ""set_min_competitive_score"" : 0,
                  ""next_doc"" : 0,
                  ""match"" : 0,
                  ""next_doc_count"" : 0,
                  ""score_count"" : 0,
                  ""compute_max_score_count"" : 0,
                  ""compute_max_score"" : 0,
                  ""advance"" : 0,
                  ""advance_count"" : 0,
                  ""count_weight_count"" : 0,
                  ""score"" : 0,
                  ""build_scorer_count"" : 2,
                  ""create_weight"" : 887875,
                  ""shallow_advance"" : 0,
                  ""count_weight"" : 0,
                  ""create_weight_count"" : 1,
                  ""build_scorer"" : 3041
                }
              }
            ],
            ""rewrite_time"" : 224292,
            ""collector"" : [
              {
                ""name"" : ""SimpleTopScoreDocCollector"",
                ""reason"" : ""search_top_hits"",
                ""time_in_nanos"" : 192418
              }
            ]
          }
        ],
        ""aggregations"" : [ ]
      }
    ]
  }
}
--- 2nd RUN ---
{
  ""took"" : 2,
  ""timed_out"" : false,
  ""_shards"" : {
    ""total"" : 1,
    ""successful"" : 1,
    ""skipped"" : 0,
    ""failed"" : 0
  },
  ""hits"" : {
    ""total"" : {
      ""value"" : 0,
      ""relation"" : ""eq""
    },
    ""max_score"" : null,
    ""hits"" : [ ]
  },
  ""profile"" : {
    ""shards"" : [
      {
        ""id"" : ""[_4V8ixH1R_yrjsWYEDhRwQ][test_index][0]"",
        ""searches"" : [
          {
            ""query"" : [
              {
                ""type"" : ""TermQuery"",
                ""description"" : ""test_text:ewobzemoud"",
                ""time_in_nanos"" : 233750,
                ""breakdown"" : {
                  ""set_min_competitive_score_count"" : 0,
                  ""match_count"" : 0,
                  ""shallow_advance_count"" : 0,
                  ""set_min_competitive_score"" : 0,
                  ""next_doc"" : 0,
                  ""match"" : 0,
                  ""next_doc_count"" : 0,
                  ""score_count"" : 0,
                  ""compute_max_score_count"" : 0,
                  ""compute_max_score"" : 0,
                  ""advance"" : 0,
                  ""advance_count"" : 0,
                  ""count_weight_count"" : 0,
                  ""score"" : 0,
                  ""build_scorer_count"" : 2,
                  ""create_weight"" : 232583,
                  ""shallow_advance"" : 0,
                  ""count_weight"" : 0,
                  ""create_weight_count"" : 1,
                  ""build_scorer"" : 1167
                }
              }
            ],
            ""rewrite_time"" : 4625,
            ""collector"" : [
              {
                ""name"" : ""SimpleTopScoreDocCollector"",
                ""reason"" : ""search_top_hits"",
                ""time_in_nanos"" : 2416
              }
            ]
          }
        ],
        ""aggregations"" : [ ]
      }
    ]
  }
}
--- 3rd RUN ---
{
  ""took"" : 1,
  ""timed_out"" : false,
  ""_shards"" : {
    ""total"" : 1,
    ""successful"" : 1,
    ""skipped"" : 0,
    ""failed"" : 0
  },
  ""hits"" : {
    ""total"" : {
      ""value"" : 0,
      ""relation"" : ""eq""
    },
    ""max_score"" : null,
    ""hits"" : [ ]
  },
  ""profile"" : {
    ""shards"" : [
      {
        ""id"" : ""[_4V8ixH1R_yrjsWYEDhRwQ][test_index][0]"",
        ""searches"" : [
          {
            ""query"" : [
              {
                ""type"" : ""TermQuery"",
                ""description"" : ""test_text:ewobzemoud"",
                ""time_in_nanos"" : 87959,
                ""breakdown"" : {
                  ""set_min_competitive_score_count"" : 0,
                  ""match_count"" : 0,
                  ""shallow_advance_count"" : 0,
                  ""set_min_competitive_score"" : 0,
                  ""next_doc"" : 0,
                  ""match"" : 0,
                  ""next_doc_count"" : 0,
                  ""score_count"" : 0,
                  ""compute_max_score_count"" : 0,
                  ""compute_max_score"" : 0,
                  ""advance"" : 0,
                  ""advance_count"" : 0,
                  ""count_weight_count"" : 0,
                  ""score"" : 0,
                  ""build_scorer_count"" : 2,
                  ""create_weight"" : 87042,
                  ""shallow_advance"" : 0,
                  ""count_weight"" : 0,
                  ""create_weight_count"" : 1,
                  ""build_scorer"" : 917
                }
              }
            ],
            ""rewrite_time"" : 4917,
            ""collector"" : [
              {
                ""name"" : ""SimpleTopScoreDocCollector"",
                ""reason"" : ""search_top_hits"",
                ""time_in_nanos"" : 1625
              }
            ]
          }
        ],
        ""aggregations"" : [ ]
      }
    ]
  }
}
```

8.13.2 profile output
```
--- 1st RUN ---
{
  ""took"" : 42,
  ""timed_out"" : false,
  ""_shards"" : {
    ""total"" : 1,
    ""successful"" : 1,
    ""skipped"" : 0,
    ""failed"" : 0
  },
  ""hits"" : {
    ""total"" : {
      ""value"" : 0,
      ""relation"" : ""eq""
    },
    ""max_score"" : null,
    ""hits"" : [ ]
  },
  ""profile"" : {
    ""shards"" : [
      {
        ""id"" : ""[4hvhIe0hSMSfEx6hxP5a6A][test_index][0]"",
        ""node_id"" : ""4hvhIe0hSMSfEx6hxP5a6A"",
        ""shard_id"" : 0,
        ""index"" : ""test_index"",
        ""cluster"" : ""(local)"",
        ""searches"" : [
          {
            ""query"" : [
              {
                ""type"" : ""TermQuery"",
                ""description"" : ""test_text:ewobzemoud"",
                ""time_in_nanos"" : 2038668,
                ""breakdown"" : {
                  ""set_min_competitive_score_count"" : 0,
                  ""match_count"" : 0,
                  ""shallow_advance_count"" : 0,
                  ""set_min_competitive_score"" : 0,
                  ""next_doc"" : 0,
                  ""match"" : 0,
                  ""next_doc_count"" : 0,
                  ""score_count"" : 0,
                  ""compute_max_score_count"" : 0,
                  ""compute_max_score"" : 0,
                  ""advance"" : 0,
                  ""advance_count"" : 0,
                  ""count_weight_count"" : 0,
                  ""score"" : 0,
                  ""build_scorer_count"" : 2,
                  ""create_weight"" : 2033959,
                  ""shallow_advance"" : 0,
                  ""count_weight"" : 0,
                  ""create_weight_count"" : 1,
                  ""build_scorer"" : 4709
                }
              }
            ],
            ""rewrite_time"" : 256125,
            ""collector"" : [
              {
                ""name"" : ""QueryPhaseCollector"",
                ""reason"" : ""search_query_phase"",
                ""time_in_nanos"" : 398167,
                ""children"" : [
                  {
                    ""name"" : ""SimpleTopScoreDocCollector"",
                    ""reason"" : ""search_top_hits"",
                    ""time_in_nanos"" : 253542
                  }
                ]
              }
            ]
          }
        ],
        ""aggregations"" : [ ]
      }
    ]
  }
}
--- 2nd RUN ---
{
  ""took"" : 3,
  ""timed_out"" : false,
  ""_shards"" : {
    ""total"" : 1,
    ""successful"" : 1,
    ""skipped"" : 0,
    ""failed"" : 0
  },
  ""hits"" : {
    ""total"" : {
      ""value"" : 0,
      ""relation"" : ""eq""
    },
    ""max_score"" : null,
    ""hits"" : [ ]
  },
  ""profile"" : {
    ""shards"" : [
      {
        ""id"" : ""[4hvhIe0hSMSfEx6hxP5a6A][test_index][0]"",
        ""node_id"" : ""4hvhIe0hSMSfEx6hxP5a6A"",
        ""shard_id"" : 0,
        ""index"" : ""test_index"",
        ""cluster"" : ""(local)"",
        ""searches"" : [
          {
            ""query"" : [
              {
                ""type"" : ""TermQuery"",
                ""description"" : ""test_text:ewobzemoud"",
                ""time_in_nanos"" : 537083,
                ""breakdown"" : {
                  ""set_min_competitive_score_count"" : 0,
                  ""match_count"" : 0,
                  ""shallow_advance_count"" : 0,
                  ""set_min_competitive_score"" : 0,
                  ""next_doc"" : 0,
                  ""match"" : 0,
                  ""next_doc_count"" : 0,
                  ""score_count"" : 0,
                  ""compute_max_score_count"" : 0,
                  ""compute_max_score"" : 0,
                  ""advance"" : 0,
                  ""advance_count"" : 0,
                  ""count_weight_count"" : 0,
                  ""score"" : 0,
                  ""build_scorer_count"" : 2,
                  ""create_weight"" : 535791,
                  ""shallow_advance"" : 0,
                  ""count_weight"" : 0,
                  ""create_weight_count"" : 1,
                  ""build_scorer"" : 1292
                }
              }
            ],
            ""rewrite_time"" : 5917,
            ""collector"" : [
              {
                ""name"" : ""QueryPhaseCollector"",
                ""reason"" : ""search_query_phase"",
                ""time_in_nanos"" : 7082,
                ""children"" : [
                  {
                    ""name"" : ""SimpleTopScoreDocCollector"",
                    ""reason"" : ""search_top_hits"",
                    ""time_in_nanos"" : 2667
                  }
                ]
              }
            ]
          }
        ],
        ""aggregations"" : [ ]
      }
    ]
  }
}
--- 3rd RUN ---
{
  ""took"" : 2,
  ""timed_out"" : false,
  ""_shards"" : {
    ""total"" : 1,
    ""successful"" : 1,
    ""skipped"" : 0,
    ""failed"" : 0
  },
  ""hits"" : {
    ""total"" : {
      ""value"" : 0,
      ""relation"" : ""eq""
    },
    ""max_score"" : null,
    ""hits"" : [ ]
  },
  ""profile"" : {
    ""shards"" : [
      {
        ""id"" : ""[4hvhIe0hSMSfEx6hxP5a6A][test_index][0]"",
        ""node_id"" : ""4hvhIe0hSMSfEx6hxP5a6A"",
        ""shard_id"" : 0,
        ""index"" : ""test_index"",
        ""cluster"" : ""(local)"",
        ""searches"" : [
          {
            ""query"" : [
              {
                ""type"" : ""TermQuery"",
                ""description"" : ""test_text:ewobzemoud"",
                ""time_in_nanos"" : 469417,
                ""breakdown"" : {
                  ""set_min_competitive_score_count"" : 0,
                  ""match_count"" : 0,
                  ""shallow_advance_count"" : 0,
                  ""set_min_competitive_score"" : 0,
                  ""next_doc"" : 0,
                  ""match"" : 0,
                  ""next_doc_count"" : 0,
                  ""score_count"" : 0,
                  ""compute_max_score_count"" : 0,
                  ""compute_max_score"" : 0,
                  ""advance"" : 0,
                  ""advance_count"" : 0,
                  ""count_weight_count"" : 0,
                  ""score"" : 0,
                  ""build_scorer_count"" : 2,
                  ""create_weight"" : 468292,
                  ""shallow_advance"" : 0,
                  ""count_weight"" : 0,
                  ""create_weight_count"" : 1,
                  ""build_scorer"" : 1125
                }
              }
            ],
            ""rewrite_time"" : 5167,
            ""collector"" : [
              {
                ""name"" : ""QueryPhaseCollector"",
                ""reason"" : ""search_query_phase"",
                ""time_in_nanos"" : 6625,
                ""children"" : [
                  {
                    ""name"" : ""SimpleTopScoreDocCollector"",
                    ""reason"" : ""search_top_hits"",
                    ""time_in_nanos"" : 2417
                  }
                ]
              }
            ]
          }
        ],
        ""aggregations"" : [ ]
      }
    ]
  }
}
```

### Steps to Reproduce

#### Prepare

Index template (`index_template.json`)
```
% cat index_template.json 
{
  ""index_patterns"": [""test*""],
  ""mappings"": {
    ""properties"": {
      ""test_text"": {
          ""type"": ""text""
      }
    }
  }
}
```

query (`query.json`)
```
% cat query.json 
{""profile"": true, ""query"": {""bool"": {""should"": [{""match"": {""test_text"": ""ewobzemoud""}}]}}}
```

test data (`bulk_requests.json`)
https://raw.githubusercontent.com/shimpeko/es_named_query_perf/main/bulk_requests.json
note: The file is prepared for different issue but can also be used for this issue.

test case (`commands.sh`)
```
% cat commands.sh 
#!/bin/bash

curl -X GET http://localhost:19200/_cluster/health?wait_for_status=green&timeout=30s
curl -X DELETE http://localhost:19200/_template/template_1
curl -X PUT http://localhost:19200/_template/template_1 -H 'Content-Type: application/json' --data ""@index_template.json""
curl -X DELETE http://localhost:19200/test_index
curl -X PUT http://localhost:19200/test_index
curl -s -X POST http://localhost:19200/test_index/_bulk/?refresh=wait_for -H 'Content-Type: application/json' --data-binary ""@bulk_requests.json"" > /dev/null
curl -X GET http://localhost:19200/test_index/_mappings
echo """"
echo """"
echo ""--- 1st RUN ---""
curl -X POST http://localhost:19200/test_index/_search?pretty=true -H 'Content-Type: application/json' --data ""@query.json""
echo ""--- 2nd RUN ---""
curl -X POST http://localhost:19200/test_index/_search?pretty=true -H 'Content-Type: application/json' --data ""@query.json""
echo ""--- 3rd RUN ---""
curl -X POST http://localhost:19200/test_index/_search?pretty=true -H 'Content-Type: application/json' --data ""@query.json""
```

Run for 8.7.1
```
% cat docker-compose-8-7.yaml 
services:
  elastic:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.7.1
    environment:
    - node.name=myes
    - bootstrap.memory_lock=true
    - cluster.initial_master_nodes=myes
    - cluster.name=myes
    - ES_JAVA_OPTS=-Xms1g -Xmx1g -Dlog4j2.formatMsgNoLookups=true
    - xpack.security.enabled=false
    - action.destructive_requires_name=false
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    ports:
    - ""19200:9200""
% docker compose -f docker-compose-8-7.yaml up -d
% ./commands.sh
```

Run for 8.13.2
```
% cat docker-compose-8-13.yaml 
services:
  elastic:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.13.2
    environment:
    - node.name=myes
    - bootstrap.memory_lock=true
    - cluster.initial_master_nodes=myes
    - cluster.name=myes
    - ES_JAVA_OPTS=-Xms1g -Xmx1g -Dlog4j2.formatMsgNoLookups=true
    - xpack.security.enabled=false
    - action.destructive_requires_name=false
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    ports:
    - ""19200:9200""
% docker compose -f docker-compose-8-13.yaml up -d
% ./commands.sh
```

You can see a significant different in the ""took"" value with a larger query like [query.json Â· GitHub](https://gist.github.com/shimpeko/cf3a34a5efe5973ca63cb1bb27a0cd1a).

### Logs (if relevant)

_No response_",shimpeko,closed,"['>bug', 'priority:high', 'Team:Search Relevance', ':Search Relevance/Search']",https://github.com/elastic/elasticsearch/issues/108659,2024-05-15T06:52:55Z,12,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/108659,"{
  ""application_resource"": ""unsure""
}"
162,108457,Circuit breaker OOMÂ ,"Recently while tracking an OOM in a serverless project, we found the following:

![image (4)](https://github.com/elastic/elasticsearch/assets/114451/62043199-3f7e-4bc4-88e4-e5ef64d93c85)

The OOM was caused by line 769 of HierarchyCircuitBreakerService, which is:

```
return new TriggerGCResult(canPerformGC, allocationIndex, allocationDuration, begin - lastCheckTime)
```

This is a record with four primitive values, so very low memory usage. But even so it was enough to push us to OOM, and if one thing should never OOM, it is the circuit breaker. Perhaps this, and similar code, can be made more memory safe with re-using the object, or pre-allocated object pool.
",craigtaverner,closed,"['>bug', ':Core/Infra/Resiliency', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/108457,2024-05-09T13:04:40Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/108457,"{
  ""application_resource"": ""yes""
}"
163,108381,Prohibit creation of rollup jobs in clusters that have never used rollup.,"The rollup feature was never GA-ed and is still tech preview. It has been deprecated since 8.11.0 in favor of downsampling. At some point the rollup functionality will be removed. In order to prepare for the removal of rollup, the creation of rollup in clusters with no rollup usage will be prohibited. To avoid any new usages of rollup while it is scheduled to be removed.",martijnvg,closed,"[':StorageEngine/Rollup', '>tech debt', 'Team:StorageEngine']",https://github.com/elastic/elasticsearch/issues/108381,2024-05-07T16:59:38Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/108381,"{
  ""application_resource"": ""unsure""
}"
164,108104,ES|QL: HeapAttack.testTooManyEval failing on serverless,"Non-deterministic failure on Serverless. A node goes down, most likely for memory pressure, but there is no OOM in the logs

```
./gradlew ':qa:stateful:test:external-modules:test-esql-heap-attack:javaRestTest' --tests ""org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.testTooManyEval"" -Dtests.seed=63D2A017E5A8CBE2 -Dtests.locale=es-PA -Dtests.timezone=America/Virgin -Druntime.java=21

```

```
org.elasticsearch.client.ResponseException: method [GET], host [http://[::1]:41855], URI [/_nodes/stats], status line [HTTP/1.1 503 Service Unavailable]
{""error"":{""root_cause"":[{""type"":""master_not_discovered_exception"",""reason"":null}],""type"":""master_not_discovered_exception"",""reason"":null},""status"":503}

  at org.elasticsearch.client.RestClient.convertResponse(RestClient.java:351)
  at org.elasticsearch.client.RestClient.performRequest(RestClient.java:317)
  at org.elasticsearch.client.RestClient.performRequest(RestClient.java:323)
  at org.elasticsearch.client.RestClient.performRequest(RestClient.java:307)
  at org.elasticsearch.client.RestClient.performRequest(RestClient.java:292)
  at org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.lambda$assertRequestBreakerEmpty$10(HeapAttackIT.java:574)
  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:1265)
  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:1250)
  at org.elasticsearch.xpack.esql.heap_attack.HeapAttackIT.assertRequestBreakerEmpty(HeapAttackIT.java:573)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:1004)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.elasticsearch.test.cluster.local.DefaultLocalElasticsearchCluster$1.evaluate(DefaultLocalElasticsearchCluster.java:47)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)
```",luigidellaquila,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/108104,2024-04-30T16:39:52Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/108104,"{
  ""application_resource"": ""yes""
}"
165,107933,insert data error when start es with docker in nas,"### Elasticsearch Version

8.11.1

### Installed Plugins

_No response_

### Java Version

docker run

### OS Version

docker run

### Problem Description

docker version 20.10.9
Docker Compose version v2.26.1

docker compose
```yaml
name: es-single-test-bak

services:
 elasticsearch:
  image: elasticsearch:8.11.1
  restart: always
  hostname: es1
  container_name: es-single-test-bak
  volumes:
   - ${DOCKER_VOLUME_DIRECTORY:-.}/es/data:/usr/share/elasticsearch/data
   - ${DOCKER_VOLUME_DIRECTORY:-.}/es/plugins:/usr/share/elasticsearch/plugins
   #- ${DOCKER_VOLUME_DIRECTORY:-.}/es/config:/usr/share/elasticsearch/config
  environment:
   - ""ES_JAVA_OPTS=-Xms512m -Xmx512m""
   - discovery.type=single-node
   - ELASTIC_PASSWORD=xxxxxx
   - xpack.security.enabled=false
   - bootstrap.memory_lock=true
  
  ports:
    - '8921:9200'     #javaã€é›†ç¾¤é€šä¿¡ç«¯å£
    - '8931:9300'     #httpé€šä¿¡ç«¯å£
  privileged: true    #çŽ¯å¢ƒå˜é‡
```

df -h
```
df -h
Filesystem                                                        Size  Used Avail Use% Mounted on
devtmpfs                                                           32G     0   32G   0% /dev
tmpfs                                                              32G     0   32G   0% /dev/shm
tmpfs                                                              32G   27M   32G   1% /run
tmpfs                                                              32G     0   32G   0% /sys/fs/cgroup
/dev/vda3                                                          46G  7.2G   39G  16% /
/dev/vda1                                                         497M  134M  363M  27% /boot
xxxxnas.cucloud.cn:/xxx  1.0P  3.3T 1021T   1% /data
```
df -T
```
Filesystem                                                       Type         1K-blocks       Used     Available Use% Mounted on
devtmpfs                                                         devtmpfs      32889124          0      32889124   0% /dev
tmpfs                                                            tmpfs         32899588          0      32899588   0% /dev/shm
tmpfs                                                            tmpfs         32899588      27100      32872488   1% /run
tmpfs                                                            tmpfs         32899588          0      32899588   0% /sys/fs/cgroup
/dev/vda3                                                        xfs           47698172    7538576      40159596  16% /
/dev/vda1                                                        xfs             508580     137108        371472  27% /boot
xxxxnas.cucloud.cn:/xxx  nfs4     1099511627776 3470503936 1096041123840   1% /data
```




### Steps to Reproduce

I use Docker Compose to start Elasticsearch, mounting the data disk to the NAS. It starts without any problem, but when inserting or migrating data from another machine, it reports an error.


migrating data 

```
docker run --rm -ti elasticdump/elasticsearch-dump \
  --input=http://xxxx:7921/intell_chat_test \
  --output=http://xxxx:8921/intell_chat_test \
	
  --type=data
```

log
```
{""@timestamp"":""2024-04-25T03:28:24.211Z"", ""log.level"": ""WARN"", ""message"":""[intell_chat_test][0] marking and sending shard failed due to [failed recovery]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[es1][generic][T#2]"",""log.logger"":""org.elasticsearch.indices.cluster.IndicesClusterStateService"",""elasticsearch.cluster.uuid"":""mZhqTRk-SyiKX-e6Eb8AEA"",""elasticsearch.node.id"":""NnwjE30dSJuiLDRaJJilhA"",""elasticsearch.node.name"":""es1"",""elasticsearch.cluster.name"":""docker-cluster"",""error.type"":""org.elasticsearch.indices.recovery.RecoveryFailedException"",""error.message"":""[intell_chat_test][0]: Recovery failed on {es1}{NnwjE30dSJuiLDRaJJilhA}{1uOB3kQpSQ2NpfzOMGoM-A}{es1}{192.168.128.2}{192.168.128.2:9300}{cdfhilmrstw}{8.11.1}{7000099-8500003}{ml.machine_memory=67378360320, transform.config_version=10.0.0, xpack.installed=true, ml.config_version=11.0.0, ml.max_jvm_size=536870912, ml.allocated_processors_double=16.0, ml.allocated_processors=16}"",""error.stack_trace"":""org.elasticsearch.indices.recovery.RecoveryFailedException: [intell_chat_test][0]: Recovery failed on {es1}{NnwjE30dSJuiLDRaJJilhA}{1uOB3kQpSQ2NpfzOMGoM-A}{es1}{192.168.128.2}{192.168.128.2:9300}{cdfhilmrstw}{8.11.1}{7000099-8500003}{ml.machine_memory=67378360320, transform.config_version=10.0.0, xpack.installed=true, ml.config_version=11.0.0, ml.max_jvm_size=536870912, ml.allocated_processors_double=16.0, ml.allocated_processors=16}\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.lambda$executeRecovery$25(IndexShard.java:3203)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListener$2.onFailure(ActionListener.java:185)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.lambda$recoveryListener$8(StoreRecovery.java:392)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListener$2.onFailure(ActionListener.java:185)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeOnFailure(ActionListenerImplementations.java:73)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.DelegatingActionListener.onFailure(DelegatingActionListener.java:27)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.lambda$internalRecoverFromStore$9(StoreRecovery.java:485)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations$ResponseWrappingActionListener.onResponse(ActionListenerImplementations.java:236)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations$DelegatingResponseActionListener.onResponse(ActionListenerImplementations.java:182)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.callListeners(CompositeIndexEventListener.java:278)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.iterateBeforeIndexShardRecovery(CompositeIndexEventListener.java:287)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.beforeIndexShardRecovery(CompositeIndexEventListener.java:314)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.preRecovery(IndexShard.java:1682)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:410)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:92)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:2339)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:73)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: [intell_chat_test/fDfr9Xu3QVKJ_i3KlcgGJQ][[intell_chat_test][0]] org.elasticsearch.index.shard.IndexShardRecoveryException: failed to recover from gateway\n\t... 16 more\nCaused by: [intell_chat_test/fDfr9Xu3QVKJ_i3KlcgGJQ][[intell_chat_test][0]] org.elasticsearch.index.engine.EngineCreationFailureException: failed to create engine\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:277)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:226)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2006)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1970)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.lambda$internalRecoverFromStore$9(StoreRecovery.java:479)\n\t... 15 more\nCaused by: java.io.IOException: Operation not supported\n\tat java.base/sun.nio.fs.LinuxNativeDispatcher.directCopy0(Native Method)\n\tat java.base/sun.nio.fs.LinuxFileSystem.directCopy(LinuxFileSystem.java:159)\n\tat java.base/sun.nio.fs.UnixFileSystem.copyFile(UnixFileSystem.java:682)\n\tat java.base/sun.nio.fs.UnixFileSystem.copy(UnixFileSystem.java:1060)\n\tat java.base/sun.nio.fs.UnixFileSystemProvider.copy(UnixFileSystemProvider.java:300)\n\tat java.base/java.nio.file.Files.copy(Files.java:1304)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.copyCheckpointTo(Translog.java:311)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.recoverFromFiles(Translog.java:292)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.<init>(Translog.java:194)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.openTranslog(InternalEngine.java:647)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:251)\n\t... 20 more\n""}

```

When I directly use the mounted data from another machine and place it on the NAS disk to start, it reports an error

```
failing shard [FailedShard[routingEntry=[.ds-ilm-history-5-2024.03.05-000001][0], node[ZpDmrG1tTD2ApvdQ3ZwWgw], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[INITIALIZING], a[id=CF3faGOdT1iQIJtlFdZagg], unassigned_info[[reason=ALLOCATION_FAILED], at[2024-04-24T13:32:57.878Z], failed_attempts[4], failed_nodes[[ZpDmrG1tTD2ApvdQ3ZwWgw]], delayed=false, last_node[ZpDmrG1tTD2ApvdQ3ZwWgw], details[failed shard on node [ZpDmrG1tTD2ApvdQ3ZwWgw]: failed recovery, failure org.elasticsearch.indices.recovery.RecoveryFailedException: [.ds-ilm-history-5-2024.03.05-000001][0]: Recovery failed on {es1}{ZpDmrG1tTD2ApvdQ3ZwWgw}{igB3S4MSRr6hslZJBaUn3g}{es1}{192.168.0.2}{192.168.0.2:9300}{cdfhilmrstw}{8.11.1}{7000099-8500003}{ml.max_jvm_size=536870912, ml.config_version=11.0.0, xpack.installed=true, transform.config_version=10.0.0, ml.machine_memory=67378360320, ml.allocated_processors=16, ml.allocated_processors_double=16.0}\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.lambda$executeRecovery$25(IndexShard.java:3203)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListener$2.onFailure(ActionListener.java:185)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.lambda$recoveryListener$8(StoreRecovery.java:392)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListener$2.onFailure(ActionListener.java:185)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeOnFailure(ActionListenerImplementations.java:73)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.DelegatingActionListener.onFailure(DelegatingActionListener.java:27)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.lambda$internalRecoverFromStore$9(StoreRecovery.java:485)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations$ResponseWrappingActionListener.onResponse(ActionListenerImplementations.java:236)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations$DelegatingResponseActionListener.onResponse(ActionListenerImplementations.java:182)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.callListeners(CompositeIndexEventListener.java:278)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.iterateBeforeIndexShardRecovery(CompositeIndexEventListener.java:287)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.beforeIndexShardRecovery(CompositeIndexEventListener.java:314)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.preRecovery(IndexShard.java:1682)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:410)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:92)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:2339)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:73)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: [.ds-ilm-history-5-2024.03.05-000001/EszqU7UTTMevs9ZjhU-MlQ][[.ds-ilm-history-5-2024.03.05-000001][0]] org.elasticsearch.index.shard.IndexShardRecoveryException: failed to recover from gateway\n\t... 16 more\nCaused by: [.ds-ilm-history-5-2024.03.05-000001/EszqU7UTTMevs9ZjhU-MlQ][[.ds-ilm-history-5-2024.03.05-000001][0]] org.elasticsearch.index.engine.EngineCreationFailureException: failed to create engine\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:277)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:226)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2006)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1970)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.lambda$internalRecoverFromStore$9(StoreRecovery.java:479)\n\t... 15 more\nCaused by: java.io.IOException: Operation not supported\n\tat java.base/sun.nio.fs.LinuxNativeDispatcher.directCopy0(Native Method)\n\tat java.base/sun.nio.fs.LinuxFileSystem.directCopy(LinuxFileSystem.java:159)\n\tat java.base/sun.nio.fs.UnixFileSystem.copyFile(UnixFileSystem.java:682)\n\tat java.base/sun.nio.fs.UnixFileSystem.copy(UnixFileSystem.java:1060)\n\tat java.base/sun.nio.fs.UnixFileSystemProvider.copy(UnixFileSystemProvider.java:300)\n\tat java.base/java.nio.file.Files.copy(Files.java:1304)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.copyCheckpointTo(Translog.java:311)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.recoverFromFiles(Translog.java:292)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.<init>(Translog.java:194)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.openTranslog(InternalEngine.java:647)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:251)\n\t... 20 more\n], allocation_status[no_valid_shard_copy]], failed_attempts[0], message=failed recovery, failure=org.elasticsearch.indices.recovery.RecoveryFailedException: [.ds-ilm-history-5-2024.03.05-000001][0]: Recovery failed on {es1}{ZpDmrG1tTD2ApvdQ3ZwWgw}{igB3S4MSRr6hslZJBaUn3g}{es1}{192.168.0.2}{192.168.0.2:9300}{cdfhilmrstw}{8.11.1}{7000099-8500003}{ml.max_jvm_size=536870912, ml.config_version=11.0.0, xpack.installed=true, transform.config_version=10.0.0, ml.machine_memory=67378360320, ml.allocated_processors=16, ml.allocated_processors_double=16.0}, markAsStale=true]]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[es1][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.routing.allocation.AllocationService"",""elasticsearch.cluster.uuid"":""CDQBcUUtRoyQdmVzmCHVLw"",""elasticsearch.node.id"":""ZpDmrG1tTD2ApvdQ3ZwWgw"",""elasticsearch.node.name"":""es1"",""elasticsearch.cluster.name"":""docker-cluster"",""error.type"":""org.elasticsearch.indices.recovery.RecoveryFailedException"",""error.message"":""[.ds-ilm-history-5-2024.03.05-000001][0]: Recovery failed on {es1}{ZpDmrG1tTD2ApvdQ3ZwWgw}{igB3S4MSRr6hslZJBaUn3g}{es1}{192.168.0.2}{192.168.0.2:9300}{cdfhilmrstw}{8.11.1}{7000099-8500003}{ml.max_jvm_size=536870912, ml.config_version=11.0.0, xpack.installed=true, transform.config_version=10.0.0, ml.machine_memory=67378360320, ml.allocated_processors=16, ml.allocated_processors_double=16.0}"",""error.stack_trace"":""org.elasticsearch.indices.recovery.RecoveryFailedException: [.ds-ilm-history-5-2024.03.05-000001][0]: Recovery failed on {es1}{ZpDmrG1tTD2ApvdQ3ZwWgw}{igB3S4MSRr6hslZJBaUn3g}{es1}{192.168.0.2}{192.168.0.2:9300}{cdfhilmrstw}{8.11.1}{7000099-8500003}{ml.max_jvm_size=536870912, ml.config_version=11.0.0, xpack.installed=true, transform.config_version=10.0.0, ml.machine_memory=67378360320, ml.allocated_processors=16, ml.allocated_processors_double=16.0}\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.lambda$executeRecovery$25(IndexShard.java:3203)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListener$2.onFailure(ActionListener.java:185)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.lambda$recoveryListener$8(StoreRecovery.java:392)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListener$2.onFailure(ActionListener.java:185)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations.safeOnFailure(ActionListenerImplementations.java:73)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.DelegatingActionListener.onFailure(DelegatingActionListener.java:27)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.lambda$internalRecoverFromStore$9(StoreRecovery.java:485)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations$ResponseWrappingActionListener.onResponse(ActionListenerImplementations.java:236)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations$DelegatingResponseActionListener.onResponse(ActionListenerImplementations.java:182)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.callListeners(CompositeIndexEventListener.java:278)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.iterateBeforeIndexShardRecovery(CompositeIndexEventListener.java:287)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.beforeIndexShardRecovery(CompositeIndexEventListener.java:314)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.preRecovery(IndexShard.java:1682)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:410)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:92)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:2339)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:73)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: [.ds-ilm-history-5-2024.03.05-000001/EszqU7UTTMevs9ZjhU-MlQ][[.ds-ilm-history-5-2024.03.05-000001][0]] org.elasticsearch.index.shard.IndexShardRecoveryException: failed to recover from gateway\n\t... 16 more\nCaused by: [.ds-ilm-history-5-2024.03.05-000001/EszqU7UTTMevs9ZjhU-MlQ][[.ds-ilm-history-5-2024.03.05-000001][0]] org.elasticsearch.index.engine.EngineCreationFailureException: failed to create engine\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:277)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:226)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2006)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1970)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.lambda$internalRecoverFromStore$9(StoreRecovery.java:479)\n\t... 15 more\nCaused by: java.io.IOException: Operation not supported\n\tat java.base/sun.nio.fs.LinuxNativeDispatcher.directCopy0(Native Method)\n\tat java.base/sun.nio.fs.LinuxFileSystem.directCopy(LinuxFileSystem.java:159)\n\tat java.base/sun.nio.fs.UnixFileSystem.copyFile(UnixFileSystem.java:682)\n\tat java.base/sun.nio.fs.UnixFileSystem.copy(UnixFileSystem.java:1060)\n\tat java.base/sun.nio.fs.UnixFileSystemProvider.copy(UnixFileSystemProvider.java:300)\n\tat java.base/java.nio.file.Files.copy(Files.java:1304)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.copyCheckpointTo(Translog.java:311)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.recoverFromFiles(Translog.java:292)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.<init>(Translog.java:194)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.openTranslog(InternalEngine.java:647)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:251)\n\t... 20 more\n""}
es-single-test  | {""@timestamp"":""2024-04-24T13:32:58.710Z"", ""log.level"": ""WARN"", ""message"":""failed to delete temp file /usr/share/elasticsearch/data/indices/iBnp_CKcSkOh7PlqEZBA4g/0/translog/translog-16854748828936634348.ckp"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[es1][generic][T#4]"",""log.logger"":""org.elasticsearch.index.translog.Translog"",""elasticsearch.cluster.uuid"":""CDQBcUUtRoyQdmVzmCHVLw"",""elasticsearch.node.id"":""ZpDmrG1tTD2ApvdQ3ZwWgw"",""elasticsearch.node.name"":""es1"",""elasticsearch.cluster.name"":""docker-cluster"",""tags"":["" [intell_chat_test_qa][0]""],""error.type"":""java.nio.file.NoSuchFileException"",""error.message"":""/usr/share/elasticsearch/data/indices/iBnp_CKcSkOh7PlqEZBA4g/0/translog/translog-16854748828936634348.ckp"",""error.stack_trace"":""java.nio.file.NoSuchFileException: /usr/share/elasticsearch/data/indices/iBnp_CKcSkOh7PlqEZBA4g/0/translog/translog-16854748828936634348.ckp\n\tat java.base/sun.nio.fs.UnixException.translateToIOException(UnixException.java:92)\n\tat java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:106)\n\tat java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)\n\tat java.base/sun.nio.fs.UnixFileSystemProvider.implDelete(UnixFileSystemProvider.java:291)\n\tat java.base/sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:104)\n\tat java.base/java.nio.file.Files.delete(Files.java:1152)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.copyCheckpointTo(Translog.java:320)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.recoverFromFiles(Translog.java:292)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.translog.Translog.<init>(Translog.java:194)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.openTranslog(InternalEngine.java:647)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:251)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:226)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:14)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:2006)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1970)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.lambda$internalRecoverFromStore$9(StoreRecovery.java:479)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations$ResponseWrappingActionListener.onResponse(ActionListenerImplementations.java:236)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionListenerImplementations$DelegatingResponseActionListener.onResponse(ActionListenerImplementations.java:182)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.callListeners(CompositeIndexEventListener.java:278)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.iterateBeforeIndexShardRecovery(CompositeIndexEventListener.java:287)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.CompositeIndexEventListener.beforeIndexShardRecovery(CompositeIndexEventListener.java:314)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.preRecovery(IndexShard.java:1682)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:410)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:92)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:2339)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:73)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)\n\tat org.elasticsearch.server@8.11.1/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)

```




### Logs (if relevant)

_No response_",631068264,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/107933,2024-04-26T07:38:06Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/107933,"{
  ""application_resource"": ""yes""
}"
166,107807,[ML] Regression in ML Trained Model Deployment Update Causes Failure,"### Elasticsearch Version

8.11.3

### Installed Plugins

_No response_

### Java Version

21

### OS Version

N/A

### Problem Description

**Background**:
In high-availability environments with a sufficient number of ML nodes, I am experiencing failures when attempting to update the `number_of_allocations` for a trained model deployment using the `POST _ml/trained_models/{model_id}/deployment/_update` API. This regression, which surfaced after the introduction of PR #98139, prevents valid updates to the number of allocations, despite the availability of ample resources. This bug has significantly impacted the normal usage of the feature in our production environment.
![image](https://github.com/elastic/elasticsearch/assets/26055883/7f6ab200-9625-4387-b61d-c300ef579a1d)


**Description of the problem including expected versus actual behavior**:
To simplify this problem, I reproduce it below. Brief description here:
The update operation fails with a `status_exception`(429) when `number_of_allocations` is set to 30, and with an `illegal_argument_exception`(400) for a negative byte value when set to 31. This behavior is a departure from previous versions where such updates were successful.

### Steps to Reproduce

**Model information for reproduction**:

- Model ID: ""baai__bge-base-zh-v1.5"" (https://huggingface.co/BAAI/bge-base-zh-v1.5)
- Model size stats: { ""model_size"": ""387.9mb"", ""model_size_bytes"": 406780568 }

**Steps to reproduce**:

1. Deploy a trained model with a certain `number_of_allocations` on an environment with at least two ML nodes (32c64g).
2. Attempt to update the deployment with `number_of_allocations` set to 30 and observe the `status_exception`(429).
3. Attempt to update the deployment with `number_of_allocations` set to 31 and observe the `illegal_argument_exception`(400) with debug logs indicating a negative byte value.

### Logs (if relevant)

when `number_of_allocations` is set to 30 and 31 in version 8.11.3
<img width=""1691"" alt=""image"" src=""https://github.com/elastic/elasticsearch/assets/26055883/a8708ff8-bffc-4f8f-a400-72ac621d02df"">
debug log
![image](https://github.com/elastic/elasticsearch/assets/26055883/ac3c18c4-314c-424d-8bc7-7ce6a64b6e58)


Reference to the behavior in versions prior to 8.11, where the issue was not present
<img width=""1687"" alt=""image"" src=""https://github.com/elastic/elasticsearch/assets/26055883/7a684ff4-e77e-4c83-911b-935e895be378"">

**Analysis of the problem**:
Upon reviewing PR #98139, I discovered that the core issue lies in the changes made to the `org.elasticsearch.xpack.core.ml.action.StartTrainedModelDeploymentAction#estimateMemoryUsageBytes` method. The modification introduced a linear relationship between the estimated memory usage and the `numberOfAllocations`, which, when combined with the subsequent arithmetic operations in `org.elasticsearch.xpack.ml.inference.assignment.planning.AssignmentPlan.Builder#accountMemory`, can result in a negative value. This negative value is then incorrectly passed to `ByteSizeValue.ofBytes().toString()`, leading to an `IllegalArgumentException`.

**Proposed Solution**:

I plan to submit two PRs: the first to handle the immediate issue of negative byte values, and the second to revert the key changes introduced by PR #98139 as a temporary measure. Concurrently, I am eager to participate in discussions for a more permanent fix that aligns with the project's goals and architecture.

It is crucial to address this regression constructively, acknowledging the complexity of software development and the potential for unintended side effects in contributions. The focus is on rectifying the issue to ensure the stability and reliability of the Elasticsearch ML features.

**Additional context**:

The issue was identified through detailed analysis and is documented with screenshots and code references to facilitate understanding and reproduction of the problem. I am committed to working on a swift resolution for this issue, as it is affecting our production environment. I am also open to engaging in discussions for a long-term solution and willing to contribute to its development.

The regression affects all subsequent versions and requires prompt attention to mitigate its impact on production environments. I have documented the debugging process with screenshots and code references to facilitate understanding and reproduction of the problem.",Rassyan,closed,"['>bug', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/107807,2024-04-24T07:36:00Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/107807,"{
  ""application_resource"": ""yes""
}"
167,107756,"[CI] MvSliceTests testEvaluateBlockWithoutNulls {TestCase=<cartesian_shape>, <integer>, <integer>} failing","**Build scan:**
https://gradle-enterprise.elastic.co/s/d7k5gdah5h3z4/tests/:x-pack:plugin:esql:test/org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvSliceTests/testEvaluateBlockWithoutNulls%20%7BTestCase=%3Ccartesian_shape%3E,%20%3Cinteger%3E,%20%3Cinteger%3E%7D


**Reproduction line:**
```
./gradlew ':x-pack:plugin:esql:test' --tests ""org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvSliceTests.testEvaluateBlockWithoutNulls {TestCase=<cartesian_shape>, <integer>, <integer>}"" -Dtests.seed=D767D3FC112B3251 -Dtests.configure_test_clusters_with_one_processor=true -Dtests.locale=th-TH -Dtests.timezone=Egypt -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
[Failure dashboard for `org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvSliceTests#testEvaluateBlockWithoutNulls {TestCase=<cartesian_shape>, <integer>, <integer>}`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testEvaluateBlockWithoutNulls%20%7BTestCase%3D%3Ccartesian_shape%3E,%20%3Cinteger%3E,%20%3Cinteger%3E%7D'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.xpack.esql.expression.function.scalar.multivalue.MvSliceTests'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.OutOfMemoryError: Java heap space


```",alex-spies,closed,"['>test-failure', 'Team:Analytics', ':Analytics/ES|QL', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/107756,2024-04-23T09:51:17Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/107756,"{
  ""application_resource"": ""yes""
}"
168,107251,[Transform] Elasticsearch upgrades make transforms fail easily,"### Elasticsearch Version

main

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

serverless, Cloud

### Problem Description

Users are noticing transforms failing when there is an Elasticsearch version upgrade.
This came up in serverless and on the Cloud. I'm not sure if this also affect stateful ES.
Each such upgrade can make a transform fail. Once the transform fails, the user has to manually stop and delete it and create a new transform.

The primary purpose of this GH issue is to reduce the volume of the transform alerts and users complaints.
Some questions/ideas that need to be addressed:
- [ ] We've seen the problem happening for the transforms with `unattended` set to `false`. Does the problem also occur when `unattended` is `true`? If so, this is a bug as we expect `unattended` transforms to never fail.
- [ ] Even when `unattended` is `false`, what can we do to make the transform more robust during these upgrades? Maybe we can make all the transforms slightly more ""unattended"", i.e. less prone to intermittent issues.
- [ ] Maybe the transforms should treat all the error types as recoverable?
- [ ] What is the right retrying strategy for a non-unattended transform?
- [ ] Does the problem happen for a version upgrade only or does it also happen for a full cluster restart (but without changing the version)?

### Steps to Reproduce

It happens during Cloud upgrades. 

### Logs (if relevant)

_No response_
```[tasklist]
### Tasks
- [ ] https://github.com/elastic/elasticsearch/issues/107215
- [ ] https://github.com/elastic/elasticsearch/issues/100891
- [ ] https://github.com/elastic/elasticsearch/issues/107263
- [ ] https://github.com/elastic/elasticsearch/issues/107266
```
",przemekwitek,closed,"['>bug', ':ml/Transform', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/107251,2024-04-09T09:36:59Z,12,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/107251,"{
  ""application_resource"": ""unsure""
}"
169,107245,failed to retrieve shard stats from node [zxt4RAOiRZy9Lol9IdIGfg]: [node_2][10.202.152.18:9300][indices:monitor/stats[n]] request_id [77247 683] timed out after [15016ms],"ES total 3 nodes: 18, 10, 15
ES occasionally reports a timeout, help to see what might be the problem?

This is the elasticsearch server log:
[2024-04-02T17:43:47,318][WARN ][o.e.c.InternalClusterInfoService] [node_2] failed to retrieve stats for node [zxt4RAOiRZy9Lol9IdIGfg]: [node_2][10.202.152.18:9300][cluster:monitor/nodes/stats[n]] request_id [772476
82] timed out after [15016ms]
[2024-04-02T17:43:47,319][WARN ][o.e.c.InternalClusterInfoService] [node_2] failed to retrieve shard stats from node [zxt4RAOiRZy9Lol9IdIGfg]: [node_2][10.202.152.18:9300][indices:monitor/stats[n]] request_id [77247
683] timed out after [15016ms]
[2024-04-02T17:43:47,319][WARN ][o.e.c.InternalClusterInfoService] [node_2] failed to retrieve shard stats from node [h4Igv51yStGQT552LJlITg]: [node_1][10.202.152.10:9300][indices:monitor/stats[n]] request_id [77247
684] timed out after [15016ms]
[2024-04-02T17:43:47,320][WARN ][o.e.c.InternalClusterInfoService] [node_2] failed to retrieve shard stats from node [WSHeMx5fQbGTE_GtNc2fKg]: [node_3][10.202.152.15:9300][indices:monitor/stats[n]] request_id [77247
685] timed out after [15016ms]
[2024-04-02T17:44:32,321][WARN ][o.e.c.InternalClusterInfoService] [node_2] failed to retrieve stats for node [WSHeMx5fQbGTE_GtNc2fKg]: [node_3][10.202.152.15:9300][cluster:monitor/nodes/stats[n]] request_id [772476
87] timed out after [15009ms]
[2024-04-02T17:44:32,323][WARN ][o.e.c.InternalClusterInfoService] [node_2] failed to retrieve stats for node [zxt4RAOiRZy9Lol9IdIGfg]: [node_2][10.202.152.18:9300][cluster:monitor/nodes/stats[n]] request_id [772476
88] timed out after [15009ms]
[2024-04-02T17:44:32,324][WARN ][o.e.c.InternalClusterInfoService] [node_2] failed to retrieve shard stats from node [zxt4RAOiRZy9Lol9IdIGfg]: [node_2][10.202.152.18:9300][indices:monitor/stats[n]] request_id [77247
689] timed out after [15009ms]
[2024-04-02T17:44:32,324][WARN ][o.e.c.InternalClusterInfoService] [node_2] failed to retrieve shard stats from node [h4Igv51yStGQT552LJlITg]: [node_1][10.202.152.10:9300][indices:monitor/stats[n]] request_id [77247
690] timed out after [15009ms]
[2024-04-02T17:44:32,324][WARN ][o.e.c.InternalClusterInfoService] [node_2] failed to retrieve shard stats from node [WSHeMx5fQbGTE_GtNc2fKg]: [node_3][10.202.152.15:9300][indices:monitor/stats[n]] request_id [77247
691] timed out after [15009ms]
[2024-04-02T17:44:44,542][WARN ][o.e.t.TransportService ] [node_2] Received response for a request that has timed out, sent [7.2m/432269ms] ago, timed out [6.9m/417260ms] ago, action [indices:monitor/stats[n]], no
de [{node_3}{WSHeMx5fQbGTE_GtNc2fKg}{j0aLmJ_1TnCAxNbdFUmuDw}{10.202.152.15}{10.202.152.15:9300}{cdfhilmrstw}{ml.machine_memory=16656986112, ml.max_open_jobs=512, xpack.installed=true, ml.max_jvm_size=1038876672, tra
nsform.node=true}], id [77247566]
[2024-04-02T17:44:44,543][WARN ][o.e.t.TransportService ] [node_2] Received response for a request that has timed out, sent [6.4m/387243ms] ago, timed out [6.2m/372235ms] ago, action [cluster:monitor/nodes/stats[n
]], node [{node_3}{WSHeMx5fQbGTE_GtNc2fKg}{j0aLmJ_1TnCAxNbdFUmuDw}{10.202.152.15}{10.202.152.15:9300}{cdfhilmrstw}{ml.machine_memory=16656986112, ml.max_open_jobs=512, xpack.installed=true, ml.max_jvm_size=103887667
2, transform.node=true}], id [77247602]
[2024-04-02T17:44:44,543][WARN ][o.e.t.TransportService ] [node_2] Received response for a request that has timed out, sent [2.7m/162310ms] ago, timed out [2.4m/147294ms] ago, action [cluster:monitor/nodes/stats[n
]], node [{node_3}{WSHeMx5fQbGTE_GtNc2fKg}{j0aLmJ_1TnCAxNbdFUmuDw}{10.202.152.15}{10.202.152.15:9300}{cdfhilmrstw}{ml.machine_memory=16656986112, ml.max_open_jobs=512, xpack.installed=true, ml.max_jvm_size=103887667
2, transform.node=true}], id [77247669]
[2024-04-02T17:44:44,585][WARN ][o.e.t.OutboundHandler ] [node_2] sending transport message [Request{indices:monitor/stats[n]}{77247654}{false}{true}{false}] of size [840] on [Netty4TcpChannel{localAddress=/10.20
2.152.18:51856, remoteAddress=10.202.152.10/10.202.152.10:9300, profile=default}] took [297189ms] which is above the warn threshold of [5000ms] with success [true]",zuomengjun,closed,['needs:triage'],https://github.com/elastic/elasticsearch/issues/107245,2024-04-09T02:06:20Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/107245,"{
  ""application_resource"": ""yes""
}"
170,107008,[ML] Convert DatafeedContext to a record,"### Description

From recent PR: https://github.com/elastic/elasticsearch/pull/106948
It's possible to reduce code footprint of `DatafeedContext` by converting it into a record, removing the need to use volatile memory to pass objects between the listeners in `DatafeedContextProvider`.",prwhelan,closed,"['>enhancement', ':ml', 'Team:ML', 'v8.14.0']",https://github.com/elastic/elasticsearch/issues/107008,2024-04-02T15:34:28Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/107008,"{
  ""application_resource"": ""yes""
}"
171,106468,Inefficiency with PerFieldDocValuesFormat and ES87TSDBDocValuesProducer,"`SegmentReader` instances in tsdb indices with a sufficient number of fields do take some space (1000+ fields, could use 800kb of jvm heap). This is small, but many segment readers may exist for these tsdb indices and could use a non-trivial amount of jvm heap (e.g. 200mb). Looking closer it looks like often the `docValuesProducer` uses up to 50% of the memory being used by a `SegmentReader` (much more than `fieldInfos` field). There are two large maps in these cases in `org.apache.lucene.codecs.perfield.PerFieldDocValuesFormat$FieldsReader` and `org.elasticsearch.index.codec.tsdb.ES87TSDBDocValuesProducer` (for `sortedNumerics` field). 

It seems wasteful that the same fields are being mentioned in both of these maps. Maybe we can use a single map instead to keep track of the right doc values producer for a field?",martijnvg,closed,"['>bug', ':StorageEngine/TSDB', 'Team:StorageEngine']",https://github.com/elastic/elasticsearch/issues/106468,2024-03-19T11:02:28Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/106468,"{
  ""application_resource"": ""yes""
}"
172,106462,Introduce a new `logs` index mode,"### Description

We would like to introduce a new index mode named `logs`. The idea is to use it as a gate for a set of features which will be used by default for the logging use case. The index mode will apply the following settings by default:

* enable synthetic source
* apply index sorting by (hostname, timestamp)
* enable doc _id k-ordered compression
* enable ZSTD compression
* enable TSDB codecs for numbers, dates and keywords
* dropping points for _seq_no",salvatore-campagna,closed,"['>enhancement', 'Team:StorageEngine', ':StorageEngine/Logs', 'v9.1.0']",https://github.com/elastic/elasticsearch/issues/106462,2024-03-19T09:52:47Z,18,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/106462,"{
  ""application_resource"": ""no""
}"
173,106461,[CI] DataTierMixedIT testMixedTierCompatibility failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/ebivm6xolwuiu/tests/:x-pack:qa:mixed-tier-cluster:v8.10.4%23mixedClusterTest/org.elasticsearch.mixed.DataTierMixedIT/testMixedTierCompatibility


**Reproduction line:**
```
./gradlew ':x-pack:qa:mixed-tier-cluster:v8.10.4#mixedClusterTest' -Dtests.class=""org.elasticsearch.mixed.DataTierMixedIT"" -Dtests.method=""testMixedTierCompatibility"" -Dtests.seed=F98F58B12D14BFFC -Dtests.bwc=true -Dtests.locale=es-HN -Dtests.timezone=America/Lower_Princes -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
Yes

**Failure history:**
[Failure dashboard for `org.elasticsearch.mixed.DataTierMixedIT#testMixedTierCompatibility`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testMixedTierCompatibility'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.mixed.DataTierMixedIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**

<details>
  <summary>Failure</summary>
```
java.lang.AssertionError: timed out waiting for green state for index [test-index] cluster state [{
  ""cluster_name"" : ""v8.10.4"",
  ""cluster_uuid"" : ""bdMIzXEdQ6maTmQH3P0ssw"",
  ""version"" : 41,
  ""state_uuid"" : ""DrTMytH6QUOgUcf-4gx-4A"",
  ""master_node"" : ""dPWNRcI_RLKVRrv6e0abyA"",
  ""blocks"" : { },
  ""nodes"" : {
    ""dPWNRcI_RLKVRrv6e0abyA"" : {
      ""name"" : ""v8.10.4-0"",
      ""ephemeral_id"" : ""Qa83MIGWS9O-6q7QudpmSQ"",
      ""transport_address"" : ""127.0.0.1:41759"",
      ""external_id"" : ""v8.10.4-0"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""xpack.installed"" : ""true"",
        ""ml.config_version"" : ""12.0.0"",
        ""transform.config_version"" : ""10.0.0"",
        ""upgraded"" : ""true""
      },
      ""roles"" : [
        ""master""
      ],
      ""version"" : ""8.14.0"",
      ""min_index_version"" : 7000099,
      ""max_index_version"" : 8504000
    },
    ""W0KY-UYHSdq04h-eqagdYA"" : {
      ""name"" : ""v8.10.4-2"",
      ""ephemeral_id"" : ""lvFxaIiWTxSrs_tPdG_pig"",
      ""transport_address"" : ""127.0.0.1:36075"",
      ""external_id"" : ""v8.10.4-2"",
      ""attributes"" : {
        ""xpack.installed"" : ""true"",
        ""transform.config_version"" : ""10.0.0"",
        ""testattr"" : ""test""
      },
      ""roles"" : [
        ""master""
      ],
      ""version"" : ""8.10.4"",
      ""min_index_version"" : 7000099,
      ""max_index_version"" : 8100499
    }
  },
  ""transport_versions"" : [
    {
      ""node_id"" : ""dPWNRcI_RLKVRrv6e0abyA"",
      ""transport_version"" : ""8612000""
    },
    {
      ""node_id"" : ""W0KY-UYHSdq04h-eqagdYA"",
      ""transport_version"" : ""8500061""
    }
  ],
  ""metadata"" : {
    ""cluster_uuid"" : ""bdMIzXEdQ6maTmQH3P0ssw"",
    ""cluster_uuid_committed"" : true,
    ""cluster_coordination"" : {
      ""term"" : 2,
      ""last_committed_config"" : [
        ""W0KY-UYHSdq04h-eqagdYA"",
        ""dPWNRcI_RLKVRrv6e0abyA"",
        ""{bootstrap-placeholder}-v8.10.4-1""
      ],
      ""last_accepted_config"" : [
        ""W0KY-UYHSdq04h-eqagdYA"",
        ""dPWNRcI_RLKVRrv6e0abyA"",
        ""{bootstrap-placeholder}-v8.10.4-1""
      ],
      ""voting_config_exclusions"" : [ ]
    },
    ""templates"" : {
      "".monitoring-beats"" : {
        ""order"" : 0,
        ""version"" : 8120099,
        ""index_patterns"" : [
          "".monitoring-beats-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""beats_state"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""state"" : {
                    ""properties"" : {
                      ""beat"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""host"" : {
                        ""properties"" : {
                          ""architecture"" : {
                            ""type"" : ""keyword""
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""hostname"" : {
                            ""type"" : ""keyword""
                          },
                          ""os"" : {
                            ""properties"" : {
                              ""build"" : {
                                ""type"" : ""keyword""
                              },
                              ""family"" : {
                                ""type"" : ""keyword""
                              },
                              ""platform"" : {
                                ""type"" : ""keyword""
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          }
                        }
                      },
                      ""input"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          },
                          ""names"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""module"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          },
                          ""names"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""output"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""service"" : {
                        ""properties"" : {
                          ""id"" : {
                            ""type"" : ""keyword""
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""version"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""format"" : ""date_time"",
                    ""type"" : ""date""
                  }
                }
              },
              ""beats_stats"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""metrics"" : {
                    ""properties"" : {
                      ""beat"" : {
                        ""properties"" : {
                          ""cgroup"" : {
                            ""properties"" : {
                              ""cpu"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""cfs"" : {
                                    ""properties"" : {
                                      ""period"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""quota"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""stats"" : {
                                    ""properties"" : {
                                      ""periods"" : {
                                        ""type"" : ""long""
                                      },
                                      ""throttled"" : {
                                        ""properties"" : {
                                          ""periods"" : {
                                            ""type"" : ""long""
                                          },
                                          ""ns"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              ""cpuacct"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""total"" : {
                                    ""properties"" : {
                                      ""ns"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""memory"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""mem"" : {
                                    ""properties"" : {
                                      ""limit"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""usage"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""cpu"" : {
                            ""properties"" : {
                              ""system"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""total"" : {
                                ""properties"" : {
                                  ""value"" : {
                                    ""type"" : ""long""
                                  },
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""user"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""info"" : {
                            ""properties"" : {
                              ""ephemeral_id"" : {
                                ""type"" : ""keyword""
                              },
                              ""uptime"" : {
                                ""properties"" : {
                                  ""ms"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          },
                          ""memstats"" : {
                            ""properties"" : {
                              ""gc_next"" : {
                                ""type"" : ""long""
                              },
                              ""memory_alloc"" : {
                                ""type"" : ""long""
                              },
                              ""memory_total"" : {
                                ""type"" : ""long""
                              },
                              ""rss"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""handles"" : {
                            ""properties"" : {
                              ""open"" : {
                                ""type"" : ""long""
                              },
                              ""limit"" : {
                                ""properties"" : {
                                  ""hard"" : {
                                    ""type"" : ""long""
                                  },
                                  ""soft"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""apm-server"" : {
                        ""properties"" : {
                          ""acm"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unavailable"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      },
                                      ""notfound"" : {
                                        ""type"" : ""long""
                                      },
                                      ""invalidquery"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""notmodified"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""unset"" : {
                                    ""type"" : ""long""
                                  },
                                  ""request"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""server"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""concurrent"" : {
                                ""properties"" : {
                                  ""wait"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""concurrency"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""decoder"" : {
                            ""properties"" : {
                              ""deflate"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""gzip"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""uncompressed"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reader"" : {
                                ""properties"" : {
                                  ""size"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""missing-content-length"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""processor"" : {
                            ""properties"" : {
                              ""metric"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""sourcemap"" : {
                                ""properties"" : {
                                  ""counter"" : {
                                    ""type"" : ""long""
                                  },
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""transaction"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""transactions"" : {
                                    ""type"" : ""long""
                                  },
                                  ""spans"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stacktraces"" : {
                                    ""type"" : ""long""
                                  },
                                  ""frames"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""error"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stacktraces"" : {
                                    ""type"" : ""long""
                                  },
                                  ""frames"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""span"" : {
                                ""properties"" : {
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""sampling"" : {
                            ""properties"" : {
                              ""transactions_dropped"" : {
                                ""type"" : ""long""
                              },
                              ""tail"" : {
                                ""properties"" : {
                                  ""dynamic_service_groups"" : {
                                    ""type"" : ""long""
                                  },
                                  ""storage"" : {
                                    ""properties"" : {
                                      ""lsm_size"" : {
                                        ""type"" : ""long""
                                      },
                                      ""value_log_size"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""events"" : {
                                    ""properties"" : {
                                      ""processed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""dropped"" : {
                                        ""type"" : ""long""
                                      },
                                      ""stored"" : {
                                        ""type"" : ""long""
                                      },
                                      ""sampled"" : {
                                        ""type"" : ""long""
                                      },
                                      ""head_unsampled"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""libbeat"" : {
                        ""properties"" : {
                          ""config"" : {
                            ""properties"" : {
                              ""module"" : {
                                ""properties"" : {
                                  ""running"" : {
                                    ""type"" : ""long""
                                  },
                                  ""starts"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stops"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reloads"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""output"" : {
                            ""properties"" : {
                              ""events"" : {
                                ""properties"" : {
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  },
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""batches"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""duplicates"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""total"" : {
                                    ""type"" : ""long""
                                  },
                                  ""toomany"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""read"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""type"" : {
                                ""type"" : ""keyword""
                              },
                              ""write"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""pipeline"" : {
                            ""properties"" : {
                              ""clients"" : {
                                ""type"" : ""long""
                              },
                              ""events"" : {
                                ""properties"" : {
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""filtered"" : {
                                    ""type"" : ""long""
                                  },
                                  ""published"" : {
                                    ""type"" : ""long""
                                  },
                                  ""retry"" : {
                                    ""type"" : ""long""
                                  },
                                  ""total"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""queue"" : {
                                ""properties"" : {
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  },
                                  ""max_events"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""system"" : {
                        ""properties"" : {
                          ""load"" : {
                            ""properties"" : {
                              ""1"" : {
                                ""type"" : ""double""
                              },
                              ""15"" : {
                                ""type"" : ""double""
                              },
                              ""5"" : {
                                ""type"" : ""double""
                              },
                              ""norm"" : {
                                ""properties"" : {
                                  ""1"" : {
                                    ""type"" : ""double""
                                  },
                                  ""15"" : {
                                    ""type"" : ""double""
                                  },
                                  ""5"" : {
                                    ""type"" : ""double""
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  ""tags"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""format"" : ""date_time"",
                    ""type"" : ""date""
                  }
                }
              },
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  }
                }
              },
              ""timestamp"" : {
                ""format"" : ""date_time"",
                ""type"" : ""date""
              },
              ""type"" : {
                ""type"" : ""keyword""
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-kibana"" : {
        ""order"" : 0,
        ""version"" : 8120099,
        ""index_patterns"" : [
          "".monitoring-kibana-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""timestamp"" : {
                ""type"" : ""date"",
                ""format"" : ""date_time""
              },
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""type"" : ""date"",
                    ""format"" : ""date_time""
                  }
                }
              },
              ""kibana_stats"" : {
                ""properties"" : {
                  ""usage"" : {
                    ""properties"" : {
                      ""index"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""kibana"" : {
                    ""properties"" : {
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""transport_address"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      },
                      ""snapshot"" : {
                        ""type"" : ""boolean""
                      },
                      ""status"" : {
                        ""type"" : ""keyword""
                      },
                      ""statuses"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""state"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      }
                    }
                  },
                  ""cloud"" : {
                    ""properties"" : {
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""id"" : {
                        ""type"" : ""keyword""
                      },
                      ""vm_type"" : {
                        ""type"" : ""keyword""
                      },
                      ""region"" : {
                        ""type"" : ""keyword""
                      },
                      ""zone"" : {
                        ""type"" : ""keyword""
                      },
                      ""metadata"" : {
                        ""type"" : ""object""
                      }
                    }
                  },
                  ""os"" : {
                    ""properties"" : {
                      ""load"" : {
                        ""properties"" : {
                          ""1m"" : {
                            ""type"" : ""half_float""
                          },
                          ""5m"" : {
                            ""type"" : ""half_float""
                          },
                          ""15m"" : {
                            ""type"" : ""half_float""
                          }
                        }
                      },
                      ""memory"" : {
                        ""properties"" : {
                          ""total_in_bytes"" : {
                            ""type"" : ""float""
                          },
                          ""free_in_bytes"" : {
                            ""type"" : ""float""
                          },
                          ""used_in_bytes"" : {
                            ""type"" : ""float""
                          }
                        }
                      },
                      ""uptime_in_millis"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""process"" : {
                    ""properties"" : {
                      ""memory"" : {
                        ""properties"" : {
                          ""heap"" : {
                            ""properties"" : {
                              ""total_in_bytes"" : {
                                ""type"" : ""float""
                              },
                              ""used_in_bytes"" : {
                                ""type"" : ""float""
                              },
                              ""size_limit"" : {
                                ""type"" : ""float""
                              }
                            }
                          },
                          ""resident_set_size_in_bytes"" : {
                            ""type"" : ""float""
                          }
                        }
                      },
                      ""event_loop_delay"" : {
                        ""type"" : ""float""
                      },
                      ""uptime_in_millis"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""sockets"" : {
                    ""properties"" : {
                      ""http"" : {
                        ""properties"" : {
                          ""total"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""https"" : {
                        ""properties"" : {
                          ""total"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""type"" : ""date""
                  },
                  ""requests"" : {
                    ""properties"" : {
                      ""disconnects"" : {
                        ""type"" : ""long""
                      },
                      ""total"" : {
                        ""type"" : ""long""
                      },
                      ""status_codes"" : {
                        ""type"" : ""object""
                      }
                    }
                  },
                  ""response_times"" : {
                    ""properties"" : {
                      ""average"" : {
                        ""type"" : ""float""
                      },
                      ""max"" : {
                        ""type"" : ""float""
                      }
                    }
                  },
                  ""concurrent_connections"" : {
                    ""type"" : ""long""
                  }
                }
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-alerts-7"" : {
        ""order"" : 0,
        ""version"" : 8120099,
        ""index_patterns"" : [
          "".monitoring-alerts-7""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""timestamp"" : {
                ""type"" : ""date""
              },
              ""update_timestamp"" : {
                ""type"" : ""date""
              },
              ""resolved_...
```
</details>

**Actual failure**

The build output contains
```
Â» [2024-03-19T04:28:11,023][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [v8.10.4-1] fatal error in thread [elasticsearch[v8.10.4-1][AsyncLucenePersistedState#updateTask][T#1]], exiting java.lang.AssertionError: org.elasticsearch.gateway.CorruptStateException: org.elasticsearch.xcontent.XContentParseException: [-1:32054] [index_template] failed to parse field [index_template]
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.PersistedClusterStateService$Writer.assertOnCommit(PersistedClusterStateService.java:1244)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.PersistedClusterStateService$Writer.commit(PersistedClusterStateService.java:1234)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.PersistedClusterStateService$Writer.writeIncrementalStateAndCommit(PersistedClusterStateService.java:976)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.GatewayMetaState$LucenePersistedState.writeClusterStateToDisk(GatewayMetaState.java:579)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.GatewayMetaState$LucenePersistedState.setLastAcceptedState(GatewayMetaState.java:562)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.GatewayMetaState$AsyncPersistedState$1.doRun(GatewayMetaState.java:436)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
Â»  	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
Â»  	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
Â»  	at java.base/java.lang.Thread.run(Thread.java:1583)
Â»  Caused by: org.elasticsearch.gateway.CorruptStateException: org.elasticsearch.xcontent.XContentParseException: [-1:32054] [index_template] failed to parse field [index_template]
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.PersistedClusterStateService.readXContent(PersistedClusterStateService.java:674)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.PersistedClusterStateService.lambda$loadOnDiskState$6(PersistedClusterStateService.java:572)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.PersistedClusterStateService.consumeFromType(PersistedClusterStateService.java:716)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.PersistedClusterStateService.loadOnDiskState(PersistedClusterStateService.java:571)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.PersistedClusterStateService$Writer.assertOnCommit(PersistedClusterStateService.java:1242)
Â»  	... 10 more
Â»  Caused by: org.elasticsearch.xcontent.XContentParseException: [-1:32054] [index_template] failed to parse field [index_template]
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.throwFailedToParse(ObjectParser.java:616)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.parseValue(ObjectParser.java:611)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.parseSub(ObjectParser.java:629)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.parse(ObjectParser.java:315)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ConstructingObjectParser.parse(ConstructingObjectParser.java:166)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.cluster.metadata.ComposableIndexTemplateMetadata.fromXContent(ComposableIndexTemplateMetadata.java:67)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.NamedXContentRegistry$Entry.lambda$new$0(NamedXContentRegistry.java:54)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:147)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:414)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.cluster.metadata.Metadata$Builder.fromXContent(Metadata.java:2660)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.gateway.PersistedClusterStateService.readXContent(PersistedClusterStateService.java:672)
Â»  	... 14 more
Â»  Caused by: org.elasticsearch.xcontent.XContentParseException: [-1:32054] [index_template] failed to parse field [template]
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.throwFailedToParse(ObjectParser.java:616)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.parseValue(ObjectParser.java:611)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.parseSub(ObjectParser.java:629)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.parse(ObjectParser.java:315)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ConstructingObjectParser.parse(ConstructingObjectParser.java:166)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.cluster.metadata.ComposableIndexTemplate.parse(ComposableIndexTemplate.java:102)
Â»  	at org.elasticsearch.server@8.10.4/org.elasticsearch.cluster.metadata.ComposableIndexTemplateMetadata.lambda$static$1(ComposableIndexTemplateMetadata.java:50)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.lambda$declareField$10(ObjectParser.java:431)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.parseValue(ObjectParser.java:609)
Â»  	... 23 more
Â»  Caused by: org.elasticsearch.xcontent.XContentParseException: [-1:32052] [template] unknown field [lifecycle]
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.lambda$errorOnUnknown$2(ObjectParser.java:105)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.parse(ObjectParser.java:299)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ConstructingObjectParser.parse(ConstructingObjectParser.java:166)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.lambda$declareField$10(ObjectParser.java:431)
Â»  	at org.elasticsearch.xcontent@8.10.4/org.elasticsearch.xcontent.ObjectParser.parseValue(ObjectParser.java:609)
Â»  	... 30 more
Â»  
```
",idegtiarenko,closed,"['blocker', '>test-failure', ':Data Management/ILM+SLM', 'Team:Data Management']",https://github.com/elastic/elasticsearch/issues/106461,2024-03-19T09:48:14Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/106461,"{
  ""application_resource"": ""yes""
}"
174,106390,`MultiSnapshot` should release each `TranslogSnapshot` when no longer needed,"Seen in a heap dump from a node that went OOME: we ran out of memory replaying a translog of 83 generations, each of which ended with an enormous document (all over 100MiB, some over 1GiB, see https://github.com/elastic/elasticsearch/issues/106389). It seems that we do not re-use the `TranslogSnapshot#reuse` buffer across generations, but nor do we release it, we just keep the last operation of each generation in memory until the whole translog replay is done.",DaveCTurner,closed,"['>bug', ':Distributed Indexing/Engine', 'Team:Distributed (Obsolete)', 'Supportability']",https://github.com/elastic/elasticsearch/issues/106390,2024-03-16T15:07:44Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/106390,"{
  ""application_resource"": ""yes""
}"
175,106206,[ML] ELSER crashes in local serverless setup,"### Description

When interacting with ELSER in serverless locally it crashes when attempting to perform inference.

Steps to reproduce
- Ensure docker is setup and running

1. Checkout kibana and bootstrap it
2. Start elasticsearch serverless locally: `yarn es serverless --projectType=security --ssl`
3. Start kibana locally `yarn start --serverless=security --ssl`
4. Download elser
5. Deploy elser via the inference API

```
PUT _inference/sparse_embedding/elser
{
  ""service"": ""elser"",
  ""service_settings"": {
    ""model_id"": "".elser_model_2"",
    ""num_allocations"": 1,
    ""num_threads"": 1
  },
  ""task_settings"": {}
}
```

7. Add an ingest processor

```
PUT _ingest/pipeline/elser
{
  ""processors"": [
    {
      ""inference"": {
        ""model_id"": ""elser"",
        ""input_output"": [
            {
                ""input_field"": ""content"",
                ""output_field"": ""text_embedding""
            }
        ]
      }
    },
    {
      ""set"": {
        ""field"": ""timestamp"",
        ""value"": ""{{_ingest.timestamp}}""
      }
    }
  ]
}
```

8. Attempt to perform inference

```
POST _ingest/pipeline/elser/_simulate
{
  ""docs"": [
    {
      ""_source"": {
             ""content"": ""hello"" 
      }
    }]
}
```

9. Retrieve the stats from the trained models api to observe that the process has crashed

```
            ""routing_state"": {
              ""routing_state"": ""failed"",
              ""reason"": """"""inference process crashed due to reason [[my-elser-model] pytorch_inference/659 process stopped unexpectedly: Fatal error: 'si_signo 11, si_code: 1, si_errno: 0, address: 0xffff83b20140, library: /lib/aarch64-linux-gnu/libc.so.6, base: 0xffff83a13000, normalized address: 0x10d140', version: 8.14.0-SNAPSHOT (build 38a5b0ec077958)
]""""""
            },
```",jonathan-buttner,closed,"['>bug', ':ml', 'Team:ML', 'Feature:NLP']",https://github.com/elastic/elasticsearch/issues/106206,2024-03-11T20:53:16Z,19,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/106206,"{
  ""application_resource"": ""unsure""
}"
176,106081,Enrich Cache should be based on memory usage instead of a flat document count,"When enriching documents via an ingest processor, we cache recently retrieved documents in a global enrich cache. This cache is set at 1000 entries by default. The cache does not take memory consumption of documents into account when storing values and evicting them. This causes heap issues on smaller node sizes when large documents are returned by enrich indices. 

As far as I can tell, the practical size limit of a document based on various limitations is in the ballpark of 50-100mb. An enrich index filled with extremely large documents can quickly fill the heap of an Elasticsearch node since the cache retains 1000 entries by default. The only fix in this scenarios is to either cease using Enrich in this fashion or drop the cache size severely.

Marking as a bug since without any guards in place this can lead to system instability.",jbaiera,closed,"['>bug', ':Data Management/Ingest Node', 'Team:Data Management']",https://github.com/elastic/elasticsearch/issues/106081,2024-03-07T18:26:39Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/106081,"{
  ""application_resource"": ""yes""
}"
177,105892,Improve blocks/vectors serialization,"Currently, we serialize blocks/vectors value by value, which simplifies the serialization code and is quite effective. However, I think we should introduce optimized serializations for concrete types, aiming to speed up and reduce memory usage. Here are some specific improvements:

- [x] Serialize BytesRefArray.
~- [ ] Use byte referencing for BigArray instances~.
- [x] Serialize the internal structure of ArrayBlock
- [x] Serialize the internal structure of BigArrayBlock
~- [ ] Defer unpacking of Page Driver needs that Page. This will help the remote coordinator and reduce memory usage on the coordinator.~",dnhatn,closed,"['Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/105892,2024-03-04T06:35:55Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/105892,"{
  ""application_resource"": ""yes""
}"
178,105475,[CI] :x-pack:plugin:enrich:test fails,"### CI Link

https://gradle-enterprise.elastic.co/s/us627zmjcye66

### Repro line

N/A

### Does it reproduce?

Didn't try

### Applicable branches

8.12

### Failure history

_No response_

### Failure excerpt

Look into the console output, I noticed following fatal error
```
#
# A fatal error has been detected by the Java Runtime Environment:
#
#  SIGSEGV (0xb) at pc=0x00007f5b777fa42e, pid=288874, tid=289337
#
# JRE version: OpenJDK Runtime Environment (21.0.2+13) (build 21.0.2+13-58)
# Java VM: OpenJDK 64-Bit Server VM (21.0.2+13-58, mixed mode, sharing, tiered, compressed oops, compressed class ptrs, g1 gc, linux-amd64)
# Problematic frame:
# V  [libjvm.so+0x5bc42e][thread 289021 also had an error]
  ciReturnTypeEntry::translate_type_data_from(ReturnTypeEntry const*)+0x2e
#
# Core dump will be written. Default location: Core dumps may be processed with ""/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h %e"" (or dumping to /opt/local-ssd/buildkite/builds/bk-agent-prod-gcp-1707801153880524692/elastic/elasticsearch-periodic-platform-support/x-pack/plugin/enrich/build/testrun/test/core.288874)
#
# An error report file with more information is saved as:
# /opt/local-ssd/buildkite/builds/bk-agent-prod-gcp-1707801153880524692/elastic/elasticsearch-periodic-platform-support/x-pack/plugin/enrich/build/testrun/test/hs_err_pid288874.log

[error occurred during error reporting (), id 0xb, SIGSEGV (0xb) at pc=0x00007f5b777e7c18]
#
# If you would like to submit a bug report, please visit:
#   https://bugreport.java.com/bugreport/crash.jsp
#
```

The java process seems to encounter an memory issue when compiling the code. Not sure whether it is an infrastructure issue. The error report and reply file can be found in the uploaded artefact. Raising this so that experts in this area can take a look.",ywangd,closed,"[':Delivery/Build', ':Core/Infra/Core', '>test-failure', 'Team:Core/Infra', 'Team:Delivery', 'low-risk']",https://github.com/elastic/elasticsearch/issues/105475,2024-02-14T00:35:23Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/105475,"{
  ""application_resource"": ""unsure""
}"
179,105319,[CI] DatafeedJobsIT testCloseJobStopsLookbackOnlyDatafeed failing,"Massive test failure caused by same cause I believe
```
org.elasticsearch.xpack.ml.integration.DatafeedJobsIT > testCloseJobStopsLookbackOnlyDatafeed FAILED
    java.lang.AssertionError: Accounting breaker not reset to 0 on node: {javaRestTest-2}{AI_OXTb_TMKzfwvQ0ZiK-A}{NavONKciSdGkJJJJSILUsg}{127.0.0.1}{127.0.0.1:49160}{cdfhilmrstw}{testattr=test, ml.machine_memory=128845193216, ml.max_open_jobs=512, xpack.installed=true, ml.max_jvm_size=536870912, transform.node=true}
    Expected: <0L>
         but: was <2556L>
```

**Build scan:**
https://gradle-enterprise.elastic.co/s/2gwjhcrnlpp36/tests/:x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest/org.elasticsearch.xpack.ml.integration.DatafeedJobsIT/testCloseJobStopsLookbackOnlyDatafeed


**Reproduction line:**
```
gradlew ':x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest' --tests ""org.elasticsearch.xpack.ml.integration.DatafeedJobsIT.testCloseJobStopsLookbackOnlyDatafeed"" -Dtests.seed=EE012D91656F5705 -Dtests.locale=id-ID -Dtests.timezone=Africa/Lubumbashi -Druntime.java=21
```

**Applicable branches:**
7.17

**Reproduces locally?:**
Didn't try

**Failure history:**
[Failure dashboard for `org.elasticsearch.xpack.ml.integration.DatafeedJobsIT#testCloseJobStopsLookbackOnlyDatafeed`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testCloseJobStopsLookbackOnlyDatafeed'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.xpack.ml.integration.DatafeedJobsIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.AssertionError: Accounting breaker not reset to 0 on node: {javaRestTest-2}{AI_OXTb_TMKzfwvQ0ZiK-A}{NavONKciSdGkJJJJSILUsg}{127.0.0.1}{127.0.0.1:49160}{cdfhilmrstw}{testattr=test, ml.machine_memory=128845193216, ml.max_open_jobs=512, xpack.installed=true, ml.max_jvm_size=536870912, transform.node=true}
Expected: <0L>
     but: was <2556L>

  at __randomizedtesting.SeedInfo.seed([EE012D91656F5705:E5C3F2E29AB0C656]:0)
  at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
  at org.junit.Assert.assertThat(Assert.java:964)
  at org.elasticsearch.test.ExternalTestCluster.ensureEstimatedStats(ExternalTestCluster.java:177)
  at org.elasticsearch.test.TestCluster.assertAfterTest(TestCluster.java:83)
  at org.elasticsearch.test.ESIntegTestCase.afterInternal(ESIntegTestCase.java:622)
  at org.elasticsearch.test.ESIntegTestCase.cleanUpCluster(ESIntegTestCase.java:2396)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:1004)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)
  at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
  at org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)
  at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
  at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
  at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
  at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

```",volodk85,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/105319,2024-02-08T23:52:40Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/105319,"{
  ""application_resource"": ""yes""
}"
180,105043,ESQL:  Verify PushDownEval/Enrich/RegexExtract logical optimizer rules correctness,"### Description

Double check `PushDownEnrich` correctness in being pushed down within the plan. Add unit tests both at the logical and physical plan along with more CSV tests for various scenarios: with/without filters (some that can be pushed down, some that do not), projections and evals.

Relates #104957",costin,closed,"['>bug', 'Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/105043,2024-02-02T02:00:54Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/105043,"{
  ""application_resource"": ""unsure""
}"
181,104874,"Support Spatial Search in ES|QL (ST_INTERSECTS, ST_CONTAINS, ST_WITHIN and ST_DISJOINT)","### Description

The spatial search in Elasticsearch is directly backed by Lucene for four cases:

* Intersects
* Contains
* Within
* Disjoint

These can be exposed in ES|QL through four OGC compliant functions:

* `boolean ST_INTERSECTS(geomA, geomB)`
* `boolean ST_CONTAINS(geomA, geomB)`
* `boolean ST_WITHIN(geomA, geomB)`
* `boolean ST_DISJOINT(geomA, geomB)`

For example:

```
FROM airports
| EVAL polygon = TO_GEOSHAPE(""POLYGON((...))"")
| WHERE ST_INTERSECTS(location, polygon)
```

See the PostGIS documentation for inspiration: https://postgis.net/docs/ST_Intersects.html

The feature can be developed in several phases:

* Bring back `Intersects` prototype prototype from last summer
  * Expects constant string WKT
  * Does in-memory constant->triangle-tree and then internal intersects
* Support all kinds of fields (source, doc-values, constants, geo/cartesian, point/shape)
* LocalPhysicalPlanner support for push-down to Lucene
  * Handle special cases regarding cartesian data (not fully supported in Elasticsearch)

```[tasklist]
### Tasks
- [x] Bring back prototype from last summer (geo_point in polygon)
- [x] Support cartesian point in polygon
- [x] Support polyon intersects polygon
- [x] Support any geometry intersects any geometry
- [x] Support doc-values for point in polygon
- [x] Support doc-values for geometry intersects geometry
- [x] Support CONTAINS and WITHIN (keep in mind inverse commutative relationship for pushdown)
- [x] Support DISJOINT (special need for handling Cartesian, which Elasticsearch does not handle completely)
- [x] Documentation
```
",craigtaverner,closed,"['>enhancement', ':Analytics/Geo', 'Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/104874,2024-01-29T16:11:14Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/104874,"{
  ""application_resource"": ""unsure""
}"
182,104786,[CI] DockerTests test150MachineDependentHeap failing,"This failure started popping up on Jan 18 for the first time.

In this build scan, seems like the CLI tries to talk to ES, which exits unexpectedly while adding an index template. Exit code is 137, which our `TESTING.asciidoc` says means ""out of memory"".

Last logs from the test:
```
  1> {""@timestamp"":""2024-01-26T05:57:56.178Z"", ""log.level"": ""INFO"", ""message"":""adding index template [.monitoring-kibana-mb] for index patterns [.monitoring-kibana-8-*]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[c87ce626b1a7][masterService#updateTask][T#1]"",""log.logger"":""org.elasticsearch.cluster.metadata.MetadataIndexTemplateService"",""elasticsearch.cluster.uuid"":""Zav8rx__QLu6-mR0d8rhKw"",""elasticsearch.node.id"":""zBWe0QaMQH2aG-coUKwcNw"",""elasticsearch.node.name"":""c87ce626b1a7"",""elasticsearch.cluster.name"":""docker-cluster""}

  1> Stderr:
  1> Jan 26, 2024 5:57:39 AM sun.util.locale.provider.LocaleProviderAdapter <clinit>
  1> WARNING: COMPAT locale provider will be removed in a future release

  1> ERROR: Elasticsearch exited unexpectedly, with exit code 137
  1> [2024-01-26T06:00:39,763][INFO ][o.e.p.u.Shell            ] [TEST-DockerTests.test150MachineDependentHeap-seed#[AA6947360780C1A7]-workerest_thread_info] Ran: [bash, -c, docker rm -f c87ce626b1a7a8472325f9aa69a2c24a170f7ddaa96ec12b6dc0779507b2c8e8] exitCode = [0] stdout = [c87ce626b1a7a8472325f9aa69a2c24a170f7ddaa96ec12b6dc0779507b2c8e8] stderr = []
```

No repro line + trying to run from within IntelliJ somehow skips the test, so couldn't repro locally.

**Build scan:**
https://gradle-enterprise.elastic.co/s/gznltc2u4khos/tests/:qa:packaging:destructiveDistroTest.default-docker/org.elasticsearch.packaging.test.DockerTests/test150MachineDependentHeap


**Reproduction line:**
```
null
```

**Applicable branches:**
8.12

**Reproduces locally?:**
Didn't try

**Failure history:**
[Failure dashboard for `org.elasticsearch.packaging.test.DockerTests#test150MachineDependentHeap`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('test150MachineDependentHeap'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.packaging.test.DockerTests'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.AssertionError: Failed to check whether Elasticsearch had started. This could be because authentication isn't working properly. Check the container logs

  at __randomizedtesting.SeedInfo.seed([AA6947360780C1A7:603C4726C5DB4757]:0)
  at org.elasticsearch.packaging.util.docker.Docker.waitForElasticsearch(Docker.java:589)
  at org.elasticsearch.packaging.util.docker.Docker.waitForElasticsearch(Docker.java:574)
  at org.elasticsearch.packaging.test.DockerTests.machineDependentHeapTest(DockerTests.java:1056)
  at org.elasticsearch.packaging.test.DockerTests.test150MachineDependentHeap(DockerTests.java:1015)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
  at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

  Caused by: java.lang.RuntimeException: Elasticsearch did not start

    at org.elasticsearch.packaging.util.ServerUtils.waitForElasticsearch(ServerUtils.java:292)
    at org.elasticsearch.packaging.util.docker.Docker.lambda$waitForElasticsearch$10(Docker.java:587)
    at org.elasticsearch.packaging.util.docker.Docker.withLogging(Docker.java:604)
    at org.elasticsearch.packaging.util.docker.Docker.waitForElasticsearch(Docker.java:587)
    at org.elasticsearch.packaging.util.docker.Docker.waitForElasticsearch(Docker.java:574)
    at org.elasticsearch.packaging.test.DockerTests.machineDependentHeapTest(DockerTests.java:1056)
    at org.elasticsearch.packaging.test.DockerTests.test150MachineDependentHeap(DockerTests.java:1015)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
    at java.lang.reflect.Method.invoke(Method.java:580)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
    at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1583)

    Caused by: javax.net.ssl.SSLHandshakeException: Remote host terminated the handshake

      at sun.security.ssl.SSLSocketImpl.handleEOF(SSLSocketImpl.java:1714)
      at sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1514)
      at sun.security.ssl.SSLSocketImpl.readHandshakeRecord(SSLSocketImpl.java:1421)
      at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:455)
      at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:426)
      at org.apache.http.conn.ssl.SSLConnectionSocketFactory.createLayeredSocket(SSLConnectionSocketFactory.java:436)
      at org.apache.http.conn.ssl.SSLConnectionSocketFactory.connectSocket(SSLConnectionSocketFactory.java:384)
      at org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:142)
      at org.apache.http.impl.conn.PoolingHttpClientConnectionManager.connect(PoolingHttpClientConnectionManager.java:376)
      at org.apache.http.impl.execchain.MainClientExec.establishRoute(MainClientExec.java:393)
      at org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:236)
      at org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:186)
      at org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:89)
      at org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:110)
      at org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)
      at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:83)
      at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:56)
      at org.apache.http.client.fluent.Request.internalExecute(Request.java:173)
      at org.apache.http.client.fluent.Executor.execute(Executor.java:262)
      at org.elasticsearch.packaging.util.ServerUtils.execute(ServerUtils.java:145)
      at org.elasticsearch.packaging.util.ServerUtils.waitForElasticsearch(ServerUtils.java:241)
      at org.elasticsearch.packaging.util.docker.Docker.lambda$waitForElasticsearch$10(Docker.java:587)
      at org.elasticsearch.packaging.util.docker.Docker.withLogging(Docker.java:604)
      at org.elasticsearch.packaging.util.docker.Docker.waitForElasticsearch(Docker.java:587)
      at org.elasticsearch.packaging.util.docker.Docker.waitForElasticsearch(Docker.java:574)
      at org.elasticsearch.packaging.test.DockerTests.machineDependentHeapTest(DockerTests.java:1056)
      at org.elasticsearch.packaging.test.DockerTests.test150MachineDependentHeap(DockerTests.java:1015)
      at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
      at java.lang.reflect.Method.invoke(Method.java:580)
      at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
      at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
      at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
      at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
      at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
      at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
      at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
      at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
      at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
      at java.lang.Thread.run(Thread.java:1583)

      Caused by: java.io.EOFException: SSL peer shut down incorrectly

        at sun.security.ssl.SSLSocketInputRecord.read(SSLSocketInputRecord.java:494)
        at sun.security.ssl.SSLSocketInputRecord.readHeader(SSLSocketInputRecord.java:483)
        at sun.security.ssl.SSLSocketInputRecord.decode(SSLSocketInputRecord.java:160)
        at sun.security.ssl.SSLTransport.decode(SSLTransport.java:111)
        at sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1506)
        at sun.security.ssl.SSLSocketImpl.readHandshakeRecord(SSLSocketImpl.java:1421)
        at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:455)
        at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:426)
        at org.apache.http.conn.ssl.SSLConnectionSocketFactory.createLayeredSocket(SSLConnectionSocketFactory.java:436)
        at org.apache.http.conn.ssl.SSLConnectionSocketFactory.connectSocket(SSLConnectionSocketFactory.java:384)
        at org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:142)
        at org.apache.http.impl.conn.PoolingHttpClientConnectionManager.connect(PoolingHttpClientConnectionManager.java:376)
        at org.apache.http.impl.execchain.MainClientExec.establishRoute(MainClientExec.java:393)
        at org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:236)
        at org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:186)
        at org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:89)
        at org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:110)
        at org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)
        at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:83)
        at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:56)
        at org.apache.http.client.fluent.Request.internalExecute(Request.java:173)
        at org.apache.http.client.fluent.Executor.execute(Executor.java:262)
        at org.elasticsearch.packaging.util.ServerUtils.execute(ServerUtils.java:145)
        at org.elasticsearch.packaging.util.ServerUtils.waitForElasticsearch(ServerUtils.java:241)
        at org.elasticsearch.packaging.util.docker.Docker.lambda$waitForElasticsearch$10(Docker.java:587)
        at org.elasticsearch.packaging.util.docker.Docker.withLogging(Docker.java:604)
        at org.elasticsearch.packaging.util.docker.Docker.waitForElasticsearch(Docker.java:587)
        at org.elasticsearch.packaging.util.docker.Docker.waitForElasticsearch(Docker.java:574)
        at org.elasticsearch.packaging.test.DockerTests.machineDependentHeapTest(DockerTests.java:1056)
        at org.elasticsearch.packaging.test.DockerTests.test150MachineDependentHeap(DockerTests.java:1015)
        at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
        at java.lang.reflect.Method.invoke(Method.java:580)
        at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
        at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
        at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
        at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
        at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
        at java.lang.Thread.run(Thread.java:1583)

```",alex-spies,closed,"['blocker', ':Delivery/Packaging', '>test-failure', 'Team:Delivery']",https://github.com/elastic/elasticsearch/issues/104786,2024-01-26T09:19:15Z,9,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/104786,"{
  ""application_resource"": ""yes""
}"
183,104651,[CI] SuggestStatsIT testSimpleStats failing,"Looks like a genuine leak to me, perhaps we only just started to see this because of https://github.com/elastic/elasticsearch/pull/104588?

**Build scan:**
https://gradle-enterprise.elastic.co/s/xszrggp3wtbyk/tests/:server:internalClusterTest/org.elasticsearch.index.suggest.stats.SuggestStatsIT/testSimpleStats


**Reproduction line:**
```
./gradlew ':server:internalClusterTest' --tests ""org.elasticsearch.index.suggest.stats.SuggestStatsIT.testSimpleStats"" -Dtests.seed=A612D72765A35276 -Dtests.locale=hr-HR -Dtests.timezone=Asia/Irkutsk -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
[Failure dashboard for `org.elasticsearch.index.suggest.stats.SuggestStatsIT#testSimpleStats`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testSimpleStats'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.index.suggest.stats.SuggestStatsIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.AssertionError: 
Expected: an empty collection
     but: <[LEAK: ByteBuf.release() was not called before it's garbage-collected. See https://netty.io/wiki/reference-counted-objects.html for more information.
Recent access records: 
Created at:
	io.netty.buffer.PooledByteBufAllocator.newHeapBuffer(PooledByteBufAllocator.java:390)
	io.netty.buffer.AbstractByteBufAllocator.heapBuffer(AbstractByteBufAllocator.java:169)
	org.elasticsearch.transport.netty4.NettyAllocator$NoDirectBuffers.heapBuffer(NettyAllocator.java:287)
	org.elasticsearch.transport.netty4.NettyAllocator$1.obtain(NettyAllocator.java:135)
	org.elasticsearch.common.io.stream.RecyclerBytesStreamOutput.ensureCapacityFromPosition(RecyclerBytesStreamOutput.java:235)
	org.elasticsearch.common.io.stream.RecyclerBytesStreamOutput.ensureCapacity(RecyclerBytesStreamOutput.java:224)
	org.elasticsearch.common.io.stream.RecyclerBytesStreamOutput.writeBytes(RecyclerBytesStreamOutput.java:75)
	org.elasticsearch.common.io.Streams$FlushOnCloseOutputStream.writeBytes(Streams.java:220)
	org.elasticsearch.common.io.stream.StreamOutput.write(StreamOutput.java:491)
	com.fasterxml.jackson.core.json.UTF8JsonGenerator._flushBuffer(UTF8JsonGenerator.java:2203)
	com.fasterxml.jackson.core.json.UTF8JsonGenerator.close(UTF8JsonGenerator.java:1227)
	org.elasticsearch.xcontent.provider.json.JsonXContentGenerator.close(JsonXContentGenerator.java:592)
	org.elasticsearch.xcontent.XContentBuilder.close(XContentBuilder.java:1259)
	org.elasticsearch.common.bytes.BytesReference.bytes(BytesReference.java:36)
	org.elasticsearch.rest.RestResponse.<init>(RestResponse.java:138)
	org.elasticsearch.rest.RestResponse.<init>(RestResponse.java:108)
	org.elasticsearch.rest.action.RestActionListener.onFailure(RestActionListener.java:55)
	org.elasticsearch.rest.action.RestActionListener.onResponse(RestActionListener.java:40)
	org.elasticsearch.rest.action.RestCancellableNodeClient$1.onResponse(RestCancellableNodeClient.java:87)
	org.elasticsearch.rest.action.RestCancellableNodeClient$1.onResponse(RestCancellableNodeClient.java:81)
	org.elasticsearch.action.ActionListener$3.onResponse(ActionListener.java:314)
	org.elasticsearch.tasks.TaskManager$1.onResponse(TaskManager.java:202)
	org.elasticsearch.tasks.TaskManager$1.onResponse(TaskManager.java:196)
	org.elasticsearch.action.ActionListenerImplementations$RunBeforeActionListener.onResponse(ActionListenerImplementations.java:307)
	org.elasticsearch.action.ActionListener$3.onResponse(ActionListener.java:314)
	org.elasticsearch.action.ActionListenerImplementations$MappedActionListener.onResponse(ActionListenerImplementations.java:95)
	org.elasticsearch.health.HealthService.validateResultsAndNotifyListener(HealthService.java:196)
	org.elasticsearch.health.HealthService$1.lambda$calculateFilteredIndicatorsRunnable$1(HealthService.java:156)
	org.elasticsearch.action.ActionRunnable$4.doRun(ActionRunnable.java:95)
	org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:917)
	java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	java.base/java.lang.Thread.run(Thread.java:1583)]>

  at __randomizedtesting.SeedInfo.seed([A612D72765A35276:E3D6AE0D9C1FC786]:0)
  at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
  at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:6)
  at org.elasticsearch.test.ESTestCase.assertThat(ESTestCase.java:2119)
  at org.elasticsearch.test.ESTestCase.checkStaticState(ESTestCase.java:729)
  at org.elasticsearch.test.ESTestCase.after(ESTestCase.java:520)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:1004)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at org.junit.rules.RunRules.evaluate(RunRules.java:20)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

```",DaveCTurner,closed,"[':Distributed Coordination/Network', '>test-failure', 'Team:Distributed (Obsolete)', 'low-risk']",https://github.com/elastic/elasticsearch/issues/104651,2024-01-23T12:18:11Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/104651,"{
  ""application_resource"": ""yes""
}"
184,104264,@elastic/transport is breaking is crashing my node app,"### Elasticsearch Version

8.10.0

### Installed Plugins

_No response_

### Java Version

19

### OS Version

m1

### Problem Description

```
import { Client } from '@elastic/elasticsearch';

const esClient =  new Client({
      node: config.ELASTICSEARCH,
      maxRetries: 2,
      requestTimeout: 3000,
    })
```

it is causing an error and crashing my node app, because it needs a TLS CA certificate

```
ConnectionError: other side closed - Local: ::1:58714, Remote: ::1:9200
at SniffingTransport.request (/node_modules/@elastic/transport/src/Transport.ts:585:17)
at Client.IndexApi (/node_modules/@elastic/elasticsearch/src/api/api/index.ts:75:10)
````

### Steps to Reproduce

here is our docker compose with mTLS and certs generation

```yml
version: '3.8'
services:
  setup:
    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}
    volumes:
      - certs:/usr/share/elasticsearch/config/certs
    user: '0'
    command: >
      bash -c '
        if [ x${ELASTIC_PASSWORD} == x ]; then
          echo ""Set the ELASTIC_PASSWORD environment variable in the .env file"";
          exit 1;
        elif [ x${KIBANA_PASSWORD} == x ]; then
          echo ""Set the KIBANA_PASSWORD environment variable in the .env file"";
          exit 1;
        fi;
        if [ ! -f config/certs/ca.zip ]; then
          echo ""Creating CA"";
          bin/elasticsearch-certutil ca --silent --pem -out config/certs/ca.zip;
          unzip config/certs/ca.zip -d config/certs;
        fi;
        if [ ! -f config/certs/certs.zip ]; then
          echo ""Creating certs"";
          echo -ne \
          ""instances:\n""\
          ""  - name: es01\n""\
          ""    dns:\n""\
          ""      - es01\n""\
          ""      - localhost\n""\
          ""    ip:\n""\
          ""      - 127.0.0.1\n""\
          ""  - name: kibana\n""\
          ""    dns:\n""\
          ""      - kibana\n""\
          ""      - localhost\n""\
          ""    ip:\n""\
          ""      - 127.0.0.1\n""\
          ""  - name: fleet-server\n""\
          ""    dns:\n""\
          ""      - fleet-server\n""\
          ""      - localhost\n""\
          ""    ip:\n""\
          ""      - 127.0.0.1\n""\
          > config/certs/instances.yml;
          bin/elasticsearch-certutil cert --silent --pem -out config/certs/certs.zip --in config/certs/instances.yml --ca-cert config/certs/ca/ca.crt --ca-key config/certs/ca/ca.key;
          unzip config/certs/certs.zip -d config/certs;
        fi;
        echo ""Setting file permissions""
        chown -R root:root config/certs;
        find . -type d -exec chmod 750 \{\} \;;
        find . -type f -exec chmod 640 \{\} \;;
        echo ""Waiting for Elasticsearch availability"";
        until curl -s --cacert config/certs/ca/ca.crt https://es01:9200 | grep -q ""missing authentication credentials""; do sleep 30; done;
        echo ""Setting kibana_system password"";
        until curl -s -X POST --cacert config/certs/ca/ca.crt -u ""elastic:${ELASTIC_PASSWORD}"" -H ""Content-Type: application/json"" https://es01:9200/_security/user/kibana_system/_password -d ""{\""password\"":\""${KIBANA_PASSWORD}\""}"" | grep -q ""^{}""; do sleep 10; done;
        echo ""All done!"";
      '
    healthcheck:
      test: ['CMD-SHELL', '[ -f config/certs/es01/es01.crt ]']
      interval: 1s
      timeout: 5s
      retries: 120

  es01:
    depends_on:
      setup:
        condition: service_healthy
    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}
    labels:
      co.elastic.logs/module: elasticsearch
    volumes:
      - certs:/usr/share/elasticsearch/config/certs
      - esdata01:/usr/share/elasticsearch/data
    ports:
      - ${ES_PORT}:9200
    environment:
      - node.name=es01
      - cluster.name=${CLUSTER_NAME}
      - discovery.type=single-node
      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}
      - bootstrap.memory_lock=true
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=true
      - xpack.security.http.ssl.key=certs/es01/es01.key
      - xpack.security.http.ssl.certificate=certs/es01/es01.crt
      - xpack.security.http.ssl.certificate_authorities=certs/ca/ca.crt
      - xpack.security.transport.ssl.enabled=true
      - xpack.security.transport.ssl.key=certs/es01/es01.key
      - xpack.security.transport.ssl.certificate=certs/es01/es01.crt
      - xpack.security.transport.ssl.certificate_authorities=certs/ca/ca.crt
      - xpack.security.transport.ssl.verification_mode=certificate
      - xpack.license.self_generated.type=${LICENSE}
    mem_limit: ${ES_MEM_LIMIT}
    ulimits:
      memlock:
        soft: -1
        hard: -1
    healthcheck:
      test:
        [
          'CMD-SHELL',
          ""curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'"",
        ]
      interval: 10s
      timeout: 10s
      retries: 120

  kibana:
    depends_on:
      es01:
        condition: service_healthy
    image: docker.elastic.co/kibana/kibana:${STACK_VERSION}
    labels:
      co.elastic.logs/module: kibana
    volumes:
      - certs:/usr/share/kibana/config/certs
      - kibanadata:/usr/share/kibana/data
      - ./observability/kibana.yml:/usr/share/kibana/config/kibana.yml:ro
    ports:
      - ${KIBANA_PORT}:5601
    environment:
      - SERVERNAME=kibana
      - ELASTICSEARCH_HOSTS=https://es01:9200
      - ELASTICSEARCH_USERNAME=kibana_system
      - ELASTICSEARCH_PASSWORD=${KIBANA_PASSWORD}
      - ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES=config/certs/ca/ca.crt
      - XPACK_SECURITY_ENCRYPTIONKEY=${ENCRYPTION_KEY}
      - XPACK_ENCRYPTEDSAVEDOBJECTS_ENCRYPTIONKEY=${ENCRYPTION_KEY}
      - XPACK_REPORTING_ENCRYPTIONKEY=${ENCRYPTION_KEY}
      - XPACK_REPORTING_KIBANASERVER_HOSTNAME=localhost
      - SERVER_SSL_ENABLED=true
      - SERVER_SSL_CERTIFICATE=config/certs/kibana/kibana.crt
      - SERVER_SSL_KEY=config/certs/kibana/kibana.key
      - SERVER_SSL_CERTIFICATEAUTHORITIES=config/certs/ca/ca.crt
      - ELASTIC_APM_SECRET_TOKEN=${ELASTIC_APM_SECRET_TOKEN}
    mem_limit: ${KB_MEM_LIMIT}
    healthcheck:
      test:
        [
          'CMD-SHELL',
          ""curl -I -s --cacert config/certs/ca/ca.crt https://localhost:5601 | grep -q 'HTTP/1.1 302 Found'"",
        ]
      interval: 10s
      timeout: 10s
      retries: 120

  metricbeat01:
    depends_on:
      es01:
        condition: service_healthy
      kibana:
        condition: service_healthy
    image: docker.elastic.co/beats/metricbeat:${STACK_VERSION}
    user: root
    volumes:
      - certs:/usr/share/metricbeat/certs
      - metricbeatdata01:/usr/share/metricbeat/data
      - './observability/metricbeat.yml:/usr/share/metricbeat/metricbeat.yml:ro'
      - '/var/run/docker.sock:/var/run/docker.sock:ro'
      - '/sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro'
      - '/proc:/hostfs/proc:ro'
      - '/:/hostfs:ro'
    environment:
      - ELASTIC_USER=elastic
      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}
      - ELASTIC_HOSTS=https://es01:9200
      - KIBANA_HOSTS=https://kibana:5601
      - LOGSTASH_HOSTS=http://logstash01:9600
      - CA_CERT=certs/ca/ca.crt
      - ES_CERT=certs/es01/es01.crt
      - ES_KEY=certs/es01/es01.key
      - KB_CERT=certs/kibana/kibana.crt
      - KB_KEY=certs/kibana/kibana.key
    command: -strict.perms=false

  filebeat01:
    depends_on:
      es01:
        condition: service_healthy
    image: docker.elastic.co/beats/filebeat:${STACK_VERSION}
    user: root
    volumes:
      - certs:/usr/share/filebeat/certs
      - filebeatdata01:/usr/share/filebeat/data
      - './filebeat_ingest_data/:/usr/share/filebeat/ingest_data/'
      - './observability/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro'
      - '/var/lib/docker/containers:/var/lib/docker/containers:ro'
      - '/var/run/docker.sock:/var/run/docker.sock:ro'
    environment:
      - ELASTIC_USER=elastic
      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}
      - ELASTIC_HOSTS=https://es01:9200
      - KIBANA_HOSTS=https://kibana:5601
      - LOGSTASH_HOSTS=http://logstash01:9600
      - CA_CERT=certs/ca/ca.crt
    command: -strict.perms=false

  logstash01:
    depends_on:
      es01:
        condition: service_healthy
      kibana:
        condition: service_healthy
    image: docker.elastic.co/logstash/logstash:${STACK_VERSION}
    labels:
      co.elastic.logs/module: logstash
    user: root
    volumes:
      - certs:/usr/share/logstash/certs
      - logstashdata01:/usr/share/logstash/data
      - './logstash_ingest_data/:/usr/share/logstash/ingest_data/'
      - './observability/logstash.conf:/usr/share/logstash/pipeline/logstash.conf:ro'
    environment:
      - xpack.monitoring.enabled=false
      - ELASTIC_USER=elastic
      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}
      - ELASTIC_HOSTS=https://es01:9200

  fleet-server:
    depends_on:
      kibana:
        condition: service_healthy
      es01:
        condition: service_healthy
    image: docker.elastic.co/beats/elastic-agent:${STACK_VERSION}
    volumes:
      - certs:/certs
      - fleetserverdata:/usr/share/elastic-agent
      - '/var/lib/docker/containers:/var/lib/docker/containers:ro'
      - '/var/run/docker.sock:/var/run/docker.sock:ro'
      - '/sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro'
      - '/proc:/hostfs/proc:ro'
      - '/:/hostfs:ro'
    ports:
      - ${FLEET_PORT}:8220
      - ${APMSERVER_PORT}:8200
    user: root
    environment:
      - SSL_CERTIFICATE_AUTHORITIES=/certs/ca/ca.crt
      - CERTIFICATE_AUTHORITIES=/certs/ca/ca.crt
      - FLEET_CA=/certs/ca/ca.crt
      - FLEET_ENROLL=1
      - FLEET_INSECURE=true
      - FLEET_SERVER_ELASTICSEARCH_CA=/certs/ca/ca.crt
      - FLEET_SERVER_ELASTICSEARCH_HOST=https://es01:9200
      - FLEET_SERVER_ELASTICSEARCH_INSECURE=true
      - FLEET_SERVER_ENABLE=1
      - FLEET_SERVER_CERT=/certs/fleet-server/fleet-server.crt
      - FLEET_SERVER_CERT_KEY=/certs/fleet-server/fleet-server.key
      - FLEET_SERVER_INSECURE_HTTP=true
      - FLEET_SERVER_POLICY_ID=fleet-server-policy
      - FLEET_URL=https://fleet-server:8220
      - KIBANA_FLEET_CA=/certs/ca/ca.crt
      - KIBANA_FLEET_SETUP=1
      - KIBANA_FLEET_USERNAME=elastic
      - KIBANA_FLEET_PASSWORD=${ELASTIC_PASSWORD}
      - KIBANA_HOST=https://kibana:5601
```

### Logs (if relevant)

```
ConnectionError: other side closed - Local: ::1:58714, Remote: ::1:9200
at SniffingTransport.request (/node_modules/@elastic/transport/src/Transport.ts:585:17)
at Client.IndexApi (/node_modules/@elastic/elasticsearch/src/api/api/index.ts:75:10)
````",sibelius,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/104264,2024-01-11T14:16:03Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/104264,"{
  ""application_resource"": ""unsure""
}"
185,104215,[docker-compose] kibana container error log: resource_already_exists_exception: index [.apm-agent-configuration/sB9zCdtATuylj1_vgWgY4g] already exists,"### Elasticsearch Version

8.11.3

### Installed Plugins

default

### Java Version

_bundled_

### OS Version

Darwin Kernel Version 22.1.0 (macOS)

### Problem Description

I have referred to the official [docker-compose.yml](https://github.com/elastic/elasticsearch/blob/8.11/docs/reference/setup/install/docker/docker-compose.yml) to establish my three node ES clusters. I did not change `yml` file, below is my `.env` file:
```
# Password for the 'elastic' user (at least 6 characters)
ELASTIC_PASSWORD=123456

# Password for the 'kibana_system' user (at least 6 characters)
KIBANA_PASSWORD=123456

# Version of Elastic products
STACK_VERSION=8.11.3

# Set the cluster name
CLUSTER_NAME=docker-cluster

# Set to 'basic' or 'trial' to automatically start the 30-day trial
LICENSE=basic
#LICENSE=trial

# Port to expose Elasticsearch HTTP API to the host
ES_PORT=9200
#ES_PORT=127.0.0.1:9200

# Port to expose Kibana to the host
KIBANA_PORT=5601
#KIBANA_PORT=80

# Increase or decrease based on the available host memory (in bytes)
MEM_LIMIT=512241824

# Project namespace (defaults to the current folder name if not set)
COMPOSE_PROJECT_NAME=test
``` 

then I executed the command with following:
```
$ docker compose up -d

$ docker-compose ps
NAME                COMMAND                  SERVICE             STATUS              PORTS
test-es01-1         ""/bin/tini -- /usr/lâ€¦""   es01                running (healthy)   0.0.0.0:9200->9200/tcp, 9300/tcp
test-es02-1         ""/bin/tini -- /usr/lâ€¦""   es02                running (healthy)   9200/tcp, 9300/tcp
test-es03-1         ""/bin/tini -- /usr/lâ€¦""   es03                running (healthy)   9200/tcp, 9300/tcp
test-kibana-1       ""/bin/tini -- /usr/lâ€¦""   kibana              running (healthy)   0.0.0.0:5601->5601/tcp
test-setup-1        ""/bin/tini -- /usr/lâ€¦""   setup               exited (0)  
```
and I checked container log of `test-kibana-1`:
```
2024-01-11 00:19:39 [2024-01-10T16:19:39.758+00:00][INFO ][status] Kibana is now degraded (was available)
2024-01-11 00:19:46 [2024-01-10T16:19:46.026+00:00][INFO ][status] Kibana is now available (was degraded)
2024-01-11 00:20:00 [2024-01-10T16:20:00.784+00:00][INFO ][status] Kibana is now degraded (was available)
2024-01-11 00:20:03 [2024-01-10T16:20:03.948+00:00][INFO ][plugins.fleet] Fleet Usage: {""agents_enabled"":true,""agents"":{""total_enrolled"":0,""healthy"":0,""unhealthy"":0,""offline"":0,""inactive"":0,""unenrolled"":0,""total_all_statuses"":0,""updating"":0},""fleet_server"":{""total_all_statuses"":0,""total_enrolled"":0,""healthy"":0,""unhealthy"":0,""offline"":0,""updating"":0,""num_host_urls"":0}}
2024-01-11 00:20:04 [2024-01-10T16:20:04.381+00:00][WARN ][plugins.apm] Could not create index: '.apm-agent-configuration'. Retrying...
2024-01-11 00:20:04 [2024-01-10T16:20:04.382+00:00][WARN ][plugins.apm] ResponseError: resource_already_exists_exception
2024-01-11 00:20:04     Root causes:
2024-01-11 00:20:04             resource_already_exists_exception: index [.apm-agent-configuration/sB9zCdtATuylj1_vgWgY4g] already exists
2024-01-11 00:20:04     at KibanaTransport.request (/usr/share/kibana/node_modules/@elastic/transport/lib/Transport.js:479:27)
2024-01-11 00:20:04     at processTicksAndRejections (node:internal/process/task_queues:95:5)
2024-01-11 00:20:04     at KibanaTransport.request (/usr/share/kibana/node_modules/@kbn/core-elasticsearch-client-server-internal/src/create_transport.js:51:16)
2024-01-11 00:20:04     at Indices.create (/usr/share/kibana/node_modules/@elastic/elasticsearch/lib/api/api/indices.js:191:16)
2024-01-11 00:20:04     at /usr/share/kibana/node_modules/@kbn/observability-plugin/server/utils/create_or_update_index.js:39:12
2024-01-11 00:20:04     at RetryOperation._fn (/usr/share/kibana/node_modules/p-retry/index.js:50:12)
```

- I can access Kibana's login page `http://localhost:5601`, but I encountered an error while logging in.
- ES cluster health api responsed `green` color.

### Steps to Reproduce

described on above.

### Logs (if relevant)

_No response_",chaseSpace,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/104215,2024-01-10T16:43:23Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/104215,"{
  ""application_resource"": ""yes""
}"
186,104110,Re-enable HeapAttackIT,"The HeapAttackIT suite frequently failed and was muted. We need to run it through multiple iterations on private CI, investigating failures, and fixing any unaccounted memory issues before re-enabling it.",dnhatn,closed,"['Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/104110,2024-01-09T06:04:54Z,17,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/104110,"{
  ""application_resource"": ""yes""
}"
187,104104,[CI] MixedClusterClientYamlTestSuiteIT test {p0=indices.stats/13_fields/Fields - _all metric} failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/sln5uimq3ohfu/tests/:qa:mixed-cluster:v8.4.3%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=indices.stats%2F13_fields%2FFields%20-%20_all%20metric%7D


**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v8.4.3#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=indices.stats/13_fields/Fields - _all metric}"" -Dtests.seed=5D1BBF80040CA0A5 -Dtests.bwc=true -Dtests.locale=es-PA -Dtests.timezone=Asia/Tbilisi -Druntime.java=21
```

**Applicable branches:**
8.11

**Reproduces locally?:**
Didn't try

**Failure history:**
[Failure dashboard for `org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT#test {p0=indices.stats/13_fields/Fields - _all metric}`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('test%20%7Bp0%3Dindices.stats/13_fields/Fields%20-%20_all%20metric%7D'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.AssertionError: Failure at [indices.stats/13_fields:144]: field [_all.total.fielddata.memory_size_in_bytes] is not greater than [0]
Expected: a value greater than <0>
     but: <0> was equal to <0>

  at __randomizedtesting.SeedInfo.seed([5D1BBF80040CA0A5:D54F805AAAF0CD5D]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:582)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

  Caused by: java.lang.AssertionError: field [_all.total.fielddata.memory_size_in_bytes] is not greater than [0]
  Expected: a value greater than <0>
       but: <0> was equal to <0>

    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
    at org.junit.Assert.assertThat(Assert.java:956)
    at org.elasticsearch.test.rest.yaml.section.GreaterThanAssertion.doAssert(GreaterThanAssertion.java:64)
    at org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:65)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:562)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
    at java.lang.reflect.Method.invoke(Method.java:580)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1583)

```",jonathan-buttner,closed,"['>test-failure', ':Data Management/Indices APIs', 'Team:Data Management', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/104104,2024-01-08T21:52:09Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/104104,"{
  ""application_resource"": ""yes""
}"
188,104071,[CI] org.elasticsearch.xpack.ml.integration.MlDistributedFailureIT > testCloseUnassignedJobAndDatafeed FAILED,"Not sure if this is related to how the test finished, seems like it wasn't able to commit some cluster state.

### CI Link

https://gradle-enterprise.elastic.co/s/koy66u5rtoz6m/console-log?page=16

### Repro line

`./gradlew ':x-pack:plugin:ml:internalClusterTest' --tests ""org.elasticsearch.xpack.ml.integration.MlDistributedFailureIT.testCloseUnassignedJobAndDatafeed"" -Dtests.seed=9F7C125D3F23ADBF -Dtests.locale=es-PR -Dtests.timezone=Indian/Kerguelen -Druntime.java=21`

### Does it reproduce?

No

### Applicable branches

main

### Failure history

_No response_

### Failure excerpt

```

org.elasticsearch.xpack.ml.integration.MlDistributedFailureIT > testCloseUnassignedJobAndDatafeed FAILED | Â 
-- | --
Â  | java.lang.AssertionError: | Â 
Â  | Expected: an empty collection | Â 
Â  | but: <[LEAK: resource was not cleaned up before it was garbage-collected. | Â 
Â  | Recent access records: | Â 
Â  | Created at: | Â 
Â  | org.elasticsearch.action.search.ArraySearchPhaseResults.<init>(ArraySearchPhaseResults.java:25) | Â 
Â  | org.elasticsearch.action.search.QueryPhaseResultConsumer.<init>(QueryPhaseResultConsumer.java:85) | Â 
Â  | org.elasticsearch.action.search.SearchPhaseController.newSearchPhaseResults(SearchPhaseController.java:807) | Â 
Â  | org.elasticsearch.action.search.TransportSearchAction$AsyncSearchActionProvider.newSearchPhase(TransportSearchAction.java:1298) | Â 
Â  | org.elasticsearch.action.search.TransportSearchAction.executeSearch(TransportSearchAction.java:1127) | Â 
Â  | org.elasticsearch.action.search.TransportSearchAction.executeLocalSearch(TransportSearchAction.java:909) | Â 
Â  | org.elasticsearch.action.search.TransportSearchAction.lambda$executeRequest$10(TransportSearchAction.java:336) | Â 
Â  | org.elasticsearch.action.ActionListenerImplementations$ResponseWrappingActionListener.onResponse(ActionListenerImplementations.java:236) | Â 
Â  | org.elasticsearch.index.query.Rewriteable.rewriteAndFetch(Rewriteable.java:109) | Â 
Â  | org.elasticsearch.index.query.Rewriteable.rewriteAndFetch(Rewriteable.java:77) | Â 
Â  | org.elasticsearch.action.search.TransportSearchAction.executeRequest(TransportSearchAction.java:448) | Â 
Â  | org.elasticsearch.action.search.TransportSearchAction.doExecute(TransportSearchAction.java:303) | Â 
Â  | org.elasticsearch.action.search.TransportSearchAction.doExecute(TransportSearchAction.java:112) | Â 
Â  | org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:87) | Â 
Â  | org.elasticsearch.action.support.ActionFilter$Simple.apply(ActionFilter.java:53) | Â 
Â  | org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:85) | Â 
Â  | org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:62) | Â 
Â  | org.elasticsearch.tasks.TaskManager.registerAndExecute(TaskManager.java:196) | Â 
Â  | org.elasticsearch.client.internal.node.NodeClient.executeLocally(NodeClient.java:108) | Â 
Â  | org.elasticsearch.client.internal.node.NodeClient.doExecute(NodeClient.java:86) | Â 
Â  | org.elasticsearch.client.internal.support.AbstractClient.execute(AbstractClient.java:361) | Â 
Â  | org.elasticsearch.client.internal.support.AbstractClient.search(AbstractClient.java:496) | Â 
Â  | org.elasticsearch.xpack.core.ClientHelper.executeAsyncWithOrigin(ClientHelper.java:222) | Â 
Â  | org.elasticsearch.xpack.ml.job.persistence.JobConfigProvider.expandJobs(JobConfigProvider.java:585) | Â 
Â  | org.elasticsearch.xpack.ml.job.JobManager.expandJobBuilders(JobManager.java:170) | Â 
Â  | org.elasticsearch.xpack.ml.action.TransportGetJobsAction.masterOperation(TransportGetJobsAction.java:75) | Â 
Â  | org.elasticsearch.xpack.ml.action.TransportGetJobsAction.masterOperation(TransportGetJobsAction.java:34) | Â 
Â  | org.elasticsearch.action.support.master.TransportMasterNodeAction.executeMasterOperation(TransportMasterNodeAction.java:125) | Â 
Â  | org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction.lambda$doStart$3(TransportMasterNodeAction.java:236) | Â 
Â  | org.elasticsearch.action.ActionRunnable$4.doRun(ActionRunnable.java:95) | Â 
Â  | org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) | Â 
Â  | org.elasticsearch.common.util.concurrent.EsExecutors$DirectExecutorService.execute(EsExecutors.java:238) | Â 
Â  | org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction.doStart(TransportMasterNodeAction.java:236) | Â 
Â  | org.elasticsearch.action.support.master.TransportMasterNodeAction.doExecute(TransportMasterNodeAction.java:173) | Â 
Â  | org.elasticsearch.action.support.master.TransportMasterNodeAction.doExecute(TransportMasterNodeAction.java:55) | Â 
Â  | org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:87) | Â 
Â  | org.elasticsearch.action.support.ActionFilter$Simple.apply(ActionFilter.java:53) | Â 
Â  | org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:85) | Â 
Â  | org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:62) | Â 
Â  | org.elasticsearch.tasks.TaskManager.registerAndExecute(TaskManager.java:196) | Â 
Â  | org.elasticsearch.client.internal.node.NodeClient.executeLocally(NodeClient.java:108) | Â 
Â  | org.elasticsearch.client.internal.node.NodeClient.doExecute(NodeClient.java:86) | Â 
Â  | org.elasticsearch.client.internal.support.AbstractClient.execute(AbstractClient.java:361) | Â 
Â  | org.elasticsearch.xpack.core.ClientHelper.executeAsyncWithOrigin(ClientHelper.java:243) | Â 
Â  | org.elasticsearch.xpack.ml.job.task.OpenJobPersistentTasksExecutor$RevertToCurrentSnapshotAction.tryAction(OpenJobPersistentTasksExecutor.java:543) | Â 
Â  | org.elasticsearch.action.support.RetryableAction$1.doRun(RetryableAction.java:111) | Â 
Â  | org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:984) | Â 
Â  | org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) | Â 
Â  | java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) | Â 
Â  | java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) | Â 
Â  | java.base/java.lang.Thread.run(Thread.java:1583)]> | Â 
Â  | at __randomizedtesting.SeedInfo.seed([9F7C125D3F23ADBF:DC56C80530F35C6C]:0) | Â 
Â  | at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18) | Â 
Â  | at org.junit.Assert.assertThat(Assert.java:964) | Â 
Â  | at org.junit.Assert.assertThat(Assert.java:930) | Â 
Â  | at org.elasticsearch.test.ESTestCase.checkStaticState(ESTestCase.java:729) | Â 
Â  | at org.elasticsearch.test.ESTestCase.after(ESTestCase.java:520) | Â 
Â  | at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) | Â 
Â  | at java.base/java.lang.reflect.Method.invoke(Method.java:580) | Â 
Â  | at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758) | Â 
Â  | at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:1004) | Â 
Â  | at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36) | Â 
Â  | at org.junit.rules.RunRules.evaluate(RunRules.java:20) | Â 
Â  | at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48) | Â 
Â  | at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43) | Â 
Â  | at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45) | Â 
Â  | at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60) | Â 
Â  | at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44) | Â 
Â  | at org.junit.rules.RunRules.evaluate(RunRules.java:20) | Â 
Â  | at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36) | Â 
Â  | at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390) | Â 
Â  | at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843) | Â 
Â  | at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490) | Â 
Â  | at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955) | Â 
Â  | at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840) | Â 
Â  | at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891) | Â 
Â  | at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902) | Â 
Â  | at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43) | Â 
Â  | at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36) | Â 
Â  | at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38) | Â 
Â  | at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40) | Â 
Â  | at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40) | Â 
Â  | at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36) | Â 
Â  | at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36) | Â 
Â  | at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53) | Â 
Â  | at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43) | Â 
Â  | at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44) | Â 
Â  | at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60) | Â 
Â  | at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47) | Â 
Â  | at org.junit.rules.RunRules.evaluate(RunRules.java:20) | Â 
Â  | at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36) | Â 
Â  | at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390) | Â 
Â  | at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850) | Â 
Â  | at java.base/java.lang.Thread.run(Thread.java:1583)


```


<details><summary>More console output</summary>

```

1> [2024-01-08T18:48:34,322][INFO ][o.e.x.m.i.MlDistributedFailureIT] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] before test | Â 
-- | --
Â  | 1> [2024-01-08T18:48:34,327][INFO ][o.e.x.m.i.MlDistributedFailureIT] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] [MlDistributedFailureIT#testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign]: setting up test | Â 
Â  | 1> [2024-01-08T18:48:34,330][INFO ][o.e.t.InternalTestCluster] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] Setup InternalTestCluster [TEST-TEST_WORKER_VM=[926]-CLUSTER_SEED=[5997584836398292222]-HASH=[26AF09C4CEA]-cluster] with seed [533BB3A1D3CA1CFE] using [0] dedicated masters, [0] (data) nodes and [0] coord only nodes (master nodes are [auto-managed]) | Â 
Â  | 1> [2024-01-08T18:48:34,331][INFO ][o.e.x.m.i.MlDistributedFailureIT] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] [MlDistributedFailureIT#testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign]: all set up test | Â 
Â  | 1> [2024-01-08T18:48:34,339][INFO ][o.e.n.Node               ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] version[8.13.0-SNAPSHOT], pid[378403], build[unknown/012655d68ed7149bd287a8bf37c653dbd96bf098/2024-01-08T13:05:36.188992486Z], OS[Linux/4.19.0-25-cloud-amd64/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/21.0.1/21.0.1+12-29] | Â 
Â  | 1> [2024-01-08T18:48:34,339][INFO ][o.e.n.Node               ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] JVM home [/opt/buildkite-agent/.gradle/jdks/oracle_corporation-21-amd64-linux/jdk-21.0.1], using bundled JDK [false] | Â 
Â  | 1> [2024-01-08T18:48:34,339][INFO ][o.e.n.Node               ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] JVM arguments [-Des.scripting.update.ctx_in_params=false, -Des.search.rewrite_sort=true, -Des.transport.cname_in_publish_address=true, -Dgradle.dist.lib=/opt/buildkite-agent/.gradle/wrapper/dists/gradle-8.5-all/3zlzzgtsutfj0pbojr50n2l7z/gradle-8.5/lib, -Dgradle.user.home=/opt/buildkite-agent/.gradle, -Dgradle.worker.jar=/opt/buildkite-agent/.gradle/caches/8.5/workerMain/gradle-worker.jar, -Dio.netty.noKeySetOptimization=true, -Dio.netty.noUnsafe=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Djava.awt.headless=true, -Djava.locale.providers=SPI,COMPAT, -Djava.security.manager=allow, -Djna.nosys=true, -Dorg.gradle.internal.worker.tmpdir=/opt/local-ssd/buildkite/builds/bk-agent-prod-gcp-1704718960660249490/elastic/elasticsearch-periodic-platform-support/x-pack/plugin/ml/build/tmp/internalClusterTest/work, -Dorg.gradle.native=false, -Dtests.artifact=ml, -Dtests.gradle=true, -Dtests.logger.level=WARN, -Dtests.security.manager=true, -Dtests.seed=9F7C125D3F23ADBF, -Dtests.task=:x-pack:plugin:ml:internalClusterTest, --add-opens=java.base/java.security.cert=ALL-UNNAMED, --add-opens=java.base/java.nio.channels=ALL-UNNAMED, --add-opens=java.base/java.net=ALL-UNNAMED, --add-opens=java.base/javax.net.ssl=ALL-UNNAMED, --add-opens=java.base/java.nio.file=ALL-UNNAMED, --add-opens=java.base/java.time=ALL-UNNAMED, --add-opens=java.management/java.lang.management=ALL-UNNAMED, -XX:+HeapDumpOnOutOfMemoryError, -esa, -XX:+UseG1GC, -XX:HeapDumpPath=/opt/local-ssd/buildkite/builds/bk-agent-prod-gcp-1704718960660249490/elastic/elasticsearch-periodic-platform-support/x-pack/plugin/ml/build/heapdump, -Xms512m, -Xmx512m, -Dfile.encoding=UTF-8, -Djava.io.tmpdir=/opt/local-ssd/buildkite/builds/bk-agent-prod-gcp-1704718960660249490/elastic/elasticsearch-periodic-platform-support/x-pack/plugin/ml/build/testrun/internalClusterTest/temp, -Duser.country, -Duser.language=en, -Duser.variant, -ea] | Â 
Â  | 1> [2024-01-08T18:48:34,340][INFO ][o.e.n.Node               ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] Default Locale [es_PR] | Â 
Â  | 1> [2024-01-08T18:48:34,340][WARN ][o.e.n.Node               ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] version [8.13.0-SNAPSHOT] is a pre-release version of Elasticsearch and is not suitable for production | Â 
Â  | 1> [2024-01-08T18:48:34,340][WARN ][o.e.d.n.Node             ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""shared-data-path"" message=""setting [path.shared_data] is deprecated and will be removed in a future release"" | Â 
Â  | 1> [2024-01-08T18:48:34,457][WARN ][o.e.d.c.s.Settings       ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.elasticsearch.collection.enabled"" message=""[xpack.monitoring.elasticsearch.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:34,459][WARN ][o.e.d.c.s.Settings       ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.collection.enabled"" message=""[xpack.monitoring.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:34,464][INFO ][o.e.e.NodeEnvironment    ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] using [1] data paths, mounts [[/opt/local-ssd (/dev/nvme0n1)]], net usable_space [316.9gb], net total_space [368gb], types [ext4] | Â 
Â  | 1> [2024-01-08T18:48:34,465][INFO ][o.e.e.NodeEnvironment    ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] heap size [512mb], compressed ordinary object pointers [true] | Â 
Â  | 1> [2024-01-08T18:48:34,468][INFO ][o.e.n.Node               ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] node name [node_t0], node ID [ETYvSbF0THWFZZ064l8TkQ], cluster name [TEST-TEST_WORKER_VM=[926]-CLUSTER_SEED=[5997584836398292222]-HASH=[26AF09C4CEA]-cluster], roles [data_cold, data, remote_cluster_client, master, data_warm, data_content, transform, data_hot, ml, data_frozen, ingest] | Â 
Â  | 1> [2024-01-08T18:48:34,656][INFO ][o.e.f.FeatureService     ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] Registered local node features [features_supported, health.dsl.info, usage.data_tiers.precalculate_stats] | Â 
Â  | 1> [2024-01-08T18:48:34,680][WARN ][o.e.d.c.s.Settings       ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.elasticsearch.collection.enabled"" message=""[xpack.monitoring.elasticsearch.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:34,680][WARN ][o.e.d.c.s.Settings       ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.collection.enabled"" message=""[xpack.monitoring.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:34,681][INFO ][o.e.x.s.Security         ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] Security is disabled | Â 
Â  | 1> [2024-01-08T18:48:34,685][INFO ][o.e.i.r.RecoverySettings ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] using rate limit [174mb] with [default=174mb, read=0b, write=0b, max=0b] | Â 
Â  | 1> [2024-01-08T18:48:34,686][INFO ][o.e.d.DiscoveryModule    ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] using discovery type [multi-node] and seed hosts providers [settings, file] | Â 
Â  | 1> [2024-01-08T18:48:34,740][INFO ][o.e.n.Node               ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] initialized | Â 
Â  | 1> [2024-01-08T18:48:34,740][INFO ][o.e.n.Node               ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] starting ... | Â 
Â  | 1> [2024-01-08T18:48:34,756][INFO ][o.e.t.TransportService   ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] publish_address {127.0.0.1:21701}, bound_addresses {[::1]:21701}, {127.0.0.1:21701} | Â 
Â  | 1> [2024-01-08T18:48:34,779][INFO ][o.e.c.c.ClusterBootstrapService] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] this node has not joined a bootstrapped cluster yet; [cluster.initial_master_nodes] is set to [node_t0] | Â 
Â  | 1> [2024-01-08T18:48:34,793][INFO ][o.e.c.c.Coordinator      ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] setting initial configuration to VotingConfiguration{ETYvSbF0THWFZZ064l8TkQ} | Â 
Â  | 1> [2024-01-08T18:48:34,793][WARN ][o.e.d.FileBasedSeedHostsProvider] [node_t0] expected, but did not find, a dynamic hosts list at [/opt/local-ssd/buildkite/builds/bk-agent-prod-gcp-1704718960660249490/elastic/elasticsearch-periodic-platform-support/x-pack/plugin/ml/build/testrun/internalClusterTest/temp/org.elasticsearch.xpack.ml.integration.MlDistributedFailureIT_9F7C125D3F23ADBF-001/tempDir-002/config/unicast_hosts.txt] | Â 
Â  | 1> [2024-01-08T18:48:34,812][INFO ][o.e.n.Node               ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] started {node_t0}{ETYvSbF0THWFZZ064l8TkQ}{uRRvBlDNTQ-OBcomBGMbNg}{node_t0}{127.0.0.1}{127.0.0.1:21701}{cdfhilmrstw}{8.13.0}{7000099-8501000}{ml.machine_memory=101372280832, ml.allocated_processors_double=1.0, ml.config_version=12.0.0, ml.allocated_processors=1, ml.max_jvm_size=536870912, xpack.installed=true} | Â 
Â  | 1> [2024-01-08T18:48:34,870][INFO ][o.e.c.s.MasterService    ] [node_t0] elected-as-master ([1] nodes joined in term 1)[_FINISH_ELECTION_, {node_t0}{ETYvSbF0THWFZZ064l8TkQ}{uRRvBlDNTQ-OBcomBGMbNg}{node_t0}{127.0.0.1}{127.0.0.1:21701}{cdfhilmrstw}{8.13.0}{7000099-8501000} completing election], term: 1, version: 1, delta: master node changed {previous [], current [{node_t0}{ETYvSbF0THWFZZ064l8TkQ}{uRRvBlDNTQ-OBcomBGMbNg}{node_t0}{127.0.0.1}{127.0.0.1:21701}{cdfhilmrstw}{8.13.0}{7000099-8501000}]} | Â 
Â  | 1> [2024-01-08T18:48:34,878][INFO ][o.e.c.c.CoordinationState] [node_t0] cluster UUID set to [GBPvAPrnSaWEW_GcRSld4w] | Â 
Â  | 1> [2024-01-08T18:48:34,885][INFO ][o.e.c.s.ClusterApplierService] [node_t0] master node changed {previous [], current [{node_t0}{ETYvSbF0THWFZZ064l8TkQ}{uRRvBlDNTQ-OBcomBGMbNg}{node_t0}{127.0.0.1}{127.0.0.1:21701}{cdfhilmrstw}{8.13.0}{7000099-8501000}]}, term: 1, version: 1, reason: Publication{term=1, version=1} | Â 
Â  | 1> [2024-01-08T18:48:34,894][INFO ][o.e.c.c.NodeJoinExecutor ] [node_t0] node-join: [{node_t0}{ETYvSbF0THWFZZ064l8TkQ}{uRRvBlDNTQ-OBcomBGMbNg}{node_t0}{127.0.0.1}{127.0.0.1:21701}{cdfhilmrstw}{8.13.0}{7000099-8501000}] with reason [completing election] | Â 
Â  | 1> [2024-01-08T18:48:34,905][INFO ][o.e.g.GatewayService     ] [node_t0] recovered [0] indices into cluster_state | Â 
Â  | 1> [2024-01-08T18:48:34,913][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding index template [.ml-notifications-000002] for index patterns [.ml-notifications-000002] | Â 
Â  | 1> [2024-01-08T18:48:34,918][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding index template [.ml-stats] for index patterns [.ml-stats-*] | Â 
Â  | 1> [2024-01-08T18:48:34,922][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding index template [.ml-state] for index patterns [.ml-state*] | Â 
Â  | 1> [2024-01-08T18:48:34,934][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding index template [.ml-anomalies-] for index patterns [.ml-anomalies-*] | Â 
Â  | 1> [2024-01-08T18:48:34,964][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding index template [.monitoring-ent-search-mb] for index patterns [.monitoring-ent-search-8-*] | Â 
Â  | 1> [2024-01-08T18:48:34,988][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding index template [.monitoring-logstash-mb] for index patterns [.monitoring-logstash-8-*] | Â 
Â  | 1> [2024-01-08T18:48:34,992][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding template [.monitoring-alerts-7] for index patterns [.monitoring-alerts-7] | Â 
Â  | 1> [2024-01-08T18:48:35,010][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding template [.monitoring-kibana] for index patterns [.monitoring-kibana-7-*] | Â 
Â  | 1> [2024-01-08T18:48:35,018][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding template [.monitoring-logstash] for index patterns [.monitoring-logstash-7-*] | Â 
Â  | 1> [2024-01-08T18:48:35,030][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding template [.monitoring-beats] for index patterns [.monitoring-beats-7-*] | Â 
Â  | 1> [2024-01-08T18:48:35,043][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding template [.monitoring-es] for index patterns [.monitoring-es-7-*] | Â 
Â  | 1> [2024-01-08T18:48:35,053][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding index template [.monitoring-kibana-mb] for index patterns [.monitoring-kibana-8-*] | Â 
Â  | 1> [2024-01-08T18:48:35,076][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding index template [.monitoring-beats-mb] for index patterns [.monitoring-beats-8-*] | Â 
Â  | 1> [2024-01-08T18:48:35,111][INFO ][o.e.c.m.MetadataIndexTemplateService] [node_t0] adding index template [.monitoring-es-mb] for index patterns [.monitoring-es-8-*] | Â 
Â  | 1> [2024-01-08T18:48:35,127][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [node_t0] adding index lifecycle policy [ml-size-based-ilm-policy] | Â 
Â  | 1> [2024-01-08T18:48:35,147][WARN ][o.e.d.c.s.Settings       ] [node_t0] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.elasticsearch.collection.enabled"" message=""[xpack.monitoring.elasticsearch.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:35,148][WARN ][o.e.d.c.s.Settings       ] [node_t0] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.elasticsearch.collection.enabled"" message=""[xpack.monitoring.elasticsearch.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:35,148][WARN ][o.e.d.c.s.Settings       ] [node_t0] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.elasticsearch.collection.enabled"" message=""[xpack.monitoring.elasticsearch.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:35,150][WARN ][o.e.d.c.s.Settings       ] [node_t0] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.collection.enabled"" message=""[xpack.monitoring.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:35,150][WARN ][o.e.d.c.s.Settings       ] [node_t0] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.collection.enabled"" message=""[xpack.monitoring.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:35,150][WARN ][o.e.d.c.s.Settings       ] [node_t0] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.collection.enabled"" message=""[xpack.monitoring.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:35,168][WARN ][o.e.d.c.s.Settings       ] [node_t0] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.elasticsearch.collection.enabled"" message=""[xpack.monitoring.elasticsearch.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:35,168][WARN ][o.e.d.c.s.Settings       ] [node_t0] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.elasticsearch.collection.enabled"" message=""[xpack.monitoring.elasticsearch.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:35,168][WARN ][o.e.d.c.s.Settings       ] [node_t0] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.collection.enabled"" message=""[xpack.monitoring.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:35,169][WARN ][o.e.d.c.s.Settings       ] [node_t0] data_stream.dataset=""deprecation.elasticsearch"" data_stream.namespace=""default"" data_stream.type=""logs"" elasticsearch.event.category=""settings"" event.code=""xpack.monitoring.collection.enabled"" message=""[xpack.monitoring.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."" | Â 
Â  | 1> [2024-01-08T18:48:35,194][INFO ][o.e.h.n.s.HealthNodeTaskExecutor] [node_t0] Node [{node_t0}{ETYvSbF0THWFZZ064l8TkQ}] is selected as the current health node. | Â 
Â  | 1> [2024-01-08T18:48:35,197][INFO ][o.e.t.InternalTestCluster] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] changing cluster size from 1 data nodes to 0 | Â 
Â  | 1> [2024-01-08T18:48:35,197][INFO ][o.e.n.Node               ] [testClusterWithTwoMlNodes_StopsDatafeed_GivenJobFailsOnReassign] stopping ... | Â 
Â  | 1> [2024-01-08T18:48:35,200][ERROR][o.e.l.StartupSelfGeneratedLicenseTask] [node_t0] unexpected failure during [maybe generate license for cluster] | Â 
Â  | 1> org.elasticsearch.cluster.coordination.FailedToCommitClusterStateException: node closed | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.MasterService.forkQueueProcessor(MasterService.java:1292) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.MasterService$5.onCompletion(MasterService.java:1256) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.MasterService$5$1.onResponse(MasterService.java:1219) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.MasterService$5$1.onResponse(MasterService.java:1216) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListenerImplementations$RunBeforeActionListener.onResponse(ActionListenerImplementations.java:298) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListener$3.onResponse(ActionListener.java:312) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListenerImplementations$RunAfterActionListener.onResponse(ActionListenerImplementations.java:260) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListener$3.onResponse(ActionListener.java:312) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListenerImplementations$DelegatingResponseActionListener.onResponse(ActionListenerImplementations.java:182) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.MasterService$2.onResponse(MasterService.java:284) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.MasterService$2.onResponse(MasterService.java:281) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.MasterService$3.run(MasterService.java:451) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListenerImplementations$RunAfterActionListener.onFailure(ActionListenerImplementations.java:271) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListenerImplementations.safeOnFailure(ActionListenerImplementations.java:73) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListener$3.onFailure(ActionListener.java:322) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:62) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionListenerImplementations.safeOnFailure(ActionListenerImplementations.java:73) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.DelegatingActionListener.onFailure(DelegatingActionListener.java:27) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.support.ContextPreservingActionListener.onFailure(ContextPreservingActionListener.java:39) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.ActionRunnable.onFailure(ActionRunnable.java:146) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.common.util.concurrent.AbstractRunnable.onRejection(AbstractRunnable.java:52) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.onRejection(ThreadContext.java:972) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor.execute(EsThreadPoolExecutor.java:82) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.action.support.ThreadedActionListener.onResponse(ThreadedActionListener.java:31) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.coordination.Coordinator$CoordinatorPublication$4$1.onResponse(Coordinator.java:2024) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.coordination.Coordinator$CoordinatorPublication$4$1.onResponse(Coordinator.java:1956) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.ClusterApplierService$ClusterApplyActionListener.onResponse(ClusterApplierService.java:598) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.ClusterApplierService$ClusterApplyActionListener.onResponse(ClusterApplierService.java:569) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.ClusterApplierService.runTask(ClusterApplierService.java:439) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.run(ClusterApplierService.java:154) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:917) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:217) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:183) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?] | Â 
Â  | 1> 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?] | Â 
Â  | 1> 	at java.lang.Thread.run(Thread.java:1583) ~[?:?] | Â 
Â  | 1> Caused by: org.elasticsearch.common.util.concurrent.EsRejectedExecutionException: master service is in state [STOPPED] | Â 
Â  | 1> 	at org.elasticsearch.cluster.service.MasterService.getRejectionException(MasterService.java:1306) ~[elasticsearch-8.13.0-SNAPSHOT.jar:8.13.0-SNAPSHOT] | Â 
Â  | 1> 	... 37 more


```

</details>",jonathan-buttner,closed,"['>test-failure', ':ml', 'Team:ML', 'needs:risk']",https://github.com/elastic/elasticsearch/issues/104071,2024-01-08T16:57:42Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/104071,"{
  ""application_resource"": ""yes""
}"
189,103885,ES startup error: memory locking requested for elasticsearch process but memory is not locked,"### Elasticsearch Version

6.8.20

### Installed Plugins

_No response_

### Java Version

_bundled_ 1.8

### OS Version

centos7.9

### Problem Description

ES startup error: memory locking requested for elasticsearch process but memory is not locked

### Steps to Reproduce

ES startup error

### Logs (if relevant)

_No response_",smallemployees,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/103885,2024-01-04T01:53:49Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/103885,"{
  ""application_resource"": ""yes""
}"
190,103779,"GC rate increases randomly, increasing the cpu to 100%, dropping indexing rate in v8.11.3","### Elasticsearch Version

8.11.3

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux oke-cbamoicz23a-ndvldsi765q-skex3d2ztgq-6 5.4.17-2136.305.5.3.el8uek.x86_64 #2 SMP Thu Mar 17 10:45:33 PDT 2022 x86_64 x86_64 x86_64 GNU/Linux

### Problem Description

We were on version 8.7.0 from last few months and we saw no issues at all, cpu was always less then 30% overall.
our indexing rate stays around 25K/s Total, 12K/s primaries. search rate around 200/s. the cluster stores around 6TB of data at a time, 4500 shards.

We upgraded last week to 8.11.3, and the following issue started
- GC rate randomely starts increasing, and young GC reaches from 0 to 1, GC duration peaks from almost 0 to 50ms
- CPU percentage reaches 100% in next 30 mins 
- indexing rate drops from 25K/s to 2K/s

![image](https://github.com/elastic/elasticsearch/assets/13062907/c48b09d9-1d64-4a13-bbe2-c9c182bd539f)
![image](https://github.com/elastic/elasticsearch/assets/13062907/dd3fd96f-95b0-4a28-9ca2-e24ee5f158e4)

We also saw an increase in bulk average size after upgrade
![image](https://github.com/elastic/elasticsearch/assets/13062907/0c34916c-8e3d-4fa1-b65d-e7d027f8bc07)


### Steps to Reproduce

Upgrade ELK from 8.7.0 to 8.11.3

### Logs (if relevant)

```
06:48:34.126
elasticsearch.server
[elasticsearch.server][INFO] {""@timestamp"":""2024-01-02T01:18:34.126Z"", ""log.level"": ""INFO"", ""message"":""[gc][55872] overhead, spent [267ms] collecting in the last [1s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
06:51:21.404
elasticsearch.server
[elasticsearch.server][INFO] {""@timestamp"":""2024-01-02T01:21:21.404Z"", ""log.level"": ""INFO"", ""message"":""[gc][56039] overhead, spent [261ms] collecting in the last [1s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
06:51:22.409
elasticsearch.server
[elasticsearch.server][INFO] {""@timestamp"":""2024-01-02T01:21:22.409Z"", ""log.level"": ""INFO"", ""message"":""[gc][56040] overhead, spent [275ms] collecting in the last [1s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
07:07:56.858
elasticsearch.server
[elasticsearch.server][WARN] {""@timestamp"":""2024-01-02T01:37:56.858Z"", ""log.level"": ""WARN"", ""message"":""[gc][57034] overhead, spent [538ms] collecting in the last [1s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
07:14:11.143
elasticsearch.server
[elasticsearch.server][INFO] {""@timestamp"":""2024-01-02T01:44:11.143Z"", ""log.level"": ""INFO"", ""message"":""[gc][57408] overhead, spent [511ms] collecting in the last [1s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
07:18:21.260
elasticsearch.server
[elasticsearch.server][INFO] {""@timestamp"":""2024-01-02T01:48:21.260Z"", ""log.level"": ""INFO"", ""message"":""[gc][57658] overhead, spent [260ms] collecting in the last [1s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
07:34:36.831
elasticsearch.server
[elasticsearch.server][INFO] {""@timestamp"":""2024-01-02T02:04:36.831Z"", ""log.level"": ""INFO"", ""message"":""[gc][58633] overhead, spent [383ms] collecting in the last [1s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
07:35:21.847
elasticsearch.server
[elasticsearch.server][INFO] {""@timestamp"":""2024-01-02T02:05:21.847Z"", ""log.level"": ""INFO"", ""message"":""[gc][58678] overhead, spent [409ms] collecting in the last [1s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
07:35:59.860
elasticsearch.server
[elasticsearch.server][INFO] {""@timestamp"":""2024-01-02T02:05:59.860Z"", ""log.level"": ""INFO"", ""message"":""[gc][58716] overhead, spent [396ms] collecting in the last [1s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
07:36:34.865
elasticsearch.server
[elasticsearch.server][WARN] {""@timestamp"":""2024-01-02T02:06:34.865Z"", ""log.level"": ""WARN"", ""message"":""[gc][58750] overhead, spent [1s] collecting in the last [1.9s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
07:37:14.144
elasticsearch.server
[elasticsearch.server][INFO] {""@timestamp"":""2024-01-02T02:07:14.144Z"", ""log.level"": ""INFO"", ""message"":""[gc][58789] overhead, spent [395ms] collecting in the last [1.2s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
07:37:52.209
elasticsearch.server
[elasticsearch.server][INFO] {""@timestamp"":""2024-01-02T02:07:52.209Z"", ""log.level"": ""INFO"", ""message"":""[gc][58827] overhead, spent [438ms] collecting in the last [1s]"", ""ecs.version"": ""1.2.0"",""service.name"":""ES_ECS"",""event.dataset"":""elasticsearch.server"",""process.thread.name"":""elasticsearch[elasticsearch-es-ingest-data-hot-11][scheduler][T#1]"",""log.logger"":""org.elasticsearch.monitor.jvm.JvmGcMonitorService"",""elasticsearch.cluster.uuid"":""Z-shUT6qT0e8vWXtKaDfsQ"",""elasticsearch.node.id"":""4vz0m_DyQ_--ihrJXZqMjA"",""elasticsearch.node.name"":""elasticsearch-es-ingest-data-hot-11"",""elasticsearch.cluster.name"":""elasticsearch""}
```",nitesh8860,closed,"['>bug', ':Core/Infra/Core', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/103779,2024-01-02T06:18:17Z,15,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/103779,"{
  ""application_resource"": ""yes""
}"
191,103708,Search: Do something different with many shard failures,"### Elasticsearch Version

all

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

all

### Problem Description

I'm looking at a cascading failure caused by the loss of a node hosting many, many, many frozen shards. Coodinating nodes receive a ~6kb shard failure per shard. If you have tens of thousands of shards failing on search request those failure can really add up to some serious memory usage. Maybe we should truncate these? 

### Steps to Reproduce

See above.

### Logs (if relevant)

_No response_",nik9000,closed,"['>bug', 'Team:Search', 'priority:normal', ':Search Foundations/Search']",https://github.com/elastic/elasticsearch/issues/103708,2023-12-27T02:17:26Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/103708,"{
  ""application_resource"": ""yes""
}"
192,103666,ComputeService should not acquire and hold all SearchContexts at once,"If an ESQL query hits a thousand shards, then the ComputeService acquires and holds all search contexts. This can use a massive number of file descriptors and memory. I think we should rework the ComputeService to handle these incrementally.",dnhatn,closed,"['Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/103666,2023-12-21T19:17:52Z,13,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/103666,"{
  ""application_resource"": ""yes""
}"
193,103526,[CI] DataTierMixedIT testMixedTierCompatibility failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/wkijtlsflmzuu/tests/:x-pack:qa:mixed-tier-cluster:v8.9.2%23mixedClusterTest/org.elasticsearch.mixed.DataTierMixedIT/testMixedTierCompatibility


**Reproduction line:**
```
./gradlew ':x-pack:qa:mixed-tier-cluster:v8.9.2#mixedClusterTest' -Dtests.class=""org.elasticsearch.mixed.DataTierMixedIT"" -Dtests.method=""testMixedTierCompatibility"" -Dtests.seed=4D83673E628D581F -Dtests.bwc=true -Dtests.locale=es-DO -Dtests.timezone=Asia/Chungking -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
[Failure dashboard for `org.elasticsearch.mixed.DataTierMixedIT#testMixedTierCompatibility`](https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testMixedTierCompatibility'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.mixed.DataTierMixedIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium)))))


**Failure excerpt:**
```
java.lang.AssertionError: timed out waiting for green state for index [test-index] cluster state [{
  ""cluster_name"" : ""v8.9.2"",
  ""cluster_uuid"" : ""SR_Pw_WaQNKYdnALLByQ3Q"",
  ""version"" : 43,
  ""state_uuid"" : ""1K804oN8Qva3BObW7spwPg"",
  ""master_node"" : ""UuSv4yoiRuyazopsB9Uwvg"",
  ""blocks"" : { },
  ""nodes"" : {
    ""UuSv4yoiRuyazopsB9Uwvg"" : {
      ""name"" : ""v8.9.2-0"",
      ""ephemeral_id"" : ""fvexJHmQR6GP0CXHKE6ODg"",
      ""transport_address"" : ""127.0.0.1:46135"",
      ""external_id"" : ""v8.9.2-0"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""xpack.installed"" : ""true"",
        ""transform.config_version"" : ""10.0.0"",
        ""upgraded"" : ""true""
      },
      ""roles"" : [
        ""master""
      ],
      ""version"" : ""8.13.0""
    },
    ""62GBRNSbSYyag2703wgvcg"" : {
      ""name"" : ""v8.9.2-2"",
      ""ephemeral_id"" : ""qOazPmvER0usv8qBZ6xtEg"",
      ""transport_address"" : ""127.0.0.1:43391"",
      ""external_id"" : ""v8.9.2-2"",
      ""attributes"" : {
        ""xpack.installed"" : ""true"",
        ""testattr"" : ""test""
      },
      ""roles"" : [
        ""master""
      ],
      ""version"" : ""8.9.2""
    }
  },
  ""transport_versions"" : [
    {
      ""node_id"" : ""UuSv4yoiRuyazopsB9Uwvg"",
      ""transport_version"" : ""8562000""
    },
    {
      ""node_id"" : ""62GBRNSbSYyag2703wgvcg"",
      ""transport_version"" : ""8500020""
    }
  ],
  ""metadata"" : {
    ""cluster_uuid"" : ""SR_Pw_WaQNKYdnALLByQ3Q"",
    ""cluster_uuid_committed"" : true,
    ""cluster_coordination"" : {
      ""term"" : 4,
      ""last_committed_config"" : [
        ""62GBRNSbSYyag2703wgvcg"",
        ""UuSv4yoiRuyazopsB9Uwvg"",
        ""{bootstrap-placeholder}-v8.9.2-1""
      ],
      ""last_accepted_config"" : [
        ""62GBRNSbSYyag2703wgvcg"",
        ""UuSv4yoiRuyazopsB9Uwvg"",
        ""{bootstrap-placeholder}-v8.9.2-1""
      ],
      ""voting_config_exclusions"" : [ ]
    },
    ""templates"" : {
      "".monitoring-kibana"" : {
        ""order"" : 0,
        ""version"" : 8120099,
        ""index_patterns"" : [
          "".monitoring-kibana-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""timestamp"" : {
                ""type"" : ""date"",
                ""format"" : ""date_time""
              },
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""type"" : ""date"",
                    ""format"" : ""date_time""
                  }
                }
              },
              ""kibana_stats"" : {
                ""properties"" : {
                  ""usage"" : {
                    ""properties"" : {
                      ""index"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""kibana"" : {
                    ""properties"" : {
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""transport_address"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      },
                      ""snapshot"" : {
                        ""type"" : ""boolean""
                      },
                      ""status"" : {
                        ""type"" : ""keyword""
                      },
                      ""statuses"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""state"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      }
                    }
                  },
                  ""cloud"" : {
                    ""properties"" : {
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""id"" : {
                        ""type"" : ""keyword""
                      },
                      ""vm_type"" : {
                        ""type"" : ""keyword""
                      },
                      ""region"" : {
                        ""type"" : ""keyword""
                      },
                      ""zone"" : {
                        ""type"" : ""keyword""
                      },
                      ""metadata"" : {
                        ""type"" : ""object""
                      }
                    }
                  },
                  ""os"" : {
                    ""properties"" : {
                      ""load"" : {
                        ""properties"" : {
                          ""1m"" : {
                            ""type"" : ""half_float""
                          },
                          ""5m"" : {
                            ""type"" : ""half_float""
                          },
                          ""15m"" : {
                            ""type"" : ""half_float""
                          }
                        }
                      },
                      ""memory"" : {
                        ""properties"" : {
                          ""total_in_bytes"" : {
                            ""type"" : ""float""
                          },
                          ""free_in_bytes"" : {
                            ""type"" : ""float""
                          },
                          ""used_in_bytes"" : {
                            ""type"" : ""float""
                          }
                        }
                      },
                      ""uptime_in_millis"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""process"" : {
                    ""properties"" : {
                      ""memory"" : {
                        ""properties"" : {
                          ""heap"" : {
                            ""properties"" : {
                              ""total_in_bytes"" : {
                                ""type"" : ""float""
                              },
                              ""used_in_bytes"" : {
                                ""type"" : ""float""
                              },
                              ""size_limit"" : {
                                ""type"" : ""float""
                              }
                            }
                          },
                          ""resident_set_size_in_bytes"" : {
                            ""type"" : ""float""
                          }
                        }
                      },
                      ""event_loop_delay"" : {
                        ""type"" : ""float""
                      },
                      ""uptime_in_millis"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""sockets"" : {
                    ""properties"" : {
                      ""http"" : {
                        ""properties"" : {
                          ""total"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""https"" : {
                        ""properties"" : {
                          ""total"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""type"" : ""date""
                  },
                  ""requests"" : {
                    ""properties"" : {
                      ""disconnects"" : {
                        ""type"" : ""long""
                      },
                      ""total"" : {
                        ""type"" : ""long""
                      },
                      ""status_codes"" : {
                        ""type"" : ""object""
                      }
                    }
                  },
                  ""response_times"" : {
                    ""properties"" : {
                      ""average"" : {
                        ""type"" : ""float""
                      },
                      ""max"" : {
                        ""type"" : ""float""
                      }
                    }
                  },
                  ""concurrent_connections"" : {
                    ""type"" : ""long""
                  }
                }
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-logstash"" : {
        ""order"" : 0,
        ""version"" : 8120099,
        ""index_patterns"" : [
          "".monitoring-logstash-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""timestamp"" : {
                ""type"" : ""date"",
                ""format"" : ""date_time""
              },
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""type"" : ""date"",
                    ""format"" : ""date_time""
                  }
                }
              },
              ""logstash_stats"" : {
                ""type"" : ""object"",
                ""properties"" : {
                  ""logstash"" : {
                    ""properties"" : {
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""ephemeral_id"" : {
                        ""type"" : ""keyword""
                      },
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""http_address"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      },
                      ""snapshot"" : {
                        ""type"" : ""boolean""
                      },
                      ""status"" : {
                        ""type"" : ""keyword""
                      },
                      ""pipeline"" : {
                        ""properties"" : {
                          ""workers"" : {
                            ""type"" : ""short""
                          },
                          ""batch_size"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""events"" : {
                    ""properties"" : {
                      ""filtered"" : {
                        ""type"" : ""long""
                      },
                      ""in"" : {
                        ""type"" : ""long""
                      },
                      ""out"" : {
                        ""type"" : ""long""
                      },
                      ""duration_in_millis"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""type"" : ""date""
                  },
                  ""jvm"" : {
                    ""properties"" : {
                      ""uptime_in_millis"" : {
                        ""type"" : ""long""
                      },
                      ""gc"" : {
                        ""properties"" : {
                          ""collectors"" : {
                            ""properties"" : {
                              ""old"" : {
                                ""properties"" : {
                                  ""collection_count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""collection_time_in_millis"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""young"" : {
                                ""properties"" : {
                                  ""collection_count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""collection_time_in_millis"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""mem"" : {
                        ""properties"" : {
                          ""heap_max_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""heap_used_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""heap_used_percent"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""os"" : {
                    ""properties"" : {
                      ""cpu"" : {
                        ""properties"" : {
                          ""load_average"" : {
                            ""properties"" : {
                              ""1m"" : {
                                ""type"" : ""half_float""
                              },
                              ""5m"" : {
                                ""type"" : ""half_float""
                              },
                              ""15m"" : {
                                ""type"" : ""half_float""
                              }
                            }
                          }
                        }
                      },
                      ""cgroup"" : {
                        ""properties"" : {
                          ""cpuacct"" : {
                            ""properties"" : {
                              ""control_group"" : {
                                ""type"" : ""keyword""
                              },
                              ""usage_nanos"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""cpu"" : {
                            ""properties"" : {
                              ""control_group"" : {
                                ""type"" : ""keyword""
                              },
                              ""stat"" : {
                                ""properties"" : {
                                  ""number_of_elapsed_periods"" : {
                                    ""type"" : ""long""
                                  },
                                  ""number_of_times_throttled"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time_throttled_nanos"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""cfs_quota_micros"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  ""process"" : {
                    ""properties"" : {
                      ""cpu"" : {
                        ""properties"" : {
                          ""percent"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""max_file_descriptors"" : {
                        ""type"" : ""long""
                      },
                      ""open_file_descriptors"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""reloads"" : {
                    ""properties"" : {
                      ""failures"" : {
                        ""type"" : ""long""
                      },
                      ""successes"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""queue"" : {
                    ""properties"" : {
                      ""events_count"" : {
                        ""type"" : ""long""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""pipelines"" : {
                    ""type"" : ""nested"",
                    ""properties"" : {
                      ""id"" : {
                        ""type"" : ""keyword""
                      },
                      ""hash"" : {
                        ""type"" : ""keyword""
                      },
                      ""ephemeral_id"" : {
                        ""type"" : ""keyword""
                      },
                      ""events"" : {
                        ""properties"" : {
                          ""in"" : {
                            ""type"" : ""long""
                          },
                          ""filtered"" : {
                            ""type"" : ""long""
                          },
                          ""out"" : {
                            ""type"" : ""long""
                          },
                          ""duration_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""queue_push_duration_in_millis"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""queue"" : {
                        ""properties"" : {
                          ""events_count"" : {
                            ""type"" : ""long""
                          },
                          ""type"" : {
                            ""type"" : ""keyword""
                          },
                          ""max_queue_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""queue_size_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""vertices"" : {
                        ""type"" : ""nested"",
                        ""properties"" : {
                          ""id"" : {
                            ""type"" : ""keyword""
                          },
                          ""pipeline_ephemeral_id"" : {
                            ""type"" : ""keyword""
                          },
                          ""events_in"" : {
                            ""type"" : ""long""
                          },
                          ""events_out"" : {
                            ""type"" : ""long""
                          },
                          ""duration_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""queue_push_duration_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""long_counters"" : {
                            ""type"" : ""nested"",
                            ""properties"" : {
                              ""name"" : {
                                ""type"" : ""keyword""
                              },
                              ""value"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""double_gauges"" : {
                            ""type"" : ""nested"",
                            ""properties"" : {
                              ""name"" : {
                                ""type"" : ""keyword""
                              },
                              ""value"" : {
                                ""type"" : ""double""
                              }
                            }
                          }
                        }
                      },
                      ""reloads"" : {
                        ""properties"" : {
                          ""failures"" : {
                            ""type"" : ""long""
                          },
                          ""successes"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""workers"" : {
                    ""type"" : ""short""
                  },
                  ""batch_size"" : {
                    ""type"" : ""integer""
                  }
                }
              },
              ""logstash_state"" : {
                ""properties"" : {
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""http_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""ephemeral_id"" : {
                    ""type"" : ""keyword""
                  },
                  ""version"" : {
                    ""type"" : ""keyword""
                  },
                  ""snapshot"" : {
                    ""type"" : ""boolean""
                  },
                  ""status"" : {
                    ""type"" : ""keyword""
                  },
                  ""pipeline"" : {
                    ""properties"" : {
                      ""id"" : {
                        ""type"" : ""keyword""
                      },
                      ""hash"" : {
                        ""type"" : ""keyword""
                      },
                      ""ephemeral_id"" : {
                        ""type"" : ""keyword""
                      },
                      ""workers"" : {
                        ""type"" : ""short""
                      },
                      ""batch_size"" : {
                        ""type"" : ""integer""
                      },
                      ""format"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      },
                      ""representation"" : {
                        ""enabled"" : false
                      }
                    }
                  }
                }
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-alerts-7"" : {
        ""order"" : 0,
        ""version"" : 8120099,
        ""index_patterns"" : [
          "".monitoring-alerts-7""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""timestamp"" : {
                ""type"" : ""date""
              },
              ""update_timestamp"" : {
                ""type"" : ""date""
              },
              ""resolved_timestamp"" : {
                ""type"" : ""date""
              },
              ""prefix"" : {
                ""type"" : ""text""
              },
              ""message"" : {
                ""type"" : ""text""
              },
              ""suffix"" : {
                ""type"" : ""text""
              },
              ""metadata"" : {
                ""properties"" : {
                  ""cluster_uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""link"" : {
                    ""type"" : ""keyword""
                  },
                  ""severity"" : {
                    ""type"" : ""short""
                  },
                  ""type"" : {
                    ""type"" : ""keyword""
                  },
                  ""version"" : {
                    ""type"" : ""keyword""
                  },
                  ""watch"" : {
                    ""type"" : ""keyword""
                  }
                }
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-beats"" : {
        ""order"" : 0,
        ""version"" : 8120099,
        ""index_patterns"" : [
          "".monitoring-beats-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""beats_state"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""state"" : {
                    ""properties"" : {
                      ""beat"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""host"" : {
                        ""properties"" : {
                          ""architecture"" : {
                            ""type"" : ""keyword""
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""hostname"" : {
                            ""type"" : ""keyword""
                          },
                          ""os"" : {
                            ""properties"" : {
                              ""build"" : {
                                ""type"" : ""keyword""
                              },
                              ""family"" : {
                                ""type"" : ""keyword""
                              },
                              ""platform"" : {
                                ""type"" : ""keyword""
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          }
                        }
                      },
                      ""input"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          },
                          ""names"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""module"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          },
                          ""names"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""output"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""service"" : {
                        ""properties"" : {
                          ""id"" : {
                            ""type"" : ""keyword""
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""version"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""format"" : ""date_time"",
                    ""type"" : ""date""
                  }
                }
              },
              ""beats_stats"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""metrics"" : {
                    ""properties"" : {
                      ""beat"" : {
                        ""properties"" : {
                          ""cgroup"" : {
                            ""properties"" : {
                              ""cpu"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""cfs"" : {
                                    ""properties"" : {
                                      ""period"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""quota"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""stats"" : {
                                    ""properties"" : {
                                      ""periods"" : {
                                        ""type"" : ""long""
                                      },
                                      ""throttled"" : {
                                        ""properties"" : {
                                          ""periods"" : {
                                            ""type"" : ""long""
                                          },
                                          ""ns"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              ""cpuacct"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""total"" : {
                                    ""properties"" : {
                                      ""ns"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""memory"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""mem"" : {
                                    ""properties"" : {
                                      ""limit"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""usage"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""cpu"" : {
                            ""properties"" : {
                              ""system"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""total"" : {
                                ""properties"" : {
                                  ""value"" : {
                                    ""type"" : ""long""
                                  },
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""user"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""info"" : {
                            ""properties"" : {
                              ""ephemeral_id"" : {
                                ""type"" : ""keyword""
                              },
                              ""uptime"" : {
                                ""properties"" : {
                                  ""ms"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          },
                          ""memstats"" : {
                            ""properties"" : {
                              ""gc_next"" : {
                                ""type"" : ""long""
                              },
                              ""memory_alloc"" : {
                                ""type"" : ""long""
                              },
                              ""memory_total"" : {
                                ""type"" : ""long""
                              },
                              ""rss"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""handles"" : {
                            ""properties"" : {
                              ""open"" : {
                                ""type"" : ""long""
                              },
                              ""limit"" : {
                                ""properties"" : {
                                  ""hard"" : {
                                    ""type"" : ""long""
                                  },
                                  ""soft"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""apm-server"" : {
                        ""properties"" : {
                          ""acm"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unavailable"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      },
                                      ""notfound"" : {
                                        ""type"" : ""long""
                                      },
                                      ""invalidquery"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""notmodified"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""unset"" : {
                                    ""type"" : ""long""
                                  },
                                  ""request"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""server"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""concurrent"" : {
                                ""properties"" : {
                                  ""wait"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""concurrency"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""decoder"" : {
                            ""properties"" : {
                              ""deflate"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""gzip"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""uncompressed"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reader"" : {
                                ""properties"" : {
                                  ""size"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""missing-content-length"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""processor"" : {
                            ""properties"" : {
                              ""metric"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
               ...
```",edsavage,closed,"['>test-failure', ':Distributed Coordination/Cluster Coordination', 'Team:Distributed (Obsolete)', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/103526,2023-12-18T16:52:31Z,9,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/103526,"{
  ""application_resource"": ""yes""
}"
194,103442,[CI] MlWithSecurityUserRoleIT.test {yaml=ml/text_expansion_search/Test weighted tokens search} failing ,"### CI Link

https://buildkite.com/elastic/elasticsearch-pull-request/builds/4617#018c6843-2107-447e-b533-f0007b73bb38

### Repro line

./gradlew ':x-pack:plugin:ml:qa:ml-with-security:yamlRestTest' --tests ""org.elasticsearch.smoketest.MlWithSecurityUserRoleIT.test {yaml=ml/text_expansion_search/Test weighted tokens search}"" -Dtests.seed=98DCE01D04EFCB17 -Dtests.locale=en -Dtests.timezone=Europe/Lisbon -Druntime.java=21

### Does it reproduce?

Didn't try

### Applicable branches

main

### Failure history

_No response_

### Failure excerpt

```

org.elasticsearch.smoketest.MlWithSecurityUserRoleIT > test {yaml=ml/text_expansion_search/Test weighted tokens search} FAILED
--
Â  | java.lang.AssertionError:
Â  | Expected: ((a string containing ""action [cluster:monitor/xpack/ml"" or a string containing ""action [cluster:admin/xpack/ml"") or a string containing ""action [cluster:admin/ingest"")
Â  | but: was ""Failure at [ml/text_expansion_search:231]: \nExpected: \""the octopus comforter smells\""\n     but: was \""the octopus comforter is leaking\""""
Â  | at __randomizedtesting.SeedInfo.seed([98DCE01D04EFCB17:1088DFC7AA13A6EF]:0)
Â  | at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
Â  | at org.junit.Assert.assertThat(Assert.java:956)
Â  | at org.junit.Assert.assertThat(Assert.java:923)
Â  | at org.elasticsearch.smoketest.MlWithSecurityUserRoleIT.test(MlWithSecurityUserRoleIT.java:57)


```",pxsalehi,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/103442,2023-12-14T13:18:40Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/103442,"{
  ""application_resource"": ""unsure""
}"
195,103298,Highlighting can take 50% to 99% of search time,"### Elasticsearch Version

8.10.4 and 8.13.0-SNAPSHOT

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

ESS Cloud and MacOS

### Problem Description

A customer has reported that highlighting (added by Kibana) is causing their queries in Kibana to extremely slowly. Profiling of the queries showed that 99% of the search time is spent in the Highlight code paths. In their case, the ConstantScoreQuery took less than 1 second, but the highlighting runs for ~850s (this is reproducible).

I was able to reproduce this to some degree locally (details below), where a the highlighting takes ~50% of the total search time.

Root cause is not known. Key points include:

- the query being run (by Kibana) is a match_phrase against `match_only_text`.


### Steps to Reproduce

Here is how I (partially) reproduced the issue locally.


Use the following mapping to crate an index where `message` has `match_only_text` and 1 shard is created (I didn't test with more than 1 shard).

<details>
  <summary><b>Mapping</b> (toggle to view)</summary>
  <pre>
{
  ""settings"": {
    ""index"" : {
      ""number_of_shards"": 1,
      ""number_of_replicas"": 0
    }
  },
  ""mappings"": {
    ""properties"": {
      ""@timestamp"": {
        ""type"": ""date""
      },
      ""message"": {
        ""type"": ""match_only_text""
      },
      ""kubernetes"": {
        ""properties"": {
          ""container"": {
            ""properties"": {
              ""name"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""daemonset"": {
            ""properties"": {
              ""name"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""deployment"": {
            ""properties"": {
              ""name"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          }
        }
      },
      ""bytes_sent"": {
        ""type"": ""long""
      },
      ""content_type"": {
        ""type"": ""text"",
        ""fields"": {
          ""keyword"": {
            ""type"": ""keyword"",
            ""ignore_above"": 256
          }
        }
      },
      ""geoip_location_lat"": {
        ""type"": ""float""
      },
      ""geoip_location_lon"": {
        ""type"": ""float""
      },
      ""is_https"": {
        ""type"": ""boolean""
      },
      ""request"": {
        ""type"": ""text"",
        ""fields"": {
          ""keyword"": {
            ""type"": ""keyword"",
            ""ignore_above"": 256
          }
        }
      },
      ""response"": {
        ""type"": ""long""
      },
      ""runtime_ms"": {
        ""type"": ""long""
      },
      ""url"": {
        ""type"": ""keyword""
      },
      ""user_Agent"": {
        ""type"": ""text"",
        ""fields"": {
          ""keyword"": {
            ""type"": ""keyword"",
            ""ignore_above"": 256
          }
        }
      },
      ""verb"": {
        ""type"": ""text"",
        ""fields"": {
          ""keyword"": {
            ""type"": ""keyword"",
            ""ignore_above"": 256
          }
        }
      }
    }
  }
}
  </pre>
</details>


Populate this index with at least 2.5 million records in scope for the search (see my table in comments below).

<details>
  <summary><b>Data generation script</b> (toggle to view)</summary>

```
import argparse
import ndjson
from faker import Faker
from datetime import datetime, timedelta
import random

def generate_fake_data(num_lines):
    fake = Faker()

    data = []
    timestamp = datetime.strptime(""2021-04-06T14:00:00"", ""%Y-%m-%dT%H:%M:%S"")
    for _ in range(num_lines):
        timestamp_str = timestamp.strftime(""%Y-%m-%dT%H:%M:%S.000Z"")
        timestamp += timedelta(seconds=5)

        # Generate a message with at least 85 words
        message_word_count = random.randint(85, 225)
        message = fake.paragraph(nb_sentences=1, ext_word_list=None)
        while len(message.split()) < message_word_count:
            message += "" "" + fake.paragraph(nb_sentences=1, ext_word_list=None)

        ri = random.randint(1,4)
        if ri == 2:
            message += "". request errored 123 forty-five 12:45 foobar "" + fake.word() + "" "" + fake.word()
        elif ri == 3:
            message = ""12345 California request completed - "" + message

        deployment_name = ""service-integrations""
        if ri > 2:
            deployment_name = fake.word()

        json_data = {
            ""@timestamp"": timestamp_str,
            ""user_Agent"": fake.user_agent(),
            ""url"": fake.uri_path(),
            ""content_type"": fake.mime_type(),
            ""is_https"": fake.boolean(),
            ""response"": fake.random_int(min=100, max=599),
            ""verb"": fake.http_method(),
            ""geoip_location_lon"": float(fake.longitude()),
            ""geoip_location_lat"": float(fake.latitude()),
            ""bytes_sent"": fake.random_int(min=1000, max=50000),
            ""runtime_ms"": fake.random_int(min=100, max=1000),
            ""message"": message,
            ""kubernetes"": {
                ""container"": {""name"": fake.word()},
                ""daemonset"": {""name"": fake.word()},
                ""deployment"": {""name"": deployment_name}
            }
        }

        data.append(json_data)

    return data

def main():
    parser = argparse.ArgumentParser(description=""Generate ndjson with Faker"")
    parser.add_argument(""num_lines"", type=int, help=""Number of lines to produce"")
    args = parser.parse_args()

    fake_data = generate_fake_data(args.num_lines + 1)

    output_file_name = f""sdh7687-data-{args.num_lines}.json""
    with open(output_file_name, ""w"") as f:
        ndjson.dump(fake_data, f, ensure_ascii=False)

if __name__ == ""__main__"":
    main()

```
</details>

<details>
  <summary><b>Loading script</b> (toggle to view)</summary>

```
 #!/bin/bash

if [ ""$#"" -ne 2 ]; then
  echo ""Usage: $0 <port> <input_file>""
  exit 1
fi

port=""$1""
input=""$2""
output=""bulk.log""
counter=0
max_rows=10000
create='{""create"": {}}'
bulk_data=$'\n'
default_port=9200

echo ""Using port: $port""
echo ""Creating sdh7687 index with mappings to http://localhost:$port ...""
/usr/bin/curl -s -XPUT ""http://localhost:$port/sdh7687"" -H 'Content-Type: application/json' --insecure --data-binary @sdh7687-mappings-not-match-only-text.json

echo """"
echo ""Reading sdh7687 events from $input...""
while read -r log_event
do
  let ""counter=counter+1""
  bulk_data+=""$create""$'\n'""$log_event""$'\n'
  if [ $counter -eq $max_rows ]
  then
       echo ""Indexing $counter documents...""
       bulk_data+=$'\n'
       echo ""$bulk_data"" | tee temp.json > /dev/null
       /usr/bin/curl -XPOST ""http://localhost:$port/sdh7687/_bulk"" -H 'Content-Type: application/x-ndjson' -# --progress-bar   --insecure --data-binary @temp.json >> ""$output""
       rm -rf temp.json
       counter=0
       bulk_data=$'\n'
  fi
done < ""$input""

if [ $counter -lt $max_rows ] && [ $counter -gt 0 ]
then
       echo ""Indexing $counter documents...""
       bulk_data+=$'\n'
       echo ""$bulk_data"" | tee temp.json > /dev/null
       /usr/bin/curl -XPOST ""http://localhost:$port/sdh7687/_bulk"" -H 'Content-Type: application/x-ndjson'  -# --progress-bar --insecure --data-binary @temp.json >> ""$output""
       rm -rf temp.json
fi

```

</details>

Note I ran the above two scripts dozens of times to create data files with 100,000 to 200,000 entries, so that most of the data fell within a small-ish @timestamp range to index millions of documents.


Run the following query (has profiling and highlighting turned on).

<details>
  <summary><b>ES Query</b> (toggle to view)</summary>
  <pre>
POST sdh7687/_async_search
{
  ""profile"": true,
  ""track_total_hits"": false,
  ""sort"": [
    {
      ""@timestamp"": {
        ""order"": ""desc"",
        ""unmapped_type"": ""boolean""
      }
    }
  ],
  ""fields"": [
    {
      ""field"": ""*"",
      ""include_unmapped"": ""true""
    },
    {
      ""field"": ""@timestamp"",
      ""format"": ""strict_date_optional_time""
    }
  ],
  ""size"": 10,
  ""version"": true,
  ""script_fields"": {},
  ""stored_fields"": [
    ""*""
  ],
  ""runtime_mappings"": {},
  ""_source"": false,
  ""query"": {
    ""bool"": {
      ""must"": [],
      ""filter"": [
        {
          ""range"": {
            ""@timestamp"": {
              ""format"": ""strict_date_optional_time"",
              ""gte"": ""2021-01-02T06:40:00.000Z"",
              ""lte"": ""2021-04-10T06:49:07.221Z""
            }
          }
        },
        {
          ""match_phrase"": {
            ""kubernetes.deployment.name"": ""service-integrations""
          }
        }
      ],
      ""should"": [],
      ""must_not"": [
        {
          ""match_phrase"": {
            ""message"": ""request errored""
          }
        },
        {
          ""match_phrase"": {
            ""message"": ""request completed""
          }
        }
      ]
    }
  },
  ""highlight"": {
    ""pre_tags"": [
      ""@kibana-highlighted-field@""
    ],
    ""post_tags"": [
      ""@/kibana-highlighted-field@""
    ],
    ""fields"": {
      ""*"": {}
    },
    ""fragment_size"": 2147483647
  }
}
  </pre>
</details>



### Logs (if relevant)

_No response_",quux00,closed,"['>bug', ':Search Relevance/Highlighting', 'Team:Search Relevance']",https://github.com/elastic/elasticsearch/issues/103298,2023-12-11T20:59:16Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/103298,"{
  ""application_resource"": ""unsure""
}"
196,103170,filebeat is unable to display metrics on kibana discover tab,"### Elasticsearch Version

8.8.0

### Installed Plugins

_No response_

### Java Version

17.0.7 2023-04-18 LTS

### OS Version

MAC OS Darwin Kernel Version 22.5.0

### Problem Description

we was using 7.16 elasticsearch,kibana and filebeat verison earlier which used to scrap metrics and displayed in the kibana discover tab but when upgraded to 8.8.0 it doesn't display 
elastic,kibana and filebeat yaml file we are using is 
apiVersion: elasticsearch.k8s.elastic.co/v1
      kind: Elasticsearch
      metadata:
        name: elasticsearch
        labels:
          app.kubernetes.io/part-of: {{ .Chart.Name }}
          app.kubernetes.io/name: elasticsearch
          spotfire-str-installer: ""true""
      spec:
        version: {{ .Values.elasticsearch.version | quote }}
        nodeSets:
        - name: default
          count: 1
          config:
            node.roles: [""master"", ""data"", ""ingest"", ""remote_cluster_client""]
            node.store.allow_mmap: false
          volumeClaimTemplates:
          - metadata:
              name: elasticsearch-data
            spec:
              accessModes:
              - ReadWriteOnce
              resources:
                requests:
                  storage: {{ (index .Values .Values.size).elasticsearch.disk | quote }}
          podTemplate:
            spec:
              enableServiceLinks: false
              containers:
              - name: elasticsearch
                resources:
                  limits:
                    memory: {{ (index .Values .Values.size).elasticsearch.memory | quote }}
        http:
          tls:
            selfSignedCertificate:
              disabled: false
          service:
            spec:
              ports:
              - name: https
                port: 9200
                protocol: TCP
                targetPort: https
      ---
      apiVersion: kibana.k8s.elastic.co/v1
      kind: Kibana
      metadata:
        name: kibana
        labels:
          app.kubernetes.io/part-of: {{ .Chart.Name }}
          app.kubernetes.io/name: kibana
      spec:
        version: {{ .Values.kibana.version | quote }}
        count: 1
        podTemplate:
          spec:
            containers:
            - name: kibana
              env:
                - name: ELASTICSEARCH_URL
                  value: https://elasticsearch-es-http:9200
                - name: ELASTICSEARCH_HOSTS
                  value: https://elasticsearch-es-http:9200
        elasticsearchRef:
          name: elasticsearch
        http:
          tls:
            selfSignedCertificate:
              disabled: false
          service:
            spec:
              ports:
              - name: https
                port: 443
                protocol: TCP
                targetPort: https
      ---
      apiVersion: beat.k8s.elastic.co/v1beta1
      kind: Beat
      metadata:
        name: filebeat
      spec:
        type: filebeat
        version: {{ .Values.elasticsearch.version | quote }}
        elasticsearchRef:
          name: elasticsearch
        kibanaRef:
          name: kibana
        config:
          filebeat.autodiscover:
            providers:
              - node: $(NODE_NAME)
                type: kubernetes
                hints.default_config.enabled: ""false""
                templates:
                - condition.equals.kubernetes.labels.tekton_dev/memberOf: ""tasks""
                  config:
                  - paths: [""/var/log/containers/*\${data.kubernetes.container.id}.log""]
                    type: container
          processors:
          - add_cloud_metadata: {}
          - add_host_metadata: {}
          output.elasticsearch.index: ""tekton""
          setup.template.name: ""tekton""
          setup.template.pattern: ""tekton""
          filebeat.modules:
          - module: system
            syslog:
              enabled: true
            auth:
              enabled: true
        daemonSet:
          podTemplate:
            spec:
              serviceAccountName: prometheus
              automountServiceAccountToken: true
              terminationGracePeriodSeconds: 30
              dnsPolicy: ClusterFirstWithHostNet
              hostNetwork: true
              containers:
              - name: filebeat
                securityContext:
                  runAsUser: 0
                  {{- if eq .Values.cloud ""openshift"" }}
                  privileged: true
                  {{- end }}
                volumeMounts:
                - name: varlogcontainers
                  mountPath: /var/log/containers
                - name: varlogpods
                  mountPath: /var/log/pods
                - name: varlibdockercontainers
                  mountPath: /var/lib/docker/containers
                env:
                  - name: NODE_NAME
                    valueFrom:
                      fieldRef:
                        fieldPath: spec.nodeName
              volumes:
              - name: varlogcontainers
                hostPath:
                  path: /var/log/containers
              - name: varlogpods
                hostPath:
                  path: /var/log/pods
              - name: varlibdockercontainers
                hostPath:
                  path: /var/lib/docker/containers
      !
Also we cant see the time keeper dropdown in kibana discover tab

### Steps to Reproduce

deploy the elastic kibana and filebeat the yaml provided above we cant see metrics displayed in kiaban discover tab

### Logs (if relevant)

_No response_",skumarya-tibco,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/103170,2023-12-08T03:55:55Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/103170,"{
  ""application_resource"": ""yes""
}"
197,102933,[Transform] Unexpected changes in transform configuration.,"### Elasticsearch Version

main + all released versions back to 7.9

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

n/a

### Problem Description

It was observed that some transforms behaved badly after the update of **another** (unrelated) transform.

### Steps to Reproduce

1. Update the settings of one transform
2. Observe how these settings get effective for **another** transform

### Logs (if relevant)

_No response_",przemekwitek,closed,"['>bug', ':ml/Transform', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/102933,2023-12-04T16:25:08Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102933,"{
  ""application_resource"": ""yes""
}"
198,102794,`ecs@mappings` template breaks dynamic mapping of intermediate object fields,"### Elasticsearch Version

083b59122b3cdf5168d2d2351e53fca99009baf5 (8.12-SNAPSHOT)

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux

### Problem Description

The `ecs@mappings` component template's dynamic templates unintentionally match dynamically mapped object fields, attempting to map them as non-object field types, breaking ingestion of that object's child properties.

For example, the dynamic template [`ecs_usage_scaled_float`](https://github.com/elastic/elasticsearch/blob/824d06c8cf7fd4811a0ff42e3554bc70dbfb7e0a/x-pack/plugin/core/template-resources/src/main/resources/ecs%40mappings.json#L145-L153) will match the ""usage"" object when dynamically mapping `a.usage.b: 123`.

### Steps to Reproduce

```
PUT /_index_template/xyz
{
  ""index_patterns"": [""xyz""],
  ""composed_of"": [""ecs@mappings""],
  ""template"": {
    ""mappings"": {
      ""dynamic"": true
    }
  }
}

POST /xyz/_doc
{
  ""a.usage.b"": 123
}
```

```
{
  ""error"": {
    ""root_cause"": [
      {
        ""type"": ""illegal_argument_exception"",
        ""reason"": ""Malformed content, found extra data after parsing: END_OBJECT""
      }
    ],
    ""type"": ""illegal_argument_exception"",
    ""reason"": ""Malformed content, found extra data after parsing: END_OBJECT""
  },
  ""status"": 400
}
```

(Also that error message is completely unhelpful.)

### Logs (if relevant)

_No response_",axw,closed,"['>bug', ':Search Foundations/Mapping', 'Team:Search Foundations']",https://github.com/elastic/elasticsearch/issues/102794,2023-11-30T07:38:25Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102794,"{
  ""application_resource"": ""yes""
}"
199,102784,[CI] HeapAttackIT failing,"The HeapAttackIT test has started to fail on a daily basis since 22th of november

**Build scan:**
https://gradle-enterprise.elastic.co/s/h2qxzbqn5vq2m/tests/:x-pack:plugin:esql:qa:server:single-node:javaRestTest/org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT/testSortByManyLongsTooMuchMemory


**Reproduction line:**
```
./gradlew ':x-pack:plugin:esql:qa:server:single-node:javaRestTest' --tests ""org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.testSortByManyLongsTooMuchMemory"" -Dtests.seed=E5F40F3AD7D8520 -Dtests.configure_test_clusters_with_one_processor=true -Dtests.locale=hr -Dtests.timezone=Australia/NSW -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testSortByManyLongsTooMuchMemory'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium))))


**Failure excerpt:**
```
junit.framework.AssertionFailedError: Unexpected exception type, expected ResponseException but got java.io.IOException: Connection reset

  at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2869)
  at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2850)
  at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.assertCircuitBreaks(HeapAttackIT.java:77)
  at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.testSortByManyLongsTooMuchMemory(HeapAttackIT.java:73)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

  Caused by: java.io.IOException: Connection reset

    at org.elasticsearch.client.RestClient.extractAndWrapCause(RestClient.java:939)
    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:304)
    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:307)
    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:292)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.query(HeapAttackIT.java:285)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.sortByManyLongs(HeapAttackIT.java:94)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.lambda$testSortByManyLongsTooMuchMemory$0(HeapAttackIT.java:73)
    at org.apache.lucene.tests.util.LuceneTestCase._expectThrows(LuceneTestCase.java:3022)
    at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2859)
    at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2850)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.assertCircuitBreaks(HeapAttackIT.java:77)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.testSortByManyLongsTooMuchMemory(HeapAttackIT.java:73)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
    at java.lang.reflect.Method.invoke(Method.java:580)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1583)

    Caused by: java.net.SocketException: Connection reset

      at sun.nio.ch.SocketChannelImpl.throwConnectionReset(SocketChannelImpl.java:401)
      at sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:434)
      at org.apache.http.impl.nio.reactor.SessionInputBufferImpl.fill(SessionInputBufferImpl.java:231)
      at org.apache.http.impl.nio.codecs.AbstractMessageParser.fillBuffer(AbstractMessageParser.java:136)
      at org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:241)
      at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:87)
      at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:40)
      at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)
      at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)
      at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)
      at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)
      at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)
      at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)
      at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:591)
      at java.lang.Thread.run(Thread.java:1583)

```",breskeby,closed,"['>test-failure', 'Team:QL (Deprecated)', ':Analytics/ES|QL', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/102784,2023-11-29T22:35:08Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102784,"{
  ""application_resource"": ""yes""
}"
200,102725,Optimize `size=0&track_total_hits=true` when no aggs are present,"### Description

It is common in diagnostics and basic investigations to call the `_count` API. This API is basically a `size=0&track_total_hits=true` with a query filter. 

However, internally, it seems we still take each `SearchPhaseResult`, allocate a large array to merge them, hold the results in memory and never partially merge.

It seems to me that when there are no aggs, nothing is wanting to be returned (size=0) and we are only asking for a hit count, we can make some dramatic optimizations. 

Seems like we want a custom `QueryPhaseResultConsumer` that is optimized for this situation that doesn't hold all these items in memory.",benwtrent,closed,"['>enhancement', ':Search/Search', 'team-discuss', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/102725,2023-11-28T21:12:50Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102725,"{
  ""application_resource"": ""yes""
}"
201,102646,[CI] EsqlActionBreakerIT testLoadId and 26 others failing,"`EsqlActionBreakerIT` had 27 test fail, all seemingly with the same identical exception:

```
java.lang.AssertionError: Request breaker not reset to 0 on node: node_s2	
Expected: <0L>	
     but: was <112L>
```

**Build scan:**
https://gradle-enterprise.elastic.co/s/u6cz433m5hp4k/tests/:x-pack:plugin:esql:internalClusterTest/org.elasticsearch.xpack.esql.action.EsqlActionBreakerIT/testLoadId


**Reproduction line:**
```
./gradlew ':x-pack:plugin:esql:internalClusterTest' --tests ""org.elasticsearch.xpack.esql.action.EsqlActionBreakerIT.testLoadId"" -Dtests.seed=7ED9855E1E443836 -Dtests.locale=ca -Dtests.timezone=Africa/Luanda -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
No

**Failure history:**
https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testLoadId'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.xpack.esql.action.EsqlActionBreakerIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium))))


**Failure excerpt:**
```
java.lang.AssertionError: Request breaker not reset to 0 on node: node_s2
Expected: <0L>
     but: was <112L>

  at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
  at org.junit.Assert.assertThat(Assert.java:956)
  at org.elasticsearch.xpack.esql.action.AbstractEsqlIntegTestCase.lambda$ensureBlocksReleased$1(AbstractEsqlIntegTestCase.java:56)
  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:1237)
  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:1210)
  at org.elasticsearch.xpack.esql.action.AbstractEsqlIntegTestCase.ensureBlocksReleased(AbstractEsqlIntegTestCase.java:54)
  at org.elasticsearch.xpack.esql.action.EsqlActionBreakerIT.run(EsqlActionBreakerIT.java:83)
  at org.elasticsearch.xpack.esql.action.AbstractEsqlIntegTestCase.run(AbstractEsqlIntegTestCase.java:115)
  at org.elasticsearch.xpack.esql.action.AbstractEsqlIntegTestCase.run(AbstractEsqlIntegTestCase.java:105)
  at org.elasticsearch.xpack.esql.action.AbstractEsqlIntegTestCase.run(AbstractEsqlIntegTestCase.java:101)
  at org.elasticsearch.xpack.esql.action.EsqlActionIT.testLoadId(EsqlActionIT.java:1190)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

```",alex-spies,closed,"['blocker', '>test-failure', 'Team:QL (Deprecated)', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/102646,2023-11-27T14:08:59Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102646,"{
  ""application_resource"": ""yes""
}"
202,102625,ESQL: Enrich performance degradation twice in last month,"Twice in the last month the performance of `ENRICH` command has dropped dramatically:

* On the 15th November, single enrich dropped from 50ms to 85ms
* On the 24th November, it dropped further to 100ms

<img width=""946"" alt=""Screenshot 2023-11-27 at 10 35 03"" src=""https://github.com/elastic/elasticsearch/assets/114451/4fa5e346-5d93-47d0-9c49-7857ad507f13"">

See https://elasticsearch-benchmarks.elastic.co/#tracks/esql/nightly/default/30d

On the 15th the build run was `2128866bf1022046877ea255016dfa0feccb0c30`, and on the 24th it was `b12b38ca46fbc50a664d7389d6ff417e9485d8e7`.
",craigtaverner,closed,"['>bug', 'Team:QL (Deprecated)', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/102625,2023-11-27T09:38:16Z,10,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102625,"{
  ""application_resource"": ""unsure""
}"
203,102552,ESQL: add `text` type support to all functions accepting `keyword`,"### Description

Currently, some functions accepting the `keyword` type accept `text` too. We should extend `text` function support to all functions.",bpintea,closed,"['>feature', 'Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/102552,2023-11-23T18:59:49Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102552,"{
  ""application_resource"": ""no""
}"
204,102459,[CI] EnrichIT testFilterAfterEnrich failing,"Apparently the memory management for ENRICH is still leaking: `java.lang.AssertionError: Request breaker not reset to 0 on node: node_s1`

**Build scan:**
https://gradle-enterprise.elastic.co/s/w32fzxhv6cyp4/tests/:x-pack:plugin:esql:internalClusterTest/org.elasticsearch.xpack.esql.action.EnrichIT/testFilterAfterEnrich


**Reproduction line:**
```
./gradlew ':x-pack:plugin:esql:internalClusterTest' --tests ""org.elasticsearch.xpack.esql.action.EnrichIT.testFilterAfterEnrich"" -Dtests.seed=FCE173656AEE4B5A -Dtests.locale=he-IL -Dtests.timezone=Australia/LHI -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
Yes

**Failure history:**
https://es-delivery-stats.elastic.dev/app/dashboards#/view/dcec9e60-72ac-11ee-8f39-55975ded9e63?_g=(refreshInterval:(pause:!t,value:60000),time:(from:now-7d%2Fd,to:now))&_a=(controlGroupInput:(chainingSystem:HIERARCHICAL,controlStyle:twoLine,ignoreParentSettings:(ignoreFilters:!f,ignoreQuery:!f,ignoreTimerange:!f,ignoreValidations:!t),panels:('0c0c9cb8-ccd2-45c6-9b13-96bac4abc542':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:task.keyword,grow:!t,id:'0c0c9cb8-ccd2-45c6-9b13-96bac4abc542',searchTechnique:wildcard,selectedOptions:!(),singleSelect:!t,title:'Gradle%20Task',width:medium),grow:!t,order:0,type:optionsListControl,width:small),'144933da-5c1b-4257-a969-7f43455a7901':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:name.keyword,grow:!t,id:'144933da-5c1b-4257-a969-7f43455a7901',searchTechnique:wildcard,selectedOptions:!('testFilterAfterEnrich'),title:Test,width:medium),grow:!t,order:2,type:optionsListControl,width:medium),'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850':(explicitInput:(dataViewId:fbbdc689-be23-4b3d-8057-aa402e9ed0c5,enhancements:(),fieldName:className.keyword,grow:!t,id:'4e6ad9d6-6fdc-4fcc-bf1a-aa6ca79e0850',searchTechnique:wildcard,selectedOptions:!('org.elasticsearch.xpack.esql.action.EnrichIT'),title:Suite,width:medium),grow:!t,order:1,type:optionsListControl,width:medium))))


**Failure excerpt:**
```
java.lang.AssertionError: Request breaker not reset to 0 on node: node_s1
Expected: <0L>
     but: was <504L>

  at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
  at org.junit.Assert.assertThat(Assert.java:956)
  at org.elasticsearch.xpack.esql.action.AbstractEsqlIntegTestCase.lambda$ensureBlocksReleased$1(AbstractEsqlIntegTestCase.java:56)
  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:1237)
  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:1210)
  at org.elasticsearch.xpack.esql.action.AbstractEsqlIntegTestCase.ensureBlocksReleased(AbstractEsqlIntegTestCase.java:54)
  at org.elasticsearch.xpack.esql.action.EnrichIT.run(EnrichIT.java:122)
  at org.elasticsearch.xpack.esql.action.AbstractEsqlIntegTestCase.run(AbstractEsqlIntegTestCase.java:115)
  at org.elasticsearch.xpack.esql.action.AbstractEsqlIntegTestCase.run(AbstractEsqlIntegTestCase.java:105)
  at org.elasticsearch.xpack.esql.action.AbstractEsqlIntegTestCase.run(AbstractEsqlIntegTestCase.java:101)
  at org.elasticsearch.xpack.esql.action.EnrichIT.testFilterAfterEnrich(EnrichIT.java:294)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

```",luigidellaquila,closed,"['>test-failure', 'Team:QL (Deprecated)', ':Analytics/ES|QL', 'medium-risk']",https://github.com/elastic/elasticsearch/issues/102459,2023-11-22T10:05:54Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102459,"{
  ""application_resource"": ""yes""
}"
205,102457,Examine the possibility of calling System::gc from the real memory circuit breaker,"During the discussion of improve the real memory breaker, the possibility of falling back to `System::gc` was raised. This issue has been logged to track that investigation.

The current implementation of the real memory breaker creates humongous objects in an effort to trigger a GC of the *young* generation - by determining the remaining free heap space and allocating a number of objects of exactly 1/2 the region size in an attempt to fill that space. This will be ""lighter weight"" than a full GC, and also clean up the humongous objects created by the breaker itself (since this are not strongly referenced).

What is being proposed here, and to be investigated, is the possibility of adding an additional fallback to the aforementioned young gen triggering mechanism, a full GC by calling `System::gc`. Full GC's are more expensive and take longer. Any implementation should give consideration to this, we do not want to stall too long trying and waiting for this to happen.

relates #102396",ChrisHegarty,closed,"[':Core/Infra/Circuit Breakers', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/102457,2023-11-22T09:57:52Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102457,"{
  ""application_resource"": ""yes""
}"
206,102378,Avoid hitting max clause limit with the default value of `default_field`,"When not specifying a value for `index.query.default_field`, Elasticsearch uses `*` 

https://github.com/elastic/elasticsearch/blob/7e669831e87220943907da6e731437340683ddc0/server/src/main/java/org/elasticsearch/index/IndexSettings.java#L57-L59

which makes it resolve all searchable fields that have values in the index. When it resolves too many fields, an error is thrown to guard against excessive memory usage.

https://github.com/elastic/elasticsearch/blob/7e669831e87220943907da6e731437340683ddc0/server/src/main/java/org/elasticsearch/index/search/QueryParserHelper.java#L154-L164

While the limits for the max number of boolean clauses is relatively generous (at least 1024, the exact value depends on the allocated CPU and memory count), there's still a risk of hitting this limit when increasing`index.mapping.total_fields.limit` from the default value of 1000.

https://github.com/elastic/elasticsearch/blob/7e669831e87220943907da6e731437340683ddc0/server/src/main/java/org/elasticsearch/search/SearchUtils.java#L34

At the moment, Fleet sets the `total_fields.limit` to 10k by default: https://github.com/elastic/kibana/blob/6775419c0bd6606fa1bbe9ea7cf512dcd6e82093/x-pack/plugins/fleet/server/services/epm/elasticsearch/template/install.ts#L374

The way integrations guard against hitting max clause limit is that they auto-generate the `default_field` based on the fields that the package declares: https://github.com/elastic/kibana/blob/6775419c0bd6606fa1bbe9ea7cf512dcd6e82093/x-pack/plugins/fleet/server/services/epm/elasticsearch/template/default_settings.ts#L82. As discussed in https://github.com/elastic/elasticsearch/issues/99872, we want to remove this and instead rely on the default `default_field` in order to be able to use the [`ecs@mappings`](https://github.com/elastic/elasticsearch/blob/main/x-pack/plugin/core/template-resources/src/main/resources/ecs%40mappings.json) component template rather than the fields that the package defines. This will also make it possible for users to search by fields that are dynamically mapped today (such as labels).

Once #96235 is merged, we may want to lower the defaults in Fleet. However, we may not be able to do this for all integrations and users can always manually increase the field limit.

All of this is to say that I think we should guard against running into the max clause limit so that using the default value for `default_field` never runs the risk of causing a search to fail.

That seems to be relatively straightforward by limiting the number of fields we resolve here:

https://github.com/elastic/elasticsearch/blob/b65e871c1bb99efa2c9699a8c03ff02ed421c6f6/server/src/main/java/org/elasticsearch/index/search/QueryParserHelper.java#L80

For the all field (`*`)

https://github.com/elastic/elasticsearch/blob/b65e871c1bb99efa2c9699a8c03ff02ed421c6f6/server/src/main/java/org/elasticsearch/index/search/QueryParserHelper.java#L77

We can retain the logic of failing when a more specific set of fields is selected (such as `labels.*`). What's most important is that we don't fail in the default case.

cc @ruflin @javanna",felixbarny,closed,"[':Search/Search', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/102378,2023-11-20T12:48:04Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102378,"{
  ""application_resource"": ""yes""
}"
207,102272,ESQL: Meta-ticket for 8.12,"### Description

A meta ticket tracking the main issues we want to solve for the 8.12 release:

#### New Features
- [ ]  Async query - https://github.com/elastic/elasticsearch/issues/99533
- [ ]  Cross Cluster Querying (CCS) - https://github.com/elastic/elasticsearch/pull/101640

#### Language
- [ ]  Grammar for . fields - https://github.com/elastic/elasticsearch/pull/100740

#### Memory tracking 
- [x] block ref tracking - https://github.com/elastic/elasticsearch/pull/100408
- [x] Enrich memory usage - https://github.com/elastic/elasticsearch/pull/102184

#### Data loading
- [x] expose source as a metadata field - https://github.com/elastic/elasticsearch/issues/99456
- [x] multi-field extraction at once - https://github.com/elastic/elasticsearch/issues/101322 (https://github.com/elastic/elasticsearch/pull/102192)
- [ ] fallback to source extraction for fields that have field data disabled - https://github.com/elastic/elasticsearch/issues/99213

#### Resilience
- [ ] Random generation of random queries - https://github.com/elastic/elasticsearch/pull/102073
- [ ] Enrich enhancements -https://github.com/elastic/elasticsearch/issues/101654

Bugs",costin,closed,[],https://github.com/elastic/elasticsearch/issues/102272,2023-11-16T00:43:26Z,0,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102272,"{
  ""application_resource"": ""unsure""
}"
208,102267,ESQL: More memory accounting improvements,"Extends https://github.com/elastic/elasticsearch/issues/99173
- [ ] block referencing
- [ ] Filter blocks
- [ ] Expand blocks
- [ ] enrich memory accounting
- [ ] Remove Block.Ref
- [ ] Remove nonBreakingBlockFactory
- [ ] Remove deprecated Block methods",costin,closed,"['Team:QL (Deprecated)', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/102267,2023-11-16T00:12:37Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102267,"{
  ""application_resource"": ""yes""
}"
209,102260,[CI] MixedClusterClientYamlTestSuiteIT test {p0=indices.stats/13_fields/Fields - multi} failing,"Calling this a search question because the assertion tripped on `_all.total.fielddata.memory_size_in_bytes` being unexpectedly zero.

**Build scan:**
https://gradle-enterprise.elastic.co/s/ay37m7apww3lg/tests/:qa:mixed-cluster:v7.17.16%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=indices.stats%2F13_fields%2FFields%20-%20multi%7D
**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v7.17.16#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=indices.stats/13_fields/Fields - multi}"" -Dtests.seed=697B0AF0381F3A53 -Dtests.bwc=true -Dtests.locale=sr-BA -Dtests.timezone=America/Argentina/Jujuy -Druntime.java=17 -Dtests.fips.enabled=true
```

**Applicable branches:**
8.11

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT&tests.test=test%20%7Bp0%3Dindices.stats/13_fields/Fields%20-%20multi%7D


**Failure excerpt:**
```
java.lang.AssertionError: Failure at [indices.stats/13_fields:105]: field [_all.total.fielddata.memory_size_in_bytes] is not greater than [0]
Expected: a value greater than <0>
     but: <0> was equal to <0>

  at __randomizedtesting.SeedInfo.seed([697B0AF0381F3A53:E12F352A96E357AB]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:582)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
  at jdk.internal.reflect.GeneratedMethodAccessor18.invoke(null:-1)
  at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
  at java.lang.reflect.Method.invoke(Method.java:568)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:833)

  Caused by: java.lang.AssertionError: field [_all.total.fielddata.memory_size_in_bytes] is not greater than [0]
  Expected: a value greater than <0>
       but: <0> was equal to <0>

    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
    at org.junit.Assert.assertThat(Assert.java:956)
    at org.elasticsearch.test.rest.yaml.section.GreaterThanAssertion.doAssert(GreaterThanAssertion.java:64)
    at org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:65)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:562)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
    at jdk.internal.reflect.GeneratedMethodAccessor18.invoke(null:-1)
    at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:568)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:833)

```",DaveCTurner,closed,"['blocker', ':Search/Search', '>test-failure', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/102260,2023-11-15T20:41:58Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102260,"{
  ""application_resource"": ""yes""
}"
210,102111,SecurityUsageTransportAction can leak memory by double invoking REST transport listener,"`org.elasticsearch.xpack.security.SecurityUsageTransportAction#masterOperation` can leak memory on the REST layer by trying to send a failure response twice.

This shows as logging:

```
[2023-10-30T17:40:28,267][ERROR][org.elasticsearch.rest.action.RestResponseListener] [instance-0000000007] failed to send failure response
java.lang.IllegalStateException: Channel is already closed
	at org.elasticsearch.rest.RestController$ResourceHandlingHttpChannel.close(RestController.java:772) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.rest.RestController$ResourceHandlingHttpChannel.sendResponse(RestController.java:759) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.rest.action.RestActionListener.onFailure(RestActionListener.java:55) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.rest.action.RestCancellableNodeClient$1.onFailure(RestCancellableNodeClient.java:96) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.client.internal.node.NodeClient$SafelyWrappedActionListener.onFailure(NodeClient.java:170) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.tasks.TaskManager$1.onFailure(TaskManager.java:217) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.support.ContextPreservingActionListener.onFailure(ContextPreservingActionListener.java:38) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.ActionListener$Delegating.onFailure(ActionListener.java:92) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction.lambda$doStart$2(TransportMasterNodeAction.java:231) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.ActionListener$DelegatingActionListener.onFailure(ActionListener.java:218) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.ActionListener$Delegating.onFailure(ActionListener.java:92) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.client.internal.node.NodeClient$SafelyWrappedActionListener.onFailure(NodeClient.java:170) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.tasks.TaskManager$1.onFailure(TaskManager.java:217) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.support.ContextPreservingActionListener.onFailure(ContextPreservingActionListener.java:38) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.ActionListener$Delegating.onFailure(ActionListener.java:92) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction.lambda$doStart$2(TransportMasterNodeAction.java:231) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.ActionListener$DelegatingActionListener.onFailure(ActionListener.java:218) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.ActionListener$2.onFailure(ActionListener.java:170) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.ActionListener$Delegating.onFailure(ActionListener.java:92) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.xpack.security.profile.ProfileService.tryFreezeAndCheckIndex(ProfileService.java:1015) ~[?:?]
	at org.elasticsearch.xpack.security.profile.ProfileService.usageStats(ProfileService.java:333) ~[?:?]
	at org.elasticsearch.xpack.security.SecurityUsageTransportAction.masterOperation(SecurityUsageTransportAction.java:180) ~[?:?]
	at org.elasticsearch.xpack.security.SecurityUsageTransportAction.masterOperation(SecurityUsageTransportAction.java:50) ~[?:?]
	at org.elasticsearch.action.support.master.TransportMasterNodeAction.executeMasterOperation(TransportMasterNodeAction.java:124) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction.lambda$doStart$3(TransportMasterNodeAction.java:235) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:72) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:917) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) ~[elasticsearch-8.6.1.jar:?]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?]
	at java.lang.Thread.run(Thread.java:1589) ~[?:?]
	Suppressed: org.elasticsearch.action.UnavailableShardsException: at least one primary shard for the index [.security-profile-8] is unavailable
		at org.elasticsearch.xpack.security.support.SecurityIndexManager.getUnavailableReason(SecurityIndexManager.java:138) ~[?:?]
		at org.elasticsearch.xpack.security.profile.ProfileService.tryFreezeAndCheckIndex(ProfileService.java:1015) ~[?:?]
		at org.elasticsearch.xpack.security.profile.ProfileService.usageStats(ProfileService.java:333) ~[?:?]
		at org.elasticsearch.xpack.security.SecurityUsageTransportAction.masterOperation(SecurityUsageTransportAction.java:180) ~[?:?]
		at org.elasticsearch.xpack.security.SecurityUsageTransportAction.masterOperation(SecurityUsageTransportAction.java:50) ~[?:?]
		at org.elasticsearch.action.support.master.TransportMasterNodeAction.executeMasterOperation(TransportMasterNodeAction.java:124) ~[elasticsearch-8.6.1.jar:?]
		at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction.lambda$doStart$3(TransportMasterNodeAction.java:235) ~[elasticsearch-8.6.1.jar:?]
		at org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:72) ~[elasticsearch-8.6.1.jar:?]
		at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:917) ~[elasticsearch-8.6.1.jar:?]
		at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) ~[elasticsearch-8.6.1.jar:?]
		at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?]
		at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?]
		at java.lang.Thread.run(Thread.java:1589) ~[?:?]
```

which leaks on the transport layer as such:

```
[instance-0000000007] An exception was thrown by org.elasticsearch.transport.netty4.Netty4TcpChannel$$Lambda$6602/0x00000008023d2000.operationComplete()
java.util.ConcurrentModificationException: null
	at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:1013) ~[?:?]
	at java.util.ArrayList$Itr.next(ArrayList.java:967) ~[?:?]
	at org.elasticsearch.core.IOUtils.close(IOUtils.java:117) ~[elasticsearch-core-8.6.1.jar:?]
	at org.elasticsearch.core.Releasables.close(Releasables.java:23) ~[elasticsearch-core-8.6.1.jar:?]
	at org.elasticsearch.common.io.stream.RecyclerBytesStreamOutput.close(RecyclerBytesStreamOutput.java:172) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.rest.AbstractRestChannel.releaseOutputBuffer(AbstractRestChannel.java:193) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.core.IOUtils.close(IOUtils.java:71) ~[elasticsearch-core-8.6.1.jar:?]
	at org.elasticsearch.core.IOUtils.close(IOUtils.java:119) ~[elasticsearch-core-8.6.1.jar:?]
	at org.elasticsearch.core.Releasables.close(Releasables.java:23) ~[elasticsearch-core-8.6.1.jar:?]
	at org.elasticsearch.http.DefaultRestChannel.lambda$sendResponse$3(DefaultRestChannel.java:154) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.action.ActionListener$3.onResponse(ActionListener.java:267) ~[elasticsearch-8.6.1.jar:?]
	at org.elasticsearch.transport.netty4.Netty4TcpChannel.lambda$addPromise$1(Netty4TcpChannel.java:79) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:578) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:552) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:491) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:616) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.setSuccess0(DefaultPromise.java:605) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.trySuccess(DefaultPromise.java:104) ~[?:?]
	at io.netty.util.concurrent.PromiseCombiner.tryPromise(PromiseCombiner.java:170) ~[?:?]
	at io.netty.util.concurrent.PromiseCombiner.access$600(PromiseCombiner.java:35) ~[?:?]
	at io.netty.util.concurrent.PromiseCombiner$1.operationComplete0(PromiseCombiner.java:62) ~[?:?]
	at io.netty.util.concurrent.PromiseCombiner$1.operationComplete(PromiseCombiner.java:44) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:578) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:552) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:491) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:616) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.setSuccess0(DefaultPromise.java:605) ~[?:?]
	at io.netty.util.concurrent.DefaultPromise.trySuccess(DefaultPromise.java:104) ~[?:?]
```


The bug is relatively obvious:

We create a couple of listeners like so:

```
        final ActionListener<Map<String, Object>> roleMappingStoreUsageListener = ActionListener.wrap(nativeRoleMappingStoreUsage -> {
            Map<String, Object> usage = singletonMap(""native"", nativeRoleMappingStoreUsage);
            roleMappingUsageRef.set(usage);
            doCountDown.run();
        }, listener::onFailure);

        final ActionListener<Map<String, Object>> realmsUsageListener = ActionListener.wrap(realmsUsage -> {
            realmsUsageRef.set(realmsUsage);
            doCountDown.run();
        }, listener::onFailure);
```

all of these listeners have to come together to form the final response and wait for each other in the success case. In the failure case though, they all individually and immediately resolve the main transport listener (`listener` in this example). So if two of the sub-requests of this action fail at the same time, we try to double send a failure response which leads to #102101 and a memory leak.",original-brownbear,closed,"['>bug', ':Security/Security', 'Team:Security']",https://github.com/elastic/elasticsearch/issues/102111,2023-11-13T23:22:23Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102111,"{
  ""application_resource"": ""yes""
}"
211,102063,"During data ingestion, significants amount of CPU and memory is used to parse date strings (>10% realistic for some workloads)","### Elasticsearch Version

8.11.0

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux, 6.5.9-arch2-1

### Problem Description

I was trying to reproduce benchmarks in [elastic/elasticsearch-opensearch-benchmark](https://github.com/elastic/elasticsearch-opensearch-benchmark), but got surprised at indexing. What surprised me was how much CPU time and memory was spent on parsing date strings for the 2 date fields in the data used by the benchmark - roughly 10% of the CPU time and ~30% of memory allocations came from parsing date strings.

This is due to the `java.time` date parsers being quite slow - but it is quite possible to build a faster parser.  I tried building [one](https://github.com/antonha/es-date-parse-bench-nov-2023/blob/main/src/main/java/antonha/dateparse/CharDateParser.java) with the same leniency as `strict_date_optional_time` (which is the default, and used in ES/OpenSearch benchmark repo). I got it about 50% faster, but I'm sure that it can be done better than that. 

Given how much Elasticsearch is used for log data, I would date parsing slowness to be a performance bug. 

There are more details in [this blog post](https://blunders.io/posts/es-benchmark-1-date-parse). There are benchmarks of different (mostly) relevant date parsers in the [antonha/es-date-parse-bench-nov-2023](https://github.com/antonha/es-date-parse-bench-nov-2023) repository.

I will also open an issue with OpenSearch, since I do believe that they are affected as well (the code is older than the fork). I will happily work on a PR, assuming that that does not prevent me from contributing the same to OpenSearch. 

### Steps to Reproduce

The data and index setup is the one described in [elastic/elasticsearch-opensearch-benchmark](https://github.com/elastic/elasticsearch-opensearch-benchmark). I used version 8.11.0 of Elasticsearch. 

I used a batch indexer on the same machine, with a decently fast SSD for storage. The indexing process needs to be CPU-bound (for the Elasticsearch process) to experience the slowdown. Using a profiler, such as Flight Recorder, should be able to show the same CPU and memory usage. 

### Logs (if relevant)

_No response_",antonha,closed,"['>enhancement', ':Core/Infra/Core', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/102063,2023-11-13T10:26:27Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/102063,"{
  ""application_resource"": ""no""
}"
212,101926,[CI] MlAssignmentPlannerUpgradeIT testMlAssignmentPlannerUpgrade failing,"This looks like we need a test assumption so we don't run this in environments where it can't succeed: `Reason: This node has insufficient allocated processors. Available processors [1], free processors [0], processors required for each allocation of this model [1]`. This integration test was introduced in https://github.com/elastic/elasticsearch/pull/98874

**Build scan:**
https://gradle-enterprise.elastic.co/s/csfzw3sbupz3w/tests/:x-pack:qa:rolling-upgrade:v8.11.1%23oldClusterTest/org.elasticsearch.upgrades.MlAssignmentPlannerUpgradeIT/testMlAssignmentPlannerUpgrade
**Reproduction line:**
```
./gradlew ':x-pack:qa:rolling-upgrade:v8.11.1#oldClusterTest' -Dtests.class=""org.elasticsearch.upgrades.MlAssignmentPlannerUpgradeIT"" -Dtests.method=""testMlAssignmentPlannerUpgrade"" -Dtests.seed=9733484CA2FD9E9F -Dtests.bwc=true -Dtests.configure_test_clusters_with_one_processor=true -Dtests.locale=sr-CS -Dtests.timezone=America/Thule -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.upgrades.MlAssignmentPlannerUpgradeIT&tests.test=testMlAssignmentPlannerUpgrade


**Failure excerpt:**
```
org.elasticsearch.client.ResponseException: method [POST], host [http://127.0.0.1:37329], URI [/_ml/trained_models/new_memory_format/deployment/_start?timeout=40s&wait_for=started&inference_threads=1&model_threads=1], status line [HTTP/1.1 429 Too Many Requests]
Warnings: [Deprecated field [model_threads] used, expected [number_of_allocations] instead, Deprecated field [inference_threads] used, expected [threads_per_allocation] instead]
{""error"":{""root_cause"":[{""type"":""status_exception"",""reason"":""Could not start deployment because no ML nodes with sufficient capacity were found""}],""type"":""status_exception"",""reason"":""Could not start deployment because no ML nodes with sufficient capacity were found"",""caused_by"":{""type"":""illegal_state_exception"",""reason"":""Could not start deployment because no suitable nodes were found, allocation explanation [Could not assign (more) allocations on node [1kxIZS2TTfiMWWGQta8D1g]. Reason: This node has insufficient allocated processors. Available processors [1], free processors [0], processors required for each allocation of this model [1]|Could not assign (more) allocations on node [Rt9lb1FKR0q_71eP1m1hzA]. Reason: This node has insufficient allocated processors. Available processors [1], free processors [0], processors required for each allocation of this model [1]|Could not assign (more) allocations on node [f_9n2rEFRIitR0uvnk3BLA]. Reason: This node has insufficient allocated processors. Available processors [1], free processors [0], processors required for each allocation of this model [1]]""}},""status"":429}

  at __randomizedtesting.SeedInfo.seed([9733484CA2FD9E9F:382316FB07353418]:0)
  at org.elasticsearch.client.RestClient.convertResponse(RestClient.java:347)
  at org.elasticsearch.client.RestClient.performRequest(RestClient.java:313)
  at org.elasticsearch.client.RestClient.performRequest(RestClient.java:288)
  at org.elasticsearch.upgrades.MlAssignmentPlannerUpgradeIT.startDeployment(MlAssignmentPlannerUpgradeIT.java:279)
  at org.elasticsearch.upgrades.MlAssignmentPlannerUpgradeIT.startDeployment(MlAssignmentPlannerUpgradeIT.java:266)
  at org.elasticsearch.upgrades.MlAssignmentPlannerUpgradeIT.setupDeployments(MlAssignmentPlannerUpgradeIT.java:210)
  at org.elasticsearch.upgrades.MlAssignmentPlannerUpgradeIT.testMlAssignmentPlannerUpgrade(MlAssignmentPlannerUpgradeIT.java:72)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

```",williamrandolph,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk']",https://github.com/elastic/elasticsearch/issues/101926,2023-11-08T17:25:47Z,11,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/101926,"{
  ""application_resource"": ""yes""
}"
213,101828,Elasticsearch does not refresh AWS Web Identity Token file when changed on disk,"### Elasticsearch Version

8.x

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Kubernetes 

### Problem Description

**Observed**
We have ECK users reporting that S3 repository setups that rely on AWS IAM roles for service accounts (IRSA) stop working after a while and only a restart of the affected Pods restores functionality. 

https://github.com/elastic/cloud-on-k8s/issues/7208

The users are following this documentation on the ECK side https://www.elastic.co/guide/en/cloud-on-k8s/master/k8s-snapshots.html#k8s-iam-service-accounts which configures a `CustomWebIdentityTokenCredentialsProvider` based on information from the two environment variables `AWS_WEB_IDENTITY_TOKEN_FILE` (and `AWS_ROLE_ARN`) 

My hunch is that Elasticsearch is not watching the file pointed to by `AWS_WEB_IDENTITY_TOKEN_FILE` and does not [refresh](https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/auth/STSAssumeRoleWithWebIdentitySessionCredentialsProvider.html#refresh--) the credentials when the token changes on disk after the configured expiration time. This would be consistent with the users reporting that a restart of the Pods solves the problem. 


**Expected** 
I think it would be reasonable to expect that Elasticsearch reloads the credentials when the token changes on disk without user intervention. 




### Steps to Reproduce

https://www.elastic.co/guide/en/cloud-on-k8s/master/k8s-snapshots.html#k8s-iam-service-accounts

with a short ` expirationSeconds: 300` or something along those lines. 
Then wait for token refresh. (Disclaimer: I have not tried it yet myself just relaying user reports here)

### Logs (if relevant)

_No response_",pebrc,closed,"['>bug', ':Distributed Coordination/Snapshot/Restore', 'Team:Distributed (Obsolete)']",https://github.com/elastic/elasticsearch/issues/101828,2023-11-06T12:38:38Z,13,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/101828,"{
  ""application_resource"": ""yes""
}"
214,101752,Potential Memory Leak in JwtRealm,"The logic for the cache in `JwtRealm` produces a broken `Cache` instance to some degree. 
We create a `BytesArray` from the user credential hash:

```java
            final BytesArray jwtCacheKey = isCacheEnabled() ? new BytesArray(jwtAuthenticationToken.getUserCredentialsHash()) : null;
            if (jwtCacheKey != null) {
                final User cachedUser = tryAuthenticateWithCache(tokenPrincipal, jwtCacheKey);
```

and use it as as a cache key in a `Cache` instance down the line.
But then we also clear the bytes in that `BytesArray` to `0` in org.elasticsearch.xpack.security.authc.jwt.JwtAuthenticationToken#clearCredentials. 

This leads to the hash map in the `Cache` getting filled with loads of `BytesArray` that all have the same 0-filled content but that were not equal to each other when first inserted into the map, causing the map to put them all in the same bucket.

<img width=""1233"" alt=""image"" src=""https://github.com/elastic/elasticsearch/assets/6490959/86a914d7-a2d4-4b01-ad99-e0d14e71a58b"">

ref path to the broken map:

<img width=""1436"" alt=""image"" src=""https://github.com/elastic/elasticsearch/assets/6490959/87ac6f78-bc09-41c4-9a79-28fbbd14f6e6"">
",original-brownbear,closed,"['>bug', ':Security/Security', 'Team:Security']",https://github.com/elastic/elasticsearch/issues/101752,2023-11-02T21:59:27Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/101752,"{
  ""application_resource"": ""yes""
}"
215,101691,Enhance Query API key information API,"#### Summary: 

Enhance [Query API key information API](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-query-api-key.html) to support API key management page use cases

#### Description: 

To improve user experience Customers with a large number of API keys are unable to use the API key management page today as there is a lack of pagination support in the GET endpoint. To enable such users to use this feature, we (Kibana security team) are moving away from the Get API key information API to the Query API. We require some changes to the Query API key API to support enhanced searching and term aggregation. 


- **Search Capabilities**
    -  Description: Extend the current search capabilities of the API endpoint to accept new query fields.
    - Requirement: Add a new query field called `type` to the [existing ones](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-query-api-key.html#security-api-query-api-key-request-body)
    - Possible values: `cross_cluster`, `rest`. The filter will only call one or the other and never both at the same time

- **Term Aggregation:**
    - Description: When loading a subset of API keys, the endpoint should provide all associated usernames, types and if the keys are active/expired,  irrespective of the number of keys loaded.
    - Use Case: For instance, a user visits a UI page and loads 10 API keys. These 10 keys are a subset of a total of 20 keys, each created by a different user. The UI's Owner dropdown should display all 20 usernames, even if only 10 are loaded. Similarly, having that information for active/expired keys and types of keys would be needed as well.
    - Note: The term aggregation should honor the privileges `manage_api_key` and `manage_own_api_key` for the results. For those users who have the `manage_own_api_key` privileges, the results should not include the keys that do not belong to them. 


**UI**

<img width=""653"" alt=""image"" src=""https://github.com/elastic/elasticsearch/assets/1442420/15907d7b-fda0-4bb8-a1b2-b0c5cda83468"">



This is the existing UI which loads all the API keys and then displays them using an in-memory table. 

We intend to move away from this in-memory table. To support a 1:1 mapping between the old and new features, we would also require some enhancements to the API to support use cases of the search bar

Free text search
If a user searches with the term `exp`, the table currently displays results as follows

<img width=""618"" alt=""image"" src=""https://github.com/elastic/elasticsearch/assets/1442420/07843908-f062-4ded-9507-8cf7abe0c5dc"">


This also works similarly if the user searches by API key â€œtypeâ€ as â€˜personal/cross_cluster` or any other criteria on that page.

<img width=""635"" alt=""image"" src=""https://github.com/elastic/elasticsearch/assets/1442420/4a68ad04-cb84-42b7-b808-cc38cd9e75e5"">
 

To keep the user experience similar across this change, a free text query capability like this one would be a very welcome addition to the Query API key information API. 

Weâ€™d like to inspect the following fields for free text search: 
- Username
- Type
- Name
- Id",SiddharthMantri,closed,"['>enhancement', ':Security/Security', 'Team:Security']",https://github.com/elastic/elasticsearch/issues/101691,2023-11-01T19:26:50Z,11,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/101691,"{
  ""application_resource"": ""yes""
}"
216,101654,Enhancements for ESQL enrich,"We have a basic enrich in ESQL in 8.11, but there is room for improvement. Below are items that we can improve:

- [x] Support ip type natively
- [ ] More robust resolution
- [ ] Planning rules
- [ ] Plan description
- [x] Operator status
- [x] Memory tracking (https://github.com/elastic/elasticsearch/pull/102184)
- [x] Execution modes
- [x] More IT testing (https://github.com/elastic/elasticsearch/pull/102099)
- [ ] [Scheduling](https://github.com/elastic/elasticsearch/issues/50071)
- [ ] Time based enrich
- [x] IP Ranges support",dnhatn,closed,"['Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/101654,2023-10-31T23:06:30Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/101654,"{
  ""application_resource"": ""yes""
}"
217,101612,[ML] Refactor assignment planning code,"### Description

There are a couple of refactoring that fall out of #98874. This issue captures what still has to be done:
- Computing the amount of required memory externally and passing it to `AssignmentPlan.accountMemory()` is cumbersome. It can be done internally in the class.
- This would simplify the functions 
  - `ZoneAwareAssignmentPlanner.swapOriginalModelsInPlan`
  - `AbstractPreserveAllocations.mergePreservedAllocations`
  - `TrainedModelAssignmentRebalancer.copyAssignments`",valeriy42,closed,"['>refactoring', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/101612,2023-10-31T14:18:18Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/101612,"{
  ""application_resource"": ""yes""
}"
218,101598,[CI] ClassificationHousePricingIT testFeatureImportanceValues failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/uwwlkdiu6izvg/tests/:x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest/org.elasticsearch.xpack.ml.integration.ClassificationHousePricingIT/testFeatureImportanceValues
**Reproduction line:**
```
./gradlew ':x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest' --tests ""org.elasticsearch.xpack.ml.integration.ClassificationHousePricingIT.testFeatureImportanceValues"" -Dtests.seed=8C442F444C8DA895 -Dtests.locale=ca-ES -Dtests.timezone=Africa/Gaborone -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.xpack.ml.integration.ClassificationHousePricingIT&tests.test=testFeatureImportanceValues


**Failure excerpt:**
```
java.lang.AssertionError: Stats were: {""id"":""classification_house_pricing_test_feature_importance_values"",""state"":""started"",""progress"":[{""phase"":""reindexing"",""progress_percent"":100},{""phase"":""loading_data"",""progress_percent"":100},{""phase"":""feature_selection"",""progress_percent"":100},{""phase"":""coarse_parameter_search"",""progress_percent"":100},{""phase"":""fine_tuning_parameters"",""progress_percent"":100},{""phase"":""final_training"",""progress_percent"":100},{""phase"":""writing_results"",""progress_percent"":100},{""phase"":""inference"",""progress_percent"":98}],""data_counts"":{""training_docs_count"":510,""test_docs_count"":950,""skipped_docs_count"":0},""memory_usage"":{""timestamp"":1698748402711,""peak_usage_bytes"":232102,""status"":""ok""},""analysis_stats"":{""classification_stats"":{""timestamp"":1698748402711,""iteration"":0,""hyperparameters"":{""class_assignment_objective"":""maximize_minimum_recall"",""alpha"":6.0709755979659175,""downsample_factor"":0.23874177497042998,""eta"":0.6217679005474379,""eta_growth_rate_per_tree"":1.3108839502737188,""feature_bag_fraction"":0.13333333333333341,""gamma"":0.3794904870054506,""lambda"":0.02703658022998078,""max_attempts_to_add_tree"":0,""max_optimization_rounds_per_hyperparameter"":2,""max_trees"":16,""num_folds"":0,""num_splits_per_feature"":0,""soft_tree_depth_limit"":4.289165585614386,""soft_tree_depth_tolerance"":0.15},""timing_stats"":{""elapsed_time"":0,""iteration_time"":0},""validation_loss"":{""loss_type"":""binomial_logistic""}}},""node"":{""id"":""Cc575Xj0T9aRR8t9oavYYw"",""name"":""javaRestTest-1"",""ephemeral_id"":""KLmNX-teT2iKh5FeSZZu-Q"",""transport_address"":""127.0.0.1:37293"",""attributes"":{""testattr"":""test"",""transform.config_version"":""10.0.0"",""xpack.installed"":""true"",""ml.allocated_processors"":""32"",""ml.max_jvm_size"":""536870912"",""ml.config_version"":""11.0.0"",""ml.machine_memory"":""101258194944"",""ml.allocated_processors_double"":""32.0""}},""assignment_explanation"":""""}
Expected: <stopped>
     but: was <started>

  at __randomizedtesting.SeedInfo.seed([8C442F444C8DA895:719549882B1AF1C0]:0)
  at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
  at org.junit.Assert.assertThat(Assert.java:956)
  at org.elasticsearch.xpack.ml.integration.MlNativeDataFrameAnalyticsIntegTestCase.assertIsStopped(MlNativeDataFrameAnalyticsIntegTestCase.java:204)
  at org.elasticsearch.xpack.ml.integration.MlNativeDataFrameAnalyticsIntegTestCase.lambda$waitUntilAnalyticsIsStopped$0(MlNativeDataFrameAnalyticsIntegTestCase.java:129)
  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:1202)
  at org.elasticsearch.xpack.ml.integration.MlNativeDataFrameAnalyticsIntegTestCase.waitUntilAnalyticsIsStopped(MlNativeDataFrameAnalyticsIntegTestCase.java:129)
  at org.elasticsearch.xpack.ml.integration.MlNativeDataFrameAnalyticsIntegTestCase.waitUntilAnalyticsIsStopped(MlNativeDataFrameAnalyticsIntegTestCase.java:125)
  at org.elasticsearch.xpack.ml.integration.ClassificationHousePricingIT.testFeatureImportanceValues(ClassificationHousePricingIT.java:1566)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

```",cbuescher,closed,"['>test-failure', ':ml', 'Team:ML', 'low-risk', 'v9.0.0']",https://github.com/elastic/elasticsearch/issues/101598,2023-10-31T11:16:35Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/101598,"{
  ""application_resource"": ""unsure""
}"
219,101331,[CI] FeatureUpgradeIT testGetFeatureUpgradeStatus failing with IllegalArgumentException: mapping with hash [...] not found,"**Build scan:**
https://gradle-enterprise.elastic.co/s/ibqgql7fylvvw/tests/:qa:rolling-upgrade:v7.17.15%23bwcTest/org.elasticsearch.upgrades.FeatureUpgradeIT/testGetFeatureUpgradeStatus%20%7BupgradedNodes=3%7D
**Reproduction line:**
```
./gradlew ':qa:rolling-upgrade:v7.17.15#bwcTest' -Dtests.class=""org.elasticsearch.upgrades.FeatureUpgradeIT"" -Dtests.method=""testGetFeatureUpgradeStatus {upgradedNodes=3}"" -Dtests.seed=85641CEF59F01F1F -Dtests.bwc=true -Dtests.locale=ja-JP-u-ca-japanese-x-lvariant-JP -Dtests.timezone=Europe/Bratislava -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.upgrades.FeatureUpgradeIT&tests.test=testGetFeatureUpgradeStatus%20%7BupgradedNodes%3D3%7D


**Failure excerpt:**
```
java.lang.RuntimeException: An error occurred while checking cluster 'test-cluster' status.

  at __randomizedtesting.SeedInfo.seed([85641CEF59F01F1F:4A3B8B4A3EE04BD8]:0)
  at org.elasticsearch.test.cluster.local.DefaultLocalClusterHandle.waitUntilReady(DefaultLocalClusterHandle.java:188)
  at org.elasticsearch.test.cluster.local.DefaultLocalClusterHandle.upgradeNodeToVersion(DefaultLocalClusterHandle.java:151)
  at org.elasticsearch.test.cluster.local.DefaultLocalElasticsearchCluster.upgradeNodeToVersion(DefaultLocalElasticsearchCluster.java:134)
  at org.elasticsearch.upgrades.ParameterizedRollingUpgradeTestCase.upgradeNode(ParameterizedRollingUpgradeTestCase.java:126)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:980)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.elasticsearch.test.cluster.local.DefaultLocalElasticsearchCluster$1.evaluate(DefaultLocalElasticsearchCluster.java:39)
  at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

  Caused by: java.io.IOException: 408 Request Timeout

    at org.elasticsearch.test.cluster.local.WaitForHttpResource.checkResource(WaitForHttpResource.java:129)
    at org.elasticsearch.test.cluster.local.WaitForHttpResource.waitFor(WaitForHttpResource.java:107)
    at org.elasticsearch.test.cluster.local.DefaultLocalClusterHandle.waitUntilReady(DefaultLocalClusterHandle.java:186)
    at org.elasticsearch.test.cluster.local.DefaultLocalClusterHandle.upgradeNodeToVersion(DefaultLocalClusterHandle.java:151)
    at org.elasticsearch.test.cluster.local.DefaultLocalElasticsearchCluster.upgradeNodeToVersion(DefaultLocalElasticsearchCluster.java:134)
    at org.elasticsearch.upgrades.ParameterizedRollingUpgradeTestCase.upgradeNode(ParameterizedRollingUpgradeTestCase.java:126)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
    at java.lang.reflect.Method.invoke(Method.java:580)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:980)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.elasticsearch.test.cluster.local.DefaultLocalElasticsearchCluster$1.evaluate(DefaultLocalElasticsearchCluster.java:39)
    at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1583)

```",droberts195,closed,"['>test-failure', 'Team:Core/Infra', ':Core/Infra/Node Lifecycle', 'low-risk']",https://github.com/elastic/elasticsearch/issues/101331,2023-10-25T15:54:53Z,16,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/101331,"{
  ""application_resource"": ""yes""
}"
220,101310,Tasks sometimes successfully complete with 0s timeout,"## Summary
Kibana's CI includes a set of tests like:
```
POST /index_with_10k_docs/_update_by_query?wait_for_completion=false
GET /_tasks/<task_id>?wait_for_completion=true,timeout=0s
# assert that task hits timeout
```

There's also a similar test that creates a reindex task instead of a update_by_query task.

Somewhere between 1c12f68d14b743d9e2344e0406ab755d2e6d2407 and dbbe44300914cfb59063bce0815095f6bf94fa4d these two tests started failing sporadically because the task does not timeout.
https://github.com/elastic/elasticsearch/compare/1c12f68d14b743d9e2344e0406ab755d2e6d2407...dbbe44300914cfb59063bce0815095f6bf94fa4d

## Steps to reproduce
```
git clone git@github.com:rudolf/kibana.git
git checkout reproduce-es-regression
yarn kbn bootstrap
# PASS (eventually runs out of memory without any assertion failures)
ES_SNAPSHOT_MANIFEST=""https://storage.googleapis.com/kibana-ci-es-snapshots-daily/8.11.0/archives/20230908-142133_1c12f68d/manifest.json"" node scripts/jest_integration.js src/core/server/integration_tests/saved_objects/migrations/group3/actions/actions.test.ts

# FAIL (tends to hit failed assertion after a minute or two)
ES_SNAPSHOT_MANIFEST=""https://storage.googleapis.com/kibana-ci-es-snapshots-daily/8.11.0/archives/20230909-141910_dbbe4430/manifest.json"" node scripts/jest_integration.js src/core/server/integration_tests/saved_objects/migrations/group3/actions/actions.test.ts
```",rudolf,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/101310,2023-10-25T11:28:43Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/101310,"{
  ""application_resource"": ""yes""
}"
221,101307,Elasticsearch V8.10.4 dies with a â€œnoClassDefFoundErrorâ€,"### Elasticsearch Version

V8.10.4

### Installed Plugins

none

### Java Version

_bundled_

### OS Version

CentOS 7

### Problem Description

While indexing our Nextcloud user data, the Nextcloud indexer sends an (encrypted) PDF to ES which bring ES to death. :cold_face:

I could isolate the user's documents, which I let index against our ES V7.17.13 node, which continues to work - as I would expect from V8 too.

Seems there are some bouncy castle dependencies broken?

Please fix that dependencies since we cannot migrate to ES V8.10 as long as this issue 

### Steps to Reproduce

start the OCC indexer with the encyrpted PDF

php occ fulltextsearch:index:document -u UserId files docId


index is ""nextcloud"":

---- settings.json ----
{
  ""settings"": {
    ""index"": {
      ""routing"": {
        ""allocation"": {
          ""include"": {
            ""_tier_preference"": ""data_content""
          }
        }
      },
      ""mapping"": {
        ""total_fields"": {
          ""limit"": ""10000""
        }
      },
      ""number_of_shards"": ""1"",
      ""provided_name"": ""nextcloud"",
      ""creation_date"": ""1697437432798"",
      ""number_of_replicas"": ""1"",
      ""uuid"": ""9e3_sqY_QEyycgg21BNQHA"",
      ""version"": {
        ""created"": ""8100399""
      }
    }
  },
  ""defaults"": {
    ""index"": {
      ""flush_after_merge"": ""512mb"",
      ""time_series"": {
        ""end_time"": ""9999-12-31T23:59:59.999Z"",
        ""start_time"": ""-9999-01-01T00:00:00Z"",
        ""es87tsdb_codec"": {
          ""enabled"": ""true""
        }
      },
      ""final_pipeline"": ""_none"",
      ""max_inner_result_window"": ""100"",
      ""unassigned"": {
        ""node_left"": {
          ""delayed_timeout"": ""1m""
        }
      },
      ""max_terms_count"": ""65536"",
      ""rollup"": {
        ""source"": {
          ""name"": """",
          ""uuid"": """"
        }
      },
      ""lifecycle"": {
        ""prefer_ilm"": ""true"",
        ""rollover_alias"": """",
        ""origination_date"": ""-1"",
        ""name"": """",
        ""parse_origination_date"": ""false"",
        ""step"": {
          ""wait_time_threshold"": ""12h""
        },
        ""indexing_complete"": ""false""
      },
      ""mode"": ""standard"",
      ""routing_partition_size"": ""1"",
      ""force_memory_term_dictionary"": ""false"",
      ""max_docvalue_fields_search"": ""100"",
      ""merge"": {
        ""scheduler"": {
          ""max_thread_count"": ""4"",
          ""auto_throttle"": ""true"",
          ""max_merge_count"": ""9""
        },
        ""policy"": {
          ""merge_factor"": ""32"",
          ""floor_segment"": ""2mb"",
          ""max_merge_at_once_explicit"": ""30"",
          ""max_merge_at_once"": ""10"",
          ""max_merged_segment"": ""0b"",
          ""expunge_deletes_allowed"": ""10.0"",
          ""segments_per_tier"": ""10.0"",
          ""type"": ""UNSET"",
          ""deletes_pct_allowed"": ""20.0""
        }
      },
      ""max_refresh_listeners"": ""1000"",
      ""max_regex_length"": ""1000"",
      ""load_fixed_bitset_filters_eagerly"": ""true"",
      ""number_of_routing_shards"": ""1"",
      ""write"": {
        ""wait_for_active_shards"": ""1""
      },
      ""verified_before_close"": ""false"",
      ""mapping"": {
        ""coerce"": ""false"",
        ""nested_fields"": {
          ""limit"": ""50""
        },
        ""depth"": {
          ""limit"": ""20""
        },
        ""field_name_length"": {
          ""limit"": ""9223372036854775807""
        },
        ""nested_objects"": {
          ""limit"": ""10000""
        },
        ""ignore_malformed"": ""false"",
        ""dimension_fields"": {
          ""limit"": ""21""
        }
      },
      ""source_only"": ""false"",
      ""soft_deletes"": {
        ""enabled"": ""true"",
        ""retention"": {
          ""operations"": ""0""
        },
        ""retention_lease"": {
          ""period"": ""12h""
        }
      },
      ""max_script_fields"": ""32"",
      ""query"": {
        ""default_field"": [
          ""*""
        ],
        ""parse"": {
          ""allow_unmapped_fields"": ""true""
        }
      },
      ""format"": ""0"",
      ""frozen"": ""false"",
      ""sort"": {
        ""missing"": [],
        ""mode"": [],
        ""field"": [],
        ""order"": []
      },
      ""priority"": ""1"",
      ""routing_path"": [],
      ""version"": {
        ""compatibility"": ""8100399""
      },
      ""codec"": ""default"",
      ""max_rescore_window"": ""10000"",
      ""bloom_filter_for_id_field"": {
        ""enabled"": ""true""
      },
      ""max_adjacency_matrix_filters"": ""100"",
      ""analyze"": {
        ""max_token_count"": ""10000""
      },
      ""gc_deletes"": ""60s"",
      ""top_metrics_max_size"": ""10"",
      ""optimize_auto_generated_id"": ""true"",
      ""max_ngram_diff"": ""1"",
      ""hidden"": ""false"",
      ""translog"": {
        ""flush_threshold_age"": ""1m"",
        ""generation_threshold_size"": ""64mb"",
        ""flush_threshold_size"": ""10gb"",
        ""sync_interval"": ""5s"",
        ""retention"": {
          ""size"": ""-1"",
          ""age"": ""-1""
        },
        ""durability"": ""REQUEST""
      },
      ""auto_expand_replicas"": ""false"",
      ""fast_refresh"": ""false"",
      ""recovery"": {
        ""type"": """"
      },
      ""requests"": {
        ""cache"": {
          ""enable"": ""true""
        }
      },
      ""data_path"": """",
      ""highlight"": {
        ""max_analyzed_offset"": ""1000000"",
        ""weight_matches_mode"": {
          ""enabled"": ""true""
        }
      },
      ""routing"": {
        ""rebalance"": {
          ""enable"": ""all""
        },
        ""allocation"": {
          ""disk"": {
            ""watermark"": {
              ""ignore"": ""false""
            }
          },
          ""enable"": ""all"",
          ""total_shards_per_node"": ""-1""
        }
      },
      ""search"": {
        ""slowlog"": {
          ""level"": ""TRACE"",
          ""threshold"": {
            ""fetch"": {
              ""warn"": ""-1"",
              ""trace"": ""-1"",
              ""debug"": ""-1"",
              ""info"": ""-1""
            },
            ""query"": {
              ""warn"": ""-1"",
              ""trace"": ""-1"",
              ""debug"": ""-1"",
              ""info"": ""-1""
            }
          }
        },
        ""idle"": {
          ""after"": ""30s""
        },
        ""throttled"": ""false""
      },
      ""fielddata"": {
        ""cache"": ""node""
      },
      ""look_ahead_time"": ""2h"",
      ""default_pipeline"": ""_none"",
      ""max_slices_per_scroll"": ""1024"",
      ""shard"": {
        ""check_on_startup"": ""false""
      },
      ""xpack"": {
        ""watcher"": {
          ""template"": {
            ""version"": """"
          }
        },
        ""version"": """",
        ""ccr"": {
          ""following_index"": ""false""
        }
      },
      ""percolator"": {
        ""map_unmapped_fields_as_text"": ""false""
      },
      ""allocation"": {
        ""max_retries"": ""5"",
        ""existing_shards_allocator"": ""gateway_allocator""
      },
      ""refresh_interval"": ""1s"",
      ""indexing"": {
        ""slowlog"": {
          ""reformat"": ""true"",
          ""threshold"": {
            ""index"": {
              ""warn"": ""-1"",
              ""trace"": ""-1"",
              ""debug"": ""-1"",
              ""info"": ""-1""
            }
          },
          ""source"": ""1000"",
          ""level"": ""TRACE""
        }
      },
      ""compound_format"": ""1gb"",
      ""blocks"": {
        ""metadata"": ""false"",
        ""read"": ""false"",
        ""read_only_allow_delete"": ""false"",
        ""read_only"": ""false"",
        ""write"": ""false""
      },
      ""max_result_window"": ""10000"",
      ""store"": {
        ""stats_refresh_interval"": ""10s"",
        ""type"": """",
        ""fs"": {
          ""fs_lock"": ""native""
        },
        ""preload"": [],
        ""snapshot"": {
          ""snapshot_name"": """",
          ""index_uuid"": """",
          ""cache"": {
            ""prewarm"": {
              ""enabled"": ""true""
            },
            ""enabled"": ""true"",
            ""excluded_file_types"": []
          },
          ""repository_uuid"": """",
          ""uncached_chunk_size"": ""-1b"",
          ""delete_searchable_snapshot"": ""false"",
          ""index_name"": """",
          ""partial"": ""false"",
          ""blob_cache"": {
            ""metadata_files"": {
              ""max_length"": ""64kb""
            }
          },
          ""repository_name"": """",
          ""snapshot_uuid"": """"
        }
      },
      ""queries"": {
        ""cache"": {
          ""enabled"": ""true""
        }
      },
      ""shard_limit"": {
        ""group"": ""normal""
      },
      ""warmer"": {
        ""enabled"": ""true""
      },
      ""downsample"": {
        ""origin"": {
          ""name"": """",
          ""uuid"": """"
        },
        ""source"": {
          ""name"": """",
          ""uuid"": """"
        },
        ""status"": ""unknown""
      },
      ""override_write_load_forecast"": ""0.0"",
      ""max_shingle_diff"": ""3"",
      ""query_string"": {
        ""lenient"": ""false""
      }
    }
  }
}

----  stats.json. ----

{
  ""_shards"": {
    ""total"": 2,
    ""successful"": 1,
    ""failed"": 0
  },
  ""stats"": {
    ""uuid"": ""9e3_sqY_QEyycgg21BNQHA"",
    ""health"": ""yellow"",
    ""status"": ""open"",
    ""primaries"": {
      ""docs"": {
        ""count"": 3019416,
        ""deleted"": 2246
      },
      ""shard_stats"": {
        ""total_count"": 1
      },
      ""store"": {
        ""size_in_bytes"": 59698292351,
        ""total_data_set_size_in_bytes"": 59698292351,
        ""reserved_in_bytes"": 0
      },
      ""indexing"": {
        ""index_total"": 0,
        ""index_time_in_millis"": 0,
        ""index_current"": 0,
        ""index_failed"": 0,
        ""delete_total"": 0,
        ""delete_time_in_millis"": 0,
        ""delete_current"": 0,
        ""noop_update_total"": 0,
        ""is_throttled"": false,
        ""throttle_time_in_millis"": 0,
        ""write_load"": 0
      },
      ""get"": {
        ""total"": 0,
        ""time_in_millis"": 0,
        ""exists_total"": 0,
        ""exists_time_in_millis"": 0,
        ""missing_total"": 0,
        ""missing_time_in_millis"": 0,
        ""current"": 0
      },
      ""search"": {
        ""open_contexts"": 0,
        ""query_total"": 1,
        ""query_time_in_millis"": 1,
        ""query_current"": 0,
        ""fetch_total"": 1,
        ""fetch_time_in_millis"": 0,
        ""fetch_current"": 0,
        ""scroll_total"": 0,
        ""scroll_time_in_millis"": 0,
        ""scroll_current"": 0,
        ""suggest_total"": 0,
        ""suggest_time_in_millis"": 0,
        ""suggest_current"": 0
      },
      ""merges"": {
        ""current"": 0,
        ""current_docs"": 0,
        ""current_size_in_bytes"": 0,
        ""total"": 0,
        ""total_time_in_millis"": 0,
        ""total_docs"": 0,
        ""total_size_in_bytes"": 0,
        ""total_stopped_time_in_millis"": 0,
        ""total_throttled_time_in_millis"": 0,
        ""total_auto_throttle_in_bytes"": 20971520
      },
      ""refresh"": {
        ""total"": 2,
        ""total_time_in_millis"": 0,
        ""external_total"": 2,
        ""external_total_time_in_millis"": 1,
        ""listeners"": 0
      },
      ""flush"": {
        ""total"": 0,
        ""periodic"": 0,
        ""total_time_in_millis"": 0
      },
      ""warmer"": {
        ""current"": 0,
        ""total"": 1,
        ""total_time_in_millis"": 1
      },
      ""query_cache"": {
        ""memory_size_in_bytes"": 0,
        ""total_count"": 0,
        ""hit_count"": 0,
        ""miss_count"": 0,
        ""cache_size"": 0,
        ""cache_count"": 0,
        ""evictions"": 0
      },
      ""fielddata"": {
        ""memory_size_in_bytes"": 0,
        ""evictions"": 0,
        ""global_ordinals"": {
          ""build_time_in_millis"": 0
        }
      },
      ""completion"": {
        ""size_in_bytes"": 0
      },
      ""segments"": {
        ""count"": 40,
        ""memory_in_bytes"": 0,
        ""terms_memory_in_bytes"": 0,
        ""stored_fields_memory_in_bytes"": 0,
        ""term_vectors_memory_in_bytes"": 0,
        ""norms_memory_in_bytes"": 0,
        ""points_memory_in_bytes"": 0,
        ""doc_values_memory_in_bytes"": 0,
        ""index_writer_memory_in_bytes"": 0,
        ""version_map_memory_in_bytes"": 0,
        ""fixed_bit_set_memory_in_bytes"": 0,
        ""max_unsafe_auto_id_timestamp"": -1,
        ""file_sizes"": {}
      },
      ""translog"": {
        ""operations"": 0,
        ""size_in_bytes"": 55,
        ""uncommitted_operations"": 0,
        ""uncommitted_size_in_bytes"": 55,
        ""earliest_last_modified_age"": 192143
      },
      ""request_cache"": {
        ""memory_size_in_bytes"": 616,
        ""evictions"": 0,
        ""hit_count"": 0,
        ""miss_count"": 1
      },
      ""recovery"": {
        ""current_as_source"": 0,
        ""current_as_target"": 0,
        ""throttle_time_in_millis"": 0
      },
      ""bulk"": {
        ""total_operations"": 0,
        ""total_time_in_millis"": 0,
        ""total_size_in_bytes"": 0,
        ""avg_time_in_millis"": 0,
        ""avg_size_in_bytes"": 0
      },
      ""dense_vector"": {
        ""value_count"": 0
      }
    },
    ""total"": {
      ""docs"": {
        ""count"": 3019416,
        ""deleted"": 2246
      },
      ""shard_stats"": {
        ""total_count"": 1
      },
      ""store"": {
        ""size_in_bytes"": 59698292351,
        ""total_data_set_size_in_bytes"": 59698292351,
        ""reserved_in_bytes"": 0
      },
      ""indexing"": {
        ""index_total"": 0,
        ""index_time_in_millis"": 0,
        ""index_current"": 0,
        ""index_failed"": 0,
        ""delete_total"": 0,
        ""delete_time_in_millis"": 0,
        ""delete_current"": 0,
        ""noop_update_total"": 0,
        ""is_throttled"": false,
        ""throttle_time_in_millis"": 0,
        ""write_load"": 0
      },
      ""get"": {
        ""total"": 0,
        ""time_in_millis"": 0,
        ""exists_total"": 0,
        ""exists_time_in_millis"": 0,
        ""missing_total"": 0,
        ""missing_time_in_millis"": 0,
        ""current"": 0
      },
      ""search"": {
        ""open_contexts"": 0,
        ""query_total"": 1,
        ""query_time_in_millis"": 1,
        ""query_current"": 0,
        ""fetch_total"": 1,
        ""fetch_time_in_millis"": 0,
        ""fetch_current"": 0,
        ""scroll_total"": 0,
        ""scroll_time_in_millis"": 0,
        ""scroll_current"": 0,
        ""suggest_total"": 0,
        ""suggest_time_in_millis"": 0,
        ""suggest_current"": 0
      },
      ""merges"": {
        ""current"": 0,
        ""current_docs"": 0,
        ""current_size_in_bytes"": 0,
        ""total"": 0,
        ""total_time_in_millis"": 0,
        ""total_docs"": 0,
        ""total_size_in_bytes"": 0,
        ""total_stopped_time_in_millis"": 0,
        ""total_throttled_time_in_millis"": 0,
        ""total_auto_throttle_in_bytes"": 20971520
      },
      ""refresh"": {
        ""total"": 2,
        ""total_time_in_millis"": 0,
        ""external_total"": 2,
        ""external_total_time_in_millis"": 1,
        ""listeners"": 0
      },
      ""flush"": {
        ""total"": 0,
        ""periodic"": 0,
        ""total_time_in_millis"": 0
      },
      ""warmer"": {
        ""current"": 0,
        ""total"": 1,
        ""total_time_in_millis"": 1
      },
      ""query_cache"": {
        ""memory_size_in_bytes"": 0,
        ""total_count"": 0,
        ""hit_count"": 0,
        ""miss_count"": 0,
        ""cache_size"": 0,
        ""cache_count"": 0,
        ""evictions"": 0
      },
      ""fielddata"": {
        ""memory_size_in_bytes"": 0,
        ""evictions"": 0,
        ""global_ordinals"": {
          ""build_time_in_millis"": 0
        }
      },
      ""completion"": {
        ""size_in_bytes"": 0
      },
      ""segments"": {
        ""count"": 40,
        ""memory_in_bytes"": 0,
        ""terms_memory_in_bytes"": 0,
        ""stored_fields_memory_in_bytes"": 0,
        ""term_vectors_memory_in_bytes"": 0,
        ""norms_memory_in_bytes"": 0,
        ""points_memory_in_bytes"": 0,
        ""doc_values_memory_in_bytes"": 0,
        ""index_writer_memory_in_bytes"": 0,
        ""version_map_memory_in_bytes"": 0,
        ""fixed_bit_set_memory_in_bytes"": 0,
        ""max_unsafe_auto_id_timestamp"": -1,
        ""file_sizes"": {}
      },
      ""translog"": {
        ""operations"": 0,
        ""size_in_bytes"": 55,
        ""uncommitted_operations"": 0,
        ""uncommitted_size_in_bytes"": 55,
        ""earliest_last_modified_age"": 192143
      },
      ""request_cache"": {
        ""memory_size_in_bytes"": 616,
        ""evictions"": 0,
        ""hit_count"": 0,
        ""miss_count"": 1
      },
      ""recovery"": {
        ""current_as_source"": 0,
        ""current_as_target"": 0,
        ""throttle_time_in_millis"": 0
      },
      ""bulk"": {
        ""total_operations"": 0,
        ""total_time_in_millis"": 0,
        ""total_size_in_bytes"": 0,
        ""avg_time_in_millis"": 0,
        ""avg_size_in_bytes"": 0
      },
      ""dense_vector"": {
        ""value_count"": 0
      }
    }
  }
}


### Logs (if relevant)

java.lang.NoClassDefFoundError: org/bouncycastle/cms/CMSException
	at java.lang.Class.getDeclaredConstructors0(Native Method) ~[?:?]
	at java.lang.Class.privateGetDeclaredConstructors(Class.java:3549) ~[?:?]
	at java.lang.Class.getConstructor0(Class.java:3754) ~[?:?]
	at java.lang.Class.getDeclaredConstructor(Class.java:2930) ~[?:?]
	at org.apache.pdfbox.pdmodel.encryption.SecurityHandlerFactory.newSecurityHandler(SecurityHandlerFactory.java:132) ~[?:?]
	at org.apache.pdfbox.pdmodel.encryption.SecurityHandlerFactory.newSecurityHandlerForFilter(SecurityHandlerFactory.java:116) ~[?:?]
	at org.apache.pdfbox.pdmodel.encryption.PDEncryption.<init>(PDEncryption.java:97) ~[?:?]
	at org.apache.pdfbox.pdfparser.COSParser.prepareDecryption(COSParser.java:2974) ~[?:?]
	at org.apache.pdfbox.pdfparser.COSParser.retrieveTrailer(COSParser.java:285) ~[?:?]
	at org.apache.pdfbox.pdfparser.PDFParser.initialParse(PDFParser.java:173) ~[?:?]
	at org.apache.pdfbox.pdfparser.PDFParser.parse(PDFParser.java:226) ~[?:?]
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:1232) ~[?:?]
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:1206) ~[?:?]
	at org.apache.tika.parser.pdf.PDFParser.getPDDocument(PDFParser.java:317) ~[?:?]
	at org.apache.tika.parser.pdf.PDFParser.parse(PDFParser.java:172) ~[?:?]
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:298) ~[?:?]
	at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:195) ~[?:?]
	at org.apache.tika.Tika.parseToString(Tika.java:525) ~[?:?]
	at org.elasticsearch.ingest.attachment.TikaImpl.lambda$parse$0(TikaImpl.java:97) ~[?:?]
	at java.security.AccessController.doPrivileged(AccessController.java:714) ~[?:?]
	at org.elasticsearch.ingest.attachment.TikaImpl.parse(TikaImpl.java:96) ~[?:?]
	at org.elasticsearch.ingest.attachment.AttachmentProcessor.execute(AttachmentProcessor.java:121) ~[?:?]
	at org.elasticsearch.ingest.CompoundProcessor.innerExecute(CompoundProcessor.java:163) ~[elasticsearch-8.10.4.jar:?]
	at org.elasticsearch.ingest.CompoundProcessor.execute(CompoundProcessor.java:139) ~[elasticsearch-8.10.4.jar:?]
	at org.elasticsearch.ingest.Pipeline.execute(Pipeline.java:112) ~[elasticsearch-8.10.4.jar:?]
	at org.elasticsearch.ingest.IngestDocument.executePipeline(IngestDocument.java:853) ~[elasticsearch-8.10.4.jar:?]
	at org.elasticsearch.ingest.IngestService.executePipeline(IngestService.java:951) ~[elasticsearch-8.10.4.jar:?]
	at org.elasticsearch.ingest.IngestService.executePipelines(IngestService.java:827) ~[elasticsearch-8.10.4.jar:?]
	at org.elasticsearch.ingest.IngestService$1.doRun(IngestService.java:721) ~[elasticsearch-8.10.4.jar:?]
	at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) ~[elasticsearch-8.10.4.jar:?]
	at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33) ~[elasticsearch-8.10.4.jar:?]
	at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983) ~[elasticsearch-8.10.4.jar:?]
	at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26) ~[elasticsearch-8.10.4.jar:?]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[?:?]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[?:?]
	at java.lang.Thread.run(Thread.java:1583) ~[?:?]",Franco901,closed,"['>bug', ':Data Management/Ingest Node', 'Team:Data Management']",https://github.com/elastic/elasticsearch/issues/101307,2023-10-25T11:16:13Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/101307,"{
  ""application_resource"": ""unsure""
}"
222,100589,[CI] DatafeedJobsRestID: Cancelled recovery not cleaning up,"Although it's an ML test suite, the problems all look to be because an index was deleted while a recovery was ongoing and but the recovery task never goes away.

**Build scan:**
https://gradle-enterprise.elastic.co/s/e3zjigozbae3y/tests/:x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest/org.elasticsearch.xpack.ml.integration.PyTorchModelIT/testInferWithMultipleDocs
**Reproduction line:**
```
gradlew ':x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest' --tests ""org.elasticsearch.xpack.ml.integration.PyTorchModelIT.testInferWithMultipleDocs"" -Dtests.seed=E0D151F0DED2B412 -Dtests.locale=ca-ES -Dtests.timezone=America/Montreal -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.xpack.ml.integration.PyTorchModelIT&tests.test=testInferWithMultipleDocs
**Failure excerpt:**
```
java.lang.AssertionError: 2 active tasks found:
internal:index/shard/recovery/start_recovery YDcumwItTqWvln7Kvk5LkA:17655 -                            transport  1696930099813 09:28:19 44.7m       127.0.0.1 javaRestTest-0 recovery of [low_memory_analysis_source_index][7] to {javaRestTest-1}{6XF9PkkYR8GpW47PmXaydA}{czoYWR-xROq8xLJ8x2kjHQ}{javaRestTest-1}{127.0.0.1}{127.0.0.1:63790}{dilm}{8.12.0}{7000099-8500003} [recoveryId=86, targetAllocationId=4vEsDrkWS6qFol7KVThGwA, clusterStateVersion=2460, startingSeqNo=-2, primaryRelocation=false, canDownloadSnapshotFiles=true]
internal:index/shard/recovery/start_recovery qCRYNw1uTX-Vd_NKudrooQ:12297 -                            transport  1696930100318 09:28:20 44.7m       127.0.0.1 javaRestTest-2 recovery of [low_memory_analysis_source_index][6] to {javaRestTest-0}{YDcumwItTqWvln7Kvk5LkA}{PvyMHe6XS6uh4Wag1jfuLA}{javaRestTest-0}{127.0.0.1}{127.0.0.1:63717}{dim}{8.12.0}{7000099-8500003} [recoveryId=84, targetAllocationId=0lxnkFTcScutcVJdpRzG0g, clusterStateVersion=2463, startingSeqNo=-2, primaryRelocation=false, canDownloadSnapshotFiles=true]
 expected:<0> but was:<2>

  at __randomizedtesting.SeedInfo.seed([E0D151F0DED2B412:92CC60B79BA0B63F]:0)
  at org.junit.Assert.fail(Assert.java:88)
  at org.junit.Assert.failNotEquals(Assert.java:834)
  at org.junit.Assert.assertEquals(Assert.java:645)
  at org.elasticsearch.test.rest.ESRestTestCase.lambda$waitForPendingTasks$2(ESRestTestCase.java:506)
  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:1196)
  at org.elasticsearch.test.rest.ESRestTestCase.waitForPendingTasks(ESRestTestCase.java:477)
  at org.elasticsearch.test.rest.ESRestTestCase.waitForPendingTasks(ESRestTestCase.java:463)
  at org.elasticsearch.xpack.ml.integration.PyTorchModelRestTestCase.cleanup(PyTorchModelRestTestCase.java:86)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:1004)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

```",DaveCTurner,closed,"['blocker', '>test-failure', ':Distributed Indexing/Recovery', 'Team:Distributed (Obsolete)']",https://github.com/elastic/elasticsearch/issues/100589,2023-10-10T11:24:01Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/100589,"{
  ""application_resource"": ""yes""
}"
223,100538,[CI] HeapAttackIT testHugeManyConcat failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/w4q65kvoz3u7c/tests/:x-pack:plugin:esql:qa:server:single-node:javaRestTest/org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT/testHugeManyConcat
**Reproduction line:**
```
./gradlew ':x-pack:plugin:esql:qa:server:single-node:javaRestTest' --tests ""org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.testHugeManyConcat"" -Dtests.seed=5E1802C017D19187 -Dtests.locale=sl-SI -Dtests.timezone=Asia/Taipei -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT&tests.test=testHugeManyConcat
**Failure excerpt:**
```
junit.framework.AssertionFailedError: Unexpected exception type, expected ResponseException but got java.io.IOException: Connection reset

  at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2869)
  at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2850)
  at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.assertCircuitBreaks(HeapAttackIT.java:76)
  at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.testHugeManyConcat(HeapAttackIT.java:197)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

  Caused by: java.io.IOException: Connection reset

    at org.elasticsearch.client.RestClient.extractAndWrapCause(RestClient.java:935)
    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:300)
    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:303)
    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:288)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.query(HeapAttackIT.java:281)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.manyConcat(HeapAttackIT.java:230)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.lambda$testHugeManyConcat$3(HeapAttackIT.java:197)
    at org.apache.lucene.tests.util.LuceneTestCase._expectThrows(LuceneTestCase.java:3022)
    at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2859)
    at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2850)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.assertCircuitBreaks(HeapAttackIT.java:76)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.testHugeManyConcat(HeapAttackIT.java:197)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
    at java.lang.reflect.Method.invoke(Method.java:580)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1583)

    Caused by: java.net.SocketException: Connection reset

      at sun.nio.ch.SocketChannelImpl.throwConnectionReset(SocketChannelImpl.java:401)
      at sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:434)
      at org.apache.http.impl.nio.reactor.SessionInputBufferImpl.fill(SessionInputBufferImpl.java:231)
      at org.apache.http.impl.nio.codecs.AbstractMessageParser.fillBuffer(AbstractMessageParser.java:136)
      at org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:241)
      at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:87)
      at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:40)
      at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)
      at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)
      at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)
      at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)
      at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)
      at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)
      at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:591)
      at java.lang.Thread.run(Thread.java:1583)

```",henningandersen,closed,"['blocker', '>test-failure', 'Team:QL (Deprecated)', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/100538,2023-10-09T17:38:54Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/100538,"{
  ""application_resource"": ""yes""
}"
224,100528,Block and Vector creation can start to use a block factory that performs circuit breaking - 8.12,"Extends https://github.com/elastic/elasticsearch/issues/99173

### Description

This meta issue lists a number of places in the ESQL runtime where Block and Vector creation can start to use a block factory that performs breaking/accountancy that needs to land in 8.12.

- [x] #100678
- [x] #100640
- [x] #102683
 - [x] Reference tracking https://github.com/elastic/elasticsearch/pull/100408
 - [ ] Remove copy operations
   - [x] Deep copy on aliases https://github.com/elastic/elasticsearch/pull/100408
   - [x] Deep copy in eval https://github.com/elastic/elasticsearch/pull/100408
   - [ ] ~Copy in filter @alex-spies~ **Update:** not planned, currently not clear whether this really improves performance.
   - [x] Copy in expand https://github.com/elastic/elasticsearch/pull/103681
 - [x] operators (all not covered in #99826
   - [x] Enrich @dnhatn 
   - [x] LuceneSource @nik9000 #101396
   - [x] doc values reading @nik9000  #101383
   - [x] stored field reading @nik9000  #101383
   - [x] dissect #101400
 - [x] generate `toString` for `ExpressionEvaluator.Factory` and remove `ThrowingDriverContext` from `EvalOperatorFactory.describe` #100516
 - [x] Move BlockFactory.getNonBreakingInstance() to tests only (https://github.com/elastic/elasticsearch/pull/103661)
 - [ ] Make sure that many many many small pages don't fill up memory without filling the breaker. See `testTooManyEval`.
- [x] Remove Block.Ref (https://github.com/elastic/elasticsearch/pull/102513)
- [x] Remove deprecated Block methods
- [x] BytesRef does allocation that canâ€™t be tracked when going across a page boundary (#102350)",nik9000,closed,"['>enhancement', 'Team:Analytics', ':Analytics/ES|QL', 'v8.13.0']",https://github.com/elastic/elasticsearch/issues/100528,2023-10-09T15:48:01Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/100528,"{
  ""application_resource"": ""yes""
}"
225,100514,[CI] MixedClusterClientYamlTestSuiteIT test {p0=aggregations/terms/Global ordinals are loaded with the global_ordinals execution hint} failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/qrj3emts4qefs/tests/:qa:mixed-cluster:v8.1.3%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=aggregations%2Fterms%2FGlobal%20ordinals%20are%20loaded%20with%20the%20global_ordinals%20execution%20hint%7D
**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v8.1.3#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=aggregations/terms/Global ordinals are loaded with the global_ordinals execution hint}"" -Dtests.seed=52203CE2294AC60F -Dtests.bwc=true -Dtests.locale=sr-ME -Dtests.timezone=Pacific/Johnston -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT&tests.test=test%20%7Bp0%3Daggregations/terms/Global%20ordinals%20are%20loaded%20with%20the%20global_ordinals%20execution%20hint%7D
**Failure excerpt:**
```
java.lang.AssertionError: Failure at [aggregations/terms:741]: field [indices.test_1.total.fielddata.memory_size_in_bytes] is not greater than [0]
Expected: a value greater than <0>
     but: <0> was equal to <0>

  at __randomizedtesting.SeedInfo.seed([52203CE2294AC60F:DA74033887B6ABF7]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:582)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

  Caused by: java.lang.AssertionError: field [indices.test_1.total.fielddata.memory_size_in_bytes] is not greater than [0]
  Expected: a value greater than <0>
       but: <0> was equal to <0>

    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
    at org.junit.Assert.assertThat(Assert.java:956)
    at org.elasticsearch.test.rest.yaml.section.GreaterThanAssertion.doAssert(GreaterThanAssertion.java:64)
    at org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:65)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:562)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
    at java.lang.reflect.Method.invoke(Method.java:580)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1583)

```",edsavage,closed,"[':Analytics/Aggregations', '>test-failure', 'Team:Analytics']",https://github.com/elastic/elasticsearch/issues/100514,2023-10-09T13:46:46Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/100514,"{
  ""application_resource"": ""yes""
}"
226,100502,[CI] MixedClusterClientYamlTestSuiteIT test {p0=search.vectors/60_dense_vector_dynamic_mapping/Fields with float arrays within the threshold map as dense_vector} failing,"Test has failed just the once.

**Build scan:**
https://gradle-enterprise.elastic.co/s/bdc4arhkiazly/tests/:qa:mixed-cluster:v8.11.0%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=search.vectors%2F60_dense_vector_dynamic_mapping%2FFields%20with%20float%20arrays%20within%20the%20threshold%20map%20as%20dense_vector%7D
**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v8.11.0#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=search.vectors/60_dense_vector_dynamic_mapping/Fields with float arrays within the threshold map as dense_vector}"" -Dtests.seed=D699A81BE55AB321 -Dtests.bwc=true -Dtests.locale=sr-Latn-ME -Dtests.timezone=America/Indiana/Vevay -Druntime.java=18
```

**Applicable branches:**
main

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT&tests.test=test%20%7Bp0%3Dsearch.vectors/60_dense_vector_dynamic_mapping/Fields%20with%20float%20arrays%20within%20the%20threshold%20map%20as%20dense_vector%7D
**Failure excerpt:**
```
java.lang.AssertionError: Failure at [search.vectors/60_dense_vector_dynamic_mapping:61]: field [test-map-dense-vector.mappings.properties.my_field.dims] is null

  at __randomizedtesting.SeedInfo.seed([D699A81BE55AB321:5ECD97C14BA6DED9]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:582)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:577)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:833)

  Caused by: java.lang.AssertionError: field [test-map-dense-vector.mappings.properties.my_field.dims] is null

    at org.junit.Assert.fail(Assert.java:88)
    at org.junit.Assert.assertTrue(Assert.java:41)
    at org.junit.Assert.assertNotNull(Assert.java:712)
    at org.elasticsearch.test.rest.yaml.section.MatchAssertion.doAssert(MatchAssertion.java:78)
    at org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:65)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:562)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
    at java.lang.reflect.Method.invoke(Method.java:577)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:833)

```",edsavage,closed,"['>test-failure', ':Search Relevance/Vectors', 'low-risk', 'Team:Search Relevance']",https://github.com/elastic/elasticsearch/issues/100502,2023-10-09T11:13:16Z,18,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/100502,"{
  ""application_resource"": ""unsure""
}"
227,100371,[CI] IndexingIT testIndexing failing,"This has started failing a ton the last few days. I frankly have no idea what team this should be assigned to.

**Build scan:**
https://gradle-enterprise.elastic.co/s/rnuiwsuovl67g/tests/:x-pack:qa:rolling-upgrade:v8.2.2%23twoThirdsUpgradedTest/org.elasticsearch.upgrades.IndexingIT/testIndexing
**Reproduction line:**
```
./gradlew ':x-pack:qa:rolling-upgrade:v8.2.2#twoThirdsUpgradedTest' -Dtests.class=""org.elasticsearch.upgrades.IndexingIT"" -Dtests.method=""testIndexing"" -Dtests.seed=5FCCBD08EED2E750 -Dtests.bwc=true -Dtests.locale=ar-DZ -Dtests.timezone=Etc/GMT-12 -Druntime.java=21
```

**Applicable branches:**
8.11, main

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.upgrades.IndexingIT&tests.test=testIndexing
**Failure excerpt:**
```
java.lang.AssertionError: timed out waiting for green state for index [] cluster state [{
  ""cluster_name"" : ""v8.2.2"",
  ""cluster_uuid"" : ""mVPEGDh-SdCu0v5EceFlWA"",
  ""version"" : 680,
  ""state_uuid"" : ""4fJnJEsdRyWShvznWMlEeg"",
  ""master_node"" : ""WYDNNPxcSHCzUlxU4LJM9A"",
  ""blocks"" : {
    ""indices"" : {
      ""mounted_index_shared_cache"" : {
        ""8"" : {
          ""description"" : ""index write (api)"",
          ""retryable"" : false,
          ""levels"" : [
            ""write""
          ]
        }
      },
      ""mounted_index_full_copy"" : {
        ""8"" : {
          ""description"" : ""index write (api)"",
          ""retryable"" : false,
          ""levels"" : [
            ""write""
          ]
        }
      }
    }
  },
  ""nodes"" : {
    ""lGvXtOvMSZmPEwEQeeGjBw"" : {
      ""name"" : ""v8.2.2-1"",
      ""ephemeral_id"" : ""bpIxschHTD-M27zJJvM85w"",
      ""transport_address"" : ""127.0.0.1:38157"",
      ""external_id"" : ""v8.2.2-1"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""ml.config_version"" : ""11.0.0"",
        ""xpack.installed"" : ""true"",
        ""transform.config_version"" : ""10.0.0"",
        ""ml.allocated_processors"" : ""32"",
        ""ml.machine_memory"" : ""101258194944"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""upgraded"" : ""true"",
        ""ml.allocated_processors_double"" : ""32.0""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ],
      ""version"" : ""8.12.0"",
      ""min_index_version"" : 7000099,
      ""max_index_version"" : 8500003
    },
    ""WYDNNPxcSHCzUlxU4LJM9A"" : {
      ""name"" : ""v8.2.2-0"",
      ""ephemeral_id"" : ""X1i8SReGSlO72K9B5b7IMA"",
      ""transport_address"" : ""127.0.0.1:45279"",
      ""external_id"" : ""v8.2.2-0"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""ml.config_version"" : ""11.0.0"",
        ""xpack.installed"" : ""true"",
        ""transform.config_version"" : ""10.0.0"",
        ""ml.allocated_processors"" : ""32"",
        ""ml.machine_memory"" : ""101258194944"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""upgraded"" : ""true"",
        ""ml.allocated_processors_double"" : ""32.0""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ],
      ""version"" : ""8.12.0"",
      ""min_index_version"" : 7000099,
      ""max_index_version"" : 8500003
    }
  },
  ""nodes_versions"" : [
    {
      ""node_id"" : ""lGvXtOvMSZmPEwEQeeGjBw"",
      ""transport_version"" : ""8512000"",
      ""mappings_versions"" : {
        "".secrets-inference"" : {
          ""version"" : 1,
          ""hash"" : -1434574148
        },
        "".triggered_watches"" : {
          ""version"" : 1,
          ""hash"" : -502826165
        },
        "".fleet-agents-7"" : {
          ""version"" : 1,
          ""hash"" : -644511608
        },
        "".fleet-servers-7"" : {
          ""version"" : 1,
          ""hash"" : -916922632
        },
        "".fleet-policies-leader-7"" : {
          ""version"" : 1,
          ""hash"" : -1108172796
        },
        "".ml-config"" : {
          ""version"" : 1,
          ""hash"" : 1455005892
        },
        "".security-tokens-7"" : {
          ""version"" : 1,
          ""hash"" : 576296021
        },
        "".geoip_databases"" : {
          ""version"" : 1,
          ""hash"" : -305757839
        },
        "".snapshot-blob-cache"" : {
          ""version"" : 1,
          ""hash"" : 632712485
        },
        "".security-profile-8"" : {
          ""version"" : 1,
          ""hash"" : -909540896
        },
        "".search-app-1"" : {
          ""version"" : 1,
          ""hash"" : -501711141
        },
        "".watches"" : {
          ""version"" : 1,
          ""hash"" : -1045118511
        },
        "".fleet-artifacts-7"" : {
          ""version"" : 1,
          ""hash"" : -1593703898
        },
        "".query-rules-1"" : {
          ""version"" : 1,
          ""hash"" : 1647955624
        },
        "".transform-internal-007"" : {
          ""version"" : 1,
          ""hash"" : 1144737897
        },
        "".fleet-enrollment-api-keys-7"" : {
          ""version"" : 1,
          ""hash"" : -840564854
        },
        "".fleet-actions-7"" : {
          ""version"" : 1,
          ""hash"" : 961753072
        },
        "".tasks"" : {
          ""version"" : 0,
          ""hash"" : -945584329
        },
        "".fleet-secrets-7"" : {
          ""version"" : 1,
          ""hash"" : -745394230
        },
        "".ml-meta"" : {
          ""version"" : 1,
          ""hash"" : 976416370
        },
        "".security-7"" : {
          ""version"" : 1,
          ""hash"" : -1061511639
        },
        "".logstash"" : {
          ""version"" : 1,
          ""hash"" : -1058806351
        },
        "".ml-inference-000005"" : {
          ""version"" : 2,
          ""hash"" : -1534099917
        },
        "".async-search"" : {
          ""version"" : 0,
          ""hash"" : -1403744380
        },
        "".inference"" : {
          ""version"" : 1,
          ""hash"" : 645017346
        },
        "".fleet-policies-7"" : {
          ""version"" : 1,
          ""hash"" : 762674907
        },
        "".synonyms-2"" : {
          ""version"" : 1,
          ""hash"" : -888080772
        }
      }
    },
    {
      ""node_id"" : ""WYDNNPxcSHCzUlxU4LJM9A"",
      ""transport_version"" : ""8512000"",
      ""mappings_versions"" : { }
    }
  ],
  ""metadata"" : {
    ""cluster_uuid"" : ""mVPEGDh-SdCu0v5EceFlWA"",
    ""cluster_uuid_committed"" : true,
    ""cluster_coordination"" : {
      ""term"" : 4,
      ""last_committed_config"" : [
        ""WYDNNPxcSHCzUlxU4LJM9A"",
        ""lGvXtOvMSZmPEwEQeeGjBw"",
        ""DGulxgtJQKKeIF6J-oYHRA""
      ],
      ""last_accepted_config"" : [
        ""WYDNNPxcSHCzUlxU4LJM9A"",
        ""lGvXtOvMSZmPEwEQeeGjBw"",
        ""DGulxgtJQKKeIF6J-oYHRA""
      ],
      ""voting_config_exclusions"" : [ ]
    },
    ""templates"" : {
      "".monitoring-kibana"" : {
        ""order"" : 0,
        ""version"" : 8080099,
        ""index_patterns"" : [
          "".monitoring-kibana-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""timestamp"" : {
                ""type"" : ""date"",
                ""format"" : ""date_time""
              },
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""type"" : ""date"",
                    ""format"" : ""date_time""
                  }
                }
              },
              ""kibana_stats"" : {
                ""properties"" : {
                  ""usage"" : {
                    ""properties"" : {
                      ""index"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""kibana"" : {
                    ""properties"" : {
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""transport_address"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      },
                      ""snapshot"" : {
                        ""type"" : ""boolean""
                      },
                      ""status"" : {
                        ""type"" : ""keyword""
                      },
                      ""statuses"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""state"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      }
                    }
                  },
                  ""cloud"" : {
                    ""properties"" : {
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""id"" : {
                        ""type"" : ""keyword""
                      },
                      ""vm_type"" : {
                        ""type"" : ""keyword""
                      },
                      ""region"" : {
                        ""type"" : ""keyword""
                      },
                      ""zone"" : {
                        ""type"" : ""keyword""
                      },
                      ""metadata"" : {
                        ""type"" : ""object""
                      }
                    }
                  },
                  ""os"" : {
                    ""properties"" : {
                      ""load"" : {
                        ""properties"" : {
                          ""1m"" : {
                            ""type"" : ""half_float""
                          },
                          ""5m"" : {
                            ""type"" : ""half_float""
                          },
                          ""15m"" : {
                            ""type"" : ""half_float""
                          }
                        }
                      },
                      ""memory"" : {
                        ""properties"" : {
                          ""total_in_bytes"" : {
                            ""type"" : ""float""
                          },
                          ""free_in_bytes"" : {
                            ""type"" : ""float""
                          },
                          ""used_in_bytes"" : {
                            ""type"" : ""float""
                          }
                        }
                      },
                      ""uptime_in_millis"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""process"" : {
                    ""properties"" : {
                      ""memory"" : {
                        ""properties"" : {
                          ""heap"" : {
                            ""properties"" : {
                              ""total_in_bytes"" : {
                                ""type"" : ""float""
                              },
                              ""used_in_bytes"" : {
                                ""type"" : ""float""
                              },
                              ""size_limit"" : {
                                ""type"" : ""float""
                              }
                            }
                          },
                          ""resident_set_size_in_bytes"" : {
                            ""type"" : ""float""
                          }
                        }
                      },
                      ""event_loop_delay"" : {
                        ""type"" : ""float""
                      },
                      ""uptime_in_millis"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""sockets"" : {
                    ""properties"" : {
                      ""http"" : {
                        ""properties"" : {
                          ""total"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""https"" : {
                        ""properties"" : {
                          ""total"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""type"" : ""date""
                  },
                  ""requests"" : {
                    ""properties"" : {
                      ""disconnects"" : {
                        ""type"" : ""long""
                      },
                      ""total"" : {
                        ""type"" : ""long""
                      },
                      ""status_codes"" : {
                        ""type"" : ""object""
                      }
                    }
                  },
                  ""response_times"" : {
                    ""properties"" : {
                      ""average"" : {
                        ""type"" : ""float""
                      },
                      ""max"" : {
                        ""type"" : ""float""
                      }
                    }
                  },
                  ""concurrent_connections"" : {
                    ""type"" : ""long""
                  }
                }
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-beats"" : {
        ""order"" : 0,
        ""version"" : 8080099,
        ""index_patterns"" : [
          "".monitoring-beats-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""beats_state"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""state"" : {
                    ""properties"" : {
                      ""beat"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""host"" : {
                        ""properties"" : {
                          ""architecture"" : {
                            ""type"" : ""keyword""
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""hostname"" : {
                            ""type"" : ""keyword""
                          },
                          ""os"" : {
                            ""properties"" : {
                              ""build"" : {
                                ""type"" : ""keyword""
                              },
                              ""family"" : {
                                ""type"" : ""keyword""
                              },
                              ""platform"" : {
                                ""type"" : ""keyword""
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          }
                        }
                      },
                      ""input"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          },
                          ""names"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""module"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          },
                          ""names"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""output"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""service"" : {
                        ""properties"" : {
                          ""id"" : {
                            ""type"" : ""keyword""
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""version"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""format"" : ""date_time"",
                    ""type"" : ""date""
                  }
                }
              },
              ""beats_stats"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""metrics"" : {
                    ""properties"" : {
                      ""beat"" : {
                        ""properties"" : {
                          ""cgroup"" : {
                            ""properties"" : {
                              ""cpu"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""cfs"" : {
                                    ""properties"" : {
                                      ""period"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""quota"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""stats"" : {
                                    ""properties"" : {
                                      ""periods"" : {
                                        ""type"" : ""long""
                                      },
                                      ""throttled"" : {
                                        ""properties"" : {
                                          ""periods"" : {
                                            ""type"" : ""long""
                                          },
                                          ""ns"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              ""cpuacct"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""total"" : {
                                    ""properties"" : {
                                      ""ns"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""memory"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""mem"" : {
                                    ""properties"" : {
                                      ""limit"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""usage"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""cpu"" : {
                            ""properties"" : {
                              ""system"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""total"" : {
                                ""properties"" : {
                                  ""value"" : {
                                    ""type"" : ""long""
                                  },
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""user"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""info"" : {
                            ""properties"" : {
                              ""ephemeral_id"" : {
                                ""type"" : ""keyword""
                              },
                              ""uptime"" : {
                                ""properties"" : {
                                  ""ms"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          },
                          ""memstats"" : {
                            ""properties"" : {
                              ""gc_next"" : {
                                ""type"" : ""long""
                              },
                              ""memory_alloc"" : {
                                ""type"" : ""long""
                              },
                              ""memory_total"" : {
                                ""type"" : ""long""
                              },
                              ""rss"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""handles"" : {
                            ""properties"" : {
                              ""open"" : {
                                ""type"" : ""long""
                              },
                              ""limit"" : {
                                ""properties"" : {
                                  ""hard"" : {
                                    ""type"" : ""long""
                                  },
                                  ""soft"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""apm-server"" : {
                        ""properties"" : {
                          ""acm"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unavailable"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      },
                                      ""notfound"" : {
                                        ""type"" : ""long""
                                      },
                                      ""invalidquery"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""notmodified"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""unset"" : {
                                    ""type"" : ""long""
                                  },
                                  ""request"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""server"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""concurrent"" : {
                                ""properties"" : {
                                  ""wait"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""concurrency"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""decoder"" : {
                            ""properties"" : {
                              ""deflate"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""gzip"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""uncompressed"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reader"" : {
                                ""properties"" : {
                                  ""size"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""missing-content-length"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""processor"" : {
                            ""properties"" : {
                              ""metric"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""sourcemap"" : {
                                ""properties"" : {
                                  ""counter"" : {
                                    ""type"" : ""long""
                                  },
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""transaction"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""transactions"" : {
                                    ""type"" : ""long""
                                  },
                                  ""spans"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stacktraces"" : {
                                    ""type"" : ""long""
                                  },
                                  ""frames"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""error"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stacktraces"" : {
                                    ""type"" : ""long""
                                  },
                                  ""frames"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""span"" : {
                                ""properties"" : {
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""sampling"" : {
                            ""properties"" : {
                              ""transactions_dropped"" : {
                                ""type"" : ""long""
                              },
                              ""tail"" : {
                                ""properties"" : {
                                  ""dynamic_service_groups"" : {
                                    ""type"" : ""long""
                                  },
                                  ""storage"" : {
                                    ""properties"" : {
                                      ""lsm_size"" : {
                                        ""type"" : ""long""
                                      },
                                      ""value_log_size"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""events"" : {
                                    ""properties"" : {
                                      ""processed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""dropped"" : {
                                        ""type"" : ""long""
                                      },
                                      ""stored"" : {
                                        ""type"" : ""long""
                                      },
                                      ""sampled"" : {
                                        ""type"" : ""long""
                                      },
                                      ""head_unsampled"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""libbeat"" : {
                        ""properties"" : {
                          ""config"" : {
                            ""properties"" : {
                              ""module"" : {
                                ""properties"" : {
                                  ""running"" : {
                                    ""type"" : ""long""
                                  },
                                  ""starts"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stops"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reloads"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""output"" : {
                            ""properties"" : {
                              ""events"" : {
                                ""properties"" : {
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  },
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""batches"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""duplicates"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""total"" : {
                                    ""type"" : ""long""
                                  },
                                  ""toomany"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""read"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""type"" : {
                                ""type"" : ""keyword""
                              },
                              ""write"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""pipeline"" : {
                            ""properties"" : {
                              ""clients"" : {
                                ""type"" : ""long""
                              },
                              ""events"" : {
                                ""properties"" : {
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""filtered"" : {
                                    ""type"" : ""long""
                                  },
                                  ""published"" : {
                                    ""type"" : ""long""
                                  },
                                  ""retry"" : {
                                    ""type"" : ""long""
                                  },...
```",mark-vieira,closed,"['blocker', '>test-failure', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/100371,2023-10-05T21:10:57Z,13,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/100371,"{
  ""application_resource"": ""yes""
}"
228,100288,[CI] HeapAttackIT testHugeConcat failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/raslhxar3ujes/tests/:x-pack:plugin:esql:qa:server:single-node:javaRestTest/org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT/testHugeConcat
**Reproduction line:**
```
./gradlew ':x-pack:plugin:esql:qa:server:single-node:javaRestTest' --tests ""org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.testHugeConcat"" -Dtests.seed=C4EA0D658E691F34 -Dtests.locale=ar-SD -Dtests.timezone=Etc/GMT+11 -Druntime.java=21
```

**Applicable branches:**
main

**Reproduces locally?:**
Yes

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT&tests.test=testHugeConcat
**Failure excerpt:**
```
junit.framework.AssertionFailedError: Unexpected exception type, expected ResponseException but got java.io.IOException: Connection reset

  at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2869)
  at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2850)
  at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.assertCircuitBreaks(HeapAttackIT.java:71)
  at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.testHugeConcat(HeapAttackIT.java:163)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
  at java.lang.reflect.Method.invoke(Method.java:580)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1583)

  Caused by: java.io.IOException: Connection reset

    at org.elasticsearch.client.RestClient.extractAndWrapCause(RestClient.java:935)
    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:300)
    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:303)
    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:288)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.concat(HeapAttackIT.java:177)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.lambda$testHugeConcat$1(HeapAttackIT.java:163)
    at org.apache.lucene.tests.util.LuceneTestCase._expectThrows(LuceneTestCase.java:3022)
    at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2859)
    at org.apache.lucene.tests.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2850)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.assertCircuitBreaks(HeapAttackIT.java:71)
    at org.elasticsearch.xpack.esql.qa.single_node.HeapAttackIT.testHugeConcat(HeapAttackIT.java:163)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
    at java.lang.reflect.Method.invoke(Method.java:580)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1583)

    Caused by: java.net.SocketException: Connection reset

      at sun.nio.ch.SocketChannelImpl.throwConnectionReset(SocketChannelImpl.java:401)
      at sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:434)
      at org.apache.http.impl.nio.reactor.SessionInputBufferImpl.fill(SessionInputBufferImpl.java:231)
      at org.apache.http.impl.nio.codecs.AbstractMessageParser.fillBuffer(AbstractMessageParser.java:136)
      at org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:241)
      at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:87)
      at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:40)
      at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)
      at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)
      at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)
      at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)
      at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)
      at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)
      at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:591)
      at java.lang.Thread.run(Thread.java:1583)

```",ChrisHegarty,closed,"['>test-failure', 'Team:QL (Deprecated)', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/100288,2023-10-04T15:36:38Z,12,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/100288,"{
  ""application_resource"": ""yes""
}"
229,100120,AbstractSearchAsyncAction captures cluster state unnecessarily,"`org.elasticsearch.action.search.AbstractSearchAsyncAction#clusterState` is almost entirely unused, except for one trace log message and one call to `org.elasticsearch.cluster.ClusterState#getMinTransportVersion`. If the cluster state is changing quickly while searches are starting then these captured cluster states can consume substantial memory. If all we care about is the min transport version then we should just pass that in.

Note that the cluster state that ends up here is also captured by various lambdas (e.g. the one that runs after the can-match phase). The more we can reduce the scope of this cluster state capture, the better.",DaveCTurner,closed,"['>bug', ':Search/Search', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/100120,2023-10-01T08:20:17Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/100120,"{
  ""application_resource"": ""yes""
}"
230,100081,[CI] org.elasticsearch.xpack.esql.qa.single_node.EsqlSpecIT failing,"There's been a lot of failure for this suite in the past few days, e.g.: https://gradle-enterprise.elastic.co/s/ho4zlyo4xtu4g/tests/overview?outcome=failed

Failure history: https://gradle-enterprise.elastic.co/scans/tests?search.buildOutcome=failure&search.timeZoneId=Europe/Berlin&tests.container=org.elasticsearch.xpack.esql.qa.single_node.EsqlSpecIT",pxsalehi,closed,"['>test-failure', 'Team:QL (Deprecated)', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/100081,2023-09-29T16:03:32Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/100081,"{
  ""application_resource"": ""unsure""
}"
231,99815,Integrate TDigestState with circuit breakers,"### Description

`TDigest`is missing integration with circuit breakers. The latter can track memory allocation and throw an exception before exhausting the heap. While the latest (forked) version of the TDigest library has constant memory footprint of < 100kB, it's still possible to create thousands of such instances (one per bucket) so it's still valuable to complete this task.",kkrik-es,closed,"['>enhancement', ':Analytics/Aggregations', 'Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/99815,2023-09-22T13:56:39Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99815,"{
  ""application_resource"": ""yes""
}"
232,99802,Limit term query values to IndexWriter.MAX_TERM_LENGTH,"### Description

There is a hard limit on the size of terms that can be indexed in lucene.  However, we don't check this at query time, which can lead to memory issues if the term query in question is case insensitive.  Very long terms are normally a sign of user error, so we should check up-front the length of the input and throw and exception if it is greater than `IndexWriter.MAX_TERM_LENGTH`.",romseygeek,closed,"['>enhancement', ':Search/Search', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/99802,2023-09-22T09:48:36Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99802,"{
  ""application_resource"": ""yes""
}"
233,99774,[CI] MixedClusterClientYamlTestSuiteIT test {p0=aggregations/terms/Global ordinals are loaded with the global_ordinals execution hint} failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/6gbvbxlef5oq2/tests/:qa:mixed-cluster:v8.2.0%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=aggregations%2Fterms%2FGlobal%20ordinals%20are%20loaded%20with%20the%20global_ordinals%20execution%20hint%7D

**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v8.2.0#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=aggregations/terms/Global ordinals are loaded with the global_ordinals execution hint}"" -Dtests.seed=79C1CCB2702CF1EC -Dtests.bwc=true -Dtests.locale=es-MX -Dtests.timezone=Africa/Nairobi -Druntime.java=20
```

**Applicable branches:**
main

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT&tests.test=test%20%7Bp0%3Daggregations/terms/Global%20ordinals%20are%20loaded%20with%20the%20global_ordinals%20execution%20hint%7D

**Failure excerpt:**
```
java.lang.AssertionError: Failure at [aggregations/terms:737]: field [indices.test_1.total.fielddata.memory_size_in_bytes] is not greater than [0]
Expected: a value greater than <0>
     but: <0> was equal to <0>

  at __randomizedtesting.SeedInfo.seed([79C1CCB2702CF1EC:F195F368DED09C14]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:582)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

  Caused by: java.lang.AssertionError: field [indices.test_1.total.fielddata.memory_size_in_bytes] is not greater than [0]
  Expected: a value greater than <0>
       but: <0> was equal to <0>

    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
    at org.junit.Assert.assertThat(Assert.java:956)
    at org.elasticsearch.test.rest.yaml.section.GreaterThanAssertion.doAssert(GreaterThanAssertion.java:64)
    at org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:65)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:562)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
    at java.lang.reflect.Method.invoke(Method.java:578)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1623)

```",arteam,closed,"[':Analytics/Aggregations', '>test-failure', 'Team:Analytics', 'low-risk']",https://github.com/elastic/elasticsearch/issues/99774,2023-09-21T16:32:12Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99774,"{
  ""application_resource"": ""yes""
}"
234,99739,PIT IDs can grow to many MiB in size,"Today, the length of a PIT ID scales with the number of shards captured by the PIT. In a large cross-cluster scenario there may be 100k or more shards, leading to IDs that are several MiB in size. Simply creating these IDs in memory burns a bunch of CPU (see https://github.com/elastic/elasticsearch/pull/99219 for some optimizations there) but we still have to send them over the wire as part of each request, and the cross-region transit costs for this traffic can be several US cents per GiB so the cost of that traffic can be eyewatering.",DaveCTurner,closed,"['>bug', ':Search/Search', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/99739,2023-09-21T09:31:30Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99739,"{
  ""application_resource"": ""no""
}"
235,99684,EQL sequence queries open PIT against indices not included in search request,"### Elasticsearch Version

8.11

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux 5.3.0-64-generic

### Problem Description

EQL search requests with sequence queries open a PIT internally, but the PIT includes indices that were not part of the EQL search request. The final results are correct because the searches include a `terms` filter on the `_index` field that limits the returned results to the correct indices, however, performance suffers when there are many indices in the system. Performance is noticeably worse when some indices are on frozen nodes and get included in the PIT despite not being included in the original search request. In this case frozen node CPU usage spikes even when the EQL search request from the user does not include any frozen indices in the request.

Since the indices in the PIT are not respecting the list of indices from the search request, users have no means to tune and prevent EQL sequence searches from impacting their frozen nodes.

### Steps to Reproduce

Script to create 2 indices, then query `test_eql_sequence_pit` with an EQL sequence in a loop:
```
#!/bin/sh

ES=http://elastic:changeme@localhost:9200
ESIDX=test_eql_sequence_pit
ESIDX_UNRELATED=test_unrelated_index

curl -s -XDELETE $ES/$ESIDX >/dev/null

curl -s -XPUT $ES/$ESIDX?pretty=true -H 'Content-Type: application/json' -d '{
    ""settings"": {}
}'

curl -s -XPUT $ES/$ESIDX_UNRELATED?pretty=true -H 'Content-Type: application/json' -d '{
    ""settings"": {}
}'

curl -s -XPOST $ES/$ESIDX/_mapping?pretty=true -H 'Content-Type: application/json' -d '{
    ""properties"": {
        ""@timestamp"": {
            ""type"": ""date""
        }
    }
}'

for i in {1..100}
do
echo ""$i""
curl -s -XPOST $ES/$ESIDX/_bulk?pretty=true\&refresh=true -H 'Content-Type: application/json' -d \
'{""index"": {}}
{""@timestamp"": ""1695149097000""}
{""index"": {}}
{""@timestamp"": ""1695149097001""}
{""index"": {}}
{""@timestamp"": ""1695149097002""}
{""index"": {}}
{""@timestamp"": ""1695149097003""}
{""index"": {}}
{""@timestamp"": ""1695149097004""}
{""index"": {}}
{""@timestamp"": ""1695149097005""}
{""index"": {}}
{""@timestamp"": ""1695149097006""}
{""index"": {}}
{""@timestamp"": ""1695149097007""}
'>/dev/null
done

for (( ; ; ))
do
curl -s -XPOST $ES/$ESIDX/_eql/search -H 'Content-Type: application/json' -d \
'{
  ""size"": 100,
  ""query"":""sequence [any where true][any where true][any where true][any where true][any where true][any where true][any where true][any where true]""
}
'>/dev/null

done
```

While the first script is running, fetch active tasks with this second script:
```
#!/bin/sh

ES=http://elastic:changeme@localhost:9200
ESIDX=test_eql_sequence_pit

curl -s -XGET ""$ES/_tasks?actions=*search&detailed=true""
```

Example response:
```
{
  ""nodes"": {
    ""8MqMka6cR1KWtajIGSmW3A"": {
      ""name"": ""marshall-X570-AORUS-PRO-WIFI"",
      ""transport_address"": ""127.0.0.1:9300"",
      ""host"": ""127.0.0.1"",
      ""ip"": ""127.0.0.1:9300"",
      ""roles"": [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ],
      ""attributes"": {
        ""ml.machine_memory"": ""33683869696"",
        ""transform.config_version"": ""10.0.0"",
        ""xpack.installed"": ""true"",
        ""ml.config_version"": ""10.0.0"",
        ""ml.max_jvm_size"": ""1610612736"",
        ""ml.allocated_processors_double"": ""24.0"",
        ""ml.allocated_processors"": ""24""
      },
      ""tasks"": {
        ""8MqMka6cR1KWtajIGSmW3A:3727"": {
          ""node"": ""8MqMka6cR1KWtajIGSmW3A"",
          ""id"": 3727,
          ""type"": ""transport"",
          ""action"": ""indices:data/read/search"",
          ""description"": ""indices[test_unrelated_index,test_eql_sequence_pit], search_type[QUERY_THEN_FETCH], source[{\""size\"":1000,\""timeout\"":\""30s\"",\""query\"":{\""bool\"":{\""filter\"":[{\""range\"":{\""@timestamp\"":{\""time_zone\"":\""UTC\"",\""format\"":\""epoch_millis\"",\""boost\"":1.0}}},{\""term\"":{\""_index\"":{\""value\"":\""test_eql_sequence_pit\""}}}],\""boost\"":1.0}},\""_source\"":false,\""fields\"":[{\""field\"":\""@timestamp\"",\""format\"":\""epoch_millis\""}],\""sort\"":[{\""@timestamp\"":{\""order\"":\""desc\"",\""missing\"":\""_last\"",\""unmapped_type\"":\""date\""}}],\""track_total_hits\"":-1,\""pit\"":{\""id\"":\""6-aGBAEVdGVzdF9lcWxfc2VxdWVuY2VfcGl0FnRuOU42aGVlVHdLcWc2ay0wRjZFcXcAFjhNcU1rYTZjUjFLV3RhaklHU21XM0EAAAAAAAAAAHAWYURhZ0N4MzRSckstM0NpanE2SFRDUQABFnRuOU42aGVlVHdLcWc2ay0wRjZFcXcAAA==\""}}]"",
          ""start_time_in_millis"": 1695163108456,
          ""running_time_in_nanos"": 5185143,
          ""cancellable"": true,
          ""cancelled"": false,
          ""parent_task_id"": ""8MqMka6cR1KWtajIGSmW3A:3722"",
          ""headers"": {}
        }
      }
    }
  }
}
```
The task description shows a query going to both indices even though the EQL search request is made to `test_eql_sequence_pit` specifically with no wildcards.

### Logs (if relevant)

_No response_",marshallmain,closed,"['>enhancement', ':Analytics/EQL', 'Team:QL (Deprecated)']",https://github.com/elastic/elasticsearch/issues/99684,2023-09-19T22:56:08Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99684,"{
  ""application_resource"": ""yes""
}"
236,99592,High memory pressure for Elasticsearch versions using JDK 20+,"### Elasticsearch Version

8.7.1 and above, 7.17.10 and above

### Installed Plugins

_No response_

### Java Version

JDK 20 or above.

The issue depends on the JDK version rather than the ES version.

For reference, these are the bundled JDK versions (see `Dependencies and versions` section in Elasticsearch docs per stack version):
```
Stack  - JDK
-----    ---
7.17.10 - 20.0.1+9
7.17.11 - 20.0.1+9
7.17.12 - 20.0.2+9
7.17.13 - 20.0.2+9
7.17.14 - 21+35
7.17.15 - 21.0.1+12
8.7.1   - 20.0.1+9
8.8.2   - 20.0.1+9
8.9.0   - 20.0.2+9
8.9.1   - 20.0.2+9
8.9.2   - 20.0.2+9
8.10.0  - 20.0.2+9
8.10.1  - 20.0.2+9
8.10.2  - 20.0.2+9
8.10.3  - 21+35
8.10.4  - 21+35
8.11.0  - 21.0.1+12
8.11.1  - 21.0.1+12
```

The last stack version that allows the escape hatch workaround of re-enabling the disabled JVM setting (`-XX:+UnlockDiagnosticVMOptions -XX:+G1UsePreventiveGC` - see Problem Description below) are:
- Elasticsearch v8.10.2 for 8.x branch
- Elasticsearch v7.17.13 for 7.x branch

since versions after this one bundle JDK21 or later that has the setting removed from the JVM entirely.
Adding or leaving the JVM setting in place and starting/upgrading to 8.10.3+ will fail to start the JVM due to the unknown setting in the later JDK versions.

Switch to non-bundled JDK < 20 (when possible) should also function as a workaround. 

### OS Version

N/A

### Problem Description

In 8.7.1 the bundled JDK was changed to JDK 20.0.1 in this PR: https://github.com/elastic/elasticsearch/pull/95373

When retrieving large documents from Elasticsearch we see high memory pressure on the data node returning the documents.

There seems to be a distinct difference in how allocated memory is cleaned up between JDK 19 and JDK 20.

The graphs below show memory usage when allocating many ~5mb byte arrays to transfer a ~400 mb pytorch model from  a data node to an ML node. The pytorch model is chunked and stored in separate documents that are retrieved one at a time by the ML node. When repeatedly allocating these large arrays, we see memory pressure distinctly increase in JDK 20.0.1. The graphs show memory usage over time when repeatedly starting and stopping the pytorch model.

**Memory pressure for 8.7.0**

![image](https://github.com/elastic/elasticsearch/assets/56361221/570fcd24-b163-4266-b2a6-ff8ac8c6bc23)

**Memory pressure for 8.7.1**

![image](https://github.com/elastic/elasticsearch/assets/56361221/a42b9588-08a5-4660-bd4d-92c5da4e5c28)

Here's one from using VisualVM to monitor heap usage using a local deployment

![image](https://github.com/elastic/elasticsearch/assets/56361221/826224b0-e3f8-4938-8158-a8b9669bbd9e)


**Memory pressure for 8.7.1 when using the `-XX:+UnlockDiagnosticVMOptions -XX:+G1UsePreventiveGC` options**

If the data node is started with the JVM options enabled we see memory usage closer to what it looks like in JDK 19

![image](https://github.com/elastic/elasticsearch/assets/56361221/5ceb599e-64c3-4317-a21c-b4580a7bab1b)


### Steps to Reproduce

The issue can be reproduced easily in cloud but I'll describe the steps for running elasticsearch locally too.

#### Setup

**Cloud**
In cloud deploy a cluster with

- 2 zones and 4 GB data nodes
- 2 zones and 4 GB ML nodes
- Enable monitoring so you can see the heap usage

**Locally**

Run two nodes (1 data node, and 1 ML node).

Download and install 8.7.1 https://www.elastic.co/downloads/past-releases/elasticsearch-8-7-1
Download and install 8.7.1 of kibana https://www.elastic.co/downloads/past-releases/kibana-8-7-1
Download and install eland https://github.com/elastic/eland

An easy way to run two nodes is simply to decompress the bundle in two places.

Configuration

- Create a file under `config/jvm.options.d` and add the following JVM options for both the data node and ML node
```
-Xms4g
-Xmx4g
```

- Add the following settings to the data nodes `config/elasticsearch.yml` file

```
node.roles: [""master"", ""data"", ""data_content"", ""ingest"", ""data_hot"", ""data_warm"", ""data_cold"", ""data_frozen"", ""transform""]
xpack.security.enabled: true
xpack.license.self_generated.type: ""trial""
```

- Add the following settings to the ml nodes `config/elasticsearch.yml` file
```
node.roles: [""ml""]
xpack.security.enabled: true
xpack.license.self_generated.type: ""trial""
```

- Reset the `elastic` password on the data node

From `bin`

```
./elasticsearch-reset-password -i -u elastic --url http://localhost:9200
```

- Create a service token for kibana

From `bin`

```
./elasticsearch-service-tokens create elastic/kibana <token name>
```

- Add this token to kibana's `kibana.yml` file

```
elasticsearch.serviceAccountToken: ""<token>""
```

and ensure that these settings are disabled `elasticsearch.username` and `elasticsearch.password`

- Start both elasticsearch nodes and kibana
- Connect VisualVM to the data node and observe memory usage over time

**Reproducing the bug in cloud and locally**

- Upload a pytorch model of around ~400 mb

Locally
```
docker run -it --rm --network host elastic/eland \
    eland_import_hub_model \
      --url http://elastic:changeme@host.docker.internal:9200/ \
      --hub-model-id sentence-transformers/all-distilroberta-v1 \
--clear-previous
```

For cloud
```
docker run -it --rm elastic/eland \
    eland_import_hub_model \
      --url https://elastic:<cloud password>@<cloud es url>:9243 \
      --hub-model-id sentence-transformers/all-distilroberta-v1 \
--clear-previous
```

- Repeatedly start and stop the uploaded model (20 - 30 times)
  - Navigate to Machine Learning -> Trained models
  - Click the start and stop buttons repeatedly
- Observe memory usage over time

### Logs (if relevant)

_No response_",jonathan-buttner,closed,"['>bug', ':Search/Search', ':Core/Infra/Circuit Breakers', ':ml', 'Team:Core/Infra', 'Team:Search', 'Team:ML', 'v8.7.1']",https://github.com/elastic/elasticsearch/issues/99592,2023-09-14T18:56:39Z,41,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99592,"{
  ""application_resource"": ""yes""
}"
237,99508,DockerTests.test600Interrupt failing due to stdout being too long,"### CI Link

https://gradle-enterprise.elastic.co/s/kl67xjolc3cgc

### Repro line

n/a

### Does it reproduce?

Yes

### Applicable branches

main

### Failure history

_No response_

### Failure excerpt

https://gradle-enterprise.elastic.co/scans/tests?search.timeZoneId=Europe/Warsaw&tests.container=org.elasticsearch.packaging.test.DockerTests&tests.test=test600Interrupt

the test fails due to infrastructure code reading from docker's stdout failing due to stdout being too long
```


<<Too large to read (113516 bytes), truncated>>"" | Â 
-- | --
Â  | at __randomizedtesting.SeedInfo.seed([359E5782DDE88E6E:AF75E480BDF7F318]:0) | Â 
Â  | at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18) | Â 
Â  | at org.junit.Assert.assertThat(Assert.java:956) | Â 
Â  | at org.elasticsearch.packaging.test.DockerTests.test600Interrupt(DockerTests.java:1237)


```
the limit is 100*1024*charsize

we should iteratively check the stdout instead of copying the full output",pgomulka,closed,"[':Core/Infra/Core', '>test-failure', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/99508,2023-09-13T07:37:18Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99508,"{
  ""application_resource"": ""yes""
}"
238,99496,[CI] DocsClientYamlTestSuiteIT test {yaml=reference/rest-api/usage/line_38} failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/twppfyraqo45a/tests/:docs:yamlRestTest/org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT/test%20%7Byaml=reference%2Frest-api%2Fusage%2Fline_38%7D

**Reproduction line:**
```
./gradlew ':docs:yamlRestTest' --tests ""org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT.test {yaml=reference/rest-api/usage/line_38}"" -Dtests.seed=BDA102BBC82984E1 -Dtests.locale=en-IE -Dtests.timezone=Asia/Baku -Druntime.java=20
```

**Applicable branches:**
main

**Reproduces locally?:**
Yes

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT&tests.test=test%20%7Byaml%3Dreference/rest-api/usage/line_38%7D

**Failure excerpt:**
```
java.lang.AssertionError: Failure at [reference/rest-api/usage:16]: Expected a map containing
                         eql: a map containing
                     available: <true>
                       enabled: <true>
                      features: a map containing
                           joins: a map containing
                join_queries_three: <0>
                  join_queries_two: <0>
                        join_until: <0>
         join_queries_five_or_more: <0>
                 join_queries_four: <0>
                        sequence: <7>
                            keys: a map containing
                     join_keys_two: <0>
                     join_keys_one: <4>
                   join_keys_three: <0>
            join_keys_five_or_more: <0>
                    join_keys_four: <0>
                            join: <0>
                       sequences: a map containing
            sequence_queries_three: <2>
             sequence_queries_four: <0>
              sequence_queries_two: <5>
                    sequence_until: <0>
                  sequence_maxspan: <4>
     sequence_queries_five_or_more: <0>
                           event: <20>
                           pipes: a map containing
                         pipe_tail: <24>
                         pipe_head: <0>
                       queries: a map containing
                             all: a map containing
                             total: <27>
                            failed: <0>
                            _all: a map containing
                             total: <27>
                            failed: <0>
              frozen_indices: a map containing
                 indices_count: <0>
                     available: <true>
                       enabled: <true>
                         sql: a map containing
                      features: a map containing
                          having: <2>
                       subselect: <0>
                           limit: <2>
                         orderby: <13>
                           where: <4>
                            join: <0>
                         groupby: <2>
                         command: <0>
                           local: <0>
                     available: <true>
                       queries: a map containing
                            rest: a map containing
                             total: <18>
                            paging: <2>
                            failed: <0>
                             cli: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          canvas: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            odbc: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            jdbc: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          odbc32: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          odbc64: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            _all: a map containing
                             total: <18>
                            paging: <2>
                            failed: <0>
                       translate: a map containing
                             count: <2>
                       enabled: <true>
                      rollup: a map containing
                     available: <true>
                       enabled: <true>
        searchable_snapshots: a map containing
    shared_cache_indices_count: <0>
                 indices_count: <0>
                     available: <true>
       full_copy_indices_count: <0>
                       enabled: <true>
                   analytics: a map containing
                         stats: a map containing
                      rate_usage: <5>
                 normalize_usage: <1>
                   boxplot_usage: <5>
               top_metrics_usage: <8>
               multi_terms_usage: <4>
    cumulative_cardinality_usage: <2>
              string_stats_usage: <5>
        moving_percentiles_usage: <1>
                    t_test_usage: <3>
                     available: <true>
                       enabled: <true>
                    logstash: a map containing
                     available: <true>
                       enabled: <true>
                    security: a map containing
                     available: <true>
                       enabled: <true>
                        realms: a map containing
                            file: a map containing
                              name: a list containing
                                   0: ""file""
                         available: <true>
                             cache: a list containing
                                   0: a map containing
                                  size: <2>
                              size: a list containing
                                   0: <2>
                           enabled: <true>
                             order: a list containing
                                   0: <0>
                            ldap: a map containing
                           enabled: <false>
                         available: <true>
                          native: a map containing
                              name: a list containing
                                   0: ""native""
                         available: <true>
                             cache: a list containing
                                   0: a map containing
                                  size: <0>
                              size: a list containing
                                   0: <0>
                           enabled: <true>
                             order: a list containing
                                   0: <1>
                             jwt: a map containing
                           enabled: <false>
                         available: <true>
                            saml: a map containing
                              name: a list containing
                                   0: ""saml1""
                         available: <true>
                           enabled: <true>
                             order: a list containing
                                   0: <4>
                        kerberos: a map containing
                           enabled: <false>
                         available: <true>
                            oidc: a map containing
                              name: a list containing
                                   0: ""oidc1""
                         available: <true>
                           enabled: <true>
                             order: a list containing
                                   0: <2>
                active_directory: a map containing
                           enabled: <false>
                         available: <true>
                             pki: a map containing
                    has_truststore: a list containing
                                   0: <true>
       is_authentication_delegated: a list containing
                                   0: <true>
                              name: a list containing
                                   0: ""pki1""
                         available: <true>
      has_default_username_pattern: a list containing
                                   0: <true>
                           enabled: <true>
                             order: a list containing
                                   0: <3>
          has_authorization_realms: a list containing
                                   0: <false>
                         roles: a map containing
                            file: a map containing
                    remote_indices: <0>
                               dls: <false>
                              size: <1>
                               fls: <false>
                          native: a map containing
                               dls: <false>
                              size: <0>
                               fls: <false>
                             dls: a map containing
                     bit_set_cache: a map containing
                               count: <0>
                              memory: ""0b""
                     memory_in_bytes: <0>
                  role_mapping: a map containing
                          native: a map containing
                              size: <0>
                           enabled: <0>
                           ssl: a map containing
           remote_cluster_client: a map containing
                           enabled: <true>
                            http: a map containing
                           enabled: <false>
                       transport: a map containing
                           enabled: <false>
                 token_service: a map containing
                         enabled: <true>
               api_key_service: a map containing
                         enabled: <true>
                         audit: a map containing
                         enabled: <false>
                      ipfilter: a map containing
                            http: <false>
                       transport: <false>
                     anonymous: a map containing
                         enabled: <false>
                      fips_140: a map containing
                         enabled: <false>
           operator_privileges: a map containing
                       available: <true>
                         enabled: <false>
                  user_profile: a map containing
                          recent: <0>
                           total: <0>
                         enabled: <0>
         remote_cluster_server: a map containing
                         enabled: <false>
                        api_keys: a map containing
                           ccs_ccr: <0>
                               ccr: <0>
                               ccs: <0>
                             total: <0>
                       available: <true>
                   transform: a map containing
                     available: <true>
                       enabled: <true>
                         ccr: a map containing
    auto_follow_patterns_count: <0>
                     available: <true>
        follower_indices_count: <0>
                       enabled: <true>
                  health_api: a map containing
                     available: <true>
                       enabled: <true>
                      statuses: a map containing
                           green: <11>
                          values: a list containing
                                 0: ""green""
                   invocations: a map containing
                           total: <11>
                    verbose_true: <10>
                   verbose_false: <1>
                     spatial: a map containing
                     available: <true>
                       enabled: <true>
                          ml: a map containing
                     inference: a map containing
                     deployments: a map containing
                           time_ms: a map containing
                                 avg: <0.0>
                             count: <0>
                 model_sizes_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                  inference_counts: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                  trained_models: a map containing
                  model_size_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
              estimated_operations: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                             count: a map containing
                               total: <1>
                         prepackaged: <1>
                               other: <0>
                              _all: a map containing
                               count: <1>
               ingest_processors: a map containing
                              _all: a map containing
                           pipelines: a map containing
                                 count: <0>
                             time_ms: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
                  num_docs_processed: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
                        num_failures: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
     data_frame_analytics_jobs: a map containing
                    memory_usage: a map containing
                  peak_usage_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                            _all: a map containing
                             count: <0>
                 analysis_counts: an empty map
                          jobs: a map containing
                            _all: a map containing
                             count: <0>
                         detectors: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                        created_by: an empty map
                        model_size: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                         forecasts: a map containing
                               total: <0>
                     forecasted_jobs: <0>
                     available: <true>
                     datafeeds: a map containing
                            _all: a map containing
                             count: <0>
                    node_count: <1>
                       enabled: <true>
                     watcher: a map containing
                     execution: a map containing
                         actions: a map containing
                              _all: a map containing
                               total: <15>
                    total_time_in_ms: <383>
                             email: <unexpected> but was <{total=1, total_time_in_ms=19}>
                         watch: a map containing
                           input: a map containing
                              _all: a map containing
                               total: <0>
                              active: <0>
                         trigger: a map containing
                              _all: a map containing
                               total: <0>
                              active: <0>
                     available: <true>
                         count: a map containing
                           total: <0>
                          active: <0>
                       enabled: <true>
           enterprise_search: a map containing
           search_applications: a map containing
                           count: <0>
         analytics_collections: a map containing
                           count: <0>
                query_rulesets: a map containing
                total_rule_count: <0>
                     total_count: <0>
                  min_rule_count: <0>
                  max_rule_count: <0>
                     available: <true>
                       enabled: <true>
                        esql: a map containing
                      features: a map containing
                            eval: <5>
                           stats: <2>
                         dissect: <0>
                            grok: <0>
                           limit: <8>
                           where: <0>
                            sort: <2>
                     available: <true>
                       queries: a map containing
                            rest: a map containing
                             total: <8>
                            failed: <0>
                          kibana: a map containing
                             total: <0>
                            failed: <0>
                            _all: a map containing
                             total: <8>
                            failed: <0>
                       enabled: <true>
                     archive: a map containing
                 indices_count: <0>
                     available: <true>
                       enabled: <true>
                         ilm: a map containing
                  policy_count: <19>
                  policy_stats: a list containing
                               0: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               1: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               2: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""3d""
                            max_age_millis: <259200000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <345600000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               3: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               4: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               5: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                               6: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""forcemerge""
                                       1: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""3d""
                            max_age_millis: <259200000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <259200000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               7: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               8: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""300gb""
                            max_size_bytes: <322122547200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               9: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""7d""
                            max_age_millis: <604800000>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <604800000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              10: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <31536000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              11: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""7d""
                            max_age_millis: <604800000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <604800000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              12: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""10gb""
              max_primary_shard_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              13: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""14d""
                            max_age_millis: <1209600000>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <2073600000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              14: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <15552000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              15: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              16: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              17: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <15552000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              18: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                              frozen: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""searchable_snapshot""
                        configurations: an empty map
                                cold: a map containing
                               min_age: <5184000000L>
                               actions: a list containing
                                       0: ""searchable_snapshot""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <63504000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                  monitoring: a map containing
            collection_enabled: <false>
                     available: <true>
             enabled_exporters: a map containing
                           local: <1>
                       enabled: <true>
                       graph: a map containing
                     available: <true>
                       enabled: <true>
            aggregate_metric: a map containing
                     available: <true>
                       enabled: <true>
                  data_tiers: a map containing
                     data_warm: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                   data_frozen: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                     data_cold: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                     available: <true>
                  data_content: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                       enabled: <true>
                      data_hot: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                         slm: a map containing
                     available: <true>
                       enabled: <true>
                  policy_count: <0>
                  policy_stats: a map containing
                  retention_runs: <1>
                retention_failed: <0>
             retention_timed_out: <0>
         retention_deletion_time: ""0s""
  retention_deletion_time_millis: <0>
           total_snapshots_taken: <0>
          total_snapshots_failed: <0>
         total_snapshots_deleted: <0>
total_snapshot_deletion_failures: <0>
                    policy_stats: an empty list
                 voting_only: a map containing
                     available: <true>
                       enabled: <true>
                data_streams: a map containing
                 indices_count: <0>
                     available: <true>
                  data_streams: <0>
                       enabled: <true>
              data_lifecycle: a map containing
                     available: <true>
                         count: <0>
         default_rollover_used: <true>
                       enabled: <true>
                     retention: a map containing
                  minimum_millis: <0>
                  average_millis: <0.0>
                  maximum_millis: <0>
             remote_clusters: a map containing
                          mode: a map containing
                           proxy: <0>
                           sniff: <0>
                      security: a map containing
                         api_key: <0>
                            cert: <0>
                          size: <0>

  at __randomizedtesting.SeedInfo.seed([BDA102BBC82984E1:35F53D6166D5E919]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:582)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:534)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

  Caused by: java.lang.AssertionError: Expected a map containing
                           eql: a map containing
                       available: <true>
                         enabled: <true>
                        features: a map containing
                             joins: a map containing
                  join_queries_three: <0>
                    join_queries_two...
```",jrodewig,closed,"['>docs', '>test-failure', 'Team:Docs']",https://github.com/elastic/elasticsearch/issues/99496,2023-09-12T19:33:34Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99496,"{
  ""application_resource"": ""unsure""
}"
239,99460,ESQL: Major Issues for 8.11,"### Description

A meta ticket tracking the main issues we want to solve for the 8.11:

- [x] Accurate memory tracking https://github.com/elastic/elasticsearch/issues/99173
- [x] add warning header for default limit - https://github.com/elastic/elasticsearch/issues/100555
- [x] Prevent unsupported data extraction from blowing up https://github.com/elastic/elasticsearch/issues/99506
	- [x] fall back to field loading to keyword, if subfield exists https://github.com/elastic/elasticsearch/issues/99183
- [x] default limit in Kibana https://github.com/elastic/elasticsearch/issues/99458
- [x] count(*) / count() + push down filtered count https://github.com/elastic/elasticsearch/issues/99459
- [x] request timeout - https://github.com/elastic/elasticsearch/pull/99526

Bugs:
- [x] EsqlSpecIT test {ints.MultipleWarnings} failing https://github.com/elastic/elasticsearch/issues/98719
- [x] mv_expand after sort fails https://github.com/elastic/elasticsearch/issues/99971
- [x] RestEsqlIT testTextMode #100257
- [x] drop date_xxx() warning when arguments are in reverse order https://github.com/elastic/elasticsearch/issues/99562
- [x] Improve parsing of query parameters  https://github.com/elastic/elasticsearch/issues/99570
- [x] null layout on ECS schema with WHERE + STATS https://github.com/elastic/elasticsearch/issues/100807
- [x] missing field in filter https://github.com/elastic/elasticsearch/issues/100869
- [x] Relax ValueSources check in OrdinalsGroupingOperator https://github.com/elastic/elasticsearch/pull/100566
- [x] Improve verifier for incorrect agg declaration https://github.com/elastic/elasticsearch/pull/100650
- [x] Aggregation don't preserve projection #99936
- [x] Grouping on ordinals ignore null group #100109 
- [x] Unhandled error when using multi-value as function argument  https://github.com/elastic/elasticsearch/issues/100497
- [x] org.elasticsearch.xpack.esql.qa.single_node.EsqlSpecIT failing https://github.com/elastic/elasticsearch/issues/100081
- [x] When double limiting the limit after mv_expand is not applied anymore https://github.com/elastic/elasticsearch/issues/100774
### Nice to have:

### Postponed:
- [ ] fallback to source extraction for fields that have field data disabled https://github.com/elastic/elasticsearch/issues/99213
- [ ] expose source as a metadata field https://github.com/elastic/elasticsearch/issues/99456
- [ ] default project for Kibana queries https://github.com/elastic/elasticsearch/issues/99457
- [ ] ES|QL does not consistently handle field names starting with a number https://github.com/elastic/elasticsearch/issues/100312
- [ ] emit warnings from all functions returning nulls on multivalues https://github.com/elastic/elasticsearch/issues/98743
- [ ] Incorrect error messages - https://github.com/elastic/elasticsearch/issues/100047
- [ ] https://github.com/elastic/elasticsearch/issues/99672
- [ ]  syntax error on date math if date period variable is at the end of the expression https://github.com/elastic/elasticsearch/issues/99293
- [ ] ESQL: date_extract using a constant/literal chrono_field fails to record the warning  https://github.com/elastic/elasticsearch/issues/100038
- [ ] ESQL: Comparing a large long to an int field fails when pushed to source https://github.com/elastic/elasticsearch/issues/99960
- [ ] fallback to source extraction for fields that have field data disabled https://github.com/elastic/elasticsearch/issues/99213
",costin,closed,"['>enhancement', 'Meta', 'Team:QL (Deprecated)', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/99460,2023-09-12T05:19:12Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99460,"{
  ""application_resource"": ""yes""
}"
240,99409,[Ml] CircuitBreakingException when deploying the ELSER model,"### Elasticsearch Version

8.9.1

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

any

### Problem Description

Deploying the ELSER model can cause a `CircuitBreakingException` if the cluster is being used heavily. Often the `CircuitBreakingException` is thrown because a request from Kibana or another client cannot be serviced with the available memory while loading the ELSER model which temporarily increases memory pressure in the JVM. In this scenario Kibana becomes unresponsive but in many cases the ELSER model deployment completes successfully but the UI takes a while to see that status change. 

```
Caused by: org.elasticsearch.common.breaker.CircuitBreakingException: [parent] Data too large, data for [indices:data/read/search[phase/query]] would be [1045092822/996.6mb], which is larger than the limit of [1020054732/972.7mb], real usage: [1045091992/996.6mb], new bytes reserved: [830/830b], usages [eql_sequence=0/0b, fielddata=1779/1.7kb, request=0/0b, inflight_requests=830/830b, model_inference=0/0b] at org.elasticsearch.indices.breaker.HierarchyCircuitBreakerService.checkParentLimit(HierarchyCircuitBreakerService.java:414)
```

### Steps to Reproduce

The problem occurs more commonly on smaller nodes with less JVM heap memory (e.g. 2GB JVM heap). Reproduce by repeatedly deploying and un-deploying the ELSER model. 

### Logs (if relevant)

_No response_",davidkyle,closed,"['>bug', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/99409,2023-09-11T09:14:13Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99409,"{
  ""application_resource"": ""yes""
}"
241,99349,[ML] Modify the Java temp directory every day on every node,"A significant number of production support cases we get arise because of the Linux functionality to delete subdirectories under `/tmp` that haven't been modified in 10 days. Elasticsearch creates a secure temporary directory on startup 

This causes a problem for ML, because ML is the only part of Elasticsearch that tends to want to access the temporary directory more than a few minutes after node startup. If no ML processes run on a node for 10 days and then after that the user tries to start one then startup fails because it needs the temporary directory that the OS has cleaned up due to inactivity.

To prevent this happening, the ML plugin should do something to modify the temporary directory every day.

One simple way to do this that would minimise clutter would be to create a file in the temporary directory called `keepalive.ml` if it doesn't exist, and delete it if it does exist.

This should run on a 24 hour timer on every node with the ML plugin enabled. Even if the node is not an ML node it might need to run the DFA memory estimation program.",droberts195,closed,"['>enhancement', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/99349,2023-09-08T09:11:14Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99349,"{
  ""application_resource"": ""yes""
}"
242,99292,[Transform] Force stopping a transform does not always remove the persistent task,"We've seen at least two cases now where force stopping a transform doesn't remove the persistent task.

This is unacceptable - it means that in the event of certain other errors occurring in a cluster it's possible to end up with transforms that are blocking other operations yet cannot be stopped. Because the persistent task lives in cluster state, even the workaround of restarting the node where the local transform task was running does not solve the problem, as the zombie transform reappears on a different node.

The way force stop is implemented in anomaly detection is that the force stop removes the persistent task, then anything else is a reaction to the persistent task being removed. For transforms force stop performs other steps before removing the persistent task. This is why there's a risk of the persistent task not being removed if one of these other steps hangs or fails.

We should reimplement force stop for transforms so that removing the persistent task is step 1 and everything else is a reaction to that. Force stop does not need to provide any guarantees about data consistency. It is for emergency situations where nothing else works, and the most important thing in these situations is that it removes the persistent task.",droberts195,closed,"['>bug', ':ml/Transform', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/99292,2023-09-07T10:16:32Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99292,"{
  ""application_resource"": ""yes""
}"
243,99230,Provide clarifications on voting configuration changes timeouts,"### Description

There are a lot of docs about automatic cluster changes, but they all go by this:

> After a node has joined or left the cluster the elected master must issue a cluster-state update that adjusts the voting configuration to match, and this can take a short time to complete. **It is important to wait for this adjustment to complete** before removing more nodes from the cluster.

Docs provide basically no clarification on how the end user should understand when it is safe to proceed. It also can't be assumed that it is enough just to wait for some kind of timeout, for example, as in the naive scenario end user removes a node and expects it to be pulled out of the configuration automatically - but if there is any trouble with the master election exactly at that moment, or just a tight GC loop on masters because of the memory configuration, or another kind of disaster, then the actual removal of the node from cluster will be delayed to the moment cluster has reformed again (and pulling out a node is not necessarily a thing happening in a healthy environment, it may be a part of disaster recovery - if you need a precise example, imagine that ES was deployed on VMs that became unhealthy by themselves, and the end user needs to recycle all the masters one by one to spin up fresh unaffected VMs). I assume that it's possible to watch the cluster configuration, but that requires some toolset to do it in the automated way and some insight to do it manually, and both ways are also opaque from just looking at the corresponding documentation.

So this is a request for more thorough explanation of the processes under the hood and clarification on how user can detect that the automatic cluster state change has kicked in and safely proceed.",etki,closed,"['>enhancement', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/99230,2023-09-06T10:30:55Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99230,"{
  ""application_resource"": ""yes""
}"
244,99173,ESQL: Add memory accountancy and circuit breaking,"Currently the ESQL runtime does not use circuit breakers, so is susceptible to OutOfMemoryErrors when working with large amounts of data or performing memory intensive operations . Similar to other parts of Elasticsearch, ESQL should circuit break its allocations and track overall memory usage.

The ESQL runtime on data nodes has a bounded queue in their exchange sink. This queue adds a natural bound to the amount of outstanding pages (and transitively bocks and vectors) that are in use at any one time, but is not sufficient when dealing with data with large numbers of columns or bytes refs that are enormous in size.  Additionally, the coordinator may need to hold a lot of data in memory when processing output from the data nodes and/or computing the overall result. 

ESQL driver pipelines are executed in a single threaded manner. The general idea is have a circuit breaker per driver, whereby this breaker would ""checkout"" chunks of memory from it's parent breaker. These chunks would be allotted to the code executing in the driver - a thread local allocation if you will. The driver breaker subsequently request more memory from its parent when this TLA is exhausted. The ESQL runtime will have an overall breaker for all of its allocations on any one particular node, which includes the tasks that it performs as both a data node as well as a coordinator.

A non-exhaustive list of specific tasks:

- [x] Add memory accountancy for blocks and vectors
- [ ] Create overall ESQL breaker
- [x] Driver specific breaker (https://github.com/elastic/elasticsearch/pull/102901)
- [x] https://github.com/elastic/elasticsearch/issues/99826
- [x] Move block and vector creation to a factory instance, allowing to circuit break on creation
- [x] Releasable blocks/vectors - allowing to adjust the circuit breaker
- [x] https://github.com/elastic/elasticsearch/issues/100147",ChrisHegarty,closed,"['Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/99173,2023-09-04T13:46:28Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99173,"{
  ""application_resource"": ""yes""
}"
245,99154,[CI] `CsvTests` hit suite timeout (and Gradle runner hit OOME),"This build failed: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+main+intake+multijob+part2/6729/consoleText

```
REPRODUCE WITH: ./gradlew ':x-pack:plugin:esql:test' --tests ""org.elasticsearch.xpack.esql.CsvTests"" -Dtests.method=""test {string.In3VLWithComputedNull}"" -Dtests.seed=81DA78149F2DAC1A -Dtests.locale=es-ES -Dtests.timezone=Africa/Djibouti -Druntime.java=20

org.elasticsearch.xpack.esql.CsvTests > test {string.In3VLWithComputedNull} FAILED
    java.lang.Exception: Test abandoned because suite timeout was reached.
        at __randomizedtesting.SeedInfo.seed([81DA78149F2DAC1A]:0)

> Task :x-pack:plugin:snapshot-repo-test-kit:qa:minio:javaRestTest
Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF8 -Dsun.jnu.encoding=UTF8

> Task :x-pack:plugin:searchable-snapshots:qa:rest:yamlRestTest

Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread ""pool-1-thread-1""
```

The OOME suggests that the quantity of logs was overwhelming.",DaveCTurner,closed,"['>test-failure', 'Team:QL (Deprecated)', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/99154,2023-09-04T08:17:14Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99154,"{
  ""application_resource"": ""unsure""
}"
246,99139,ES 7.17 Exponentially growing query cache,"### Elasticsearch Version

7.17,8.8.0

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

centos7

### Problem Description

We recently migrated our Elastic cluster from version 7.7.1 to 7.17.0, and have been noticing that the query cache keeps growing exponentially if indexing is running on the nodes simultaneously with reasonably high search load. This leads to high latency on the search queries. We have the same heap, cache, and cluster settings on both the old and the new versions but this was not an issue on the old version.


Full description of the problem on ElasticSearch discussion forum https://discuss.elastic.co/t/es-7-17-exponentially-growing-query-cache/298784/1

### Steps to Reproduce

https://discuss.elastic.co/t/es-7-17-exponentially-growing-query-cache/298784/1

### Logs (if relevant)

_No response_",oleg-smith,closed,"['>bug', ':Search/Search', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/99139,2023-09-01T22:22:20Z,11,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/99139,"{
  ""application_resource"": ""yes""
}"
247,98963,ESQL count_distinct memory issues,"ESQL's count_distinct grouping stats seems to have some memory issues. I tested this with the StackOverflow rally track and consistently encountered a circuit breaker error. The error persists for some time before I can issue other queries.

```
from so | stats questions = count_distinct(questionId) by tags | sort questions desc | limit 10
```

I haven't dug into the issue yet, but I am opening this GitHub issue to so that we can investigate.",dnhatn,closed,"['>bug', 'Team:Analytics', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/98963,2023-08-29T04:11:36Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/98963,"{
  ""application_resource"": ""yes""
}"
248,98893,ESQL hits rejection with many shards,"I played ESQL with many shards benchmark (50K shards) and found that ESQL encounters rejection issues when executing against more than 1000 shards. This is because we [generate](https://github.com/elastic/elasticsearch/blob/65af5b2199b404623f22a529ac21c732d80dd9de/x-pack/plugin/esql/src/main/java/org/elasticsearch/xpack/esql/planner/EsPhysicalOperationProviders.java#L145) a high number of Lucene operators based on the target shards without proper limitations.. Besides addressing the rejection issue, we should also limit the number of concurrent pipelines to reduce memory usage and intermediate states.

```java
{""error"":{""root_cause"":[{""type"":""es_rejected_execution_exception"",""reason"":""rejected execution of TimedRunnable{original=org.elasticsearch.compute.operator.Driver$1@6b8fbaa8, creationTimeNanos=33588117603137, startTimeNanos=0, finishTimeNanos=-1, failedOrRejected=false} on 
TaskExecutionTimeTrackingEsThreadPoolExecutor[name = elasticsearch-0/esql_worker, queue capacity = 1000, task execution EWMA = 34.8ms, total task execution time = 5s, org.elasticsearch.common.util.concurrent.TaskExecutionTimeTrackingEsThreadPoolExecutor@16a14076[Running, pool size = 25, active threads = 25, queued tasks = 2981, completed tasks = 1065]]"",""stack_trace"":""org.elasticsearch.ElasticsearchException$1: rejected execution of TimedRunnable{original=org.elasticsearch.compute.operator.Driver$1@6b8fbaa8, creationTimeNanos=33588117603137, startTimeNanos=0, finishTimeNanos=-1, failedOrRejected=false} on 
TaskExecutionTimeTrackingEsThreadPoolExecutor[name = elasticsearch-0/esql_worker, queue capacity = 1000, task execution EWMA = 34.8ms, total task execution time = 5s, org.elasticsearch.common.util.concurrent.TaskExecutionTimeTrackingEsThreadPoolExecutor@16a14076[Running, pool size = 25, active threads = 25, queued tasks = 2981, completed tasks = 1065]]
```",dnhatn,closed,"['>bug', 'Team:QL (Deprecated)', ':Analytics/ES|QL']",https://github.com/elastic/elasticsearch/issues/98893,2023-08-25T17:10:39Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/98893,"{
  ""application_resource"": ""yes""
}"
249,98649,error registering kibana privileges with elasticsearch for kibana-.kibana - POST /_security/privilege hangs,"### Elasticsearch Version

8.9.0

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux b3865cfa1be4 5.15.49-linuxkit-pr #1 SMP Thu May 25 07:17:40 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux

### Problem Description

initial problem:
following the instruction to run elastic+kibana in docker
https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#_prepare_the_environment

however after startup kibana reports a lot of errors like:
`error registering kibana privileges with elasticsearch for kibana-.kibana: request timed out`

after debugging i minimized the steps to reproduce to following



### Steps to Reproduce

create file `docker-compose.yaml`:
```
version: '3'
name: elastic

services:
  elasticsearch:
    container_name: elasticsearch
    image: docker.elastic.co/elasticsearch/elasticsearch:8.9.0
    volumes:
      - ./data_elasticsearch:/usr/share/elasticsearch/data
    ports:
      - 9200:9200
    environment:
      - cluster.routing.allocation.disk.threshold_enabled=false
      - node.name=elasticsearch
      - cluster.name=docker-cluster
      - discovery.type=single-node
      - xpack.security.enabled=true
      - ELASTIC_PASSWORD=elastic
```

create the folder `data_elasticsearch` with just one file [body-502.json.gz](https://github.com/elastic/elasticsearch/files/12389411/body-502.json.gz)  (extract it)

it's a real content kibana sends to elastic

now after starting elasticsearch try to call following command from elascticsearch container/terminal:
```
curl -v -X POST -u elastic:elastic http://localhost:9200/_security/privilege -H ""Expect:"" -H ""Content-Type: application/json"" --data @$HOME/data/body-502.json
```

as a result curl just hangs

![image](https://github.com/elastic/elasticsearch/assets/7533327/923718f1-58ff-4d84-8d93-c919e87e8895)

I believe it's a source of the issue `error registering kibana privileges with elasticsearch for kibana-.kibana`


### Logs (if relevant)

_No response_",dlukyanov,closed,"['>bug', ':Security/Security', 'Team:Security']",https://github.com/elastic/elasticsearch/issues/98649,2023-08-20T23:41:46Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/98649,"{
  ""application_resource"": ""unsure""
}"
250,98580,[CI] DocsClientYamlTestSuiteIT test {yaml=reference/indices/shard-stores/line_150} failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/pobq7lo4czwjm/tests/:docs:yamlRestTest/org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT/test%20%7Byaml=reference%2Findices%2Fshard-stores%2Fline_150%7D

**Reproduction line:**
```
./gradlew ':docs:yamlRestTest' --tests ""org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT.test {yaml=reference/indices/shard-stores/line_150}"" -Dtests.seed=2C094F05992FEEB2 -Dtests.locale=ar-OM -Dtests.timezone=Eire -Druntime.java=20
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT&tests.test=test%20%7Byaml%3Dreference/indices/shard-stores/line_150%7D

**Failure excerpt:**
```
java.lang.AssertionError: Failure at [reference/indices/shard-stores:145]: Expected a map containing
       indices: a map containing
 my-index-000001: a map containing
            shards: a map containing
                   0: a map containing
                stores: a list containing
                       0: a map containing
    KLjGCcqWTjmHruAOkl3VUg: a map containing
           transport_address: ""127.0.0.1:38081""
                       roles: a list containing
                             0: ""data""
                             1: ""data_cold""
                             2: ""data_content""
                             3: ""data_frozen""
                             4: ""data_hot""
                             5: ""data_warm""
                             6: ""ingest""
                             7: ""master""
                             8: ""ml""
                             9: ""remote_cluster_client""
                            10: ""transform""
                        name: ""node-0""
           min_index_version: <7000099>
                 external_id: ""node-0""
                  attributes: a map containing
ml.allocated_processors_double: ""32.0""
                      testattr: ""test""
      transform.config_version: ""10.0.0""
               xpack.installed: ""true""
       ml.allocated_processors: ""32""
               ml.max_jvm_size: ""536870912""
             ml.config_version: ""10.0.0""
             ml.machine_memory: ""101259079680""
           max_index_version: expected <8100099> but was <8110099>
                ephemeral_id: ""xz_18EB5Tc-30qqn5lvsAQ""
                     version: ""8.11.0""
                allocation: ""primary""
             allocation_id: ""6vLq-yF0ScK8H6OU7bL3Eg""

  at __randomizedtesting.SeedInfo.seed([2C094F05992FEEB2:A45D70DF37D3834A]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:571)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:523)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

  Caused by: java.lang.AssertionError: Expected a map containing
         indices: a map containing
   my-index-000001: a map containing
              shards: a map containing
                     0: a map containing
                  stores: a list containing
                         0: a map containing
      KLjGCcqWTjmHruAOkl3VUg: a map containing
             transport_address: ""127.0.0.1:38081""
                         roles: a list containing
                               0: ""data""
                               1: ""data_cold""
                               2: ""data_content""
                               3: ""data_frozen""
                               4: ""data_hot""
                               5: ""data_warm""
                               6: ""ingest""
                               7: ""master""
                               8: ""ml""
                               9: ""remote_cluster_client""
                              10: ""transform""
                          name: ""node-0""
             min_index_version: <7000099>
                   external_id: ""node-0""
                    attributes: a map containing
  ml.allocated_processors_double: ""32.0""
                        testattr: ""test""
        transform.config_version: ""10.0.0""
                 xpack.installed: ""true""
         ml.allocated_processors: ""32""
                 ml.max_jvm_size: ""536870912""
               ml.config_version: ""10.0.0""
               ml.machine_memory: ""101259079680""
             max_index_version: expected <8100099> but was <8110099>
                  ephemeral_id: ""xz_18EB5Tc-30qqn5lvsAQ""
                       version: ""8.11.0""
                  allocation: ""primary""
               allocation_id: ""6vLq-yF0ScK8H6OU7bL3Eg""

    at org.elasticsearch.test.MapMatcher.assertMap(MapMatcher.java:82)
    at org.elasticsearch.test.MapMatcher.assertMap(MapMatcher.java:65)
    at org.elasticsearch.test.rest.yaml.section.MatchAssertion.doAssert(MatchAssertion.java:94)
    at org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:65)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:551)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:523)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
    at java.lang.reflect.Method.invoke(Method.java:578)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1623)

```",thecoop,closed,"[':Core/Infra/Core', '>test-failure', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/98580,2023-08-17T09:29:42Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/98580,"{
  ""application_resource"": ""unsure""
}"
251,98389,RestChunkedXContentListener always responds with a 200 Status.OK,"### Elasticsearch Version

8.9

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

n/a

### Problem Description

#94736 reworked search responses to use chunked responses, reducing the probability that a very large response might cause out-of-memory problems on co-ordinating nodes.  However, the REST layer code that handles these chunked responses always returns a status code of 200, and searches can return other codes here if some or all shards are missing.  We should add a status-handling version of this code, similar to RestStatusToXContentListener.

I uncovered this while working on converting AsyncSearchResponse to use chunked responses, which tripped an explicit test that checks for the status code returned over the REST layer.  It seems we don't have similar tests for plain searches.

### Steps to Reproduce

n/a

### Logs (if relevant)

_No response_",romseygeek,closed,"['>bug', ':Core/Infra/REST API', 'Team:Core/Infra', 'v8.9.0', 'Team:Search Foundations', ':Search Foundations/Search']",https://github.com/elastic/elasticsearch/issues/98389,2023-08-11T11:09:59Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/98389,"{
  ""application_resource"": ""no""
}"
252,98201,Snapshot/restore repository-s3 â€“> Using IAM roles for Kubernetes service accounts for authentication is not working,"### Elasticsearch Version

Version 8.9.0

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

debian-sid-slim:v23.29.0

### Problem Description


Hi,

Currently we are following the guide here[1]. We can successfully assign proper service account(hence AWS iam role) to the es pods. If relevant here[2] you can see our redacted elasticsearch CRD file.

This correctly results in assigning the proper role to the es nodes(I can test if the role works simply by logging in to pod console & test some s3 copy operations.)

Next I refer to [1] to create the symlinks in the folder - here is a catch, ""ES_PATH_CONF"" is not set, hence we set it to "" /usr/share/elasticsearch/config"" & create a link to the AWS TOKEN as written in same documentation.

But still when we try to verify the repository connection status we get the error [3]

Any idea or guidance is appreciated, we are stuck.

Thanks!
Ahmet

### Steps to Reproduce

1. [S3 repository | Elasticsearch Guide [8.5] | Elastic](https://www.elastic.co/guide/en/elasticsearch/reference/8.5/repository-s3.html#iam-kubernetes-service-accounts)
2.
```python
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name:  <REDACTED>
spec:
  version: <REDACTED>
  image: <REDACTED>
  auth:
    fileRealm:
      - secretName: <REDACTED>
      - secretName: <REDACTED>
  nodeSets:
  - name: default
    count: 2
    podTemplate:
      spec:
        serviceAccount: <SA Name that binds to proper AWS Role>
        serviceAccountName: <SA Name that binds to proper AWS Role>
        imagePullSecrets:
          - name: <REDACTED>
        containers:
          - name: elasticsearch
            resources: <REDACTED>
    volumeClaimTemplates:
      - metadata:
          name: elasticsearch-data # Do not change this name unless you set up a volume mount for the data path.
        spec:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: <REDACTED>
    config:
      node.store.allow_mmap: <REDACTED>
``` 
3.
```python
{
  ""name"": ""ResponseError"",
  ""meta"": {
    ""body"": {
      ""error"": {
        ""root_cause"": [
          {
            ""type"": ""repository_verification_exception"",
            ""reason"": ""[repository-s3] path [<REDACTED>] is not accessible on master node""
          }
        ],
        ""type"": ""repository_verification_exception"",
        ""reason"": ""[repository-s3] path [<REDACTED>] is not accessible on master node"",
        ""caused_by"": {
          ""type"": ""i_o_exception"",
          ""reason"": ""Unable to upload object [<REDACTED>/tests-hQo9BhOSQ5S1VGbd2mCXoA/master.dat] using a single upload"",
          ""caused_by"": {
            ""type"": ""amazon_s3_exception"",
            ""reason"": ""amazon_s3_exception: Access Denied (Service: Amazon S3; Status Code: 403; Error Code: AccessDenied; Request ID: <REDACTED>; S3 Extended Request ID: <REDACTED>; Proxy: null)""
          }
        }
      },
      ""status"": 500
    },
    ""statusCode"": 500,
    ""headers"": {
      ""x-opaque-id"": ""<REDACTED>;kibana:application:management:"",
      ""x-elastic-product"": ""Elasticsearch"",
      ""content-type"": ""application/json"",
      ""content-length"": ""732""
    },
    ""meta"": {
      ""context"": null,
      ""request"": {
        ""params"": {
          ""method"": ""POST"",
          ""path"": ""/_snapshot/repository-s3/_verify"",
          ""querystring"": """",
          ""headers"": {
            ""user-agent"": ""Kibana/8.9.0"",
            ""x-elastic-product-origin"": ""kibana"",
            ""authorization"": ""Basic <REDACTED>"",
            ""x-opaque-id"": ""<REDACTED>;kibana:application:management:"",
            ""x-elastic-client-meta"": ""es=8.8.0p,js=16.20.1,t=8.3.1,hc=16.20.1"",
            ""accept"": ""application/vnd.elasticsearch+json; compatible-with=8,text/plain""
          }
        },
        ""options"": {
          ""opaqueId"": ""<REDACTED>;kibana:application:management:"",
          ""headers"": {
            ""x-elastic-product-origin"": ""kibana"",
            ""user-agent"": ""Kibana/8.9.0"",
            ""authorization"": ""Basic <REDACTED>"",
            ""x-opaque-id"": ""<REDACTED>"",
            ""x-elastic-client-meta"": ""es=8.8.0p,js=16.20.1,t=8.3.1,hc=16.20.1""
          }
        },
        ""id"": 1
      },
      ""name"": ""elasticsearch-js"",
      ""connection"": {
        ""url"": ""<REDACTED>"",
        ""id"": ""<REDACTED>"",
        ""headers"": {},
        ""status"": ""alive""
      },
      ""attempts"": 0,
      ""aborted"": false
    },
    ""warnings"": null
  }
}
``` 

### Logs (if relevant)

_No response_",ahmetdd,closed,"['>bug', ':Distributed Coordination/Snapshot/Restore', 'Team:Distributed (Obsolete)']",https://github.com/elastic/elasticsearch/issues/98201,2023-08-04T11:30:41Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/98201,"{
  ""application_resource"": ""yes""
}"
253,98107,Track total fields overhead,"### Elasticsearch Version

8.8

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

All OSs

### Problem Description

When a node contains a huge number of fields `_nodes/stats` mappings section reports incorrect `total_estimated_overhead`, where reported value could be 100X time smaller than the real value occupied by `FieldInfo`.

### Steps to Reproduce

Create an index with many fields.

### Logs (if relevant)

_No response_",mayya-sharipova,closed,"['>enhancement', 'Team:StorageEngine', ':StorageEngine/Mapping']",https://github.com/elastic/elasticsearch/issues/98107,2023-08-01T14:49:54Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/98107,"{
  ""application_resource"": ""yes""
}"
254,97829,too many NodeStats cause memory leak,"### Elasticsearch Version

5.2.2

### Installed Plugins

_No response_

### Java Version

1.8

### OS Version

redhat7.0

### Problem Description

ES cluster has running about 1 month, and it will be oom,the jvm sizeï¼š31G. the NodeStats instances occupied about 60% JVM memory.
the jvm dump file in MAT show as below :
![111](https://github.com/elastic/elasticsearch/assets/5284670/b0c411e7-3ea6-4941-bd00-aafd7a255c9d)
![222](https://github.com/elastic/elasticsearch/assets/5284670/ac5e8b4d-cfc8-4000-9458-7d2b818197e7)
![333](https://github.com/elastic/elasticsearch/assets/5284670/4dbd835d-da41-4d6f-9c3f-c2e291d7b7e6)


### Steps to Reproduce

show as the problem desc.

### Logs (if relevant)

_No response_",xufenxu,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/97829,2023-07-20T05:58:56Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/97829,"{
  ""application_resource"": ""yes""
}"
255,97493,[CI] PyTorchModelIT testUpdateDeployment_GivenAllocationsAreIncreasedOverResources_AndScalingIsPossible failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/ycnpamf74xt4q/tests/:x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest/org.elasticsearch.xpack.ml.integration.PyTorchModelIT/testUpdateDeployment_GivenAllocationsAreIncreasedOverResources_AndScalingIsPossible

**Reproduction line:**
```
./gradlew ':x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest' --tests ""org.elasticsearch.xpack.ml.integration.PyTorchModelIT.testUpdateDeployment_GivenAllocationsAreIncreasedOverResources_AndScalingIsPossible"" -Dtests.seed=9ABB57AF13651E74 -Dtests.locale=vi -Dtests.timezone=Asia/Omsk -Druntime.java=20
```

**Applicable branches:**
8.9

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.xpack.ml.integration.PyTorchModelIT&tests.test=testUpdateDeployment_GivenAllocationsAreIncreasedOverResources_AndScalingIsPossible

**Failure excerpt:**
```
java.lang.AssertionError: 10 active tasks found:
cluster:admin/xpack/ml/trained_models/deployment/update f_r7TSMFTZORrEA-7ccBdQ:64315 -                            transport  1688913875419 14:44:35 1.5m        127.0.0.1 javaRestTest-2 
cluster:admin/xpack/ml/trained_models/deployment/update 3ojfdy-kQFWOf8dBiFkv7A:97871 f_r7TSMFTZORrEA-7ccBdQ:64315 transport  1688913875420 14:44:35 1.5m        127.0.0.1 javaRestTest-0 
publish_cluster_state_update                            3ojfdy-kQFWOf8dBiFkv7A:97873 -                            master     1688913875428 14:44:35 1.5m        127.0.0.1 javaRestTest-0 publication of cluster state [13078]
internal:cluster/coordination/join                      3ojfdy-kQFWOf8dBiFkv7A:97876 -                            direct     1688913875458 14:44:35 1.5m        127.0.0.1 javaRestTest-0 
internal:cluster/coordination/join                      3ojfdy-kQFWOf8dBiFkv7A:97879 -                            transport  1688913875467 14:44:35 1.5m        127.0.0.1 javaRestTest-0 
internal:cluster/coordination/join                      3ojfdy-kQFWOf8dBiFkv7A:97880 -                            transport  1688913875467 14:44:35 1.5m        127.0.0.1 javaRestTest-0 
internal:cluster/coordination/join                      3ojfdy-kQFWOf8dBiFkv7A:97886 -                            transport  1688913875473 14:44:35 1.5m        127.0.0.1 javaRestTest-0 
internal:cluster/coordination/join                      3ojfdy-kQFWOf8dBiFkv7A:97890 -                            transport  1688913875475 14:44:35 1.5m        127.0.0.1 javaRestTest-0 
internal:cluster/coordination/join                      3ojfdy-kQFWOf8dBiFkv7A:97912 -                            direct     1688913875627 14:44:35 1.5m        127.0.0.1 javaRestTest-0 
internal:cluster/coordination/join                      3ojfdy-kQFWOf8dBiFkv7A:97917 -                            transport  1688913875642 14:44:35 1.5m        127.0.0.1 javaRestTest-0 
 expected:<0> but was:<10>

  at __randomizedtesting.SeedInfo.seed([9ABB57AF13651E74:C1359384C7366D83]:0)
  at org.junit.Assert.fail(Assert.java:88)
  at org.junit.Assert.failNotEquals(Assert.java:834)
  at org.junit.Assert.assertEquals(Assert.java:645)
  at org.elasticsearch.test.rest.ESRestTestCase.lambda$waitForPendingTasks$2(ESRestTestCase.java:490)
  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:1172)
  at org.elasticsearch.test.rest.ESRestTestCase.waitForPendingTasks(ESRestTestCase.java:461)
  at org.elasticsearch.test.rest.ESRestTestCase.waitForPendingTasks(ESRestTestCase.java:447)
  at org.elasticsearch.xpack.ml.integration.PyTorchModelRestTestCase.cleanup(PyTorchModelRestTestCase.java:86)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:1004)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

```",droberts195,closed,"['>test-failure', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/97493,2023-07-10T10:10:41Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/97493,"{
  ""application_resource"": ""yes""
}"
256,97245,[CI] TextExpansionQueryIT testSearchWithMissingModel failing,"Many tests failed with the same error, but the first one was `testSearchWithMissingModel`, so presumably if any single test is responsible for causing these recovery tasks to linger it's that one. That test hasn't been modified since March.

**Build scan:**
https://gradle-enterprise.elastic.co/s/6dhljzr55ppxs/tests/:x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest/org.elasticsearch.xpack.ml.integration.TextExpansionQueryIT/testSearchWithMissingModel

**Reproduction line:**
```
./gradlew ':x-pack:plugin:ml:qa:native-multi-node-tests:javaRestTest' --tests ""org.elasticsearch.xpack.ml.integration.TextExpansionQueryIT.testSearchWithMissingModel"" -Dtests.seed=4C373A6E503FD58D -Dtests.locale=sr-ME -Dtests.timezone=BET -Druntime.java=20
```

**Applicable branches:**
8.9

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.xpack.ml.integration.TextExpansionQueryIT&tests.test=testSearchWithMissingModel

**Failure excerpt:**
```
java.lang.AssertionError: 3 active tasks found:
internal:index/shard/recovery/start_recovery At-hs4rwTxeh3N8lcb21Eg:59240  -                            transport  1688005283461 02:21:23 3.8m        127.0.0.1 javaRestTest-0 recovery of [test-model-memory-limit][5] to {javaRestTest-2}{elR80oPZSbiOWi4v0-rtPw}{6k_gGKEVR_mRpXb9xX4bVA}{javaRestTest-2}{127.0.0.1}{127.0.0.1:35557}{dilm}{8.9.0} [recoveryId=624, targetAllocationId=jZ9eregIRN-R3ESrviNgNA, startingSeqNo=-2, primaryRelocation=false, canDownloadSnapshotFiles=true]
internal:index/shard/recovery/start_recovery elR80oPZSbiOWi4v0-rtPw:71769  -                            transport  1688005283462 02:21:23 3.8m        127.0.0.1 javaRestTest-2 recovery of [test-model-memory-limit][3] to {javaRestTest-0}{At-hs4rwTxeh3N8lcb21Eg}{eNMb9dmhQfiuj_p4EDdq2w}{javaRestTest-0}{127.0.0.1}{127.0.0.1:32915}{dim}{8.9.0} [recoveryId=558, targetAllocationId=F0NBThr9TDO9iAT1IHU-5g, startingSeqNo=-2, primaryRelocation=false, canDownloadSnapshotFiles=true]
internal:index/shard/recovery/start_recovery elR80oPZSbiOWi4v0-rtPw:71775  -                            transport  1688005283470 02:21:23 3.8m        127.0.0.1 javaRestTest-2 recovery of [test-model-memory-limit][6] to {javaRestTest-1}{oaS5tiGqQaCBdx_sthr1_w}{zKm-bS5cSH2e_MYG_KRuSQ}{javaRestTest-1}{127.0.0.1}{127.0.0.1:33105}{dilm}{8.9.0} [recoveryId=540, targetAllocationId=87IdPEZjT32RbRZTY3Hmgw, startingSeqNo=-2, primaryRelocation=false, canDownloadSnapshotFiles=true]
 expected:<0> but was:<3>

  at __randomizedtesting.SeedInfo.seed([4C373A6E503FD58D:424290DD7772D0DE]:0)
  at org.junit.Assert.fail(Assert.java:88)
  at org.junit.Assert.failNotEquals(Assert.java:834)
  at org.junit.Assert.assertEquals(Assert.java:645)
  at org.elasticsearch.test.rest.ESRestTestCase.lambda$waitForPendingTasks$2(ESRestTestCase.java:490)
  at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:1172)
  at org.elasticsearch.test.rest.ESRestTestCase.waitForPendingTasks(ESRestTestCase.java:461)
  at org.elasticsearch.test.rest.ESRestTestCase.waitForPendingTasks(ESRestTestCase.java:447)
  at org.elasticsearch.xpack.ml.integration.PyTorchModelRestTestCase.cleanup(PyTorchModelRestTestCase.java:86)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:1004)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

```",droberts195,closed,"['>test-failure', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/97245,2023-06-29T16:27:11Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/97245,"{
  ""application_resource"": ""yes""
}"
257,97046,Report JVM stats for all memory pools,"Today we report stats on certain JVM memory pools (munging their names according to `org.elasticsearch.monitor.jvm.GcNames#getByMemoryPoolName`) but we omit stats on other pools on the grounds that they are [""not interesting""](https://github.com/elastic/elasticsearch/blob/d6b80c0b335cd1a2f75378a03b87d4d49f1885b1/server/src/main/java/org/elasticsearch/monitor/jvm/JvmStats.java#L67). In practice these not-interesting pools can be sizeable, and we should expose all their sizes in our stats.",DaveCTurner,closed,"['>bug', ':Core/Infra/Core', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/97046,2023-06-23T12:16:11Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/97046,"{
  ""application_resource"": ""yes""
}"
258,96983,geo_line does not use simplify algorithm or capped memory for time-series,"### Elasticsearch Version

8.9.0

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

all

### Problem Description

In https://github.com/elastic/elasticsearch/pull/96953 we added support for a much more memory efficient algorithm that relies on the time-ordering and grouping provided by the time-series aggregation in TSDB. However, this work only covered the data nodes, and the reduce phase in the coordinating nodes that merges geo_lines does not take this into account, leading to unexpected truncation of long geo_lines.

### Steps to Reproduce

Easiest to reproduce by setting the shard size small, loading very long geolines that will be composed of many data points over many shards, and then setting the geo_line aggregation size to a small size. The final lines will not include the two end points as they should, but be truncated.

### Logs (if relevant)

_No response_",craigtaverner,closed,"['>bug', ':Analytics/Geo', 'Team:Analytics']",https://github.com/elastic/elasticsearch/issues/96983,2023-06-21T14:11:25Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96983,"{
  ""application_resource"": ""yes""
}"
259,96784,Configuration of elastic search and kibana,"Unable to generate username and password, already set up elastic search with kibana once but unable to get username and password for the second time.
Command promt output given below:
Need help with setting up elastic search and kibana again.
`[2023-06-13T11:02:19,456][INFO ][o.e.n.Node               ] [IN-PSV110121] version[8.8.1], pid[23168], build[zip/f8edfccba429b6477927a7c1ce1bc6729521305e/2023-06-05T21:32:25.188464208Z], OS[Windows 10/10.0/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/20.0.1/20.0.1+9-29]
[2023-06-13T11:02:19,461][INFO ][o.e.n.Node               ] [IN-PSV110121] JVM home [C:\Users\mrchalla\Downloads\elasticsearch-8.8.1\jdk], using bundled JDK [true]
[2023-06-13T11:02:19,462][INFO ][o.e.n.Node               ] [IN-PSV110121] JVM arguments [-Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -Djava.security.manager=allow, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Dlog4j2.formatMsgNoLookups=true, -Djava.locale.providers=SPI,COMPAT, --add-opens=java.base/java.io=org.elasticsearch.preallocate, -XX:+UseG1GC, -Djava.io.tmpdir=C:\Users\mrchalla\AppData\Local\Temp\elasticsearch, -XX:+HeapDumpOnOutOfMemoryError, -XX:+ExitOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,level,pid,tags:filecount=32,filesize=64m, -Xms16261m, -Xmx16261m, -XX:MaxDirectMemorySize=8527020032, -XX:InitiatingHeapOccupancyPercent=30, -XX:G1ReservePercent=25, -Des.distribution.type=zip, --module-path=C:\Users\mrchalla\Downloads\elasticsearch-8.8.1\lib, --add-modules=jdk.net, --add-modules=org.elasticsearch.preallocate, -Djdk.module.main=org.elasticsearch.server]
[2023-06-13T11:02:21,736][WARN ][stderr                   ] [IN-PSV110121] SLF4J: No SLF4J providers were found.
[2023-06-13T11:02:21,736][WARN ][stderr                   ] [IN-PSV110121] SLF4J: Defaulting to no-operation (NOP) logger implementation
[2023-06-13T11:02:21,736][WARN ][stderr                   ] [IN-PSV110121] SLF4J: See https://www.slf4j.org/codes.html#noProviders for further details.
[2023-06-13T11:02:21,737][WARN ][stderr                   ] [IN-PSV110121] SLF4J: Class path contains SLF4J bindings targeting slf4j-api versions 1.7.x or earlier.
[2023-06-13T11:02:21,737][WARN ][stderr                   ] [IN-PSV110121] SLF4J: Ignoring binding found at [jar:file:///C:/Users/mrchalla/Downloads/elasticsearch-8.8.1/modules/repository-azure/log4j-slf4j-impl-2.19.0.jar!/org/slf4j/impl/StaticLoggerBinder.class]
[2023-06-13T11:02:21,738][WARN ][stderr                   ] [IN-PSV110121] SLF4J: See https://www.slf4j.org/codes.html#ignoredBindings for an explanation.
[2023-06-13T11:02:23,378][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [repository-url]
[2023-06-13T11:02:23,378][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [dlm]
[2023-06-13T11:02:23,379][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-core]
[2023-06-13T11:02:23,379][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-redact]
[2023-06-13T11:02:23,380][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [ingest-user-agent]
[2023-06-13T11:02:23,381][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-async-search]
[2023-06-13T11:02:23,381][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-monitoring]
[2023-06-13T11:02:23,382][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [repository-s3]
[2023-06-13T11:02:23,382][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-analytics]
[2023-06-13T11:02:23,383][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-ent-search]
[2023-06-13T11:02:23,383][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-autoscaling]
[2023-06-13T11:02:23,384][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [lang-painless]
[2023-06-13T11:02:23,384][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-ml]
[2023-06-13T11:02:23,384][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [lang-mustache]
[2023-06-13T11:02:23,385][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [legacy-geo]
[2023-06-13T11:02:23,385][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-ql]
[2023-06-13T11:02:23,386][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [rank-rrf]
[2023-06-13T11:02:23,386][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [analysis-common]
[2023-06-13T11:02:23,386][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [transport-netty4]
[2023-06-13T11:02:23,387][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [aggregations]
[2023-06-13T11:02:23,387][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [ingest-common]
[2023-06-13T11:02:23,387][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [frozen-indices]
[2023-06-13T11:02:23,388][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-identity-provider]
[2023-06-13T11:02:23,388][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-shutdown]
[2023-06-13T11:02:23,388][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-text-structure]
[2023-06-13T11:02:23,389][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [snapshot-repo-test-kit]
[2023-06-13T11:02:23,389][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [ml-package-loader]
[2023-06-13T11:02:23,390][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [kibana]
[2023-06-13T11:02:23,390][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [constant-keyword]
[2023-06-13T11:02:23,391][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-logstash]
[2023-06-13T11:02:23,391][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-ccr]
[2023-06-13T11:02:23,392][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-graph]
[2023-06-13T11:02:23,392][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [parent-join]
[2023-06-13T11:02:23,393][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-enrich]
[2023-06-13T11:02:23,396][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [repositories-metering-api]
[2023-06-13T11:02:23,397][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [transform]
[2023-06-13T11:02:23,397][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [repository-azure]
[2023-06-13T11:02:23,398][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [repository-gcs]
[2023-06-13T11:02:23,398][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [spatial]
[2023-06-13T11:02:23,399][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [apm]
[2023-06-13T11:02:23,399][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [mapper-extras]
[2023-06-13T11:02:23,400][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [mapper-version]
[2023-06-13T11:02:23,400][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-aggregate-metric]
[2023-06-13T11:02:23,401][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-rollup]
[2023-06-13T11:02:23,401][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [percolator]
[2023-06-13T11:02:23,401][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [data-streams]
[2023-06-13T11:02:23,402][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-stack]
[2023-06-13T11:02:23,402][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [rank-eval]
[2023-06-13T11:02:23,403][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [reindex]
[2023-06-13T11:02:23,403][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-security]
[2023-06-13T11:02:23,404][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [blob-cache]
[2023-06-13T11:02:23,404][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [searchable-snapshots]
[2023-06-13T11:02:23,405][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [snapshot-based-recoveries]
[2023-06-13T11:02:23,406][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-watcher]
[2023-06-13T11:02:23,406][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [old-lucene-versions]
[2023-06-13T11:02:23,407][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-ilm]
[2023-06-13T11:02:23,407][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-voting-only-node]
[2023-06-13T11:02:23,408][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-deprecation]
[2023-06-13T11:02:23,408][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-fleet]
[2023-06-13T11:02:23,409][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-profiling]
[2023-06-13T11:02:23,412][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [ingest-geoip]
[2023-06-13T11:02:23,412][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-write-load-forecaster]
[2023-06-13T11:02:23,413][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [search-business-rules]
[2023-06-13T11:02:23,413][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [ingest-attachment]
[2023-06-13T11:02:23,414][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [wildcard]
[2023-06-13T11:02:23,415][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [unsigned-long]
[2023-06-13T11:02:23,415][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-sql]
[2023-06-13T11:02:23,416][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [runtime-fields-common]
[2023-06-13T11:02:23,416][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-async]
[2023-06-13T11:02:23,417][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [vector-tile]
[2023-06-13T11:02:23,417][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [lang-expression]
[2023-06-13T11:02:23,418][INFO ][o.e.p.PluginsService     ] [IN-PSV110121] loaded module [x-pack-eql]
[2023-06-13T11:02:26,033][WARN ][stderr                   ] [IN-PSV110121] Jun 13, 2023 11:02:26 AM org.apache.lucene.store.MemorySegmentIndexInputProvider <init>
[2023-06-13T11:02:26,043][INFO ][o.e.e.NodeEnvironment    ] [IN-PSV110121] using [1] data paths, mounts [[Windows (C:)]], net usable_space [391.6gb], net total_space [476.3gb], types [NTFS]
[2023-06-13T11:02:26,043][INFO ][o.e.e.NodeEnvironment    ] [IN-PSV110121] heap size [15.8gb], compressed ordinary object pointers [true]
[2023-06-13T11:02:26,092][INFO ][o.e.n.Node               ] [IN-PSV110121] node name [IN-PSV110121], node ID [vnXnF_z1SD6w-yMqlo987A], cluster name [elasticsearch], roles [data_cold, data, remote_cluster_client, master, data_warm, data_content, transform, data_hot, ml, data_frozen, ingest]
[2023-06-13T11:02:27,797][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [IN-PSV110121] [controller/18396] [Main.cc@123] controller (64 bit): Version 8.8.1 (Build 4658a65098c570) Copyright (c) 2023 Elasticsearch BV
[2023-06-13T11:02:28,093][INFO ][o.e.x.s.Security         ] [IN-PSV110121] Security is enabled
[2023-06-13T11:02:28,407][INFO ][o.e.x.s.a.s.FileRolesStore] [IN-PSV110121] parsed [0] roles from file [C:\Users\mrchalla\Downloads\elasticsearch-8.8.1\config\roles.yml]
[2023-06-13T11:02:28,838][INFO ][o.e.x.p.ProfilingPlugin  ] [IN-PSV110121] Profiling is enabled
[2023-06-13T11:02:29,289][WARN ][stderr                   ] [IN-PSV110121] SLF4J: No SLF4J providers were found.
[2023-06-13T11:02:29,289][WARN ][stderr                   ] [IN-PSV110121] SLF4J: Defaulting to no-operation (NOP) logger implementation
[2023-06-13T11:02:29,290][WARN ][stderr                   ] [IN-PSV110121] SLF4J: See https://www.slf4j.org/codes.html#noProviders for further details.
[2023-06-13T11:02:29,293][WARN ][stderr                   ] [IN-PSV110121] SLF4J: Class path contains SLF4J bindings targeting slf4j-api versions 1.7.x or earlier.
[2023-06-13T11:02:29,293][WARN ][stderr                   ] [IN-PSV110121] SLF4J: Ignoring binding found at [jar:file:///C:/Users/mrchalla/Downloads/elasticsearch-8.8.1/modules/x-pack-security/log4j-slf4j-impl-2.19.0.jar!/org/slf4j/impl/StaticLoggerBinder.class]
[2023-06-13T11:02:29,294][WARN ][stderr                   ] [IN-PSV110121] SLF4J: See https://www.slf4j.org/codes.html#ignoredBindings for an explanation.
[2023-06-13T11:02:29,322][INFO ][o.e.t.n.NettyAllocator   ] [IN-PSV110121] creating NettyAllocator with the following configs: [name=elasticsearch_configured, chunk_size=1mb, suggested_max_allocation_size=1mb, factors={es.unsafe.use_netty_default_chunk_and_page_size=false, g1gc_enabled=true, g1gc_region_size=8mb}]
[2023-06-13T11:02:29,340][INFO ][o.e.i.r.RecoverySettings ] [IN-PSV110121] using rate limit [40mb] with [default=40mb, read=0b, write=0b, max=0b]
[2023-06-13T11:02:29,373][INFO ][o.e.d.DiscoveryModule    ] [IN-PSV110121] using discovery type [multi-node] and seed hosts providers [settings]
[2023-06-13T11:02:30,341][INFO ][o.e.n.Node               ] [IN-PSV110121] initialized
[2023-06-13T11:02:30,342][INFO ][o.e.n.Node               ] [IN-PSV110121] starting ...
[2023-06-13T11:02:30,363][INFO ][o.e.x.s.c.f.PersistentCache] [IN-PSV110121] persistent cache index loaded
[2023-06-13T11:02:30,364][INFO ][o.e.x.d.l.DeprecationIndexingComponent] [IN-PSV110121] deprecation component started
[2023-06-13T11:02:30,509][INFO ][o.e.t.TransportService   ] [IN-PSV110121] publish_address {127.0.0.1:9300}, bound_addresses {127.0.0.1:9300}, {[::1]:9300}
[2023-06-13T11:02:30,821][WARN ][o.e.b.BootstrapChecks    ] [IN-PSV110121] the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured
[2023-06-13T11:02:30,821][WARN ][o.e.b.BootstrapChecks    ] [IN-PSV110121] Transport SSL must be enabled if security is enabled. Please set [xpack.security.transport.ssl.enabled] to [true] or disable security by setting [xpack.security.enabled] to [false]
[2023-06-13T11:02:30,823][INFO ][o.e.c.c.ClusterBootstrapService] [IN-PSV110121] this node is locked into cluster UUID [qgoJV9VhQJ2AeTGq5CT7sA] and will not attempt further cluster bootstrapping
[2023-06-13T11:02:30,832][INFO ][o.e.c.c.ClusterBootstrapService] [IN-PSV110121] no discovery configuration found, will perform best-effort cluster bootstrapping after [3s] unless existing master is discovered
[2023-06-13T11:02:30,931][INFO ][o.e.c.s.MasterService    ] [IN-PSV110121] elected-as-master ([1] nodes joined in term 3)[_FINISH_ELECTION_, {IN-PSV110121}{vnXnF_z1SD6w-yMqlo987A}{8Q8n6LinQB6FsP0t7QrN_A}{IN-PSV110121}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{8.8.1} completing election], term: 3, version: 33, delta: master node changed {previous [], current [{IN-PSV110121}{vnXnF_z1SD6w-yMqlo987A}{8Q8n6LinQB6FsP0t7QrN_A}{IN-PSV110121}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{8.8.1}]}
[2023-06-13T11:02:31,037][INFO ][o.e.c.s.ClusterApplierService] [IN-PSV110121] master node changed {previous [], current [{IN-PSV110121}{vnXnF_z1SD6w-yMqlo987A}{8Q8n6LinQB6FsP0t7QrN_A}{IN-PSV110121}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{8.8.1}]}, term: 3, version: 33, reason: Publication{term=3, version=33}
[2023-06-13T11:02:31,065][INFO ][o.e.c.f.AbstractFileWatchingService] [IN-PSV110121] starting file watcher ...
[2023-06-13T11:02:31,070][INFO ][o.e.c.f.AbstractFileWatchingService] [IN-PSV110121] file settings service up and running [tid=83]
[2023-06-13T11:02:31,075][INFO ][o.e.c.c.NodeJoinExecutor ] [IN-PSV110121] node-join: [{IN-PSV110121}{vnXnF_z1SD6w-yMqlo987A}{8Q8n6LinQB6FsP0t7QrN_A}{IN-PSV110121}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{8.8.1}] with reason [completing election]
[2023-06-13T11:02:31,095][INFO ][o.e.h.AbstractHttpServerTransport] [IN-PSV110121] publish_address {127.0.0.1:9200}, bound_addresses {127.0.0.1:9200}, {[::1]:9200}
[2023-06-13T11:02:31,096][INFO ][o.e.n.Node               ] [IN-PSV110121] started {IN-PSV110121}{vnXnF_z1SD6w-yMqlo987A}{8Q8n6LinQB6FsP0t7QrN_A}{IN-PSV110121}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{8.8.1}{ml.machine_memory=34102108160, xpack.installed=true, ml.allocated_processors_double=12.0, ml.max_jvm_size=17054040064, ml.allocated_processors=12}
[2023-06-13T11:02:31,158][INFO ][o.e.l.ClusterStateLicenseService] [IN-PSV110121] license [478026a2-2685-4471-b1b0-9e6261679361] mode [basic] - valid
[2023-06-13T11:02:31,160][INFO ][o.e.x.s.a.Realms         ] [IN-PSV110121] license mode is [basic], currently licensed security realms are [reserved/reserved,file/default_file,native/default_native]
[2023-06-13T11:02:31,166][INFO ][o.e.g.GatewayService     ] [IN-PSV110121] recovered [0] indices into cluster_state
[2023-06-13T11:02:31,299][INFO ][o.e.h.n.s.HealthNodeTaskExecutor] [IN-PSV110121] Node [{IN-PSV110121}{vnXnF_z1SD6w-yMqlo987A}] is selected as the current health node.
`",mohanachalla,closed,['needs:triage'],https://github.com/elastic/elasticsearch/issues/96784,2023-06-13T05:35:06Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96784,"{
  ""application_resource"": ""unsure""
}"
260,96711,[CI] MixedClusterClientYamlTestSuiteIT test {p0=indices.stats/13_fields/Fielddata fields - all metric} failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/zlgx2yuikqnp6/tests/:qa:mixed-cluster:v8.4.0%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=indices.stats%2F13_fields%2FFielddata%20fields%20-%20all%20metric%7D

**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v8.4.0#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=indices.stats/13_fields/Fielddata fields - all metric}"" -Dtests.seed=F8C1BF871B7A72B7 -Dtests.bwc=true -Dtests.locale=tr -Dtests.timezone=Asia/Hong_Kong -Druntime.java=20
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT&tests.test=test%20%7Bp0%3Dindices.stats/13_fields/Fielddata%20fields%20-%20all%20metric%7D

**Failure excerpt:**
```
java.lang.AssertionError: Failure at [indices.stats/13_fields:232]: value of [_all.total.fielddata.fields.bar.memory_size_in_bytes] is not comparable (got [null])
Expected: an instance of java.lang.Comparable
     but: null

  at __randomizedtesting.SeedInfo.seed([F8C1BF871B7A72B7:7095805DB5861F4F]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:572)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

  Caused by: java.lang.AssertionError: value of [_all.total.fielddata.fields.bar.memory_size_in_bytes] is not comparable (got [null])
  Expected: an instance of java.lang.Comparable
       but: null

    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
    at org.junit.Assert.assertThat(Assert.java:956)
    at org.elasticsearch.test.rest.yaml.section.GreaterThanAssertion.doAssert(GreaterThanAssertion.java:50)
    at org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:65)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:552)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
    at java.lang.reflect.Method.invoke(Method.java:578)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1623)

```",idegtiarenko,closed,"[':Data Management/Stats', '>test-failure', 'Team:Data Management', 'low-risk']",https://github.com/elastic/elasticsearch/issues/96711,2023-06-08T14:58:34Z,13,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96711,"{
  ""application_resource"": ""yes""
}"
261,96574,Execution failed for task ':qa:rolling-upgrade:v8.8.0#oneThirdUpgradedTest'.,"### CI Link

https://gradle-enterprise.elastic.co/s/auzc7rymva2g4

### Repro line

./gradlew :qa:rolling-upgrade:v8.8.0#oneThirdUpgradedTest

### Does it reproduce?

Yes

### Applicable branches

8.8

### Failure history

_No response_

### Failure excerpt
```
 [2023-06-05T13:17:33,878][WARN ][o.e.c.c.JoinHelper       ] [v8.8.0-0] last failed join attempt was 967ms ago, failed to join {v8.8.0-1}{Q30XLr6JTA6Z0OuQdZYSNA}{NFdzm0nsSAybBAkCCAsdJg}{v8.8.0-1}{127.0.0.1}{127.0.0.1:35155}{cdfhilmrstw}{8.8.0}{ml.allocated_processors=32, testattr=test, ml.allocated_processors_double=32.0, ml.machine_memory=101200584704, xpack.installed=true, ml.max_jvm_size=536870912} with JoinRequest{sourceNode={v8.8.0-0}{uUkkMrdaS2aNpQ2LnS8E9g}{xvFDghtqTUi4kaJWTFCBoA}{v8.8.0-0}{127.0.0.1}{127.0.0.1:41814}{cdfhilmrstw}{8.9.0}{upgraded=true, ml.allocated_processors=32, ml.allocated_processors_double=32.0, ml.max_jvm_size=536870912, xpack.installed=true, testattr=test, ml.machine_memory=101200584704}, transportVersion=8500007, minimumTerm=1, optionalJoin=Optional.empty} org.elasticsearch.transport.RemoteTransportException: [v8.8.0-1][127.0.0.1:35155][internal:cluster/coordination/join]	
Â»  Caused by: java.lang.IllegalStateException: failure when sending a join validation request from [{v8.8.0-1}{Q30XLr6JTA6Z0OuQdZYSNA}{NFdzm0nsSAybBAkCCAsdJg}{v8.8.0-1}{127.0.0.1}{127.0.0.1:35155}{cdfhilmrstw}{8.8.0}] to [{v8.8.0-0}{uUkkMrdaS2aNpQ2LnS8E9g}{xvFDghtqTUi4kaJWTFCBoA}{v8.8.0-0}{127.0.0.1}{127.0.0.1:41814}{cdfhilmrstw}{8.9.0}]	
Â»  	at org.elasticsearch.cluster.coordination.Coordinator.lambda$sendJoinValidate$13(Coordinator.java:730)	
Â»  	at org.elasticsearch.action.ActionListenerImplementations$DelegatingResponseActionListener.acceptException(ActionListenerImplementations.java:126)	
Â»  	at org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:59)	
Â»  	at org.elasticsearch.action.ActionListenerImplementations$DelegatingResponseActionListener.onFailure(ActionListenerImplementations.java:131)	
Â»  	at org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:59)	
Â»  	at org.elasticsearch.action.ActionListenerImplementations.safeOnFailure(ActionListenerImplementations.java:71)	
Â»  	at org.elasticsearch.action.DelegatingActionListener.onFailure(DelegatingActionListener.java:27)	
Â»  	at org.elasticsearch.action.ActionListenerImplementations$RunAfterActionListener.onFailure(ActionListenerImplementations.java:181)	
Â»  	at org.elasticsearch.action.ActionListenerImplementations.safeAcceptException(ActionListenerImplementations.java:59)	
Â»  	at org.elasticsearch.action.ActionListenerImplementations.safeOnFailure(ActionListenerImplementations.java:71)	
Â»  	at org.elasticsearch.action.ActionListener$5.onFailure(ActionListener.java:339)	
Â»  	at org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:48)	
Â»  	at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1405)	
Â»  	at org.elasticsearch.transport.InboundHandler.doHandleException(InboundHandler.java:461)	
Â»  	at org.elasticsearch.transport.InboundHandler$3.doRun(InboundHandler.java:453)	
Â»  	at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)	
Â»  	at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)	
Â»  	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)	
Â»  	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)	
Â»  	at java.lang.Thread.run(Thread.java:1623)	
Â»  Caused by: org.elasticsearch.transport.RemoteTransportException: [v8.8.0-0][127.0.0.1:41814][internal:cluster/coordination/join/validate]	
Â»  Caused by: java.lang.IllegalStateException: unexpected byte [0x02]	
Â»  	at org.elasticsearch.common.io.stream.StreamInput.readBoolean(StreamInput.java:564)	
Â»  	at org.elasticsearch.common.io.stream.StreamInput.readBoolean(StreamInput.java:554)	
Â»  	at org.elasticsearch.common.io.stream.StreamInput.readOptionalTimeValue(StreamInput.java:1306)	
Â»  	at org.elasticsearch.cluster.metadata.DataLifecycle.<init>(DataLifecycle.java:143)	
Â»  	at org.elasticsearch.common.io.stream.StreamInput.readOptionalWriteable(StreamInput.java:1006)	
Â»  	at org.elasticsearch.cluster.metadata.Template.<init>(Template.java:161)	
Â»  	at org.elasticsearch.cluster.metadata.ComponentTemplate.<init>(ComponentTemplate.java:73)	
Â»  	at org.elasticsearch.common.io.stream.StreamInput.readMap(StreamInput.java:641)	
Â»  	at org.elasticsearch.common.io.stream.StreamInput.readMap(StreamInput.java:625)	
Â»  	at org.elasticsearch.cluster.metadata.ComponentTemplateMetadata.<init>(ComponentTemplateMetadata.java:62)	
Â»  	at org.elasticsearch.common.io.stream.NamedWriteableAwareStreamInput.readNamedWriteable(NamedWriteableAwareStreamInput.java:56)	
Â»  	at org.elasticsearch.common.io.stream.NamedWriteableAwareStreamInput.readNamedWriteable(NamedWriteableAwareStreamInput.java:32)	
Â»  	at org.elasticsearch.cluster.metadata.Metadata.readFrom(Metadata.java:1653)	
Â»  	at org.elasticsearch.cluster.ClusterState.readFrom(ClusterState.java:907)	
Â»  	at org.elasticsearch.cluster.coordination.ValidateJoinRequest.readCompressed(ValidateJoinRequest.java:59)	
Â»  	at org.elasticsearch.cluster.coordination.ValidateJoinRequest.lambda$new$0(ValidateJoinRequest.java:36)	
Â»  	at org.elasticsearch.cluster.coordination.ValidateJoinRequest.getOrReadState(ValidateJoinRequest.java:76)	
Â»  	at org.elasticsearch.cluster.coordination.JoinValidationService.lambda$new$2(JoinValidationService.java:121)	
Â»  	at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:74)	
Â»  	at org.elasticsearch.transport.InboundHandler$1.doRun(InboundHandler.java:315)	
Â»  	at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)	
Â»  	at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)	
Â»  	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)	
Â»  	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)	
Â»  	at java.lang.Thread.run(Thread.java:1623)	
Â»  
```",edsavage,closed,"['>test-failure', ':Data Management/Data streams', 'Team:Data Management']",https://github.com/elastic/elasticsearch/issues/96574,2023-06-05T14:14:42Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96574,"{
  ""application_resource"": ""yes""
}"
262,96572,The _terms_enum endpoint has no limits on the size of its prefix,"### Elasticsearch Version

8.8

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

all

### Problem Description

`_terms_enum` queries against a `keyword` field build automata out of their prefix string, to be intersected with the terms dictionary on the relevant field.  We don't have a limit on the size of this prefix, meaning that if somebody (either accidentally or maliciously) passes a very large string here, we can run out of memory.

### Steps to Reproduce

Send a very large string as part of a `_terms_enum` request against a keyword field.

### Logs (if relevant)

_No response_",romseygeek,closed,"['>bug', ':Search/Search', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/96572,2023-06-05T13:13:56Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96572,"{
  ""application_resource"": ""yes""
}"
263,96569,Chunk the GET _ilm/policy response,"### Description

Clusters can have thousands of ILM policies. 
`GET _ilm/policy` returns all of them and runs on the master node.

This proposes we chunk the response for better memory usage and clients experience.

Relates to https://github.com/elastic/elasticsearch/issues/96568",andreidan,closed,"['>enhancement', ':Data Management/ILM+SLM', 'Team:Data Management']",https://github.com/elastic/elasticsearch/issues/96569,2023-06-05T12:09:11Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96569,"{
  ""application_resource"": ""yes""
}"
264,96552,TSDB: numbers that are mapped as `keyword` are not validated correctly at routing time,"I am trying to add dimensions to the system integration package, core data_stream. When enabling TSDB - all documents are dropped with the error:
```
 {\""type\"":\""illegal_argument_exception\"",\""reason\"":\""Error extracting routing: Routing values must be strings but found [VALUE_NUMBER]\"",\""caused_by\"":{\""type\"":\""parsing_exception\"",\""reason\"":\""Routing values must be strings but found [VALUE_NUMBER]\"",\""line\"":1,\""col\"":505}}, dropping event!""
```
Even though all selected for dimensions fields are of type `keyword` - see draft PR https://github.com/elastic/integrations/pull/6454

the field of concerns is `system.core.id`, mapping:
```
      ""system"": {
        ""properties"": {
          ""core"": {
            ""properties"": {
              ""id"": {
                ""type"": ""keyword"",
                ""time_series_dimension"": true
              },
```
mapping - keyword , but actual value - number

<details>
<summary> Document example </summary>

```
{
    ""agent"": {
        ""ephemeral_id"": ""20d6ad4a-276c-491c-b4a1-a98bcc404be1"",
        ""id"": ""37188f3d-6747-4f0e-831d-87af1f5ea514"",
        ""name"": ""kind-worker"",
        ""type"": ""metricbeat"",
        ""version"": ""8.8.0""
    },
    ""data_stream"": {
        ""dataset"": ""system.core"",
        ""namespace"": ""default"",
        ""type"": ""metrics""
    },
    ""ecs"": {
        ""version"": ""8.0.0""
    },
    ""elastic_agent"": {
        ""id"": ""37188f3d-6747-4f0e-831d-87af1f5ea514"",
        ""snapshot"": false,
        ""version"": ""8.8.0""
    },
    ""event"": {
        ""dataset"": ""system.core"",
        ""duration"": 226255,
        ""module"": ""system""
    },
    ""host"": {
        ""architecture"": ""x86_64"",
        ""containerized"": false,
        ""hostname"": ""kind-worker"",
        ""id"": ""d79d0441a1cd4e14a3361dd723319cb3"",
        ""ip"": [
            ""10.244.2.1"",
            ""10.244.2.1"",
            ""172.24.0.4"",
            ""172.18.0.4"",
            ""fc00:f853:ccd:e793::4"",
            ""fe80::42:acff:fe12:4""
        ],
        ""mac"": [
            ""02-42-AC-12-00-04"",
            ""02-42-AC-18-00-04"",
            ""5E-9E-3C-8C-9C-E2"",
            ""CA-74-3B-E9-F5-32""
        ],
        ""name"": ""kind-worker"",
        ""os"": {
            ""codename"": ""focal"",
            ""family"": ""debian"",
            ""kernel"": ""5.15.49-linuxkit"",
            ""name"": ""Ubuntu"",
            ""platform"": ""ubuntu"",
            ""type"": ""linux"",
            ""version"": ""20.04.6 LTS (Focal Fossa)""
        }
    },
    ""metricset"": {
        ""name"": ""core"",
        ""period"": 10000
    },
    ""service"": {
        ""type"": ""system""
    },
    ""system"": {
        ""core"": {
            ""core_id"": 0,
            ""id"": 1,
            ""idle"": {
                ""pct"": 0.9586
            },
            ""iowait"": {
                ""pct"": 0.001
            },
            ""irq"": {
                ""pct"": 0
            },
            ""mhz"": 2400,
            ""model_name"": ""Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz"",
            ""model_number"": ""158"",
            ""nice"": {
                ""pct"": 0
            },
            ""physical_id"": 1,
            ""softirq"": {
                ""pct"": 0.001
            },
            ""steal"": {
                ""pct"": 0
            },
            ""system"": {
                ""pct"": 0.0186
            },
            ""total"": {
                ""pct"": 0.0404
            },
            ""user"": {
                ""pct"": 0.0207
            }
        }
    }
}
```

</details>

<details>
<summary> Index mapping </summary>

```
{
  ""mappings"": {
    ""_meta"": {
      ""managed_by"": ""fleet"",
      ""managed"": true,
      ""package"": {
        ""name"": ""system""
      }
    },
    ""_data_stream_timestamp"": {
      ""enabled"": true
    },
    ""dynamic_templates"": [
      {
        ""container.labels"": {
          ""path_match"": ""container.labels.*"",
          ""match_mapping_type"": ""string"",
          ""mapping"": {
            ""type"": ""keyword""
          }
        }
      },
      {
        ""strings_as_keyword"": {
          ""match_mapping_type"": ""string"",
          ""mapping"": {
            ""ignore_above"": 1024,
            ""type"": ""keyword""
          }
        }
      }
    ],
    ""date_detection"": false,
    ""properties"": {
      ""@timestamp"": {
        ""type"": ""date""
      },
      ""agent"": {
        ""properties"": {
          ""id"": {
            ""type"": ""keyword"",
            ""time_series_dimension"": true
          }
        }
      },
      ""cloud"": {
        ""properties"": {
          ""account"": {
            ""properties"": {
              ""id"": {
                ""type"": ""keyword"",
                ""time_series_dimension"": true
              }
            }
          },
          ""availability_zone"": {
            ""type"": ""keyword"",
            ""time_series_dimension"": true
          },
          ""image"": {
            ""properties"": {
              ""id"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""instance"": {
            ""properties"": {
              ""id"": {
                ""type"": ""keyword"",
                ""time_series_dimension"": true
              },
              ""name"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""machine"": {
            ""properties"": {
              ""type"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""project"": {
            ""properties"": {
              ""id"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""provider"": {
            ""type"": ""keyword"",
            ""time_series_dimension"": true
          },
          ""region"": {
            ""type"": ""keyword"",
            ""time_series_dimension"": true
          }
        }
      },
      ""container"": {
        ""properties"": {
          ""id"": {
            ""type"": ""keyword"",
            ""time_series_dimension"": true
          },
          ""image"": {
            ""properties"": {
              ""name"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""name"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          }
        }
      },
      ""data_stream"": {
        ""properties"": {
          ""dataset"": {
            ""type"": ""constant_keyword""
          },
          ""namespace"": {
            ""type"": ""constant_keyword""
          },
          ""type"": {
            ""type"": ""constant_keyword""
          }
        }
      },
      ""event"": {
        ""properties"": {
          ""agent_id_status"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""dataset"": {
            ""type"": ""constant_keyword"",
            ""value"": ""system.core""
          },
          ""ingested"": {
            ""type"": ""date"",
            ""format"": ""strict_date_time_no_millis||strict_date_optional_time||epoch_millis""
          },
          ""module"": {
            ""type"": ""constant_keyword"",
            ""value"": ""system""
          }
        }
      },
      ""host"": {
        ""properties"": {
          ""architecture"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""containerized"": {
            ""type"": ""boolean""
          },
          ""domain"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""hostname"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""id"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""ip"": {
            ""type"": ""ip""
          },
          ""mac"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""name"": {
            ""type"": ""keyword"",
            ""time_series_dimension"": true
          },
          ""os"": {
            ""properties"": {
              ""build"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""codename"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""family"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""full"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024,
                ""fields"": {
                  ""text"": {
                    ""type"": ""match_only_text""
                  }
                }
              },
              ""kernel"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""name"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024,
                ""fields"": {
                  ""text"": {
                    ""type"": ""match_only_text""
                  }
                }
              },
              ""platform"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""version"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""type"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          }
        }
      },
      ""system"": {
        ""properties"": {
          ""core"": {
            ""properties"": {
              ""id"": {
                ""type"": ""keyword"",
                ""time_series_dimension"": true
              },
              ""idle"": {
                ""properties"": {
                  ""pct"": {
                    ""type"": ""scaled_float"",
                    ""meta"": {
                      ""unit"": ""percent""
                    },
                    ""scaling_factor"": 1000,
                    ""time_series_metric"": ""gauge""
                  },
                  ""ticks"": {
                    ""type"": ""long"",
                    ""time_series_metric"": ""counter""
                  }
                }
              },
              ""iowait"": {
                ""properties"": {
                  ""pct"": {
                    ""type"": ""scaled_float"",
                    ""meta"": {
                      ""unit"": ""percent""
                    },
                    ""scaling_factor"": 1000,
                    ""time_series_metric"": ""gauge""
                  },
                  ""ticks"": {
                    ""type"": ""long"",
                    ""time_series_metric"": ""counter""
                  }
                }
              },
              ""irq"": {
                ""properties"": {
                  ""pct"": {
                    ""type"": ""scaled_float"",
                    ""meta"": {
                      ""unit"": ""percent""
                    },
                    ""scaling_factor"": 1000,
                    ""time_series_metric"": ""gauge""
                  },
                  ""ticks"": {
                    ""type"": ""long"",
                    ""time_series_metric"": ""counter""
                  }
                }
              },
              ""nice"": {
                ""properties"": {
                  ""pct"": {
                    ""type"": ""scaled_float"",
                    ""meta"": {
                      ""unit"": ""percent""
                    },
                    ""scaling_factor"": 1000,
                    ""time_series_metric"": ""gauge""
                  },
                  ""ticks"": {
                    ""type"": ""long"",
                    ""time_series_metric"": ""counter""
                  }
                }
              },
              ""softirq"": {
                ""properties"": {
                  ""pct"": {
                    ""type"": ""scaled_float"",
                    ""meta"": {
                      ""unit"": ""percent""
                    },
                    ""scaling_factor"": 1000,
                    ""time_series_metric"": ""gauge""
                  },
                  ""ticks"": {
                    ""type"": ""long"",
                    ""time_series_metric"": ""counter""
                  }
                }
              },
              ""steal"": {
                ""properties"": {
                  ""pct"": {
                    ""type"": ""scaled_float"",
                    ""meta"": {
                      ""unit"": ""percent""
                    },
                    ""scaling_factor"": 1000,
                    ""time_series_metric"": ""gauge""
                  },
                  ""ticks"": {
                    ""type"": ""long"",
                    ""time_series_metric"": ""counter""
                  }
                }
              },
              ""system"": {
                ""properties"": {
                  ""pct"": {
                    ""type"": ""scaled_float"",
                    ""meta"": {
                      ""unit"": ""percent""
                    },
                    ""scaling_factor"": 1000,
                    ""time_series_metric"": ""gauge""
                  },
                  ""ticks"": {
                    ""type"": ""long"",
                    ""time_series_metric"": ""counter""
                  }
                }
              },
              ""user"": {
                ""properties"": {
                  ""pct"": {
                    ""type"": ""scaled_float"",
                    ""meta"": {
                      ""unit"": ""percent""
                    },
                    ""scaling_factor"": 1000,
                    ""time_series_metric"": ""gauge""
                  },
                  ""ticks"": {
                    ""type"": ""long"",
                    ""time_series_metric"": ""counter""
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
```

</details>

<details>
<summary> Index settings </summary>

```
{
  ""settings"": {
    ""index"": {
      ""mapping"": {
        ""total_fields"": {
          ""limit"": ""10000""
        }
      },
      ""hidden"": ""true"",
      ""time_series"": {
        ""end_time"": ""2023-06-02T15:09:20.000Z"",
        ""start_time"": ""2023-06-02T10:47:46.000Z""
      },
      ""provided_name"": "".ds-metrics-system.core-default-2023.06.02-000002"",
      ""final_pipeline"": "".fleet_final_pipeline-1"",
      ""query"": {
        ""default_field"": [
          ""cloud.account.id"",
          ""cloud.availability_zone"",
          ""cloud.instance.id"",
          ""cloud.instance.name"",
          ""cloud.machine.type"",
          ""cloud.provider"",
          ""cloud.region"",
          ""cloud.project.id"",
          ""cloud.image.id"",
          ""container.id"",
          ""container.image.name"",
          ""container.name"",
          ""host.hostname"",
          ""host.id"",
          ""host.os.build"",
          ""host.os.codename"",
          ""host.os.family"",
          ""host.os.full"",
          ""host.os.kernel"",
          ""host.os.name"",
          ""host.os.platform"",
          ""host.os.version"",
          ""host.architecture"",
          ""host.mac"",
          ""host.name"",
          ""host.type"",
          ""agent.id"",
          ""system.core.id""
        ]
      },
      ""creation_date"": ""1685710066976"",
      ""number_of_replicas"": ""1"",
      ""routing_path"": [
        ""host.name"",
        ""container.id"",
        ""cloud.instance.id"",
        ""cloud.availability_zone"",
        ""cloud.account.id"",
        ""agent.id"",
        ""system.core.id"",
        ""cloud.provider"",
        ""cloud.region""
      ],
      ""uuid"": ""eiJy8iZKTnOrOW85vY6PQg"",
      ""version"": {
        ""created"": ""8080099""
      },
      ""lifecycle"": {
        ""name"": ""metrics""
      },
      ""mode"": ""time_series"",
      ""codec"": ""best_compression"",
      ""routing"": {
        ""allocation"": {
          ""include"": {
            ""_tier_preference"": ""data_hot""
          }
        }
      },
      ""number_of_shards"": ""1"",
      ""default_pipeline"": ""metrics-system.core-1.32.0-beta.1""
    }
  },
  ""defaults"": {
    ""index"": {
      ""flush_after_merge"": ""512mb"",
      ""time_series"": {
        ""es87tsdb_codec"": {
          ""enabled"": ""true""
        }
      },
      ""max_inner_result_window"": ""100"",
      ""unassigned"": {
        ""node_left"": {
          ""delayed_timeout"": ""1m""
        }
      },
      ""max_terms_count"": ""65536"",
      ""rollup"": {
        ""source"": {
          ""name"": """",
          ""uuid"": """"
        }
      },
      ""lifecycle"": {
        ""parse_origination_date"": ""false"",
        ""prefer_ilm"": ""true"",
        ""step"": {
          ""wait_time_threshold"": ""12h""
        },
        ""indexing_complete"": ""false"",
        ""rollover_alias"": """",
        ""origination_date"": ""-1""
      },
      ""routing_partition_size"": ""1"",
      ""force_memory_term_dictionary"": ""false"",
      ""max_docvalue_fields_search"": ""100"",
      ""merge"": {
        ""scheduler"": {
          ""max_thread_count"": ""4"",
          ""auto_throttle"": ""true"",
          ""max_merge_count"": ""9""
        },
        ""policy"": {
          ""merge_factor"": ""32"",
          ""floor_segment"": ""2mb"",
          ""max_merge_at_once_explicit"": ""30"",
          ""max_merge_at_once"": ""10"",
          ""max_merged_segment"": ""0b"",
          ""expunge_deletes_allowed"": ""10.0"",
          ""segments_per_tier"": ""10.0"",
          ""type"": ""UNSET"",
          ""deletes_pct_allowed"": ""20.0""
        }
      },
      ""max_refresh_listeners"": ""1000"",
      ""max_regex_length"": ""1000"",
      ""load_fixed_bitset_filters_eagerly"": ""true"",
      ""number_of_routing_shards"": ""1"",
      ""write"": {
        ""wait_for_active_shards"": ""1""
      },
      ""verified_before_close"": ""false"",
      ""mapping"": {
        ""coerce"": ""false"",
        ""nested_fields"": {
          ""limit"": ""50""
        },
        ""depth"": {
          ""limit"": ""20""
        },
        ""field_name_length"": {
          ""limit"": ""9223372036854775807""
        },
        ""nested_objects"": {
          ""limit"": ""10000""
        },
        ""ignore_malformed"": ""false"",
        ""dimension_fields"": {
          ""limit"": ""21""
        }
      },
      ""source_only"": ""false"",
      ""soft_deletes"": {
        ""enabled"": ""true"",
        ""retention"": {
          ""operations"": ""0""
        },
        ""retention_lease"": {
          ""period"": ""12h""
        }
      },
      ""max_script_fields"": ""32"",
      ""query"": {
        ""parse"": {
          ""allow_unmapped_fields"": ""true""
        }
      },
      ""format"": ""0"",
      ""frozen"": ""false"",
      ""sort"": {
        ""missing"": [],
        ""mode"": [],
        ""field"": [],
        ""order"": []
      },
      ""priority"": ""1"",
      ""version"": {
        ""compatibility"": ""8080099""
      },
      ""max_rescore_window"": ""10000"",
      ""bloom_filter_for_id_field"": {
        ""enabled"": ""true""
      },
      ""max_adjacency_matrix_filters"": ""100"",
      ""analyze"": {
        ""max_token_count"": ""10000""
      },
      ""gc_deletes"": ""60s"",
      ""top_metrics_max_size"": ""10"",
      ""optimize_auto_generated_id"": ""true"",
      ""max_ngram_diff"": ""1"",
      ""translog"": {
        ""flush_threshold_age"": ""1m"",
        ""generation_threshold_size"": ""64mb"",
        ""flush_threshold_size"": ""10gb"",
        ""sync_interval"": ""5s"",
        ""retention"": {
          ""size"": ""-1"",
          ""age"": ""-1""
        },
        ""durability"": ""REQUEST""
      },
      ""auto_expand_replicas"": ""false"",
      ""recovery"": {
        ""type"": """"
      },
      ""requests"": {
        ""cache"": {
          ""enable"": ""true""
        }
      },
      ""data_path"": """",
      ""highlight"": {
        ""max_analyzed_offset"": ""1000000""
      },
      ""routing"": {
        ""rebalance"": {
          ""enable"": ""all""
        },
        ""allocation"": {
          ""disk"": {
            ""watermark"": {
              ""ignore"": ""false""
            }
          },
          ""enable"": ""all"",
          ""total_shards_per_node"": ""-1""
        }
      },
      ""search"": {
        ""slowlog"": {
          ""level"": ""TRACE"",
          ""threshold"": {
            ""fetch"": {
              ""warn"": ""-1"",
              ""trace"": ""-1"",
              ""debug"": ""-1"",
              ""info"": ""-1""
            },
            ""query"": {
              ""warn"": ""-1"",
              ""trace"": ""-1"",
              ""debug"": ""-1"",
              ""info"": ""-1""
            }
          }
        },
        ""idle"": {
          ""after"": ""30s""
        },
        ""throttled"": ""false""
      },
      ""fielddata"": {
        ""cache"": ""node""
      },
      ""look_ahead_time"": ""2h"",
      ""max_slices_per_scroll"": ""1024"",
      ""shard"": {
        ""check_on_startup"": ""false""
      },
      ""xpack"": {
        ""watcher"": {
          ""template"": {
            ""version"": """"
          }
        },
        ""version"": """",
        ""ccr"": {
          ""following_index"": ""false""
        }
      },
      ""percolator"": {
        ""map_unmapped_fields_as_text"": ""false""
      },
      ""allocation"": {
        ""max_retries"": ""5"",
        ""existing_shards_allocator"": ""gateway_allocator""
      },
      ""refresh_interval"": ""1s"",
      ""indexing"": {
        ""slowlog"": {
          ""reformat"": ""true"",
          ""threshold"": {
            ""index"": {
              ""warn"": ""-1"",
              ""trace"": ""-1"",
              ""debug"": ""-1"",
              ""info"": ""-1""
            }
          },
          ""source"": ""1000"",
          ""level"": ""TRACE""
        }
      },
      ""compound_format"": ""1gb"",
      ""blocks"": {
        ""metadata"": ""false"",
        ""read"": ""false"",
        ""read_only_allow_delete"": ""false"",
        ""read_only"": ""false"",
        ""write"": ""false""
      },
      ""max_result_window"": ""10000"",
      ""store"": {
        ""stats_refresh_interval"": ""10s"",
        ""type"": """",
        ""fs"": {
          ""fs_lock"": ""native""
        },
        ""preload"": [],
        ""snapshot"": {
          ""snapshot_name"": """",
          ""index_uuid"": """",
          ""cache"": {
            ""prewarm"": {
              ""enabled"": ""true""
            },
            ""enabled"": ""true"",
            ""excluded_file_types"": []
          },
          ""repository_uuid"": """",
          ""uncached_chunk_size"": ""-1b"",
          ""delete_searchable_snapshot"": ""false"",
          ""index_name"": """",
          ""partial"": ""false"",
          ""blob_cache"": {
            ""metadata_files"": {
              ""max_length"": ""64kb""
            }
          },
          ""repository_name"": """",
          ""snapshot_uuid"": """"
        }
      },
      ""queries"": {
        ""cache"": {
          ""enabled"": ""true""
        }
      },
      ""shard_limit"": {
        ""group"": ""normal""
      },
      ""warmer"": {
        ""enabled"": ""true""
      },
      ""downsample"": {
        ""source"": {
          ""name"": """",
          ""uuid"": """"
        },
        ""status"": ""unknown""
      },
      ""override_write_load_forecast"": ""0.0"",
      ""max_shingle_diff"": ""3"",
      ""query_string"": {
        ""lenient"": ""false""
      }
    }
  }
}
```

</details>


cc @lalit-satapathy @mvg

",tetianakravchenko,closed,"['>bug', 'Team:Analytics', ':StorageEngine/TSDB']",https://github.com/elastic/elasticsearch/issues/96552,2023-06-05T08:16:02Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96552,"{
  ""application_resource"": ""yes""
}"
265,96471,[CI] DocsClientYamlTestSuiteIT test {yaml=reference/rest-api/usage/line_38} failing,"It looks like there is some issue with the response format. 

**Build scan:**
https://gradle-enterprise.elastic.co/s/fgywlwd2jzobe/tests/:docs:yamlRestTest/org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT/test%20%7Byaml=reference%2Frest-api%2Fusage%2Fline_38%7D

**Reproduction line:**
```
./gradlew ':docs:yamlRestTest' --tests ""org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT.test {yaml=reference/rest-api/usage/line_38}"" -Dtests.seed=A2E9F58B9E81A215 -Dbuild.snapshot=false -Dtests.jvm.argline=""-Dbuild.snapshot=false"" -Dtests.locale=zh-CN -Dtests.timezone=Etc/UTC -Druntime.java=20
```

**Applicable branches:**
main

**Reproduces locally?:**
Yes

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT&tests.test=test%20%7Byaml%3Dreference/rest-api/usage/line_38%7D

**Failure excerpt:**
```
java.lang.AssertionError: Failure at [reference/rest-api/usage:16]: Expected a map containing
                         eql: a map containing
                     available: <true>
                       enabled: <true>
                      features: a map containing
                           joins: a map containing
                join_queries_three: <0>
                  join_queries_two: <0>
                        join_until: <0>
         join_queries_five_or_more: <0>
                 join_queries_four: <0>
                        sequence: <4>
                            keys: a map containing
                     join_keys_two: <0>
                     join_keys_one: <3>
                   join_keys_three: <0>
            join_keys_five_or_more: <0>
                    join_keys_four: <0>
                            join: <0>
                       sequences: a map containing
            sequence_queries_three: <1>
             sequence_queries_four: <0>
              sequence_queries_two: <3>
                    sequence_until: <0>
                  sequence_maxspan: <2>
     sequence_queries_five_or_more: <0>
                           event: <8>
                           pipes: a map containing
                         pipe_tail: <9>
                         pipe_head: <0>
                       queries: a map containing
                             all: a map containing
                             total: <12>
                            failed: <0>
                            _all: a map containing
                             total: <12>
                            failed: <0>
              frozen_indices: a map containing
                 indices_count: <0>
                     available: <true>
                       enabled: <true>
                         sql: a map containing
                      features: a map containing
                          having: <1>
                       subselect: <0>
                           limit: <1>
                         orderby: <7>
                           where: <3>
                            join: <0>
                         groupby: <1>
                         command: <0>
                           local: <0>
                     available: <true>
                       queries: a map containing
                            rest: a map containing
                             total: <10>
                            paging: <1>
                            failed: <0>
                             cli: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          canvas: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            odbc: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            jdbc: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          odbc32: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          odbc64: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            _all: a map containing
                             total: <10>
                            paging: <1>
                            failed: <0>
                       translate: a map containing
                             count: <1>
                       enabled: <true>
                      rollup: a map containing
                     available: <true>
                       enabled: <true>
        searchable_snapshots: a map containing
    shared_cache_indices_count: <0>
                 indices_count: <0>
                     available: <true>
       full_copy_indices_count: <0>
                       enabled: <true>
                   analytics: a map containing
                         stats: a map containing
                      rate_usage: <2>
                 normalize_usage: <0>
                   boxplot_usage: <3>
               top_metrics_usage: <4>
               multi_terms_usage: <1>
    cumulative_cardinality_usage: <0>
              string_stats_usage: <1>
        moving_percentiles_usage: <0>
                    t_test_usage: <1>
                     available: <true>
                       enabled: <true>
                    logstash: a map containing
                     available: <true>
                       enabled: <true>
                    security: a map containing
                     available: <true>
                       enabled: <false>
                   transform: a map containing
                     available: <true>
                       enabled: <true>
                         ccr: a map containing
    auto_follow_patterns_count: <0>
                     available: <true>
        follower_indices_count: <0>
                       enabled: <true>
                  health_api: a map containing
                     available: <true>
                       enabled: <true>
                      statuses: a map containing
                           green: <5>
                          values: a list containing
                                 0: ""green""
                   invocations: a map containing
                           total: <5>
                    verbose_true: <5>
                     spatial: a map containing
                     available: <true>
                       enabled: <true>
                          ml: a map containing
                     inference: a map containing
                     deployments: a map containing
                           time_ms: a map containing
                                 avg: <0.0>
                             count: <0>
                 model_sizes_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                  inference_counts: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                  trained_models: a map containing
                  model_size_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
              estimated_operations: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                             count: a map containing
                               total: <1>
                         prepackaged: <1>
                               other: <0>
                              _all: a map containing
                               count: <1>
               ingest_processors: a map containing
                              _all: a map containing
                           pipelines: a map containing
                                 count: <0>
                             time_ms: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
                  num_docs_processed: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
                        num_failures: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
     data_frame_analytics_jobs: a map containing
                    memory_usage: a map containing
                  peak_usage_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                            _all: a map containing
                             count: <0>
                 analysis_counts: an empty map
                          jobs: a map containing
                            _all: a map containing
                             count: <0>
                         detectors: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                        created_by: an empty map
                        model_size: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                         forecasts: a map containing
                               total: <0>
                     forecasted_jobs: <0>
                     available: <true>
                     datafeeds: a map containing
                            _all: a map containing
                             count: <0>
                    node_count: <1>
                       enabled: <true>
                     watcher: a map containing
                     execution: a map containing
                         actions: a map containing
                              _all: a map containing
                               total: <0>
                    total_time_in_ms: <0>
                         watch: a map containing
                           input: a map containing
                              _all: a map containing
                               total: <0>
                              active: <0>
                         trigger: a map containing
                              _all: a map containing
                               total: <0>
                              active: <0>
                     available: <true>
                         count: a map containing
                           total: <0>
                          active: <0>
                       enabled: <true>
           enterprise_search: a map containing
           search_applications: a map containing
                           count: <0>
         analytics_collections: a map containing
                           count: <0>
                     available: <true>
                       enabled: <true>
                     archive: a map containing
                 indices_count: <0>
                     available: <true>
                       enabled: <true>
                         ilm: a map containing
                  policy_count: <17>
                  policy_stats: a list containing
                               0: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               1: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""3d""
                            max_age_millis: <259200000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <345600000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               2: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               3: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                               4: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""forcemerge""
                                       1: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""3d""
                            max_age_millis: <259200000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <259200000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               5: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               6: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""300gb""
                            max_size_bytes: <322122547200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               7: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <31536000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               8: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""7d""
                            max_age_millis: <604800000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <604800000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               9: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""10gb""
              max_primary_shard_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              10: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <15552000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              11: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              12: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              13: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""7d""
                            max_age_millis: <604800000>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <604800000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              14: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <15552000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              15: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              16: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                  monitoring: a map containing
            collection_enabled: <false>
                     available: <true>
             enabled_exporters: a map containing
                           local: <1>
                       enabled: <true>
                       graph: a map containing
                     available: <true>
                       enabled: <true>
            aggregate_metric: a map containing
                     available: <true>
                       enabled: <true>
                  data_tiers: a map containing
                     data_warm: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                   data_frozen: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                     data_cold: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                     available: <true>
                  data_content: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                       enabled: <true>
                      data_hot: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                         slm: a map containing
                     available: <true>
                       enabled: <true>
                  policy_count: <0>
                  policy_stats: a map containing
                  retention_runs: <0>
                retention_failed: <0>
             retention_timed_out: <0>
         retention_deletion_time: ""0s""
  retention_deletion_time_millis: <0>
           total_snapshots_taken: <0>
          total_snapshots_failed: <0>
         total_snapshots_deleted: <0>
total_snapshot_deletion_failures: <0>
                    policy_stats: an empty list
                 voting_only: a map containing
                     available: <true>
                       enabled: <true>
                data_streams: a map containing
                 indices_count: <0>
                     available: <true>
                  data_streams: <0>
                       enabled: <true>
              data_lifecycle: a map containing
                     lifecycle: expected a map but was <missing>
                     available: <true>
                       enabled: <true>
                         count: <unexpected> but was <0>
         default_rollover_used: <unexpected> but was <true>
                     retention: <unexpected> but was <{minimum_millis=0, maximum_millis=0, average_millis=0.0}>

  at __randomizedtesting.SeedInfo.seed([A2E9F58B9E81A215:2ABDCA51307DCFED]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:572)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

  Caused by: java.lang.AssertionError: Expected a map containing
                           eql: a map containing
                       available: <true>
                         enabled: <true>
                        features: a map containing
                             joins: a map containing
                  join_queries_three: <0>
                    join_queries_two: <0>
                          join_until: <0>
           join_queries_five_or_more: <0>
                   join_queries_four: <0>
                          sequence: <4>
                              keys: a map containing
                       join_keys_two: <0>
                       join_keys_one: <3>
                     join_keys_three: <0>
              join_keys_five_or_more: <0>
                      join_keys_four: <0>
                              join: <0>
                         sequences: a map containing
              sequence_queries_three: <1>
               sequence_queries_four: <0>
                sequence_queries_two: <3>
                      sequence_until: <0>
                    sequence_maxspan: <2>
       sequence_queries_five_or_more: <0>
                             event: <8>
                             pipes: a map containing
                           pipe_tail: <9>
                           pipe_head: <0>
                         queries: a map containing
                               all: a map containing
                               total: <12>
                              failed: <0>
                              _all: a map containing
                               total: <12>
                              failed: <0>
                frozen_indices: a map containing
                   indices_count: <0>
                       available: <true>
                         enabled: <true>
                           sql: a map containing
                        features: a map containing
                            having: <1>
                         subselect: <0>
                             limit: <1>
                           orderby: <7>
                             where: <3>
                              join: <0>
                           groupby: <1>
                           command: <0>
                             local: <0>
                       available: <true>
                         queries: a map containing
                              rest: a map containing
                               total: <10>
                              paging: <1>
                              failed: <0>
                               cli: a map containing
                               total: <0>
                              paging: <0>
                              failed: <0>
                            canvas: a map containing
                               total: <0>
                              paging: <0>
                              failed: <0>
                              odbc: a map containing
                               total: <0>
                              paging: <0>
                              failed: <0>
                              jdbc: a map containing
                               total: <0>
                              paging: <0>
                              failed: <0>
                            odbc32: a map containing
                               total: <0>
                              paging: <0>
                              failed: <0>
                            odbc64: a map containing
                               total: <0>
                              paging: <0>
                              failed: <0>
                              _all: a map containing
                               total: <10>
                              paging: <1>
                              failed: <0>
                         translate: a map containing
                               count: <1>
                         enabled: <true>
                        rollup: a map containing
                       available: <true>
                         enabled: <true>
          searchable_snapshots: a map containing
      shared_cache_indices_count: <0>
                   indices_count: <0>
                       available: <true>
         full_copy_indices_count: <0>
                         enabled: <true>
                     analytics: a map containing
                           stats: a map containing
                        rate_usage: <2>
                   normalize_usage: <0>
                     boxplot_usage: <3>
                 top_metrics_usage: <4>
                 multi_terms_usage: <1>
      cumulative_cardinality_usage: <0>
                string_stats_usage: <1>
          moving_percentiles_usage: <0>
                      t_test_usage: <1>
                       available: <true>
                         enabled: <true>
                      logstash: a map containing
                       available: <true>
                         enabled: <true>
                      security: a map containing
                       available: <true>
                         enabled: <false>
                     transform: a map containing
                       available: <true>
                         enabled: <true>
                           ccr: a map containing
      auto_follow_patterns_count: <0>
                       available: <true>
          follower_indices_count: <0>
                         enabled: <true>
                    health_api: a map containing
                       available: <true>
                         enabled: <true>
                        statuses: a map containing
                             green: <5>
                            values: a list containing
                                   0: ""green""
                     invocations: a map containing
                             total: <5>
                      verbose_true: <5>
                       spatial: a map containing
                       available: <true>
                         enabled: <true>
                            ml: a map containing
                       inference: a map containing
                       deployments: a map containing
                             time_ms: a map containing
                                   avg: <0.0>
                               count: <0>
                   model_sizes_bytes: a map containing
                                 total: <0.0>
                                   min: <0.0>
                                   avg: <0.0>
                                   max: <0.0>
                    inference_counts: a map containing
                                 total: <0.0>
                                   min: <0.0>
                                   avg: <0.0>
                                   max: <0.0>
                    trained_models: a map containing
                    model_size_bytes: a map containing
                                 total: <0.0>
                                   min: <0.0>
                                   avg: <0.0>
                                   max: <0.0>
                estimated_operations: a map containing
                                 total: <0.0>
                                   min: <0.0>
                                   avg: <0.0>
                                   max: <0.0>
                               count: a map containing
                                 total: <1>
                           prepackaged: <1>
                                 other: <0>
                                _all: a map containing
                                 count: <1>
                 ingest_processors: a map containing
                                _all: a map containing
                             pipelines: a map containing
                                   count: <0>
                               time_ms: a map containing
                                     min: <0>
                                     max: <0>
                                     sum: <0>
                    num_docs_processed: a map containing
                                     min: <0>
                                     max: <0>
                                     sum: <0>
                          num_failures: a map containing
                                     min: <0>
                                     max: <0>
                                     sum: <0>
       data_frame_analytics_jobs: a map containing
                      memory_usage: a map containing
                    peak_usage_bytes: a map containing
                                 total: <0.0>
                                   min: <0.0>
                                   avg: <0.0>
                                   max: <0.0>
                              _all: a map containing
                               count: <0>
                   analysis_counts: an empty map
                            jobs: a map containing
                              _all: a map containing
                               count: <0>
                           detectors: a map containing
                                 total: <0.0>
                                   min: <0.0>
                                   avg: <0.0>
                                   max: <0.0>
                          created_by: an empty map
                          model_size: a map containing
                                 total: <0.0>
                                   min: <0.0>
                                   avg: <0.0>
                                   max: <0.0>
                           forecasts: a map containing
                                 total: <0>
                       forecasted_jobs: <0>
                       available: <true>
                       datafeeds: a map containing
                              _all: a map containing
                               count: <0>
                      node_count: <1>
                         enabled: <true>
                       watcher: a map containing
                       execution: a map containing
                           actions: a map containing
                                _all: a map containing
                                 total: <0>
                      total_time_in_ms: <0>
                           watch: a map containing
                             input: a map containing
                                _all: a map containing
                                 total: <0>
                                active: <0>
                           trigger: a map containing
                                _all: a map containing
                              ...
```",gmarouli,closed,"['>test-failure', 'Team:Data Management']",https://github.com/elastic/elasticsearch/issues/96471,2023-06-01T06:59:49Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96471,"{
  ""application_resource"": ""no""
}"
266,96465,search.allow_expensive_queries + wildcard application privs can fail authorization,"### Elasticsearch Version

Tested against 8.6.0

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Ubuntu

### Problem Description

When `search.allow_expensive_queries` is set to `false` some queries may fail since they are considered expensive. Typically there is an obvious connection between the action you are performing and any errors raised due to expensive queries. For example, if you explicitly issue a [prefix query](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html) and  `search.allow_expensive_queries` is set to `false` there is a natural correlation between your request and the error. 

It has been found that when the following conditions are met 

* The API key or role has application level privileges
* One of the application level privileges has a trailing wildcard in the application name (i.e. `myapp*`) 
* The API key or role  is not cached 

then authentication will fail due to an error [1] related to the expensive query. This because internally the code issues a prefix query to for the application name. The end result is the API key can longer be used for authentication for any action. 

Workaround include : 
* set `search.allow_expensive_queries` is set to `true`
* remove the `*` from the application privilege name

It is also possible to set  `search.allow_expensive_queries` to  `true` make a call with the API key or user with the role so that it gets cached, then set `search.allow_expensive_queries` back to `false` . That will cause the API key or role to be cached, and it will work after that, but it can also start to fail again at what would seem a random time if ever evicted from the cache or the node gets restarted. For this reason, that work around is not suggested. 

[1] Example exception. Note - other similar exceptions can occur but they all reference `search.allow_expensive_queries` and the `.security-*` index 
```
Caused by: [.security-7/9mbNjDCNRzSzrDtj2YEeKQ] org.elasticsearch.index.query.QueryShardException: failed to create query: [prefix] queries cannot be executed when 'search.allow_expensive_queries' is set to false. For optimised prefix queries on text fields please enable [index_prefixes].
	at org.elasticsearch.index.query.SearchExecutionContext.toQuery(SearchExecutionContext.java:548)
	at org.elasticsearch.index.query.SearchExecutionContext.toQuery(SearchExecutionContext.java:531)
	at org.elasticsearch.search.SearchService.parseSource(SearchService.java:1174)
	at org.elasticsearch.search.SearchService.createContext(SearchService.java:986)
	at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:630)
	at org.elasticsearch.search.SearchService.lambda$executeQueryPhase$2(SearchService.java:495)
	at org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:50)
	at org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:47)
	at org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:72)
	at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:917)
	at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.lang.Thread.run(Thread.java:1589)
```

### Steps to Reproduce

```
PUT _cluster/settings
{
    ""persistent"": {
        ""search.allow_expensive_queries"": ""false""
    }
}

POST _security/api_key
{
  ""name"": ""my_api_key"",
  ""role_descriptors"": {
    ""role1"": {
      ""cluster"": [""all""],
      ""indices"": [
        {
          ""names"": [""test""],
          ""privileges"": [""write""]
        }
      ],
      ""applications"": [
        {
          ""application"": ""app*"",
          ""privileges"": [""read"", ""write""],
          ""resources"": [""*""]
        }
      ]
    }
  },
  ""expiration"": ""1d""
}

using API key just created...

POST _bulk 
{ ""index"" : { ""_index"" : ""test"", ""_id"" : ""4"" } }
{ ""field1"" : ""value1"" }

```

EDIT: Updated text to suggest this can happen with an API key or a custom role",jakelandis,closed,"['>bug', ':Security/Authentication', 'Team:Security']",https://github.com/elastic/elasticsearch/issues/96465,2023-05-31T17:45:10Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96465,"{
  ""application_resource"": ""yes""
}"
267,96370,Leverage accelerated vector hardware instructions in Vector Search,"The upcoming Lucene 9.7.0 release has support for SIMD vectorized implementations of the low-level primitives used by Vector Search. The vectorized implementations use the currently Incubating Panama Vector API, see https://github.com/apache/lucene/pull/12311 https://github.com/apache/lucene/pull/12327. The Lucene changelog notes say it all [1] 

We should evaluate the impact of enabling this in Elasticsearch. Specifically,

 - [x] Refactor similar usages in Elasticsearch to use the Lucene VectorUtil functions - since they are much faster, e.g. `DenseVectorFieldMapper.java` can use `VectorUtil::dotProduct` (rather than its own slower scalar implementation). [96617](https://github.com/elastic/elasticsearch/pull/96617)
 
 - [x] Merge Lucene 9.7.0 *without* enabling the new Panamaized vectorized implementations. We want to validate and baseline the upgrade to 9.7.0 independently of this change. Allow, say 24+ hours, to get at least one nightly benchmark run.
   - [x] Upgrade to 9.7.0 snapshot
   - [x] Evaluate nightly benchmarks
  
- [x] Add `--add-modules jdk.incubator.vector` to the Elasticsearch startup - this will enable the faster Lucene VectorUtil implementation. https://github.com/elastic/elasticsearch/blob/main/distribution/tools/server-cli/src/main/java/org/elasticsearch/server/cli/ServerProcess.java#L222. This will raise a warning at startup, document that this is ok (similar to the security manager warning - yes, we know, it is ok! )
  - [x] conditionally add the module, only for JDK 20+ #96453
  - [x] check JVM flags, see later comment, test environments, etc
  - [x] check log output contains the expected Vector bit width https://github.com/elastic/elasticsearch/pull/96453#issuecomment-1572245662

[1] GITHUB#12302, GITHUB#12311: Add vectorized implementations of VectorUtil.dotProduct(), squareDistance(), cosine() with Java 20 jdk.incubator.vector APIs. Applications started with command line parameter ""java --add-modules jdk.incubator.vector"" on exactly Java 20 will automatically use the new vectorized implementations if running on a supported platform (x86 AVX2 or later, ARM SVE or later). This is an opt-in feature and requires explicit Java command line flag! When enabled, Lucene logs a notice using java.util.logging. Please test  thoroughly and report bugs/slowness to Lucene's mailing list.
   


",ChrisHegarty,closed,"['>feature', 'release highlight', ':Search/Search', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/96370,2023-05-26T08:14:56Z,12,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96370,"{
  ""application_resource"": ""yes""
}"
268,96116,The GeoIpCache has suboptimal performance on cache hits,"The `geoip` processor is one of our more costly ones (see [comment](https://github.com/elastic/elasticsearch/issues/96116#issuecomment-1548644191)), and a common pattern is to have several of them in a pipeline (e.g. a location and asn geoip processor for both a source and destination ip address, so that'd be four processors).

We have a cache around the actual geoip database lookup, but even in the case of a cache hit, it's still relatively expensive.

**First**, the cache is roughly an `InetAddress` --> `Response` map. However, we receive ip addresses as strings -- if the cache used `String` keys we could avoid even converting the String to an `InetAddress`.


**Second**, the cached values are not small, here these `CityResponse` objects are ~7kb a piece:

![Screen Shot 2023-05-15 at 5 37 29 PM](https://github.com/elastic/elasticsearch/assets/187034/dfd8bd61-bcac-45e5-87dc-a7db667aaf2a)

If we cached a more compact 'destination' object (e.g. a `Map<String, Object>`), we could expand the size (in objects) of the cache while not increasing the memory footprint (in bytes) -- that is, for a given bytes-size of cache we could have more records cached.

**Third**, the cached values are not optimized for cache-y usage. Consider for example this code snippet:

https://github.com/elastic/elasticsearch/blob/e81f461aa17b7bfa43ea58d851849fd5604f2e21/modules/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/GeoIpProcessor.java#L231

and then see the implementation of `getName` itself:

https://github.com/maxmind/GeoIP2-java/blob/a64bd49181c9c362d883477d910c165aec6f6116/src/main/java/com/maxmind/geoip2/record/AbstractNamedRecord.java#L43-L51

Each time we process a cache hit, we call several methods that end up invoking a `getName()` and those end up doing a map scan to find a result `String`, but the returned `String` would be the same each time -- rather than caching a `Response` and building an object from it N times, we could build such an object once and just use it as the cached value.

----

That is, we're paying a price to build the cache key (`String` to `InetAddress` conversion), and we're paying both a memory and cpu price for using the `Response` as the cache value.
",joegallo,closed,"['>enhancement', ':Data Management/Ingest Node', 'Team:Data Management']",https://github.com/elastic/elasticsearch/issues/96116,2023-05-15T21:48:49Z,13,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96116,"{
  ""application_resource"": ""yes""
}"
269,96089,`os.cgroup.cpuacct.usage_nanos` is actually microseconds when Elasticsearch is ran inside cgroup v2,"### Elasticsearch Version

master

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

5.15.0-1036-azure

### Problem Description

When Elasticsearch is ran inside a cgroup v2, the node stats output for `""https://elasticsearch:9200/_nodes/stats?filter_path=nodes.*.os.cgroup.cpuacct.usage_nanos""` is actually in microseconds, cgroup v1 correctly reports these in the nanosecond unit:
https://github.com/elastic/elasticsearch/blob/f01f07f8c65169bf5afb6146af515e2c9c676d60/server/src/main/java/org/elasticsearch/monitor/os/OsProbe.java#L695

We collect these stats in [Rally's node-stats telemetry device](https://esrally.readthedocs.io/en/stable/telemetry.html#node-stats) and it became clear that formula we use to derive CPU usage out of the available time is off by a factor of 1000 (i.e. the difference between nanoseconds and microseconds) for any container running inside a cgroup v2.

The below screenshots show the difference between cgroup v1 running on Google Kuberentes Engine (GKE), and cgroup v2 running on Azure Kubernetes Service (AKS):
![image](https://github.com/elastic/elasticsearch/assets/54515790/41814e0e-e7ef-45be-8289-4b8dde46d410)
![image](https://github.com/elastic/elasticsearch/assets/54515790/1b119a1d-6473-4854-91ad-0657926fe413)

GKE output (cgroup v1)
```shell
$ uname -a
Linux es-es-search-7b66d98c5b-fs28n 5.15.89+ #1 SMP Sat Mar 18 09:27:02 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux

$ mount -l | grep cgroup
tmpfs on /sys/fs/cgroup type tmpfs (rw,nosuid,nodev,noexec,relatime,mode=755)
cgroup on /sys/fs/cgroup/systemd type cgroup (ro,nosuid,nodev,noexec,relatime,xattr,name=systemd)
cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (ro,nosuid,nodev,noexec,relatime,net_cls,net_prio)
cgroup on /sys/fs/cgroup/pids type cgroup (ro,nosuid,nodev,noexec,relatime,pids)
cgroup on /sys/fs/cgroup/blkio type cgroup (ro,nosuid,nodev,noexec,relatime,blkio)
cgroup on /sys/fs/cgroup/freezer type cgroup (ro,nosuid,nodev,noexec,relatime,freezer)
cgroup on /sys/fs/cgroup/cpuset type cgroup (ro,nosuid,nodev,noexec,relatime,cpuset)
cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (ro,nosuid,nodev,noexec,relatime,cpu,cpuacct)
cgroup on /sys/fs/cgroup/perf_event type cgroup (ro,nosuid,nodev,noexec,relatime,perf_event)
cgroup on /sys/fs/cgroup/rdma type cgroup (ro,nosuid,nodev,noexec,relatime,rdma)
cgroup on /sys/fs/cgroup/hugetlb type cgroup (ro,nosuid,nodev,noexec,relatime,hugetlb)
cgroup on /sys/fs/cgroup/devices type cgroup (ro,nosuid,nodev,noexec,relatime,devices)
cgroup on /sys/fs/cgroup/memory type cgroup (ro,nosuid,nodev,noexec,relatime,memory)

# nanoseconds
$ cat /sys/fs/cgroup/cpu,cpuacct/cpuacct.usage
63277158346752 
```

AKS output (cgroup v2):
```shell
$ uname -a
Linux es-es-index-6f49648d8-jhm9s 5.15.0-1036-azure #43-Ubuntu SMP Wed Mar 29 16:11:05 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux

$ mount -l | grep cgroup
cgroup on /sys/fs/cgroup type cgroup2 (ro,nosuid,nodev,noexec,relatime)

# microseconds
$ cat /sys/fs/cgroup/cpu.stat
usage_usec 104036485036
user_usec 98419994704
system_usec 5616490332
nr_periods 164357
nr_throttled 143842
throttled_usec 9516539086
```

### Steps to Reproduce

I encountered the bug when running a cluster inside an Azure Kubernetes Service (AKS) cluster, but that's not exactly practical for reproductions. 

We can repro this [using ECK](https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-quickstart.html) and [Minikube with the Docker driver](https://minikube.sigs.k8s.io/docs/) on macOs.

Note that for [Linux users Minikube automatically detects whether or not cgroup v1 or v2 is in use by your workstation](https://github.com/kubernetes/minikube/blob/0477c8160dbbbb53d9f4e02d197b0f2e2a6fcac1/pkg/minikube/detect/detect.go#L190-L205) (i.e. where you invoke `minikube start` from), whereas for Docker Desktop users on macOS (which actually creates a Linux VM in the background) we need to adjust the cgroup version via modifying the engine's settings (more on this below).

Testing with cgroup v2:
```shell
# minikube > 1.23 defaults to cgroup v2
$ minikube version
minikube version: v1.26.1
commit: 62e108c3dfdec8029a890ad6d8ef96b6461426dc

# start minikube
$ minikube start

# create eck operator
$ minikube kubectl -- create -f https://download.elastic.co/downloads/eck/2.7.0/crds.yaml
$ minikube kubectl -- apply -f https://download.elastic.co/downloads/eck/2.7.0/operator.yaml
$ minikube kubectl -- -n elastic-system logs -f statefulset.apps/elastic-operator

# deploy elasticsearch
$ cat <<EOF | minikube kubectl -- apply -f -
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: quickstart
spec:
  version: 8.7.1
  nodeSets:
  - name: default
    count: 1
    config:
      node.store.allow_mmap: false
EOF

# check that es is using cgroup v2
$ minukube kubectl -- -n elastic-system exec -it local-es-default-0 -- /bin/sh

# inside es pod/container
sh-5.0$ mount -l | grep cgroup
cgroup on /sys/fs/cgroup type cgroup2 (ro,nosuid,nodev,noexec,relatime)

# get pass
$ PASSWORD=$(minikube kubectl -- get secret quickstart-es-elastic-user -o go-template='{{.data.elastic | base64decode}}')
# make service avail 
$ minikube kubectl -- port-forward service/quickstart-es-http 9200
# check output
$ curl -s -u ""elastic:$PASSWORD"" -k ""https://localhost:9200/_nodes/stats?filter_path=nodes.*.os.cgroup.cpuacct.usage_nanos"" | jq .
{
  ""nodes"": {
    ""WA7ANuASRiGF7xgO3dYp_w"": {
      ""os"": {
        ""cgroup"": {
          ""cpuacct"": {
            ""usage_nanos"": 107115513
          }
        }
      }
    }
  }
}
```


I'm on macOS Monterey 12.6 using [the `docker` driver for `minikube` ](https://minikube.sigs.k8s.io/docs/drivers/docker/), which is actually a Linux VM running behind the scenes. In order to force it to use cgroup v2 I had to configure ` ""deprecatedCgroupv1"": true,` in `$HOME/Library/Group\ Containers/group.com.docker/settings.json` and then restart  `Docker Desktop` before following these steps:
```shell
$ minukube kubectl -- -n elastic-system exec -it local-es-default-0 -- /bin/sh

# inside es pod/container
sh-5.0$ mount -l | grep cgroup
tmpfs on /sys/fs/cgroup type tmpfs (rw,nosuid,nodev,noexec,relatime,mode=755)
cgroup on /sys/fs/cgroup/cpuset type cgroup (ro,nosuid,nodev,noexec,relatime,cpuset)
cgroup on /sys/fs/cgroup/cpu type cgroup (ro,nosuid,nodev,noexec,relatime,cpu)
cgroup on /sys/fs/cgroup/cpuacct type cgroup (ro,nosuid,nodev,noexec,relatime,cpuacct)
cgroup on /sys/fs/cgroup/blkio type cgroup (ro,nosuid,nodev,noexec,relatime,blkio)
cgroup on /sys/fs/cgroup/memory type cgroup (ro,nosuid,nodev,noexec,relatime,memory)
cgroup on /sys/fs/cgroup/devices type cgroup (ro,nosuid,nodev,noexec,relatime,devices)
cgroup on /sys/fs/cgroup/freezer type cgroup (ro,nosuid,nodev,noexec,relatime,freezer)
cgroup on /sys/fs/cgroup/net_cls type cgroup (ro,nosuid,nodev,noexec,relatime,net_cls)
cgroup on /sys/fs/cgroup/perf_event type cgroup (ro,nosuid,nodev,noexec,relatime,perf_event)
cgroup on /sys/fs/cgroup/net_prio type cgroup (ro,nosuid,nodev,noexec,relatime,net_prio)
cgroup on /sys/fs/cgroup/hugetlb type cgroup (ro,nosuid,nodev,noexec,relatime,hugetlb)
cgroup on /sys/fs/cgroup/pids type cgroup (ro,nosuid,nodev,noexec,relatime,pids)
cgroup on /sys/fs/cgroup/rdma type cgroup (ro,nosuid,nodev,noexec,relatime,rdma)
systemd on /sys/fs/cgroup/systemd type cgroup (ro,nosuid,nodev,noexec,relatime,name=systemd)

# get pass
$ PASSWORD=$(minikube kubectl -- get secret quickstart-es-elastic-user -o go-template='{{.data.elastic | base64decode}}')
# make service avail 
$ minikube kubectl -- port-forward service/quickstart-es-http 9200
# check output
$ curl -s -u ""elastic:$PASSWORD"" -k ""https://localhost:9200/_nodes/stats?filter_path=nodes.*.os.cgroup.cpuacct.usage_nanos"" | jq .
{
  ""nodes"": {
    ""WA7ANuASRiGF7xgO3dYp_w"": {
      ""os"": {
        ""cgroup"": {
          ""cpuacct"": {
            ""usage_nanos"": 35975828297
          }
        }
      }
    }
  }
}
```

### Logs (if relevant)

_No response_",b-deam,closed,"['>bug', ':Core/Infra/Core', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/96089,2023-05-15T07:13:31Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96089,"{
  ""application_resource"": ""yes""
}"
270,96050,The EnrichCache has suboptimal performance on cache hits,"Here's a snippet from `GET _nodes/stats` for a simple example on my machine:

```
             {
                ""enrich"" : {
                  ""type"" : ""enrich"",
                  ""stats"" : {
                    ""count"" : 653312,
                    ""time"" : ""29s"",
                    ""time_in_millis"" : 29004,
                    ""current"" : 0,
                    ""failed"" : 0
                  }
                }
              },
```

That `enrich` processor is costing us 44 microseconds per document. But the dataset in question is actually super cache-able:

```
  ""cache_stats"" : [
    {
      ""node_id"" : ""uLluSH_HT8SthV3I9LQPrQ"",
      ""count"" : 100,
      ""hits"" : 652965,
      ""misses"" : 347,
      ""evictions"" : 0
    }
  ]
```

44 microseconds per document is way too high a performance price to paying for cache hits. **So why's it so slow?**

https://github.com/elastic/elasticsearch/blob/92ac03fcc5cdcf4ca611f34f96f21e048a378397/x-pack/plugin/enrich/src/main/java/org/elasticsearch/xpack/enrich/EnrichCache.java#L129-L151

We use the above class for the cache keys for potentially avoiding execution of `SearchRequest`s (no need to execute a `SearchRequest` if we already know what it will return). But it's not really a great class for that.

First, `SearchRequest` is mutable. We don't **happen** to mutate it, but still, it would be better if we were using a properly immutable class in the key.

Second, `SearchRequest` isn't some trivial class, there's a deep object tree there, and so `hashCode` and `equals` actually has quite a bit of work to do (see the definition of `hashCode`/`equals` for `SearchRequest` then click through to `source` which is a `SearchSourceBuilder` and scope out its `hashCode`/`equals`, then rinse and repeat, also note that all those `Objects.equals` calls are an array allocation unless something JIT'ed it out).

![Screen Shot 2023-05-11 at 4 55 47 PM](https://github.com/elastic/elasticsearch/assets/187034/ed8631d1-eeac-426a-b6a9-95bd76e0a150)

Doubly-worse, our caching implementation must execute `hashCode` twice -- once to find the right underlying `HashMap` to talk to (arguably we control this, it's called via`getCacheSegment`), and then a second time within the implementation of `HashMap` itself (we don't control this).

![Screen Shot 2023-05-11 at 4 44 20 PM](https://github.com/elastic/elasticsearch/assets/187034/15065bf5-3f07-4308-ae98-27a72edbb2f9)

So, even with a better key, it would still probably be worth it to pre-calculate the `hashCode` eagerly at construction time and then just return it repeatedly, like how `Snapshot` already does the same:

https://github.com/elastic/elasticsearch/blob/92ac03fcc5cdcf4ca611f34f96f21e048a378397/server/src/main/java/org/elasticsearch/snapshots/Snapshot.java#L76-L83

Meta: I went with `>enhancement` for this, but it's pretty close to `>bug` territory in my mind.",joegallo,closed,"['>enhancement', ':Data Management/Ingest Node', 'Team:Data Management']",https://github.com/elastic/elasticsearch/issues/96050,2023-05-11T21:05:27Z,4,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/96050,"{
  ""application_resource"": ""yes""
}"
271,95944,[CI] MixedClusterClientYamlTestSuiteIT test {p0=indices.stats/13_fields/Fields - blank} failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/llukhgof4sicw/tests/:qa:mixed-cluster:v7.17.11%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=indices.stats%2F13_fields%2FFields%20-%20blank%7D

**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v7.17.11#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=indices.stats/13_fields/Fields - blank}"" -Dtests.seed=3E8171C1F1B2915C -Dtests.bwc=true -Dtests.locale=ro -Dtests.timezone=Asia/Ujung_Pandang -Druntime.java=17
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT&tests.test=test%20%7Bp0%3Dindices.stats/13_fields/Fields%20-%20blank%7D

**Failure excerpt:**
```
java.lang.AssertionError: Failure at [indices.stats/13_fields:82]: field [_all.total.fielddata.memory_size_in_bytes] is not greater than [0]
Expected: a value greater than <0>
     but: <0> was equal to <0>

  at __randomizedtesting.SeedInfo.seed([3E8171C1F1B2915C:B6D54E1B5F4EFCA4]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:572)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
  at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(NativeMethodAccessorImpl.java:-2)
  at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
  at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
  at java.lang.reflect.Method.invoke(Method.java:568)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:833)

  Caused by: java.lang.AssertionError: field [_all.total.fielddata.memory_size_in_bytes] is not greater than [0]
  Expected: a value greater than <0>
       but: <0> was equal to <0>

    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
    at org.junit.Assert.assertThat(Assert.java:956)
    at org.elasticsearch.test.rest.yaml.section.GreaterThanAssertion.doAssert(GreaterThanAssertion.java:64)
    at org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:65)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:552)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
    at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(NativeMethodAccessorImpl.java:-2)
    at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
    at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:568)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:833)

```",bpintea,closed,"['>test-failure', 'low-risk', 'Team:Search Foundations', ':Search Foundations/Search']",https://github.com/elastic/elasticsearch/issues/95944,2023-05-09T12:09:00Z,15,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95944,"{
  ""application_resource"": ""yes""
}"
272,95925,Terms aggs: Sort by avg sub aggregation support,"### Description

## Summary

In Infrastructure Observability, we would like to provide on the [hosts view page](https://edge-lite-oblt.kb.us-west2.gcp.elastic-cloud.com/app/metrics/hosts) the capability of showing the Top X hosts sorted by a metric field, to help surface possible problems to users in their infra.


```json
GET metricbeat-*,metrics-*/_search
{
  ""size"": 0,
  ""query"": {
    ""bool"": {
      ""filter"": [
        {
          ""range"": {
            ""@timestamp"": {
              ""gte"": ""now-15m"",
              ""lte"": ""now""
            }
          }
        }
      ]
    }
  },
  ""runtime_mappings"": {
    ""rx_bytes_per_period"": {
      ""type"": ""double"",
      ""script"": ""emit((doc['host.network.ingress.bytes'].value/(doc['metricset.period'].value / 1000)));""""""
    },
    ""tx_bytes_per_period"": {
      ""type"": ""double"",
      ""script"": ""emit((doc['host.network.egress.bytes'].value/(doc['metricset.period'].value / 1000)))""
    },
    ""disk_latency"": {
      ""type"": ""double"",
      ""script"": ""emit((doc['system.diskio.write.time'].value + doc['system.diskio.read.time'].value) / ((doc['system.diskio.read.count'].value + doc['system.diskio.write.count'].value)));""
    },
    ""cpu_usage"": {
      ""type"": ""double"",
      ""script"": ""emit((doc['system.cpu.user.pct'].value + doc['system.cpu.system.pct'].value) / (doc['system.cpu.cores'].value));""
    }
  },
  ""aggs"": {
    ""grouping"": {
      ""terms"": {
        ""field"": ""host.name"",
        ""order"": {
          ""rx>value"": ""desc""
        },
        ""size"": 10,
        ""min_doc_count"": 1
      },
      ""aggs"": {
        ""diskLatency"": {
          ""filter"": {
            ""bool"": {
              ""must"": [
                {
                  ""exists"": {
                    ""field"": ""system.diskio.read.time""
                  }
                },
                {
                  ""exists"": {
                    ""field"": ""system.diskio.write.time""
                  }
                },
                {
                  ""exists"": {
                    ""field"": ""system.diskio.read.count""
                  }
                },
                {
                  ""exists"": {
                    ""field"": ""system.diskio.write.count""
                  }
                }
              ]
            }
          },
          ""aggs"": {
            ""value"": {
              ""min"": {
                ""field"": ""disk_latency""
              }
            }
          }
        },
        ""cpuUsage"": {
          ""filter"": {
            ""bool"": {
              ""must"": [
                {
                  ""exists"": {
                    ""field"": ""system.cpu.user.pct""
                  }
                },
                {
                  ""exists"": {
                    ""field"": ""system.cpu.system.pct""
                  }
                },
                {
                  ""exists"": {
                    ""field"": ""system.cpu.cores""
                  }
                }
              ]
            }
          },
          ""aggs"": {
            ""cc"": {
              ""avg"": {
                ""field"": ""cpu_usage"",
                ""missing"": 0
              }
            }
          }
        },
        ""rx"": {
          ""filter"": {
            ""exists"": {
              ""field"": ""host.network.ingress.bytes""
            }
          },
          ""aggs"": {
            ""value"": {
              ""avg"": {
                ""field"": ""rx_bytes_per_period"",
                ""missing"": 0
              }
            }
          }
        },
        ""tx"": {
          ""filter"": {
            ""exists"": {
              ""field"": ""host.network.egress.bytes""
            }
          },
          ""aggs"": {
            ""value"": {
              ""avg"": {
                ""field"": ""tx_bytes_per_period"",
                ""missing"": 0
              }
            }
          }
        },
        ""memoryTotal"": {
          ""filter"": {
            ""exists"": {
              ""field"": ""system.memory.total""
            }
          },
          ""aggs"": {
            ""value"": {
              ""avg"": {
                ""field"": ""system.memory.total""
              }
            }
          }
        },
        ""memory"": {
          ""avg"": {
            ""field"": ""system.memory.actual.used.pct""
          }
        }
      }
    }
  }
}
```

However, the [documentation](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html#_ordering_by_a_sub_aggregation) says that sorting by sub-aggregations usually produces wrong results and it only works in 2 situations: sort by `max` `desc` and `min` `asc`. 

An alternative would be to use `composite` aggregation instead to fetch all hosts + metrics and sort on the client side, but when considering enterprise datasets, where thousand of hosts can be found, ordering on the client side has proven to be problematic because it can take too much time.

I'm not sure if it's feasible, but what I'd like to propose is that Elasticsearch also supports sorting by `avg` besides `min` and `max` in terms aggs.

**Side note:** Possibly because it's not supported, another thing that can happen when sorting by `avg` is what's been described [here](https://github.com/elastic/elasticsearch/issues/95239), where null buckets are ranked higher than buckets with values when sorting by `avg` `desc` (missing value doesn't really work, because it influences the avg result, producing wrong results)

",crespocarlos,closed,"['>enhancement', ':Analytics/Aggregations', 'Team:Analytics']",https://github.com/elastic/elasticsearch/issues/95925,2023-05-08T21:28:47Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95925,"{
  ""application_resource"": ""no""
}"
273,95903,Fork tdigest library,"We plan to for the [tdigest library](https://github.com/tdunning/t-digest).

There are two main reasons behind this choice:
1. We would like to control semantic version and backward compatibility according to our definition. Right now, for instance, TDigest does not match our usage of semantic versioning when changing the library code and that makes upgrading quite challenging because exposes us to backward compatibility issues.
2. We would like to change those libraries to use some specific Elasticsearch libraries/tools/frameworks such as BigArrays. Right now when running some aggregations (percentiles, boxplot,...) we experience OOMs due to large memory usage. Using BigArrays, for instance, would allow us to deal with OOMs using Circuit Breakers.

The immediate goal of this issue is to fork the library and then at a later stage enhance to forked library to make use of the big arrays infrastructure.

Currently t-digest version 3.2 is used. The current version is 3.3 We have been locked to the 3.2 version because of at least one breaking change (how p50 is computed). The plan is to fork from the latest commit and change the forked library such that the results it produces are similar to that of version 3.2.",martijnvg,closed,"[':Delivery/Build', ':Analytics/Aggregations', '>refactoring', 'Team:Analytics', 'Team:Delivery']",https://github.com/elastic/elasticsearch/issues/95903,2023-05-08T06:21:50Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95903,"{
  ""application_resource"": ""yes""
}"
274,95852,Can't start 8.8 ECK cluster,"### Elasticsearch Version

8.8

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Ubuntu 23.04

### Problem Description

ECK 8.8 gets stuck in:
```
$ k get es -w
NAME        HEALTH    NODES   VERSION   PHASE             AGE
my-cluster   unknown           8.8.0     ApplyingChanges   3m10s
```
Error in `kubectl describe`:
```
    Message:               Cannot get compute and storage resources from Elasticsearch resource generation 2: cannot compute resources for NodeSet ""master"": no CPU request or limit set
```

### Steps to Reproduce

`kubectl apply -f` the following manifest:
```
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: my-cluster
spec:
  version: 8.8.0
  auth:
    fileRealm:
      - secretName: elasticsearch-secret
  nodeSets:
    - name: master
      count: 3
      config:
        # most Elasticsearch configuration parameters are possible to set, e.g: node.attr.attr_name: attr_value
        #node.roles: [""master"", ""data"", ""ingest"", ""ml""]
        node.roles: [""master""]
        script.painless.regex.enabled: true
        http.cors.enabled: true
        http.cors.allow-origin: ""*""
        #network.host: _site_ Forbidden: Configuration setting is reserved for internal use
        #node.name: ${HOSTNAME} Forbidden: Configuration setting is reserved for internal use
        bootstrap.memory_lock: true
        #xpack.security.transport.ssl.enabled: true Forbidden: Configuration setting is reserved for internal use
      podTemplate:
        spec:
          containers:
            - name: elasticsearch
              readinessProbe:
                exec:
                  command:
                    - bash
                    - -c
                    - /mnt/elastic-internal/scripts/readiness-probe-script.sh
                failureThreshold: 3
                initialDelaySeconds: 10
                periodSeconds: 12
                successThreshold: 1
                timeoutSeconds: 12
              env:
                - name: READINESS_PROBE_TIMEOUT
                  value: ""10""
      volumeClaimTemplates:
        - metadata:
            name: elasticsearch-data
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 10Gi
            storageClassName: gp2
    - name: data
      count: 2
      config:
        # most Elasticsearch configuration parameters are possible to set, e.g: node.attr.attr_name: attr_value
        #node.roles: [""master"", ""data"", ""ingest"", ""ml""]
        node.roles: [""data""]
        script.painless.regex.enabled: true
        http.cors.enabled: true
        http.cors.allow-origin: ""*""
        #network.host: _site_ Forbidden: Configuration setting is reserved for internal use
        #node.name: ${HOSTNAME} Forbidden: Configuration setting is reserved for internal use
        bootstrap.memory_lock: true
        #xpack.security.transport.ssl.enabled: true Forbidden: Configuration setting is reserved for internal use
      podTemplate:
        spec:
          containers:
            - name: elasticsearch
              readinessProbe:
                exec:
                  command:
                    - bash
                    - -c
                    - /mnt/elastic-internal/scripts/readiness-probe-script.sh
                failureThreshold: 3
                initialDelaySeconds: 10
                periodSeconds: 12
                successThreshold: 1
                timeoutSeconds: 12
              env:
                - name: READINESS_PROBE_TIMEOUT
                  value: ""10""
      volumeClaimTemplates:
        - metadata:
            name: elasticsearch-data
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 20Gi
            storageClassName: gp2
```

### Logs (if relevant)

_No response_",khteh,closed,['>bug'],https://github.com/elastic/elasticsearch/issues/95852,2023-05-05T03:19:31Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95852,"{
  ""application_resource"": ""yes""
}"
275,95834,[CI] DocsClientYamlTestSuiteIT test {yaml=reference/rest-api/usage/line_38} failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/ag5dadzpht7um/tests/:docs:yamlRestTest/org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT/test%20%7Byaml=reference%2Frest-api%2Fusage%2Fline_38%7D

**Reproduction line:**
```
./gradlew ':docs:yamlRestTest' --tests ""org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT.test {yaml=reference/rest-api/usage/line_38}"" -Dtests.seed=81367605BBDDD23 -Dbuild.snapshot=false -Dtests.jvm.argline=""-Dbuild.snapshot=false"" -Dtests.locale=ko-KR -Dtests.timezone=Africa/Addis_Ababa -Druntime.java=20
```

**Applicable branches:**
8.8

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT&tests.test=test%20%7Byaml%3Dreference/rest-api/usage/line_38%7D

**Failure excerpt:**
```
java.lang.AssertionError: Failure at [reference/rest-api/usage:16]: Expected a map containing
                     watcher: a map containing
                     execution: a map containing
                         actions: a map containing
                              _all: a map containing
                               total: <0>
                    total_time_in_ms: <0>
                         watch: a map containing
                           input: a map containing
                              _all: a map containing
                               total: <0>
                              active: <0>
                         trigger: a map containing
                              _all: a map containing
                               total: <0>
                              active: <0>
                     available: <true>
                         count: a map containing
                           total: <0>
                          active: <0>
                       enabled: <true>
                         eql: a map containing
                     available: <true>
                       enabled: <true>
                      features: a map containing
                           joins: a map containing
                join_queries_three: <0>
                  join_queries_two: <0>
                        join_until: <0>
         join_queries_five_or_more: <0>
                 join_queries_four: <0>
                        sequence: <0>
                            keys: a map containing
                     join_keys_two: <0>
                     join_keys_one: <0>
                   join_keys_three: <0>
            join_keys_five_or_more: <0>
                    join_keys_four: <0>
                            join: <0>
                       sequences: a map containing
            sequence_queries_three: <0>
             sequence_queries_four: <0>
              sequence_queries_two: <0>
                    sequence_until: <0>
                  sequence_maxspan: <0>
     sequence_queries_five_or_more: <0>
                           event: <4>
                           pipes: a map containing
                         pipe_tail: <4>
                         pipe_head: <0>
                       queries: a map containing
                             all: a map containing
                             total: <4>
                            failed: <0>
                            _all: a map containing
                             total: <4>
                            failed: <0>
              frozen_indices: a map containing
                 indices_count: <0>
                     available: <true>
                       enabled: <true>
                     archive: a map containing
                 indices_count: <0>
                     available: <true>
                       enabled: <true>
                         ilm: a map containing
                  policy_count: <17>
                  policy_stats: a list containing
                               0: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               1: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""3d""
                            max_age_millis: <259200000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <345600000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               2: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               3: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                               4: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""forcemerge""
                                       1: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""3d""
                            max_age_millis: <259200000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <259200000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               5: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               6: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""300gb""
                            max_size_bytes: <322122547200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               7: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <31536000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               8: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""7d""
                            max_age_millis: <604800000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <604800000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               9: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""10gb""
              max_primary_shard_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              10: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <15552000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              11: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              12: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              13: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""7d""
                            max_age_millis: <604800000>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <604800000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              14: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <15552000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              15: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              16: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                  monitoring: a map containing
            collection_enabled: <false>
                     available: <true>
             enabled_exporters: a map containing
                           local: <1>
                       enabled: <true>
                       graph: a map containing
                     available: <true>
                       enabled: <true>
            aggregate_metric: a map containing
                     available: <true>
                       enabled: <true>
                         sql: a map containing
                      features: a map containing
                          having: <0>
                       subselect: <0>
                           limit: <0>
                         orderby: <2>
                           where: <0>
                            join: <0>
                         groupby: <0>
                         command: <0>
                           local: <0>
                     available: <true>
                       queries: a map containing
                            rest: a map containing
                             total: <3>
                            paging: <1>
                            failed: <0>
                             cli: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          canvas: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            odbc: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            jdbc: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          odbc32: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          odbc64: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            _all: a map containing
                             total: <3>
                            paging: <1>
                            failed: <0>
                       translate: a map containing
                             count: <0>
                       enabled: <true>
                      rollup: a map containing
                     available: <true>
                       enabled: <true>
                  data_tiers: a map containing
                     data_warm: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                   data_frozen: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                     data_cold: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                     available: <true>
                  data_content: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                       enabled: <true>
                      data_hot: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
        searchable_snapshots: a map containing
    shared_cache_indices_count: <0>
                 indices_count: <0>
                     available: <true>
       full_copy_indices_count: <0>
                       enabled: <true>
                   analytics: a map containing
                         stats: a map containing
                      rate_usage: <1>
                 normalize_usage: <0>
                   boxplot_usage: <0>
               top_metrics_usage: <0>
               multi_terms_usage: <0>
    cumulative_cardinality_usage: <0>
              string_stats_usage: <0>
        moving_percentiles_usage: <0>
                    t_test_usage: <0>
                     available: <true>
                       enabled: <true>
                    logstash: a map containing
                     available: <true>
                       enabled: <true>
                    security: a map containing
                     available: <true>
                       enabled: <false>
                   transform: a map containing
                     available: <true>
                       enabled: <true>
                         ccr: a map containing
    auto_follow_patterns_count: <0>
                     available: <true>
        follower_indices_count: <0>
                       enabled: <true>
                         slm: a map containing
                     available: <true>
                       enabled: <true>
                  policy_count: <0>
                  policy_stats: a map containing
                  retention_runs: <0>
                retention_failed: <0>
             retention_timed_out: <0>
         retention_deletion_time: ""0s""
  retention_deletion_time_millis: <0>
           total_snapshots_taken: <0>
          total_snapshots_failed: <0>
         total_snapshots_deleted: <0>
total_snapshot_deletion_failures: <0>
                    policy_stats: an empty list
                  health_api: a map containing
                     available: <true>
                       enabled: <true>
                   invocations: a map containing
                           total: <0>
                 voting_only: a map containing
                     available: <true>
                       enabled: <true>
                data_streams: a map containing
                 indices_count: <0>
                     available: <true>
                  data_streams: <0>
                       enabled: <true>
                     spatial: a map containing
                     available: <true>
                       enabled: <true>
                          ml: a map containing
             enterprise_search: expected a map but was <missing>
                     inference: a map containing
                     deployments: a map containing
                           time_ms: a map containing
                                 avg: <0.0>
                             count: <0>
                 model_sizes_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                  inference_counts: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                  trained_models: a map containing
                  model_size_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
              estimated_operations: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                             count: a map containing
                               total: <1>
                         prepackaged: <1>
                               other: <0>
                              _all: a map containing
                               count: <1>
               ingest_processors: a map containing
                              _all: a map containing
                           pipelines: a map containing
                                 count: <0>
                             time_ms: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
                  num_docs_processed: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
                        num_failures: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
     data_frame_analytics_jobs: a map containing
                    memory_usage: a map containing
                  peak_usage_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                            _all: a map containing
                             count: <0>
                 analysis_counts: an empty map
                          jobs: a map containing
                            _all: a map containing
                             count: <0>
                         detectors: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                        created_by: an empty map
                        model_size: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                         forecasts: a map containing
                               total: <0>
                     forecasted_jobs: <0>
                     available: <true>
                     datafeeds: a map containing
                            _all: a map containing
                             count: <0>
                    node_count: <1>
                       enabled: <true>
           enterprise_search: <unexpected> but was <{available=true, enabled=true, search_applications={count=0}}>

  at __randomizedtesting.SeedInfo.seed([81367605BBDDD23:804758BAF541B0DB]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:572)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

  Caused by: java.lang.AssertionError: Expected a map containing
                       watcher: a map containing
                       execution: a map containing
                           actions: a map containing
                                _all: a map containing
                                 total: <0>
                      total_time_in_ms: <0>
                           watch: a map containing
                             input: a map containing
                                _all: a map containing
                                 total: <0>
                                active: <0>
                           trigger: a map containing
                                _all: a map containing
                                 total: <0>
                                active: <0>
                       available: <true>
                           count: a map containing
                             total: <0>
                            active: <0>
                         enabled: <true>
                           eql: a map containing
                       available: <true>
                         enabled: <true>
                        features: a map containing
                             joins: a map containing
                  join_queries_three: <0>
                    join_queries_two: <0>
                          join_until: <0>
           join_queries_five_or_more: <0>
                   join_queries_four: <0>
                          sequence: <0>
                              keys: a map containing
                       join_keys_two: <0>
                       join_keys_one: <0>
                     join_keys_three: <0>
              join_keys_five_or_more: <0>
                      join_keys_four: <0>
                              join: <0>
                         sequences: a map containing
              sequence_queries_three: <0>
               sequence_queries_four: <0>
                sequence_queries_two: <0>
                      sequence_until: <0>
                    sequence_maxspan: <0>
       sequence_queries_five_or_more: <0>
                             event: <4>
                             pipes: a map containing
                           pipe_tail: <4>
                           pipe_head: <0>
                         queries: a map containing
                               all: a map containing
                               total: <4>
                              failed: <0>
                              _all: a map containing
                               total: <4>
                              failed: <0>
                frozen_indices: a map containing
                   indices_count: <0>
                       available: <true>
                         enabled: <true>
                       archive: a map containing
                   indices_count: <0>
                       available: <true>
                         enabled: <true>
                           ilm: a map containing
                    policy_count: <17>
                    policy_stats: a list containing
                                 0: a map containing
                              phases: a map containing
                                  warm: a map containing
                                 min_age: <172800000>
                                 actions: a list containing
                                         0: ""shrink""
                                         1: ""forcemerge""
                                         2: ""migrate""
                          configurations: a map containing
                                forcemerge: a map containing
                            max_num_segments: <1>
                                    shrink: a map containing
                            number_of_shards: <1>
                                  cold: a map containing
                                 min_age: <2592000000L>
                                 actions: a list containing
                                         0: ""migrate""
                          configurations: an empty map
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <7776000000L>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 1: a map containing
                              phases: a map containing
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""3d""
                              max_age_millis: <259200000>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <345600000>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 2: a map containing
                              phases: a map containing
                                  warm: a map containing
                                 min_age: <172800000>
                                 actions: a list containing
                                         0: ""shrink""
                                         1: ""forcemerge""
                                         2: ""migrate""
                          configurations: a map containing
                                forcemerge: a map containing
                            max_num_segments: <1>
                                    shrink: a map containing
                            number_of_shards: <1>
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <2592000000L>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 3: a map containing
                              phases: a map containing
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                     indices_managed: <0>
                                 4: a map containing
                              phases: a map containing
                                  warm: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""forcemerge""
                                         1: ""migrate""
                          configurations: a map containing
                                forcemerge: a map containing
                            max_num_segments: <1>
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""3d""
                              max_age_millis: <259200000>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <259200000>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 5: a map containing
                              phases: a map containing
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <7776000000L>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 6: a map containing
                              phases: a map containing
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                                    max_size: ""300gb""
                              max_size_bytes: <322122547200L>
                                delete: a map containing
 ...
```",cbuescher,closed,"['>test-failure', ':Core/Infra/REST API', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/95834,2023-05-04T12:31:40Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95834,"{
  ""application_resource"": ""unsure""
}"
276,95791,[DOCS] Improve Install Elasticsearch with Docker documentation,"There have been a few complaints about the [Install Elasticsearch with Docker](https://github.com/elastic/elasticsearch/blob/main/docs/reference/setup/install/docker.asciidoc) documentation. We should review those docs to ensure the guidance is still correct and follows best practices.

Specific feedback provided via the feedback form:

- breaks enrollment ERROR: [xpack.security.enrollment.enabled] must be set to `true` to create an enrollment token (Apparently regarding [Always bind data volumes](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html#_always_bind_data_volumes))
- step 5 doesnt work for me it is not possible to enter any key for a password
- The example does not work, as it did not create a user at the setup service, it tries to change a password for non existing user.
- Version 7 crashes on start on windows and linux, same for version 8. 
- setup fails with security_exception: unable to authenticate user [kibana_system] for REST request

Additional issues:

- [JVM heap error](https://github.com/elastic/elasticsearch/pull/96054)",abdonpijpelink,closed,"['>docs', ':Delivery/Packaging', 'Team:Docs', 'Team:Security', 'Team:Delivery', ':Security/AutoConfiguration']",https://github.com/elastic/elasticsearch/issues/95791,2023-05-03T14:20:59Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95791,"{
  ""application_resource"": ""unsure""
}"
277,95681,[CI] MlWithSecurityIT test {yaml=ml/frequent_item_sets_agg/Test frequent item sets filter} failing,"Seems to be one off failure because of closer resource.


**Build scan:**
https://gradle-enterprise.elastic.co/s/tbfsjsm4iujyk/tests/:x-pack:plugin:ml:qa:ml-with-security:yamlRestTest/org.elasticsearch.smoketest.MlWithSecurityIT/test%20%7Byaml=ml%2Ffrequent_item_sets_agg%2FTest%20frequent%20item%20sets%20filter%7D

**Reproduction line:**
```
./gradlew ':x-pack:plugin:ml:qa:ml-with-security:yamlRestTest' --tests ""org.elasticsearch.smoketest.MlWithSecurityIT.test {yaml=ml/frequent_item_sets_agg/Test frequent item sets filter}"" -Dtests.seed=AB9BDFBDA7D09640 -Dtests.locale=ga -Dtests.timezone=EST5EDT -Druntime.java=20
```

**Applicable branches:**
main

**Reproduces locally?:**
doesn't reproduce 


**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.smoketest.MlWithSecurityIT&tests.test=test%20%7Byaml%3Dml/frequent_item_sets_agg/Test%20frequent%20item%20sets%20filter%7D

**Failure excerpt:**
```
java.lang.AssertionError: Failure at [ml/frequent_item_sets_agg:340]: expected [2xx] status code but api [search] returned [500 Internal Server Error] [{""error"":{""root_cause"":[],""type"":""search_phase_execution_exception"",""reason"":"""",""phase"":""fetch"",""grouped"":true,""failed_shards"":[],""caused_by"":{""type"":""illegal_state_exception"",""reason"":""already closed"",""stack_trace"":""java.lang.IllegalStateException: already closed\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.breaker.PreallocatedCircuitBreakerService$PreallocatedCircuitBreaker.addWithoutBreaking(PreallocatedCircuitBreakerService.java:131)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorBase.addRequestCircuitBreakerBytes(AggregatorBase.java:148)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.ItemSetMapReduceAggregator.lambda$new$0(ItemSetMapReduceAggregator.java:108)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.DelegatingCircuitBreakerService$DelegatingCircuitBreaker.addWithoutBreaking(DelegatingCircuitBreakerService.java:92)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.BigArrays.adjustBreaker(BigArrays.java:477)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.AbstractArray.close(AbstractArray.java:28)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:87)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:63)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:73)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:41)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.BytesRefArray.close(BytesRefArray.java:117)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:87)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:63)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:73)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:41)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.ImmutableTransactionStore.close(ImmutableTransactionStore.java:142)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:33)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.lambda$reduce$0(EclatMapReducer.java:344)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\n\tat java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n\tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n\tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\n\tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.base/java.util.stream.ReferencePipeline.forEachOrdered(ReferencePipeline.java:601)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.reduce(EclatMapReducer.java:332)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.reduce(EclatMapReducer.java:69)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.InternalItemSetMapReduceAggregation.reduce(InternalItemSetMapReduceAggregation.java:122)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.InternalAggregations.reduce(InternalAggregations.java:159)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.InternalAggregations.topLevelReduce(InternalAggregations.java:106)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.SearchPhaseController.reduceAggs(SearchPhaseController.java:631)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.SearchPhaseController.reducedQueryPhase(SearchPhaseController.java:594)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.QueryPhaseResultConsumer.reduce(QueryPhaseResultConsumer.java:138)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:104)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:90)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1623)\n""},""stack_trace"":""Failed to execute phase [fetch], \n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:729)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.FetchSearchPhase$1.onFailure(FetchSearchPhase.java:95)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:28)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1623)\nCaused by: java.lang.IllegalStateException: already closed\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.breaker.PreallocatedCircuitBreakerService$PreallocatedCircuitBreaker.addWithoutBreaking(PreallocatedCircuitBreakerService.java:131)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorBase.addRequestCircuitBreakerBytes(AggregatorBase.java:148)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.ItemSetMapReduceAggregator.lambda$new$0(ItemSetMapReduceAggregator.java:108)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.DelegatingCircuitBreakerService$DelegatingCircuitBreaker.addWithoutBreaking(DelegatingCircuitBreakerService.java:92)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.BigArrays.adjustBreaker(BigArrays.java:477)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.AbstractArray.close(AbstractArray.java:28)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:87)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:63)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:73)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:41)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.BytesRefArray.close(BytesRefArray.java:117)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:87)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:63)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:73)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:41)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.ImmutableTransactionStore.close(ImmutableTransactionStore.java:142)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:33)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.lambda$reduce$0(EclatMapReducer.java:344)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\n\tat java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n\tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n\tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\n\tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.base/java.util.stream.ReferencePipeline.forEachOrdered(ReferencePipeline.java:601)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.reduce(EclatMapReducer.java:332)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.reduce(EclatMapReducer.java:69)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.InternalItemSetMapReduceAggregation.reduce(InternalItemSetMapReduceAggregation.java:122)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.InternalAggregations.reduce(InternalAggregations.java:159)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.InternalAggregations.topLevelReduce(InternalAggregations.java:106)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.SearchPhaseController.reduceAggs(SearchPhaseController.java:631)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.SearchPhaseController.reducedQueryPhase(SearchPhaseController.java:594)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.QueryPhaseResultConsumer.reduce(QueryPhaseResultConsumer.java:138)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:104)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:90)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\t... 6 more\n""},""status"":500}]

  at __randomizedtesting.SeedInfo.seed([AB9BDFBDA7D09640:23CFE067092CFBB8]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:572)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

  Caused by: java.lang.AssertionError: expected [2xx] status code but api [search] returned [500 Internal Server Error] [{""error"":{""root_cause"":[],""type"":""search_phase_execution_exception"",""reason"":"""",""phase"":""fetch"",""grouped"":true,""failed_shards"":[],""caused_by"":{""type"":""illegal_state_exception"",""reason"":""already closed"",""stack_trace"":""java.lang.IllegalStateException: already closed\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.breaker.PreallocatedCircuitBreakerService$PreallocatedCircuitBreaker.addWithoutBreaking(PreallocatedCircuitBreakerService.java:131)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorBase.addRequestCircuitBreakerBytes(AggregatorBase.java:148)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.ItemSetMapReduceAggregator.lambda$new$0(ItemSetMapReduceAggregator.java:108)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.DelegatingCircuitBreakerService$DelegatingCircuitBreaker.addWithoutBreaking(DelegatingCircuitBreakerService.java:92)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.BigArrays.adjustBreaker(BigArrays.java:477)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.AbstractArray.close(AbstractArray.java:28)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:87)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:63)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:73)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:41)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.BytesRefArray.close(BytesRefArray.java:117)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:87)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:63)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:73)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:41)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.ImmutableTransactionStore.close(ImmutableTransactionStore.java:142)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:33)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.lambda$reduce$0(EclatMapReducer.java:344)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\n\tat java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n\tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n\tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\n\tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.base/java.util.stream.ReferencePipeline.forEachOrdered(ReferencePipeline.java:601)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.reduce(EclatMapReducer.java:332)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.reduce(EclatMapReducer.java:69)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.InternalItemSetMapReduceAggregation.reduce(InternalItemSetMapReduceAggregation.java:122)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.InternalAggregations.reduce(InternalAggregations.java:159)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.InternalAggregations.topLevelReduce(InternalAggregations.java:106)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.SearchPhaseController.reduceAggs(SearchPhaseController.java:631)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.SearchPhaseController.reducedQueryPhase(SearchPhaseController.java:594)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.QueryPhaseResultConsumer.reduce(QueryPhaseResultConsumer.java:138)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:104)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:90)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1623)\n""},""stack_trace"":""Failed to execute phase [fetch], \n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:729)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.FetchSearchPhase$1.onFailure(FetchSearchPhase.java:95)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:28)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:983)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1623)\nCaused by: java.lang.IllegalStateException: already closed\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.breaker.PreallocatedCircuitBreakerService$PreallocatedCircuitBreaker.addWithoutBreaking(PreallocatedCircuitBreakerService.java:131)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorBase.addRequestCircuitBreakerBytes(AggregatorBase.java:148)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.ItemSetMapReduceAggregator.lambda$new$0(ItemSetMapReduceAggregator.java:108)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.DelegatingCircuitBreakerService$DelegatingCircuitBreaker.addWithoutBreaking(DelegatingCircuitBreakerService.java:92)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.BigArrays.adjustBreaker(BigArrays.java:477)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.AbstractArray.close(AbstractArray.java:28)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:87)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:63)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:73)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:41)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.BytesRefArray.close(BytesRefArray.java:117)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:87)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:63)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:73)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:41)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.ImmutableTransactionStore.close(ImmutableTransactionStore.java:142)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)\n\tat org.elasticsearch.base@8.9.0-SNAPSHOT/org.elasticsearch.core.Releasables.close(Releasables.java:33)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.lambda$reduce$0(EclatMapReducer.java:344)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\n\tat java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n\tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n\tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\n\tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.base/java.util.stream.ReferencePipeline.forEachOrdered(ReferencePipeline.java:601)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.reduce(EclatMapReducer.java:332)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.EclatMapReducer.reduce(EclatMapReducer.java:69)\n\tat org.elasticsearch.ml@8.9.0-SNAPSHOT/org.elasticsearch.xpack.ml.aggs.frequentitemsets.mr.InternalItemSetMapReduceAggregation.reduce(InternalItemSetMapReduceAggregation.java:122)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.InternalAggregations.reduce(InternalAggregations.java:159)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.search.aggregations.InternalAggregations.topLevelReduce(InternalAggregations.java:106)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.SearchPhaseController.reduceAggs(SearchPhaseController.java:631)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.SearchPhaseController.reducedQueryPhase(SearchPhaseController.java:594)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.QueryPhaseResultConsumer.reduce(QueryPhaseResultConsumer.java:138)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:104)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:90)\n\tat org.elasticsearch.server@8.9.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)\n\t... 6 more\n""},""status"":500}]

    at org.junit.Assert.fail(Assert.java:88)
    at org.elasticsearch.test.rest.yaml.section.DoSection.execute(DoSection.java:373)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:552)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
    at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
    at java.lang.reflect.Method.invoke(Method.java:578)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:1623)

```",mayya-sharipova,closed,"['>test-failure', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/95681,2023-04-28T15:05:48Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95681,"{
  ""application_resource"": ""yes""
}"
278,95603,[CI] DocsClientYamlTestSuiteIT test {yaml=reference/rest-api/usage/line_38} failing,"Failed 7 times in the past 3 days:
https://gradle-enterprise.elastic.co/scans/tests?search.timeZoneId=Europe/Berlin&tests.container=org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT&tests.test=test%20%7Byaml%3Dreference/rest-api/usage/line_38%7D

**Build scan:**
https://gradle-enterprise.elastic.co/s/bpdzoghroz5vq/tests/:docs:yamlRestTest/org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT/test%20%7Byaml=reference%2Frest-api%2Fusage%2Fline_38%7D

**Reproduction line:**
```
./gradlew ':docs:yamlRestTest' --tests ""org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT.test {yaml=reference/rest-api/usage/line_38}"" -Dtests.seed=551AF85965B3ED17 -Dbuild.snapshot=false -Dtests.jvm.argline=""-Dbuild.snapshot=false"" -Dtests.locale=it-CH -Dtests.timezone=America/Winnipeg -Druntime.java=20
```

**Applicable branches:**
main, 8.8

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT&tests.test=test%20%7Byaml%3Dreference/rest-api/usage/line_38%7D

**Failure excerpt:**
```
java.lang.AssertionError: Failure at [reference/rest-api/usage:16]: Expected a map containing
                     watcher: a map containing
                     execution: a map containing
                         actions: a map containing
                              _all: a map containing
                               total: <6>
                    total_time_in_ms: <173>
                         watch: a map containing
                           input: a map containing
                              _all: a map containing
                               total: <0>
                              active: <0>
                         trigger: a map containing
                              _all: a map containing
                               total: <0>
                              active: <0>
                     available: <true>
                         count: a map containing
                           total: <0>
                          active: <0>
                       enabled: <true>
                         eql: a map containing
                     available: <true>
                       enabled: <true>
                      features: a map containing
                           joins: a map containing
                join_queries_three: <0>
                  join_queries_two: <0>
                        join_until: <0>
         join_queries_five_or_more: <0>
                 join_queries_four: <0>
                        sequence: <6>
                            keys: a map containing
                     join_keys_two: <0>
                     join_keys_one: <5>
                   join_keys_three: <0>
            join_keys_five_or_more: <0>
                    join_keys_four: <0>
                            join: <0>
                       sequences: a map containing
            sequence_queries_three: <1>
             sequence_queries_four: <0>
              sequence_queries_two: <5>
                    sequence_until: <1>
                  sequence_maxspan: <4>
     sequence_queries_five_or_more: <0>
                           event: <18>
                           pipes: a map containing
                         pipe_tail: <21>
                         pipe_head: <0>
                       queries: a map containing
                             all: a map containing
                             total: <24>
                            failed: <0>
                            _all: a map containing
                             total: <24>
                            failed: <0>
              frozen_indices: a map containing
                 indices_count: <0>
                     available: <true>
                       enabled: <true>
                     archive: a map containing
                 indices_count: <0>
                     available: <true>
                       enabled: <true>
                         ilm: a map containing
                  policy_count: <17>
                  policy_stats: a list containing
                               0: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               1: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""3d""
                            max_age_millis: <259200000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <345600000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               2: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               3: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                               4: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""forcemerge""
                                       1: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""3d""
                            max_age_millis: <259200000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <259200000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               5: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               6: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""300gb""
                            max_size_bytes: <322122547200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               7: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <31536000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               8: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""7d""
                            max_age_millis: <604800000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <604800000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               9: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""10gb""
              max_primary_shard_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              10: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <15552000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              11: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              12: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              13: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""7d""
                            max_age_millis: <604800000>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <604800000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              14: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <15552000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              15: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                              frozen: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""searchable_snapshot""
                        configurations: an empty map
                                cold: a map containing
                               min_age: <5184000000L>
                               actions: a list containing
                                       0: ""searchable_snapshot""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <63504000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              16: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                  monitoring: a map containing
            collection_enabled: <false>
                     available: <true>
             enabled_exporters: a map containing
                           local: <1>
                       enabled: <true>
                       graph: a map containing
                     available: <true>
                       enabled: <true>
            aggregate_metric: a map containing
                     available: <true>
                       enabled: <true>
                         sql: a map containing
                      features: a map containing
                          having: <2>
                       subselect: <0>
                           limit: <1>
                         orderby: <11>
                           where: <4>
                            join: <0>
                         groupby: <2>
                         command: <0>
                           local: <0>
                     available: <true>
                       queries: a map containing
                            rest: a map containing
                             total: <16>
                            paging: <2>
                            failed: <0>
                             cli: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          canvas: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            odbc: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            jdbc: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          odbc32: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          odbc64: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            _all: a map containing
                             total: <16>
                            paging: <2>
                            failed: <0>
                       translate: a map containing
                             count: <2>
                       enabled: <true>
                      rollup: a map containing
                     available: <true>
                       enabled: <true>
                  data_tiers: a map containing
                     data_warm: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                   data_frozen: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                     data_cold: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                     available: <true>
                  data_content: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                       enabled: <true>
                      data_hot: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
        searchable_snapshots: a map containing
    shared_cache_indices_count: <0>
                 indices_count: <0>
                     available: <true>
       full_copy_indices_count: <0>
                       enabled: <true>
                   analytics: a map containing
                         stats: a map containing
                      rate_usage: <5>
                 normalize_usage: <1>
                   boxplot_usage: <4>
               top_metrics_usage: <7>
               multi_terms_usage: <3>
    cumulative_cardinality_usage: <2>
              string_stats_usage: <4>
        moving_percentiles_usage: <1>
                    t_test_usage: <2>
                     available: <true>
                       enabled: <true>
                    logstash: a map containing
                     available: <true>
                       enabled: <true>
                    security: a map containing
                     available: <true>
                       enabled: <false>
                   transform: a map containing
                     available: <true>
                       enabled: <true>
                         ccr: a map containing
    auto_follow_patterns_count: <0>
                     available: <true>
        follower_indices_count: <0>
                       enabled: <true>
                         slm: a map containing
                     available: <true>
                       enabled: <true>
                  policy_count: <0>
                  policy_stats: a map containing
                  retention_runs: <1>
                retention_failed: <0>
             retention_timed_out: <0>
         retention_deletion_time: ""0s""
  retention_deletion_time_millis: <0>
           total_snapshots_taken: <0>
          total_snapshots_failed: <0>
         total_snapshots_deleted: <0>
total_snapshot_deletion_failures: <0>
                    policy_stats: an empty list
                  health_api: a map containing
                     available: <true>
                       enabled: <true>
                      statuses: a map containing
                           green: <11>
                          values: a list containing
                                 0: ""green""
                   invocations: a map containing
                           total: <11>
                    verbose_true: <10>
                   verbose_false: <1>
                 voting_only: a map containing
                     available: <true>
                       enabled: <true>
                data_streams: a map containing
                 indices_count: <0>
                     available: <true>
                  data_streams: <0>
                       enabled: <true>
                     spatial: a map containing
                     available: <true>
                       enabled: <true>
                          ml: a map containing
                     inference: a map containing
                     deployments: a map containing
                           time_ms: a map containing
                                 avg: <0.0>
                             count: <0>
                 model_sizes_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                  inference_counts: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                  trained_models: a map containing
                  model_size_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
              estimated_operations: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                             count: a map containing
                               total: <1>
                         prepackaged: <1>
                               other: <0>
                              _all: a map containing
                               count: <1>
               ingest_processors: a map containing
                              _all: a map containing
                           pipelines: a map containing
                                 count: <0>
                             time_ms: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
                  num_docs_processed: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
                        num_failures: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
     data_frame_analytics_jobs: a map containing
                    memory_usage: a map containing
                  peak_usage_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                            _all: a map containing
                             count: <0>
                 analysis_counts: an empty map
                          jobs: a map containing
                            _all: a map containing
                             count: <0>
                         detectors: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                        created_by: an empty map
                        model_size: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                         forecasts: a map containing
                               total: <0>
                     forecasted_jobs: <0>
                     available: <true>
                     datafeeds: a map containing
                            _all: a map containing
                             count: <0>
                    node_count: <1>
                       enabled: <true>
           enterprise_search: <unexpected> but was <{available=true, enabled=true, search_applications={count=0}}>

  at __randomizedtesting.SeedInfo.seed([551AF85965B3ED17:DD4EC783CB4F80EF]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:572)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

  Caused by: java.lang.AssertionError: Expected a map containing
                       watcher: a map containing
                       execution: a map containing
                           actions: a map containing
                                _all: a map containing
                                 total: <6>
                      total_time_in_ms: <173>
                           watch: a map containing
                             input: a map containing
                                _all: a map containing
                                 total: <0>
                                active: <0>
                           trigger: a map containing
                                _all: a map containing
                                 total: <0>
                                active: <0>
                       available: <true>
                           count: a map containing
                             total: <0>
                            active: <0>
                         enabled: <true>
                           eql: a map containing
                       available: <true>
                         enabled: <true>
                        features: a map containing
                             joins: a map containing
                  join_queries_three: <0>
                    join_queries_two: <0>
                          join_until: <0>
           join_queries_five_or_more: <0>
                   join_queries_four: <0>
                          sequence: <6>
                              keys: a map containing
                       join_keys_two: <0>
                       join_keys_one: <5>
                     join_keys_three: <0>
              join_keys_five_or_more: <0>
                      join_keys_four: <0>
                              join: <0>
                         sequences: a map containing
              sequence_queries_three: <1>
               sequence_queries_four: <0>
                sequence_queries_two: <5>
                      sequence_until: <1>
                    sequence_maxspan: <4>
       sequence_queries_five_or_more: <0>
                             event: <18>
                             pipes: a map containing
                           pipe_tail: <21>
                           pipe_head: <0>
                         queries: a map containing
                               all: a map containing
                               total: <24>
                              failed: <0>
                              _all: a map containing
                               total: <24>
                              failed: <0>
                frozen_indices: a map containing
                   indices_count: <0>
                       available: <true>
                         enabled: <true>
                       archive: a map containing
                   indices_count: <0>
                       available: <true>
                         enabled: <true>
                           ilm: a map containing
                    policy_count: <17>
                    policy_stats: a list containing
                                 0: a map containing
                              phases: a map containing
                                  warm: a map containing
                                 min_age: <172800000>
                                 actions: a list containing
                                         0: ""shrink""
                                         1: ""forcemerge""
                                         2: ""migrate""
                          configurations: a map containing
                                forcemerge: a map containing
                            max_num_segments: <1>
                                    shrink: a map containing
                            number_of_shards: <1>
                                  cold: a map containing
                                 min_age: <2592000000L>
                                 actions: a list containing
                                         0: ""migrate""
                          configurations: an empty map
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <7776000000L>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 1: a map containing
                              phases: a map containing
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""3d""
                              max_age_millis: <259200000>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <345600000>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 2: a map containing
                              phases: a map containing
                                  warm: a map containing
                                 min_age: <172800000>
                                 actions: a list containing
                                         0: ""shrink""
                                         1: ""forcemerge""
                                         2: ""migrate""
                          configurations: a map containing
                                forcemerge: a map containing
                            max_num_segments: <1>
                                    shrink: a map containing
                            number_of_shards: <1>
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <2592000000L>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 3: a map containing
                              phases: a map containing
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                     indices_managed: <0>
                                 4: a map containing
                              phases: a map containing
                                  warm: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""forcemerge""
                                         1: ""migrate""
                          configurations: a map containing
                                forcemerge: a map containing
                            max_num_segments: <1>
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""3d""
                              max_age_millis: <259200000>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <259200000>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 5: a map containing
                              phases: a map containing
                                   hot: a map containing
                     ...
```",valeriy42,closed,"['>test-failure', ':EnterpriseSearch/Application', 'Team:Enterprise Search']",https://github.com/elastic/elasticsearch/issues/95603,2023-04-27T08:55:20Z,8,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95603,"{
  ""application_resource"": ""unsure""
}"
279,95564,[CI] DocsClientYamlTestSuiteIT test {yaml=reference/rest-api/usage/line_38} failing,"Looks like _xpack/usage reports `enterprise_search` in release builds (doesn't repro on snapshot builds, locally):
```                         forecasted_jobs: <0>
                         available: <true>
                         datafeeds: a map containing
                                _all: a map containing
                                 count: <0>
                        node_count: <1>
                           enabled: <true>
               enterprise_search: <unexpected> but was <{available=true, enabled=true, search_applications={count=0}}>
        at __randomizedtesting.SeedInfo.seed([66196323F28703F3:EE4D5CF95C7B6E0B]:0)
        at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:572)
        at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
```

**Build scan:**
https://gradle-enterprise.elastic.co/s/pb2uicbszcmto/tests/:docs:yamlRestTest/org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT/test%20%7Byaml=reference%2Frest-api%2Fusage%2Fline_38%7D

**Reproduction line:**
```
./gradlew ':docs:yamlRestTest' --tests ""org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT.test {yaml=reference/rest-api/usage/line_38}"" -Dtests.seed=66196323F28703F3 -Dbuild.snapshot=false -Dtests.jvm.argline=""-Dbuild.snapshot=false"" -Dtests.locale=ja-JP-u-ca-japanese-x-lvariant-JP -Dtests.timezone=Europe/Ljubljana -Druntime.java=20
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT&tests.test=test%20%7Byaml%3Dreference/rest-api/usage/line_38%7D

**Failure excerpt:**
```
java.lang.AssertionError: Failure at [reference/rest-api/usage:16]: Expected a map containing
                     watcher: a map containing
                     execution: a map containing
                         actions: a map containing
                              _all: a map containing
                               total: <3>
                    total_time_in_ms: <116>
                         watch: a map containing
                           input: a map containing
                              _all: a map containing
                               total: <0>
                              active: <0>
                         trigger: a map containing
                              _all: a map containing
                               total: <0>
                              active: <0>
                     available: <true>
                         count: a map containing
                           total: <0>
                          active: <0>
                       enabled: <true>
                         eql: a map containing
                     available: <true>
                       enabled: <true>
                      features: a map containing
                           joins: a map containing
                join_queries_three: <0>
                  join_queries_two: <0>
                        join_until: <0>
         join_queries_five_or_more: <0>
                 join_queries_four: <0>
                        sequence: <5>
                            keys: a map containing
                     join_keys_two: <0>
                     join_keys_one: <3>
                   join_keys_three: <0>
            join_keys_five_or_more: <0>
                    join_keys_four: <0>
                            join: <0>
                       sequences: a map containing
            sequence_queries_three: <1>
             sequence_queries_four: <0>
              sequence_queries_two: <4>
                    sequence_until: <0>
                  sequence_maxspan: <2>
     sequence_queries_five_or_more: <0>
                           event: <15>
                           pipes: a map containing
                         pipe_tail: <20>
                         pipe_head: <0>
                       queries: a map containing
                             all: a map containing
                             total: <20>
                            failed: <0>
                            _all: a map containing
                             total: <20>
                            failed: <0>
              frozen_indices: a map containing
                 indices_count: <0>
                     available: <true>
                       enabled: <true>
                     archive: a map containing
                 indices_count: <0>
                     available: <true>
                       enabled: <true>
                         ilm: a map containing
                  policy_count: <17>
                  policy_stats: a list containing
                               0: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               1: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""3d""
                            max_age_millis: <259200000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <345600000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               2: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               3: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                               4: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""forcemerge""
                                       1: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""3d""
                            max_age_millis: <259200000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <259200000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               5: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               6: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""300gb""
                            max_size_bytes: <322122547200L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               7: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <31536000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               8: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""7d""
                            max_age_millis: <604800000>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <604800000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                               9: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""10gb""
              max_primary_shard_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              10: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <15552000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              11: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              12: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                   indices_managed: <0>
                              13: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""7d""
                            max_age_millis: <604800000>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <604800000>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              14: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <172800000>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                                cold: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""migrate""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <15552000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              15: a map containing
                            phases: a map containing
                                warm: a map containing
                               min_age: <2592000000L>
                               actions: a list containing
                                       0: ""shrink""
                                       1: ""forcemerge""
                                       2: ""migrate""
                        configurations: a map containing
                              forcemerge: a map containing
                          max_num_segments: <1>
                                  shrink: a map containing
                          number_of_shards: <1>
                              frozen: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""searchable_snapshot""
                        configurations: an empty map
                                cold: a map containing
                               min_age: <5184000000L>
                               actions: a list containing
                                       0: ""searchable_snapshot""
                        configurations: an empty map
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                    max_primary_shard_size: ""50gb""
              max_primary_shard_size_bytes: <53687091200L>
                              delete: a map containing
                               min_age: <63504000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                              16: a map containing
                            phases: a map containing
                                 hot: a map containing
                               min_age: <0>
                               actions: a list containing
                                       0: ""rollover""
                        configurations: a map containing
                                rollover: a map containing
                                   max_age: ""30d""
                            max_age_millis: <2592000000L>
                                  max_size: ""10gb""
                            max_size_bytes: <10737418240L>
                              delete: a map containing
                               min_age: <7776000000L>
                               actions: a list containing
                                       0: ""delete""
                        configurations: an empty map
                   indices_managed: <0>
                  monitoring: a map containing
            collection_enabled: <false>
                     available: <true>
             enabled_exporters: a map containing
                           local: <1>
                       enabled: <true>
                       graph: a map containing
                     available: <true>
                       enabled: <true>
            aggregate_metric: a map containing
                     available: <true>
                       enabled: <true>
                         sql: a map containing
                      features: a map containing
                          having: <2>
                       subselect: <0>
                           limit: <2>
                         orderby: <11>
                           where: <2>
                            join: <0>
                         groupby: <2>
                         command: <0>
                           local: <0>
                     available: <true>
                       queries: a map containing
                            rest: a map containing
                             total: <13>
                            paging: <2>
                            failed: <0>
                             cli: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          canvas: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            odbc: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            jdbc: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          odbc32: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                          odbc64: a map containing
                             total: <0>
                            paging: <0>
                            failed: <0>
                            _all: a map containing
                             total: <13>
                            paging: <2>
                            failed: <0>
                       translate: a map containing
                             count: <2>
                       enabled: <true>
                      rollup: a map containing
                     available: <true>
                       enabled: <true>
                  data_tiers: a map containing
                     data_warm: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                   data_frozen: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                     data_cold: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                     available: <true>
                  data_content: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
                       enabled: <true>
                      data_hot: a map containing
 primary_shard_size_median_bytes: <0>
             primary_shard_count: <0>
                       doc_count: <0>
    primary_shard_size_avg_bytes: <0>
              primary_size_bytes: <0>
                total_size_bytes: <0>
               total_shard_count: <0>
    primary_shard_size_mad_bytes: <0>
                      node_count: <1>
                     index_count: <0>
        searchable_snapshots: a map containing
    shared_cache_indices_count: <0>
                 indices_count: <0>
                     available: <true>
       full_copy_indices_count: <0>
                       enabled: <true>
                   analytics: a map containing
                         stats: a map containing
                      rate_usage: <5>
                 normalize_usage: <0>
                   boxplot_usage: <1>
               top_metrics_usage: <4>
               multi_terms_usage: <2>
    cumulative_cardinality_usage: <2>
              string_stats_usage: <4>
        moving_percentiles_usage: <1>
                    t_test_usage: <1>
                     available: <true>
                       enabled: <true>
                    logstash: a map containing
                     available: <true>
                       enabled: <true>
                    security: a map containing
                     available: <true>
                       enabled: <false>
                   transform: a map containing
                     available: <true>
                       enabled: <true>
                         ccr: a map containing
    auto_follow_patterns_count: <0>
                     available: <true>
        follower_indices_count: <0>
                       enabled: <true>
                         slm: a map containing
                     available: <true>
                       enabled: <true>
                  policy_count: <0>
                  policy_stats: a map containing
                  retention_runs: <1>
                retention_failed: <0>
             retention_timed_out: <0>
         retention_deletion_time: ""0s""
  retention_deletion_time_millis: <0>
           total_snapshots_taken: <0>
          total_snapshots_failed: <0>
         total_snapshots_deleted: <0>
total_snapshot_deletion_failures: <0>
                    policy_stats: an empty list
                  health_api: a map containing
                     available: <true>
                       enabled: <true>
                      statuses: a map containing
                           green: <10>
                          values: a list containing
                                 0: ""green""
                   invocations: a map containing
                           total: <10>
                    verbose_true: <9>
                   verbose_false: <1>
                 voting_only: a map containing
                     available: <true>
                       enabled: <true>
                data_streams: a map containing
                 indices_count: <0>
                     available: <true>
                  data_streams: <0>
                       enabled: <true>
                     spatial: a map containing
                     available: <true>
                       enabled: <true>
                          ml: a map containing
                     inference: a map containing
                     deployments: a map containing
                           time_ms: a map containing
                                 avg: <0.0>
                             count: <0>
                 model_sizes_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                  inference_counts: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                  trained_models: a map containing
                  model_size_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
              estimated_operations: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                             count: a map containing
                               total: <1>
                         prepackaged: <1>
                               other: <0>
                              _all: a map containing
                               count: <1>
               ingest_processors: a map containing
                              _all: a map containing
                           pipelines: a map containing
                                 count: <0>
                             time_ms: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
                  num_docs_processed: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
                        num_failures: a map containing
                                   min: <0>
                                   max: <0>
                                   sum: <0>
     data_frame_analytics_jobs: a map containing
                    memory_usage: a map containing
                  peak_usage_bytes: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                            _all: a map containing
                             count: <0>
                 analysis_counts: an empty map
                          jobs: a map containing
                            _all: a map containing
                             count: <0>
                         detectors: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                        created_by: an empty map
                        model_size: a map containing
                               total: <0.0>
                                 min: <0.0>
                                 avg: <0.0>
                                 max: <0.0>
                         forecasts: a map containing
                               total: <0>
                     forecasted_jobs: <0>
                     available: <true>
                     datafeeds: a map containing
                            _all: a map containing
                             count: <0>
                    node_count: <1>
                       enabled: <true>
           enterprise_search: <unexpected> but was <{available=true, enabled=true, search_applications={count=0}}>

  at __randomizedtesting.SeedInfo.seed([66196323F28703F3:EE4D5CF95C7B6E0B]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:572)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:524)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1623)

  Caused by: java.lang.AssertionError: Expected a map containing
                       watcher: a map containing
                       execution: a map containing
                           actions: a map containing
                                _all: a map containing
                                 total: <3>
                      total_time_in_ms: <116>
                           watch: a map containing
                             input: a map containing
                                _all: a map containing
                                 total: <0>
                                active: <0>
                           trigger: a map containing
                                _all: a map containing
                                 total: <0>
                                active: <0>
                       available: <true>
                           count: a map containing
                             total: <0>
                            active: <0>
                         enabled: <true>
                           eql: a map containing
                       available: <true>
                         enabled: <true>
                        features: a map containing
                             joins: a map containing
                  join_queries_three: <0>
                    join_queries_two: <0>
                          join_until: <0>
           join_queries_five_or_more: <0>
                   join_queries_four: <0>
                          sequence: <5>
                              keys: a map containing
                       join_keys_two: <0>
                       join_keys_one: <3>
                     join_keys_three: <0>
              join_keys_five_or_more: <0>
                      join_keys_four: <0>
                              join: <0>
                         sequences: a map containing
              sequence_queries_three: <1>
               sequence_queries_four: <0>
                sequence_queries_two: <4>
                      sequence_until: <0>
                    sequence_maxspan: <2>
       sequence_queries_five_or_more: <0>
                             event: <15>
                             pipes: a map containing
                           pipe_tail: <20>
                           pipe_head: <0>
                         queries: a map containing
                               all: a map containing
                               total: <20>
                              failed: <0>
                              _all: a map containing
                               total: <20>
                              failed: <0>
                frozen_indices: a map containing
                   indices_count: <0>
                       available: <true>
                         enabled: <true>
                       archive: a map containing
                   indices_count: <0>
                       available: <true>
                         enabled: <true>
                           ilm: a map containing
                    policy_count: <17>
                    policy_stats: a list containing
                                 0: a map containing
                              phases: a map containing
                                  warm: a map containing
                                 min_age: <172800000>
                                 actions: a list containing
                                         0: ""shrink""
                                         1: ""forcemerge""
                                         2: ""migrate""
                          configurations: a map containing
                                forcemerge: a map containing
                            max_num_segments: <1>
                                    shrink: a map containing
                            number_of_shards: <1>
                                  cold: a map containing
                                 min_age: <2592000000L>
                                 actions: a list containing
                                         0: ""migrate""
                          configurations: an empty map
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <7776000000L>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 1: a map containing
                              phases: a map containing
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""3d""
                              max_age_millis: <259200000>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <345600000>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 2: a map containing
                              phases: a map containing
                                  warm: a map containing
                                 min_age: <172800000>
                                 actions: a list containing
                                         0: ""shrink""
                                         1: ""forcemerge""
                                         2: ""migrate""
                          configurations: a map containing
                                forcemerge: a map containing
                            max_num_segments: <1>
                                    shrink: a map containing
                            number_of_shards: <1>
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <2592000000L>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 3: a map containing
                              phases: a map containing
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""30d""
                              max_age_millis: <2592000000L>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                     indices_managed: <0>
                                 4: a map containing
                              phases: a map containing
                                  warm: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""forcemerge""
                                         1: ""migrate""
                          configurations: a map containing
                                forcemerge: a map containing
                            max_num_segments: <1>
                                   hot: a map containing
                                 min_age: <0>
                                 actions: a list containing
                                         0: ""rollover""
                          configurations: a map containing
                                  rollover: a map containing
                                     max_age: ""3d""
                              max_age_millis: <259200000>
                      max_primary_shard_size: ""50gb""
                max_primary_shard_size_bytes: <53687091200L>
                                delete: a map containing
                                 min_age: <259200000>
                                 actions: a list containing
                                         0: ""delete""
                          configurations: an empty map
                     indices_managed: <0>
                                 5: a map containing
                              phases: a map containing
                                   hot: a map containing
                      ...
```",albertzaharovits,closed,"['>test-failure', 'needs:triage', ':EnterpriseSearch/Application']",https://github.com/elastic/elasticsearch/issues/95564,2023-04-26T09:56:21Z,0,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95564,"{
  ""application_resource"": ""unsure""
}"
280,95489,Synonym filter after stemmer sometimes does not work properly,"### Elasticsearch Version

7.17.9

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Ubuntu 20.04 on WSL2 of Windows 10

### Problem Description

With a simple analyzer that applies a synonym filter after a stemmer, sometimes for some stemmed words, the synonym does not work while the exact stemmed word is used in the synonym filter. For example the word ""journaliÃ¨re"" (in French) is stemmed into ""journali"", but the synonym ""journali => something"" is not taken into account.

I first reported this bug [on stackoverflow, here](https://stackoverflow.com/questions/76076597/elasticsearch-synonym-filter-after-stemmer-sometimes-does-not-work-properly), somebody reproduced it and told me to create an issue.

### Steps to Reproduce

I'm using Elasicsearch 7.17.9, here is my docker-compose config :
```
version: '3.7'
services:
    elasticsearch:
        image: docker.elastic.co/elasticsearch/elasticsearch:7.17.9
        container_name: elasticsearch
        environment:
            - discovery.type=single-node
            - bootstrap.memory_lock=true
            - ""ES_JAVA_OPTS=-Xms1000m -Xmx2000m""
        ulimits:
            memlock:
                soft: -1
                hard: -1
        volumes:
            - elasticsearch-data:/usr/share/elasticsearch/data
        ports:
            - 9200:9200
volumes:
    elasticsearch-data:
        driver: local
```

First, I created an analyzer that applies a synonym filter after the French snowball filter.

```
curl -XPUT ""http://localhost:9200/my_index"" -H 'Content-Type: application/json' -d '
{
  ""settings"": {
    ""analysis"": {
      ""filter"": {
        ""my_snow"": {
          ""type"": ""snowball"",
          ""language"": ""French""
        },
        ""my_synonym_filter"": {
          ""type"": ""synonym"", 
          ""synonyms"": [ 
            ""autr => synonym_1"",
            ""journali => synonym_2"",
            ""journalier => synonym_3""
          ]
        }
      },
      ""analyzer"": {
        ""my_analyzer"": {
          ""tokenizer"": ""standard"",
          ""filter"": [
            ""my_snow"",
            ""my_synonym_filter""
          ]
        }
      }
    }
  }
}'
```

Because my synonym filter is after the stemmer, I had to find out what are words stemmed into. To find what stemmed word to put in the synonym filter, I ran the `/my_index/_analyze` query with `""explain"": ""true""` without the synonyms. The query gave me the stemmed tokens that I put in the synonym filter.

Then, I tested this analyzer with the text ""journaliÃ¨re"". It is stemmed to ""journali"" as showed below, and the synonym filter transforms it to ""synonym_3"" instead of ""synonym_2""! And without the line `""journalier => synonym_3""` in the filter, it would not be transformed at all! Here are the query and the response :
```
curl -XGET ""http://localhost:9200/my_index/_analyze"" -H 'Content-Type: application/json' -d '
{
  ""analyzer"" : ""my_analyzer"",
  ""text"" : ""journaliÃ¨re"",
  ""explain"" : ""true""
}' | json_pp
```
```
{
   ""detail"" : {
      ""charfilters"" : [],
      ""custom_analyzer"" : true,
      ""tokenfilters"" : [
         {
            ""name"" : ""my_snow"",
            ""tokens"" : [
               {
                  ""bytes"" : ""[6a 6f 75 72 6e 61 6c 69]"",
                  ""end_offset"" : 11,
                  ""keyword"" : false,
                  ""position"" : 0,
                  ""positionLength"" : 1,
                  ""start_offset"" : 0,
                  ""termFrequency"" : 1,
                  ""token"" : ""journali"",
                  ""type"" : ""<ALPHANUM>""
               }
            ]
         },
         {
            ""name"" : ""my_synonym_filter"",
            ""tokens"" : [
               {
                  ""bytes"" : ""[73 79 6e 6f 6e 79 6d 5f 33]"",
                  ""end_offset"" : 11,
                  ""keyword"" : false,
                  ""position"" : 0,
                  ""positionLength"" : 1,
                  ""start_offset"" : 0,
                  ""termFrequency"" : 1,
                  ""token"" : ""synonym_3"",
                  ""type"" : ""SYNONYM""
               }
            ]
         }
      ],
      ""tokenizer"" : {
         ""name"" : ""standard"",
         ""tokens"" : [
            {
               ""bytes"" : ""[6a 6f 75 72 6e 61 6c 69 c3 a8 72 65]"",
               ""end_offset"" : 11,
               ""position"" : 0,
               ""positionLength"" : 1,
               ""start_offset"" : 0,
               ""termFrequency"" : 1,
               ""token"" : ""journaliÃƒÂ¨re"",
               ""type"" : ""<ALPHANUM>""
            }
         ]
      }
   }
}
```

I also tested the analyzer with the word ""journaliere"" to see if the accent had something to do with the bug. It is stemmed to ""journalier"", and then the synonym filter does not work. See the query and response below :
```
curl -XGET ""http://localhost:9200/my_index/_analyze"" -H 'Content-Type: application/json' -d '
{
  ""analyzer"" : ""my_analyzer"",
  ""text"" : ""journaliere"",
  ""explain"" : ""true""
}' | json_pp
```

```
{
   ""detail"" : {
      ""charfilters"" : [],
      ""custom_analyzer"" : true,
      ""tokenfilters"" : [
         {
            ""name"" : ""my_snow"",
            ""tokens"" : [
               {
                  ""bytes"" : ""[6a 6f 75 72 6e 61 6c 69 65 72]"",
                  ""end_offset"" : 11,
                  ""keyword"" : false,
                  ""position"" : 0,
                  ""positionLength"" : 1,
                  ""start_offset"" : 0,
                  ""termFrequency"" : 1,
                  ""token"" : ""journalier"",
                  ""type"" : ""<ALPHANUM>""
               }
            ]
         },
         {
            ""name"" : ""my_synonym_filter"",
            ""tokens"" : [
               {
                  ""bytes"" : ""[6a 6f 75 72 6e 61 6c 69 65 72]"",
                  ""end_offset"" : 11,
                  ""keyword"" : false,
                  ""position"" : 0,
                  ""positionLength"" : 1,
                  ""start_offset"" : 0,
                  ""termFrequency"" : 1,
                  ""token"" : ""journalier"",
                  ""type"" : ""<ALPHANUM>""
               }
            ]
         }
      ],
      ""tokenizer"" : {
         ""name"" : ""standard"",
         ""tokens"" : [
            {
               ""bytes"" : ""[6a 6f 75 72 6e 61 6c 69 65 72 65]"",
               ""end_offset"" : 11,
               ""position"" : 0,
               ""positionLength"" : 1,
               ""start_offset"" : 0,
               ""termFrequency"" : 1,
               ""token"" : ""journaliere"",
               ""type"" : ""<ALPHANUM>""
            }
         ]
      }
   }
}
```

Finally, so be sure other words worked I tested with ""autre"". It is stemmed to ""autr"" and then gives ""synonym_1"" which is correct.

It seems that the tokens outputted by the explained analysis are not always the same words used by the synonym filter.

### Logs (if relevant)

_No response_",AntoineRoue,closed,"['>bug', ':Search Relevance/Analysis', 'Team:Search Relevance']",https://github.com/elastic/elasticsearch/issues/95489,2023-04-24T08:40:51Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95489,"{
  ""application_resource"": ""no""
}"
281,95384,[CI] SearchWithMinCompatibleSearchNodeIT testMinVersionAsNewVersion failing,"Tagging as TSDB issue since the error is:

```
[2023-04-19T13:16:16,446][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [v8.1.1-0] fatal error in thread [elasticsearch[v8.1.1-0][write][T#13]], exiting java.lang.AssertionError: expected mapper parsing failures. got org.elasticsearch.index.mapper.DocumentParsingException: [1:134] failed to parse: _id must be unset or set to [7XQzc-TMfQ1jepZDAAABeRnDq7M] but was [Zl2omYcBecgk29tWmlOQ] because [test] is in time_series mode
```

**Build scan:**
https://gradle-enterprise.elastic.co/s/wqpond4z7i75a/tests/:qa:mixed-cluster:v8.1.1%23mixedClusterTest/org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT/testMinVersionAsNewVersion

**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v8.1.1#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT"" -Dtests.method=""testMinVersionAsNewVersion"" -Dtests.seed=3C2140849CB1BE41 -Dtests.bwc=true -Dtests.locale=en-AU -Dtests.timezone=America/Cuiaba -Druntime.java=20
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT&tests.test=testMinVersionAsNewVersion

**Failure excerpt:**
```
java.lang.AssertionError: timed out waiting for green state for index [test_min_version] cluster state [{
  ""cluster_name"" : ""v8.1.1"",
  ""cluster_uuid"" : ""9RCkmDTUSH-UiHXjPvEsqA"",
  ""version"" : 18895,
  ""state_uuid"" : ""s3KjsbLuRWSMmfAR7SjIIg"",
  ""master_node"" : ""jKGXG40FSAycCNoRpzvMoA"",
  ""blocks"" : { },
  ""nodes"" : {
    ""jKGXG40FSAycCNoRpzvMoA"" : {
      ""name"" : ""v8.1.1-3"",
      ""ephemeral_id"" : ""AEA0fFnATqaNQWcyBSt0og"",
      ""transport_address"" : ""127.0.0.1:35366"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""ml.machine_memory"" : ""101200584704"",
        ""xpack.installed"" : ""true""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    },
    ""UJbqP_V2Q3ORXfhzxRzGBA"" : {
      ""name"" : ""v8.1.1-1"",
      ""ephemeral_id"" : ""Pb3wcrCOSkmLCYEp5tDvRQ"",
      ""transport_address"" : ""127.0.0.1:39230"",
      ""attributes"" : {
        ""ml.allocated_processors_double"" : ""32.0"",
        ""upgraded"" : ""true"",
        ""ml.machine_memory"" : ""101200584704"",
        ""xpack.installed"" : ""true"",
        ""testattr"" : ""test"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""ml.allocated_processors"" : ""32""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    },
    ""DQokkvqZRfaN_j1IuLRFtA"" : {
      ""name"" : ""v8.1.1-2"",
      ""ephemeral_id"" : ""t-Ptga26RXCFQFAVF3InAw"",
      ""transport_address"" : ""127.0.0.1:37222"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""ml.machine_memory"" : ""101200584704"",
        ""xpack.installed"" : ""true"",
        ""ml.max_jvm_size"" : ""536870912""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    }
  },
  ""metadata"" : {
    ""cluster_uuid"" : ""9RCkmDTUSH-UiHXjPvEsqA"",
    ""cluster_uuid_committed"" : true,
    ""cluster_coordination"" : {
      ""term"" : 7,
      ""last_committed_config"" : [
        ""jKGXG40FSAycCNoRpzvMoA"",
        ""UJbqP_V2Q3ORXfhzxRzGBA"",
        ""DQokkvqZRfaN_j1IuLRFtA""
      ],
      ""last_accepted_config"" : [
        ""jKGXG40FSAycCNoRpzvMoA"",
        ""UJbqP_V2Q3ORXfhzxRzGBA"",
        ""DQokkvqZRfaN_j1IuLRFtA""
      ],
      ""voting_config_exclusions"" : [ ]
    },
    ""templates"" : {
      "".monitoring-alerts-7"" : {
        ""order"" : 0,
        ""version"" : 8010099,
        ""index_patterns"" : [
          "".monitoring-alerts-7""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""timestamp"" : {
                ""type"" : ""date""
              },
              ""update_timestamp"" : {
                ""type"" : ""date""
              },
              ""resolved_timestamp"" : {
                ""type"" : ""date""
              },
              ""prefix"" : {
                ""type"" : ""text""
              },
              ""message"" : {
                ""type"" : ""text""
              },
              ""suffix"" : {
                ""type"" : ""text""
              },
              ""metadata"" : {
                ""properties"" : {
                  ""cluster_uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""link"" : {
                    ""type"" : ""keyword""
                  },
                  ""severity"" : {
                    ""type"" : ""short""
                  },
                  ""type"" : {
                    ""type"" : ""keyword""
                  },
                  ""version"" : {
                    ""type"" : ""keyword""
                  },
                  ""watch"" : {
                    ""type"" : ""keyword""
                  }
                }
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-kibana"" : {
        ""order"" : 0,
        ""version"" : 8010099,
        ""index_patterns"" : [
          "".monitoring-kibana-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""timestamp"" : {
                ""type"" : ""date"",
                ""format"" : ""date_time""
              },
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""type"" : ""date"",
                    ""format"" : ""date_time""
                  }
                }
              },
              ""kibana_stats"" : {
                ""properties"" : {
                  ""usage"" : {
                    ""properties"" : {
                      ""index"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""kibana"" : {
                    ""properties"" : {
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""transport_address"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      },
                      ""snapshot"" : {
                        ""type"" : ""boolean""
                      },
                      ""status"" : {
                        ""type"" : ""keyword""
                      },
                      ""statuses"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""state"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      }
                    }
                  },
                  ""cloud"" : {
                    ""properties"" : {
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""id"" : {
                        ""type"" : ""keyword""
                      },
                      ""vm_type"" : {
                        ""type"" : ""keyword""
                      },
                      ""region"" : {
                        ""type"" : ""keyword""
                      },
                      ""zone"" : {
                        ""type"" : ""keyword""
                      },
                      ""metadata"" : {
                        ""type"" : ""object""
                      }
                    }
                  },
                  ""os"" : {
                    ""properties"" : {
                      ""load"" : {
                        ""properties"" : {
                          ""1m"" : {
                            ""type"" : ""half_float""
                          },
                          ""5m"" : {
                            ""type"" : ""half_float""
                          },
                          ""15m"" : {
                            ""type"" : ""half_float""
                          }
                        }
                      },
                      ""memory"" : {
                        ""properties"" : {
                          ""total_in_bytes"" : {
                            ""type"" : ""float""
                          },
                          ""free_in_bytes"" : {
                            ""type"" : ""float""
                          },
                          ""used_in_bytes"" : {
                            ""type"" : ""float""
                          }
                        }
                      },
                      ""uptime_in_millis"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""process"" : {
                    ""properties"" : {
                      ""memory"" : {
                        ""properties"" : {
                          ""heap"" : {
                            ""properties"" : {
                              ""total_in_bytes"" : {
                                ""type"" : ""float""
                              },
                              ""used_in_bytes"" : {
                                ""type"" : ""float""
                              },
                              ""size_limit"" : {
                                ""type"" : ""float""
                              }
                            }
                          },
                          ""resident_set_size_in_bytes"" : {
                            ""type"" : ""float""
                          }
                        }
                      },
                      ""event_loop_delay"" : {
                        ""type"" : ""float""
                      },
                      ""uptime_in_millis"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""sockets"" : {
                    ""properties"" : {
                      ""http"" : {
                        ""properties"" : {
                          ""total"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""https"" : {
                        ""properties"" : {
                          ""total"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""type"" : ""date""
                  },
                  ""requests"" : {
                    ""properties"" : {
                      ""disconnects"" : {
                        ""type"" : ""long""
                      },
                      ""total"" : {
                        ""type"" : ""long""
                      },
                      ""status_codes"" : {
                        ""type"" : ""object""
                      }
                    }
                  },
                  ""response_times"" : {
                    ""properties"" : {
                      ""average"" : {
                        ""type"" : ""float""
                      },
                      ""max"" : {
                        ""type"" : ""float""
                      }
                    }
                  },
                  ""concurrent_connections"" : {
                    ""type"" : ""long""
                  }
                }
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-beats"" : {
        ""order"" : 0,
        ""version"" : 8010099,
        ""index_patterns"" : [
          "".monitoring-beats-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""beats_state"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""state"" : {
                    ""properties"" : {
                      ""beat"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""host"" : {
                        ""properties"" : {
                          ""architecture"" : {
                            ""type"" : ""keyword""
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""hostname"" : {
                            ""type"" : ""keyword""
                          },
                          ""os"" : {
                            ""properties"" : {
                              ""build"" : {
                                ""type"" : ""keyword""
                              },
                              ""family"" : {
                                ""type"" : ""keyword""
                              },
                              ""platform"" : {
                                ""type"" : ""keyword""
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          }
                        }
                      },
                      ""input"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          },
                          ""names"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""module"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          },
                          ""names"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""output"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""service"" : {
                        ""properties"" : {
                          ""id"" : {
                            ""type"" : ""keyword""
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""version"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""format"" : ""date_time"",
                    ""type"" : ""date""
                  }
                }
              },
              ""beats_stats"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""metrics"" : {
                    ""properties"" : {
                      ""beat"" : {
                        ""properties"" : {
                          ""cgroup"" : {
                            ""properties"" : {
                              ""cpu"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""cfs"" : {
                                    ""properties"" : {
                                      ""period"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""quota"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""stats"" : {
                                    ""properties"" : {
                                      ""periods"" : {
                                        ""type"" : ""long""
                                      },
                                      ""throttled"" : {
                                        ""properties"" : {
                                          ""periods"" : {
                                            ""type"" : ""long""
                                          },
                                          ""ns"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              ""cpuacct"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""total"" : {
                                    ""properties"" : {
                                      ""ns"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""memory"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""mem"" : {
                                    ""properties"" : {
                                      ""limit"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""usage"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""cpu"" : {
                            ""properties"" : {
                              ""system"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""total"" : {
                                ""properties"" : {
                                  ""value"" : {
                                    ""type"" : ""long""
                                  },
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""user"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""info"" : {
                            ""properties"" : {
                              ""ephemeral_id"" : {
                                ""type"" : ""keyword""
                              },
                              ""uptime"" : {
                                ""properties"" : {
                                  ""ms"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          },
                          ""memstats"" : {
                            ""properties"" : {
                              ""gc_next"" : {
                                ""type"" : ""long""
                              },
                              ""memory_alloc"" : {
                                ""type"" : ""long""
                              },
                              ""memory_total"" : {
                                ""type"" : ""long""
                              },
                              ""rss"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""handles"" : {
                            ""properties"" : {
                              ""open"" : {
                                ""type"" : ""long""
                              },
                              ""limit"" : {
                                ""properties"" : {
                                  ""hard"" : {
                                    ""type"" : ""long""
                                  },
                                  ""soft"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""apm-server"" : {
                        ""properties"" : {
                          ""acm"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unavailable"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      },
                                      ""notfound"" : {
                                        ""type"" : ""long""
                                      },
                                      ""invalidquery"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""notmodified"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""unset"" : {
                                    ""type"" : ""long""
                                  },
                                  ""request"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""server"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""concurrent"" : {
                                ""properties"" : {
                                  ""wait"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""concurrency"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""decoder"" : {
                            ""properties"" : {
                              ""deflate"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""gzip"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""uncompressed"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reader"" : {
                                ""properties"" : {
                                  ""size"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""missing-content-length"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""processor"" : {
                            ""properties"" : {
                              ""metric"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""sourcemap"" : {
                                ""properties"" : {
                                  ""counter"" : {
                                    ""type"" : ""long""
                                  },
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""transaction"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""transactions"" : {
                                    ""type"" : ""long""
                                  },
                                  ""spans"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stacktraces"" : {
                                    ""type"" : ""long""
                                  },
                                  ""frames"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""error"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stacktraces"" : {
                                    ""type"" : ""long""
                                  },
                                  ""frames"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""span"" : {
                                ""properties"" : {
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""sampling"" : {
                            ""properties"" : {
                              ""transactions_dropped"" : {
                                ""type"" : ""long""
                              },
                              ""tail"" : {
                                ""properties"" : {
                                  ""dynamic_service_groups"" : {
                                    ""type"" : ""long""
                                  },
                                  ""storage"" : {
                                    ""properties"" : {
                                      ""lsm_size"" : {
                                        ""type"" : ""long""
                                      },
                                      ""value_log_size"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""events"" : {
                                    ""properties"" : {
                                      ""processed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""dropped"" : {
                                        ""type"" : ""long""
                                      },
                                      ""stored"" : {
                                        ""type"" : ""long""
                                      },
                                      ""sampled"" : {
                                        ""type"" : ""long""
                                      },
                                      ""head_unsampled"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""libbeat"" : {
                        ""properties"" : {
                          ""config"" : {
                            ""properties"" : {
                              ""module"" : {
                                ""properties"" : {
                                  ""running"" : {
                                    ""type"" : ""long""
                                  },
                                  ""starts"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stops"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reloads"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""output"" : {
                            ""properties"" : {
                              ""events"" : {
                                ""properties"" : {
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  },
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""batches"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""duplicates"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""total"" : {
                                    ""type"" : ""long""
                                  },
                                  ""toomany"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""read"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""type"" : {
                                ""type"" : ""keyword""
                              },
                              ""write"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""pipeline"" : {
                            ""properties"" : {
                              ""clients"" : {
                                ""type"" : ""long""
                              },
                              ""events"" : {
                                ""properties"" : {
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""filtered"" : {
                                    ""type"" : ""long""
                                  },
                                  ""published"" : {
                                    ""type"" : ""long""
                                  },
                                  ""retry"" : {
                                    ""type"" : ""long""
                                  },
                                  ""total"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""queue"" : {
                                ""properties"" : {
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""system"" : {
                        ""properties"" : {
                          ""load"" : {
                            ""properties"" : {
                              ""1"" : {
                                ""type"" : ""double""
                              },
                              ""15"" : {
                                ""type"" : ""double""
                              },
                              ""5"" : {
                                ""type"" : ""double""
                              },
                              ""norm"" : {
                                ""properties"" : {
                                  ""1"" : {
                                    ""type"" : ""double""
                                  },
                                  ""15"" : {
                                    ""type"" : ""double""
                                  },
                                  ""5"" : {
                                    ""type...
```",n1v0lg,closed,"['>test-failure', ':StorageEngine/TSDB', 'low-risk', 'Team:StorageEngine']",https://github.com/elastic/elasticsearch/issues/95384,2023-04-19T14:52:56Z,7,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95384,"{
  ""application_resource"": ""yes""
}"
282,95358,Test aggregations on counters and gauges in TSDB Rally track,"### Description

Right now the aggregation queries we have in the TSDB Rally track mainly run on fields that are not counters nor gauges.
The only gauge field we aggregate on is `kubernetes.container.memory.usage.bytes`.

Time series indices exist to collect and aggregate metrics. As a result we should increase our coverage when it comes to running aggregation queries on time series indices.
Other tracks (noaa, nyc_taxis) already cover aggregations on non-metric fields (as a result of operating on regular non-time series indices). For this reason we should change TSDB aggregation queries to operate on counters and gauges rather then on labels.

NOTE: probably it would also be useful to have a cardinality aggregation running on a dimension field and on a non-dimension field.",salvatore-campagna,closed,"['>enhancement', ':Analytics/Aggregations', 'Team:Analytics']",https://github.com/elastic/elasticsearch/issues/95358,2023-04-19T09:09:18Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95358,"{
  ""application_resource"": ""no""
}"
283,95355,TDigest & HdrHistogram fork,"### Description

We would like to have our own fork for both the following libraries:
 * TDigest: https://github.com/tdunning/t-digest
 * HdrHistogram https://github.com/HdrHistogram/HdrHistogram

There are two main reasons behind this choice:
1. We would like to control semantic version and backward compatibility according to our definition. Right now, for instance, TDigest does not match our usage of semantic versioning when changing the library code and that makes upgrading quite challenging because exposes us to backward compatibility issues.
2. We would like to change those libraries to use some specific Elasticsearch libraries/tools/frameworks such as BigArrays. Right now when running some aggregations (percentiles, boxplot,...) we experience OOMs due to large memory usage. Using BigArrays, for instance, would allow us to deal with OOMs using Circuit Breakers.",salvatore-campagna,closed,"['>enhancement', ':Analytics/Aggregations', 'Team:Analytics']",https://github.com/elastic/elasticsearch/issues/95355,2023-04-19T08:37:40Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95355,"{
  ""application_resource"": ""yes""
}"
284,95125,Failure accessing class MacOsPreallocator,"### Elasticsearch Version

8.8.0-SNAPSHOT

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

macOS 13.3

### Problem Description

When running the Yaml rest tests on macOS the Elasticsearch node fails to start.

```
Caused by: java.lang.IllegalAccessException: class com.sun.jna.Structure (in module com.sun.jna) cannot access class org.elasticsearch.preallocate.MacOsPreallocator$Natives$Fcntl$FStore (in module org.elasticsearch.preallocate) because module org.elasticsearch.preallocate does not export org.elasticsearch.preallocate to module com.sun.jna
```

And the last 2 log messages.
```
Â» [2023-04-11T09:40:55,474][INFO ][o.e.p.Preallocate        ] [yamlRestTest-0] pre-allocating cache file [/Users/davidkyle/source/elasticsearch/x-pack/plugin/build/testclusters/yamlRestTest-0/data/shared_snapshot_cache] (16777216 bytes) using native methods
Â» [2023-04-11T08:40:56.184025Z] [BUILD] Stopping node
```

If Elasticsearch is started with `./gradlew run` then the error does not occur - because the `pre-allocating cache file`  event is not triggered

Possibly related to #94884


### Steps to Reproduce

Run a test:
```
./gradlew ':x-pack:plugin:yamlRestTest' --tests ""org.elasticsearch.xpack.test.rest.XPackRestIT.test {p0=ml/3rd_party_deployment/*}""
```

### Logs (if relevant)

When running the Yaml rest test

```
[2023-04-11T09:17:45.069118Z] [BUILD] Setting up 3 additional config files
[2023-04-11T09:17:45.070657Z] [BUILD] Copying additional config files from distro [/Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/jvm.options.d, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/users_roles, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/role_mapping.yml, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/users, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/elasticsearch.yml, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/roles.yml, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/log4j2.properties, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/elasticsearch-plugins.example.yml, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/jvm.options]
[2023-04-11T09:17:45.072416Z] [BUILD] Creating elasticsearch keystore with password set to []
[2023-04-11T09:17:45.714354Z] [BUILD] Adding 2 keystore settings and 0 keystore files
[2023-04-11T09:17:47.119935Z] [BUILD] Installing 0 modules
[2023-04-11T09:17:47.120161Z] [BUILD] Setting up 1 users
[2023-04-11T09:17:47.903670Z] [BUILD] Setting up roles.yml
[2023-04-11T09:17:47.903975Z] [BUILD] Starting Elasticsearch process
[2023-04-11T10:17:49,686][INFO ][o.e.c.u.FeatureFlag      ] [yamlRestTest-0] The current build is a snapshot, feature flag [untrusted_remote_cluster] is enabled
[2023-04-11T10:17:50,081][INFO ][o.e.n.Node               ] [yamlRestTest-0] version[8.8.0-SNAPSHOT], pid[63135], build[tar/67ccbd8aabd0047327322920168dde2106b1f37e/2023-04-11T08:32:27.730052Z], OS[Mac OS X/13.3/aarch64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/20/20+36-2344]
[2023-04-11T10:17:50,081][INFO ][o.e.n.Node               ] [yamlRestTest-0] JVM home [/Users/davidkyle/.gradle/caches/transforms-3/9724627d5cf99175aa30a9bab0366ce2/transformed/macos-20-aarch64.tar.gz/Contents/Home], using bundled JDK [false]
[2023-04-11T10:17:50,082][INFO ][o.e.n.Node               ] [yamlRestTest-0] JVM arguments [-Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -Djava.security.manager=allow, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Dlog4j2.formatMsgNoLookups=true, -Djava.locale.providers=SPI,COMPAT, --add-opens=java.base/java.io=org.elasticsearch.preallocate, -XX:+UseG1GC, -Djava.io.tmpdir=/Users/davidkyle/source/elasticsearch/x-pack/plugin/build/testclusters/yamlRestTest-0/tmp, -XX:+HeapDumpOnOutOfMemoryError, -XX:+ExitOnOutOfMemoryError, -XX:HeapDumpPath=/Users/davidkyle/source/elasticsearch/x-pack/plugin/build/testclusters/yamlRestTest-0/logs, -XX:ErrorFile=/Users/davidkyle/source/elasticsearch/x-pack/plugin/build/testclusters/yamlRestTest-0/logs/hs_err_pid%p.log, -Xlog:gc*,gc+age=trace,safepoint:file=/Users/davidkyle/source/elasticsearch/x-pack/plugin/build/testclusters/yamlRestTest-0/logs/gc.log:utctime,level,pid,tags:filecount=32,filesize=64m, -Xms512m, -Xmx512m, -ea, -esa, -Dingest.geoip.downloader.enabled.default=false, -Dio.netty.leakDetection.level=paranoid, -XX:MaxDirectMemorySize=268435456, -XX:G1HeapRegionSize=4m, -XX:InitiatingHeapOccupancyPercent=30, -XX:G1ReservePercent=15, -Des.distribution.type=tar, --module-path=/Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/lib, --add-modules=jdk.net, --add-modules=org.elasticsearch.preallocate, -Djdk.module.main=org.elasticsearch.server]
[2023-04-11T10:17:50,082][WARN ][o.e.n.Node               ] [yamlRestTest-0] version [8.8.0-SNAPSHOT] is a pre-release version of Elasticsearch and is not suitable for production
[2023-04-11T10:17:50,995][WARN ][stderr                   ] [yamlRestTest-0] SLF4J: No SLF4J providers were found.
[2023-04-11T10:17:50,995][WARN ][stderr                   ] [yamlRestTest-0] SLF4J: Defaulting to no-operation (NOP) logger implementation
[2023-04-11T10:17:50,995][WARN ][stderr                   ] [yamlRestTest-0] SLF4J: See https://www.slf4j.org/codes.html#noProviders for further details.
[2023-04-11T10:17:50,996][WARN ][stderr                   ] [yamlRestTest-0] SLF4J: Class path contains SLF4J bindings targeting slf4j-api versions 1.7.x or earlier.
[2023-04-11T10:17:50,996][WARN ][stderr                   ] [yamlRestTest-0] SLF4J: Ignoring binding found at [jar:file:///Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/modules/repository-azure/log4j-slf4j-impl-2.19.0.jar!/org/slf4j/impl/StaticLoggerBinder.class]
[2023-04-11T10:17:50,996][WARN ][stderr                   ] [yamlRestTest-0] SLF4J: See https://www.slf4j.org/codes.html#ignoredBindings for an explanation.
[2023-04-11T10:17:51,639][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [repository-url]
[2023-04-11T10:17:51,639][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [dlm]
[2023-04-11T10:17:51,639][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [ingest-user-agent]
[2023-04-11T10:17:51,639][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-core]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-async-search]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [test-error-query]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-monitoring]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [repository-s3]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-analytics]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-ent-search]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-autoscaling]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [lang-painless]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-ml]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [test-die-with-dignity]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [legacy-geo]
[2023-04-11T10:17:51,640][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [lang-mustache]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-ql]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [analysis-common]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [test-seek-tracking-directory]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [transport-netty4]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [aggregations]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [ingest-common]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-identity-provider]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [frozen-indices]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-text-structure]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-shutdown]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [snapshot-repo-test-kit]
[2023-04-11T10:17:51,641][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [test-delayed-aggs]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [kibana]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [constant-keyword]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-logstash]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-graph]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-ccr]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [parent-join]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-enrich]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [repositories-metering-api]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [transform]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [repository-azure]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [repository-gcs]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [spatial]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [apm]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [mapper-extras]
[2023-04-11T10:17:51,642][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [mapper-version]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-aggregate-metric]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-rollup]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [percolator]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [data-streams]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-stack]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [rank-eval]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [reindex]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-security]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [blob-cache]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [searchable-snapshots]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [snapshot-based-recoveries]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-watcher]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [old-lucene-versions]
[2023-04-11T10:17:51,643][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-ilm]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-voting-only-node]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-deprecation]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-fleet]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-profiling]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [ingest-geoip]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-write-load-forecaster]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [search-business-rules]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [wildcard]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [ingest-attachment]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [unsigned-long]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-sql]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [runtime-fields-common]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-async]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [vector-tile]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [lang-expression]
[2023-04-11T10:17:51,644][INFO ][o.e.p.PluginsService     ] [yamlRestTest-0] loaded module [x-pack-eql]
[2023-04-11T10:17:51,720][INFO ][o.e.c.u.FeatureFlag      ] [yamlRestTest-0] The current build is a snapshot, feature flag [dlm] is enabled
[2023-04-11T10:17:52,766][INFO ][o.e.c.u.FeatureFlag      ] [yamlRestTest-0] The current build is a snapshot, feature flag [index_mode] is enabled
[2023-04-11T10:17:53,011][WARN ][stderr                   ] [yamlRestTest-0] Apr 11, 2023 10:17:53 AM org.apache.lucene.store.MemorySegmentIndexInputProvider <init>
[2023-04-11T10:17:53,017][INFO ][o.e.e.NodeEnvironment    ] [yamlRestTest-0] using [1] data paths, mounts [[/System/Volumes/Data (/dev/disk3s5)]], net usable_space [676.5gb], net total_space [926.3gb], types [apfs]
[2023-04-11T10:17:53,017][INFO ][o.e.e.NodeEnvironment    ] [yamlRestTest-0] heap size [512mb], compressed ordinary object pointers [true]
[2023-04-11T10:17:53,030][INFO ][o.e.n.Node               ] [yamlRestTest-0] node name [yamlRestTest-0], node ID [mYWbzdyvTlOgUXGuEC0wnA], cluster name [yamlRestTest], roles [ingest, data_frozen, ml, data_hot, transform, data_content, data_warm, master, remote_cluster_client, data, data_cold]
[2023-04-11T10:17:54,025][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [yamlRestTest-0] [controller/63136] [Main.cc@123] controller (64 bit): Version 8.8.0-SNAPSHOT (Build 4adddac391a6f5) Copyright (c) 2023 Elasticsearch BV
[2023-04-11T10:17:54,144][INFO ][o.e.x.s.Security         ] [yamlRestTest-0] Security is enabled
[2023-04-11T10:17:54,521][INFO ][o.e.x.s.a.s.FileRolesStore] [yamlRestTest-0] parsed [1] roles from file [/Users/davidkyle/source/elasticsearch/x-pack/plugin/build/testclusters/yamlRestTest-0/config/roles.yml]
[2023-04-11T10:17:54,737][INFO ][o.e.p.Preallocate        ] [yamlRestTest-0] pre-allocating cache file [/Users/davidkyle/source/elasticsearch/x-pack/plugin/build/testclusters/yamlRestTest-0/data/shared_snapshot_cache] (16777216 bytes) using native methods
[2023-04-11T10:17:54,739][ERROR][o.e.b.Elasticsearch      ] [yamlRestTest-0] fatal exception while booting Elasticsearch java.lang.Error: Exception reading field 'fst_flags' in class org.elasticsearch.preallocate.MacOsPreallocator$Natives$Fcntl$FStore
	at com.sun.jna@5.10.0/com.sun.jna.Structure.getFieldValue(Structure.java:653)
	at com.sun.jna@5.10.0/com.sun.jna.Structure.deriveLayout(Structure.java:1318)
	at com.sun.jna@5.10.0/com.sun.jna.Structure.calculateSize(Structure.java:1192)
	at com.sun.jna@5.10.0/com.sun.jna.Structure.calculateSize(Structure.java:1144)
	at com.sun.jna@5.10.0/com.sun.jna.Structure.allocateMemory(Structure.java:426)
	at com.sun.jna@5.10.0/com.sun.jna.Structure.<init>(Structure.java:216)
	at com.sun.jna@5.10.0/com.sun.jna.Structure.<init>(Structure.java:204)
	at com.sun.jna@5.10.0/com.sun.jna.Structure.<init>(Structure.java:191)
	at com.sun.jna@5.10.0/com.sun.jna.Structure.<init>(Structure.java:183)
	at org.elasticsearch.preallocate@8.8.0-SNAPSHOT/org.elasticsearch.preallocate.MacOsPreallocator$Natives$Fcntl$FStore.<init>(MacOsPreallocator.java:83)
	at java.base/java.security.AccessController.doPrivileged(AccessController.java:319)
	at org.elasticsearch.preallocate@8.8.0-SNAPSHOT/org.elasticsearch.preallocate.MacOsPreallocator.preallocate(MacOsPreallocator.java:30)
	at org.elasticsearch.preallocate@8.8.0-SNAPSHOT/org.elasticsearch.preallocate.Preallocate.preallocate(Preallocate.java:55)
	at org.elasticsearch.preallocate@8.8.0-SNAPSHOT/org.elasticsearch.preallocate.Preallocate.preallocate(Preallocate.java:39)
	at org.elasticsearch.blobcache@8.8.0-SNAPSHOT/org.elasticsearch.blobcache.shared.SharedBytes.<init>(SharedBytes.java:75)
	at org.elasticsearch.blobcache@8.8.0-SNAPSHOT/org.elasticsearch.blobcache.shared.SharedBlobCacheService.<init>(SharedBlobCacheService.java:293)
	at org.elasticsearch.searchablesnapshots@8.8.0-SNAPSHOT/org.elasticsearch.xpack.searchablesnapshots.SearchableSnapshots.createComponents(SearchableSnapshots.java:344)
	at org.elasticsearch.server@8.8.0-SNAPSHOT/org.elasticsearch.node.Node.lambda$new$16(Node.java:723)
	at org.elasticsearch.server@8.8.0-SNAPSHOT/org.elasticsearch.plugins.PluginsService.lambda$flatMap$2(PluginsService.java:266)
	at java.base/java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:273)
	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)
	at java.base/java.util.AbstractList$RandomAccessSpliterator.forEachRemaining(AbstractList.java:722)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:575)
	at java.base/java.util.stream.AbstractPipeline.evaluateToArrayNode(AbstractPipeline.java:260)
	at java.base/java.util.stream.ReferencePipeline.toArray(ReferencePipeline.java:616)
	at java.base/java.util.stream.ReferencePipeline.toArray(ReferencePipeline.java:622)
	at java.base/java.util.stream.ReferencePipeline.toList(ReferencePipeline.java:627)
	at org.elasticsearch.server@8.8.0-SNAPSHOT/org.elasticsearch.node.Node.<init>(Node.java:738)
	at org.elasticsearch.server@8.8.0-SNAPSHOT/org.elasticsearch.node.Node.<init>(Node.java:326)
	at org.elasticsearch.server@8.8.0-SNAPSHOT/org.elasticsearch.bootstrap.Elasticsearch$2.<init>(Elasticsearch.java:216)
	at org.elasticsearch.server@8.8.0-SNAPSHOT/org.elasticsearch.bootstrap.Elasticsearch.initPhase3(Elasticsearch.java:216)
	at org.elasticsearch.server@8.8.0-SNAPSHOT/org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:67)
Caused by: java.lang.IllegalAccessException: class com.sun.jna.Structure (in module com.sun.jna) cannot access class org.elasticsearch.preallocate.MacOsPreallocator$Natives$Fcntl$FStore (in module org.elasticsearch.preallocate) because module org.elasticsearch.preallocate does not export org.elasticsearch.preallocate to module com.sun.jna
	at java.base/jdk.internal.reflect.Reflection.newIllegalAccessException(Reflection.java:394)
	at java.base/java.lang.reflect.AccessibleObject.checkAccess(AccessibleObject.java:709)
	at java.base/java.lang.reflect.Field.checkAccess(Field.java:1154)
	at java.base/java.lang.reflect.Field.get(Field.java:439)
	at com.sun.jna@5.10.0/com.sun.jna.Structure.getFieldValue(Structure.java:650)
	... 33 more

ERROR: Elasticsearch did not exit normally - check the logs at /Users/davidkyle/source/elasticsearch/x-pack/plugin/build/testclusters/yamlRestTest-0/logs/yamlRestTest.log

ERROR: Elasticsearch exited unexpectedly
[2023-04-11T09:17:55.511678Z] [BUILD] Stopping node
```



And the log for a successful start using `./gradlew run`
```
[2023-04-11T09:22:08.235585Z] [BUILD] Copying additional config files from distro [/Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/jvm.options.d, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/users_roles, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/role_mapping.yml, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/users, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/elasticsearch.yml, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/roles.yml, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/log4j2.properties, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/elasticsearch-plugins.example.yml, /Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/config/jvm.options]
[2023-04-11T09:22:08.238172Z] [BUILD] Creating elasticsearch keystore with password set to []
[2023-04-11T09:22:09.050365Z] [BUILD] Adding 1 keystore settings and 0 keystore files
[2023-04-11T09:22:09.739501Z] [BUILD] Installing 0 modules
[2023-04-11T09:22:09.739788Z] [BUILD] Setting up 1 users
[2023-04-11T09:22:10.531505Z] [BUILD] Setting up roles.yml
[2023-04-11T09:22:10.532076Z] [BUILD] Starting Elasticsearch process
[2023-04-11T10:22:12,388][INFO ][o.e.c.u.FeatureFlag      ] [runTask-0] The current build is a snapshot, feature flag [untrusted_remote_cluster] is enabled
[2023-04-11T10:22:12,767][INFO ][o.e.n.Node               ] [runTask-0] version[8.8.0-SNAPSHOT], pid[63272], build[tar/67ccbd8aabd0047327322920168dde2106b1f37e/2023-04-11T08:32:27.730052Z], OS[Mac OS X/13.3/aarch64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/20/20+36-2344]
[2023-04-11T10:22:12,768][INFO ][o.e.n.Node               ] [runTask-0] JVM home [/Users/davidkyle/.gradle/caches/transforms-3/9724627d5cf99175aa30a9bab0366ce2/transformed/macos-20-aarch64.tar.gz/Contents/Home], using bundled JDK [false]
[2023-04-11T10:22:12,768][INFO ][o.e.n.Node               ] [runTask-0] JVM arguments [-Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -Djava.security.manager=allow, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Dlog4j2.formatMsgNoLookups=true, -Djava.locale.providers=SPI,COMPAT, --add-opens=java.base/java.io=org.elasticsearch.preallocate, -XX:+UseG1GC, -Djava.io.tmpdir=/Users/davidkyle/source/elasticsearch/build/testclusters/runTask-0/tmp, -XX:+HeapDumpOnOutOfMemoryError, -XX:+ExitOnOutOfMemoryError, -XX:HeapDumpPath=/Users/davidkyle/source/elasticsearch/build/testclusters/runTask-0/logs, -XX:ErrorFile=/Users/davidkyle/source/elasticsearch/build/testclusters/runTask-0/logs/hs_err_pid%p.log, -Xlog:gc*,gc+age=trace,safepoint:file=/Users/davidkyle/source/elasticsearch/build/testclusters/runTask-0/logs/gc.log:utctime,level,pid,tags:filecount=32,filesize=64m, -Xms512m, -Xmx512m, -ea, -esa, -Dingest.geoip.downloader.enabled.default=true, -Dio.netty.leakDetection.level=paranoid, -XX:MaxDirectMemorySize=268435456, -XX:G1HeapRegionSize=4m, -XX:InitiatingHeapOccupancyPercent=30, -XX:G1ReservePercent=15, -Des.distribution.type=tar, --module-path=/Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/lib, --add-modules=jdk.net, --add-modules=org.elasticsearch.preallocate, -Djdk.module.main=org.elasticsearch.server]
[2023-04-11T10:22:12,769][WARN ][o.e.n.Node               ] [runTask-0] version [8.8.0-SNAPSHOT] is a pre-release version of Elasticsearch and is not suitable for production
[2023-04-11T10:22:13,840][WARN ][stderr                   ] [runTask-0] SLF4J: No SLF4J providers were found.
[2023-04-11T10:22:13,840][WARN ][stderr                   ] [runTask-0] SLF4J: Defaulting to no-operation (NOP) logger implementation
[2023-04-11T10:22:13,841][WARN ][stderr                   ] [runTask-0] SLF4J: See https://www.slf4j.org/codes.html#noProviders for further details.
[2023-04-11T10:22:13,841][WARN ][stderr                   ] [runTask-0] SLF4J: Class path contains SLF4J bindings targeting slf4j-api versions 1.7.x or earlier.
[2023-04-11T10:22:13,841][WARN ][stderr                   ] [runTask-0] SLF4J: Ignoring binding found at [jar:file:///Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/modules/repository-azure/log4j-slf4j-impl-2.19.0.jar!/org/slf4j/impl/StaticLoggerBinder.class]
[2023-04-11T10:22:13,841][WARN ][stderr                   ] [runTask-0] SLF4J: See https://www.slf4j.org/codes.html#ignoredBindings for an explanation.
[2023-04-11T10:22:14,582][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [repository-url]
[2023-04-11T10:22:14,583][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [dlm]
[2023-04-11T10:22:14,583][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [ingest-user-agent]
[2023-04-11T10:22:14,583][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-core]
[2023-04-11T10:22:14,583][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-async-search]
[2023-04-11T10:22:14,583][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [test-error-query]
[2023-04-11T10:22:14,583][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-monitoring]
[2023-04-11T10:22:14,583][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [repository-s3]
[2023-04-11T10:22:14,583][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-analytics]
[2023-04-11T10:22:14,583][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-ent-search]
[2023-04-11T10:22:14,583][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-autoscaling]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [lang-painless]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-ml]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [test-die-with-dignity]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [legacy-geo]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [lang-mustache]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-ql]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [analysis-common]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [test-seek-tracking-directory]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [transport-netty4]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [aggregations]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [ingest-common]
[2023-04-11T10:22:14,584][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-identity-provider]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [frozen-indices]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-text-structure]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-shutdown]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [snapshot-repo-test-kit]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [test-delayed-aggs]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [kibana]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [constant-keyword]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-logstash]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-graph]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-ccr]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [parent-join]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-enrich]
[2023-04-11T10:22:14,585][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [repositories-metering-api]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [transform]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [repository-azure]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [repository-gcs]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [spatial]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [apm]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [mapper-extras]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [mapper-version]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-aggregate-metric]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-rollup]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [percolator]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [data-streams]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-stack]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [rank-eval]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [reindex]
[2023-04-11T10:22:14,586][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-security]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [blob-cache]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [searchable-snapshots]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [snapshot-based-recoveries]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-watcher]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [old-lucene-versions]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-ilm]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-voting-only-node]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-deprecation]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-fleet]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-profiling]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [ingest-geoip]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-write-load-forecaster]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [search-business-rules]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [wildcard]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [ingest-attachment]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [unsigned-long]
[2023-04-11T10:22:14,587][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-sql]
[2023-04-11T10:22:14,588][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [runtime-fields-common]
[2023-04-11T10:22:14,588][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-async]
[2023-04-11T10:22:14,588][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [vector-tile]
[2023-04-11T10:22:14,588][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [lang-expression]
[2023-04-11T10:22:14,588][INFO ][o.e.p.PluginsService     ] [runTask-0] loaded module [x-pack-eql]
[2023-04-11T10:22:14,669][INFO ][o.e.c.u.FeatureFlag      ] [runTask-0] The current build is a snapshot, feature flag [dlm] is enabled
[2023-04-11T10:22:15,766][INFO ][o.e.c.u.FeatureFlag      ] [runTask-0] The current build is a snapshot, feature flag [index_mode] is enabled
[2023-04-11T10:22:15,999][WARN ][stderr                   ] [runTask-0] Apr 11, 2023 10:22:15 AM org.apache.lucene.store.MemorySegmentIndexInputProvider <init>
[2023-04-11T10:22:16,004][INFO ][o.e.e.NodeEnvironment    ] [runTask-0] using [1] data paths, mounts [[/System/Volumes/Data (/dev/disk3s5)]], net usable_space [676.5gb], net total_space [926.3gb], types [apfs]
[2023-04-11T10:22:16,004][INFO ][o.e.e.NodeEnvironment    ] [runTask-0] heap size [512mb], compressed ordinary object pointers [true]
[2023-04-11T10:22:16,014][INFO ][o.e.n.Node               ] [runTask-0] node name [runTask-0], node ID [KYaPm967SF2w1vNlSm6vaw], cluster name [runTask], roles [ingest, data_frozen, ml, data_hot, transform, data_content, data_warm, master, remote_cluster_client, data, data_cold]
[2023-04-11T10:22:17,034][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [runTask-0] [controller/63273] [Main.cc@123] controller (64 bit): Version 8.8.0-SNAPSHOT (Build 4adddac391a6f5) Copyright (c) 2023 Elasticsearch BV
[2023-04-11T10:22:17,175][INFO ][o.e.x.s.Security         ] [runTask-0] Security is enabled
[2023-04-11T10:22:17,507][INFO ][o.e.x.s.a.s.FileRolesStore] [runTask-0] parsed [1] roles from file [/Users/davidkyle/source/elasticsearch/build/testclusters/runTask-0/config/roles.yml]
[2023-04-11T10:22:17,843][INFO ][o.e.x.p.ProfilingPlugin  ] [runTask-0] Profiling is enabled
[2023-04-11T10:22:18,134][WARN ][stderr                   ] [runTask-0] SLF4J: No SLF4J providers were found.
[2023-04-11T10:22:18,134][WARN ][stderr                   ] [runTask-0] SLF4J: Defaulting to no-operation (NOP) logger implementation
[2023-04-11T10:22:18,134][WARN ][stderr                   ] [runTask-0] SLF4J: See https://www.slf4j.org/codes.html#noProviders for further details.
[2023-04-11T10:22:18,135][WARN ][stderr                   ] [runTask-0] SLF4J: Class path contains SLF4J bindings targeting slf4j-api versions 1.7.x or earlier.
[2023-04-11T10:22:18,135][WARN ][stderr                   ] [runTask-0] SLF4J: Ignoring binding found at [jar:file:///Users/davidkyle/source/elasticsearch/distribution/archives/darwin-aarch64-tar/build/install/elasticsearch-8.8.0-SNAPSHOT/modules/x-pack-security/log4j-slf4j-impl-2.19.0.jar!/org/slf4j/impl/StaticLoggerBinder.class]
[2023-04-11T10:22:18,135][WARN ][stderr                   ] [runTask-0] SLF4J: See https://www.slf4j.org/codes.html#ignoredBindings for an explanation.
[2023-04-11T10:22:18,152][INFO ][o.e.t.n.NettyAllocator   ] [runTask-0] creating NettyAllocator with the following configs: [name=unpooled, suggested_max_allocation_size=1mb, factors={es.unsafe.use_unpooled_allocator=null, g1gc_enabled=true, g1gc_region_size=4mb, heap_size=512mb}]
[2023-04-11T10:22:18,166][INFO ][o.e.i.r.RecoverySettings ] [runTask-0] using rate limit [40mb] with [default=40mb, read=0b, write=0b, max=0b]
[2023-04-11T10:22:18,187][INFO ][o.e.d.DiscoveryModule    ] [runTask-0] using discovery type [multi-node] and seed hosts providers [settings, file]
[2023-04-11T10:22:18,723][INFO ][o.e.n.Node               ] [runTask-0] initialized
[2023-04-11T10:22:18,724][INFO ][o.e.n.Node               ] [runTask-0] starting ...
[2023-04-11T10:22:18,745][INFO ][o.e.x.s.c.f.PersistentCache] [runTask-0] persistent cache index loaded
[2023-04-11T10:22:18,746][INFO ][o.e.x.d.l.DeprecationIndexingComponent] [runTask-0] deprecation component started
[2023-04-11T10:22:18,799][INFO ][o.e.t.TransportService   ] [runTask-0] publish_address {127.0.0.1:9300}, bound_addresses {[::1]:9300}, {127.0.0.1:9300}
[2023-04-11T10:22:18,882][WARN ][o.e.b.BootstrapChecks    ] [runTask-0] Transport SSL must be enabled if security is enabled. Please set [xpack.security.transport.ssl.enabled] to [true] or disable security by setting [xpack.security.enabled] to [false]
[2023-04-11T10:22:18,883][INFO ][o.e.c.c.ClusterBootstrapService] [runTask-0] this node has not joined a bootstrapped cluster yet; [cluster.initial_master_nodes] is set to [runTask-0]
[2023-04-11T10:22:18,886][WARN ][o.e.d.FileBasedSeedHostsProvider] [runTask-0] expected, but did not find, a dynamic hosts list at [/Users/davidkyle/source/elasticsearch/build/testclusters/runTask-0/config/unicast_hosts.txt]
[2023-04-11T10:22:18,886][INFO ][o.e.c.c.Coordinator      ] [runTask-0] setting initial configuration to VotingConfiguration{KYaPm967SF2w1vNlSm6vaw}
[2023-04-11T10:22:18,934][INFO ][o.e.h.AbstractHttpServerTransport] [runTask-0] publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200}
[2023-04-11T10:22:18,936][INFO ][o.e.n.Node               ] [runTask-0] started {runTask-0}{KYaPm967SF2w1vNlSm6vaw}{YXf9vn9gQL6vK3j8iugdKA}{runTask-0}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{8.8.0}{ml.max_jvm_size=536870912, ml.allocated_processors=10, testattr=test, ml.allocated_processors_double=10.0, ml.machine_memory=34359738368, xpack.installed=true}
[2023-04-11T10:22:19,048][INFO ][o.e.c.s.MasterService    ] [runTask-0] elected-as-master ([1] nodes joined in term 1)[_FINISH_ELECTION_, {runTask-0}{KYaPm967SF2w1vNlSm6vaw}{YXf9vn9gQL6vK3j8iugdKA}{runTask-0}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{8.8.0} completing election], term: 1, version: 1, delta: master node changed {previous [], current [{runTask-0}{KYaPm967SF2w1vNlSm6vaw}{YXf9vn9gQL6vK3j8iugdKA}{runTask-0}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{8.8.0}]}
[2023-04-11T10:22:19,081][INFO ][o.e.c.c.CoordinationState] [runTask-0] cluster UUID set to [S22Qy2hSSaKcv5py1KgPOw]
[2023-04-11T10:22:19,104][INFO ][o.e.c.s.ClusterApplierService] [runTask-0] master node changed {previous [], current [{runTask-0}{KYaPm967SF2w1vNlSm6vaw}{YXf9vn9gQL6vK3j8iugdKA}{runTask-0}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{8.8.0}]}, term: 1, version: 1, reason: Publication{term=1, version=1}
[2023-04-11T10:22:19,134][INFO ][o.e.r.s.AbstractFileWatchingService] [runTask-0] starting file watcher ...
[2023-04-11T10:22:19,137][INFO ][o.e.r.s.AbstractFileWatchingService] [runTask-0] file settings service up and running [tid=58]
[2023-04-11T10:22:19,139][INFO ][o.e.c.c.NodeJoinExecutor ] [runTask-0] node-join: [{runTask-0}{KYaPm967SF2w1vNlSm6vaw}{YXf9vn9gQL6vK3j8iugdKA}{runTask-0}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{8.8.0}] with reason [completing election]
[2023-04-11T10:22:19,180][INFO ][o.e.g.GatewayService     ] [runTask-0] recovered [0] indices into cluster_state
[2023-04-11T10:22:19,249][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [behavioral_analytics-events-mappings]
[2023-04-11T10:22:19,256][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.ml-state] for index patterns [.ml-state*]
[2023-04-11T10:22:19,277][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.monitoring-kibana-mb] for index patterns [.monitoring-kibana-8-*]
[2023-04-11T10:22:19,279][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [behavioral_analytics-events-settings]
[2023-04-11T10:22:19,284][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.ml-notifications-000002] for index patterns [.ml-notifications-000002]
[2023-04-11T10:22:19,288][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.ml-stats] for index patterns [.ml-stats-*]
[2023-04-11T10:22:19,302][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.monitoring-logstash-mb] for index patterns [.monitoring-logstash-8-*]
[2023-04-11T10:22:19,315][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.ml-anomalies-] for index patterns [.ml-anomalies-*]
[2023-04-11T10:22:19,319][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding template [.monitoring-kibana] for index patterns [.monitoring-kibana-7-*]
[2023-04-11T10:22:19,328][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding template [.monitoring-beats] for index patterns [.monitoring-beats-7-*]
[2023-04-11T10:22:19,338][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding template [.monitoring-es] for index patterns [.monitoring-es-7-*]
[2023-04-11T10:22:19,344][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding template [.monitoring-logstash] for index patterns [.monitoring-logstash-7-*]
[2023-04-11T10:22:19,346][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding template [.monitoring-alerts-7] for index patterns [.monitoring-alerts-7]
[2023-04-11T10:22:19,358][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.monitoring-ent-search-mb] for index patterns [.monitoring-ent-search-8-*]
[2023-04-11T10:22:19,382][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.monitoring-beats-mb] for index patterns [.monitoring-beats-8-*]
[2023-04-11T10:22:19,415][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.monitoring-es-mb] for index patterns [.monitoring-es-8-*]
[2023-04-11T10:22:19,417][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [synthetics-settings]
[2023-04-11T10:22:19,418][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [metrics-settings]
[2023-04-11T10:22:19,422][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [metrics-mappings]
[2023-04-11T10:22:19,424][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [logs-mappings]
[2023-04-11T10:22:19,425][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [synthetics-mappings]
[2023-04-11T10:22:19,426][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [logs-settings]
[2023-04-11T10:22:19,432][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [data-streams-mappings]
[2023-04-11T10:22:19,437][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [ilm-history] for index patterns [ilm-history-5*]
[2023-04-11T10:22:19,446][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.watch-history-16] for index patterns [.watcher-history-16*]
[2023-04-11T10:22:19,448][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [.deprecation-indexing-mappings]
[2023-04-11T10:22:19,452][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.slm-history] for index patterns [.slm-history-5*]
[2023-04-11T10:22:19,454][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.fleet-file-data] for index patterns [.fleet-file-data-*-*]
[2023-04-11T10:22:19,457][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.fleet-files] for index patterns [.fleet-files-*-*]
[2023-04-11T10:22:19,458][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding component template [.deprecation-indexing-settings]
[2023-04-11T10:22:19,524][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [behavioral_analytics-events-default] for index patterns [behavioral_analytics-events-*]
[2023-04-11T10:22:19,527][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [logs] for index patterns [logs-*-*]
[2023-04-11T10:22:19,530][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [synthetics] for index patterns [synthetics-*-*]
[2023-04-11T10:22:19,533][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [.deprecation-indexing-template] for index patterns [.logs-deprecation.*]
[2023-04-11T10:22:19,537][INFO ][o.e.c.m.MetadataIndexTemplateService] [runTask-0] adding index template [metrics] for index patterns [metrics-*-*]
[2023-04-11T10:22:19,564][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [.monitoring-8-ilm-policy]
[2023-04-11T10:22:19,603][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [ml-size-based-ilm-policy]
[2023-04-11T10:22:19,634][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [behavioral_analytics-events-default_policy]
[2023-04-11T10:22:19,676][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [metrics]
[2023-04-11T10:22:19,706][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [synthetics]
[2023-04-11T10:22:19,742][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [7-days-default]
[2023-04-11T10:22:19,771][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [30-days-default]
[2023-04-11T10:22:19,809][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [logs]
[2023-04-11T10:22:19,842][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [90-days-default]
[2023-04-11T10:22:19,877][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [365-days-default]
[2023-04-11T10:22:19,904][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [180-days-default]
[2023-04-11T10:22:19,938][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [watch-history-ilm-policy-16]
[2023-04-11T10:22:19,970][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [ilm-history-ilm-policy]
[2023-04-11T10:22:19,995][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [.deprecation-indexing-ilm-policy]
[2023-04-11T10:22:20,021][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [slm-history-ilm-policy]
[2023-04-11T10:22:20,059][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [.fleet-actions-results-ilm-policy]
[2023-04-11T10:22:20,084][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [.fleet-files-ilm-policy]
[2023-04-11T10:22:20,109][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [runTask-0] adding index lifecycle policy [.fleet-file-data-ilm-policy]
[2023-04-11T10:22:20,199][INFO ][o.e.h.n.s.HealthNodeTaskExecutor] [runTask-0] Node [{runTask-0}{KYaPm967SF2w1vNlSm6vaw}] is selected as the current health node.
[2023-04-11T10:22:20,286][INFO ][o.e.l.ClusterStateLicenseService] [runTask-0] license [54c6670a-0845-4969-b0d9-00f15fdb3b47] mode [basic] - valid
[2023-04-11T10:22:20,287][INFO ][o.e.x.s.a.Realms         ] [runTask-0] license mode is [basic], currently licensed security realms are [reserved/reserved,file/default_file,native/default_native]
```
",davidkyle,closed,"['>bug', ':Core/Infra/Core', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/95125,2023-04-11T09:23:00Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95125,"{
  ""application_resource"": ""yes""
}"
285,95013,[CI] MixedClusterClientYamlTestSuiteIT test {p0=aggregations/filter/Terms lookup gets cached} failing,"Three tests failed with the same error:

* [test {p0=aggregations/filter/Terms lookup gets cached}](https://gradle-enterprise.elastic.co/s/aui2knhkg45uu/tests/:qa:mixed-cluster:v8.7.1%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=aggregations%2Ffilter%2FTerms%20lookup%20gets%20cached%7D?page=eyJvdXRwdXQiOnsiMCI6IjIifX0&top-execution=1)
* [test {p0=aggregations/filters_bucket/cache hits}](https://gradle-enterprise.elastic.co/s/aui2knhkg45uu/tests/:qa:mixed-cluster:v8.7.1%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=aggregations%2Ffilters_bucket%2Fcache%20hits%7D?top-execution=1)
* [test {p0=aggregations/adjacency_matrix/Terms lookup}](https://gradle-enterprise.elastic.co/s/aui2knhkg45uu/tests/:qa:mixed-cluster:v8.7.1%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=aggregations%2Fadjacency_matrix%2FTerms%20lookup%7D?top-execution=1)

And the error was:

```
NodeSelector [version ranges [[8.8.0 - 8.8.0]]] rejected all nodes
```

But these tests were running `:qa:mixed-cluster:v8.7.1#mixedClusterTest`, so could this be something to do with last Fridays version bump to 8.7.1 after the 8.7.0 release?

All three failed 41 times in the last seven days, and all of these in the last two days, so something seems to have happened yesterday regarding 8.7.1. The version bump was done last Friday, so three days before the problem started.

**Build scan:**
https://gradle-enterprise.elastic.co/s/aui2knhkg45uu/tests/:qa:mixed-cluster:v8.7.1%23mixedClusterTest/org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT/test%20%7Bp0=aggregations%2Ffilter%2FTerms%20lookup%20gets%20cached%7D

**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v8.7.1#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT"" -Dtests.method=""test {p0=aggregations/filter/Terms lookup gets cached}"" -Dtests.seed=DE9A2ABE4DB4F01 -Dtests.bwc=true -Dtests.locale=sv-SE -Dtests.timezone=America/Porto_Velho -Druntime.java=17
```

**Applicable branches:**
main

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT&tests.test=test%20%7Bp0%3Daggregations/filter/Terms%20lookup%20gets%20cached%7D

**Failure excerpt:**
```
java.lang.RuntimeException: Failure at [aggregations/filter:31]: NodeSelector [version ranges [[8.8.0 - 8.8.0]]] rejected all nodes, living [[host=http://127.0.0.1:33951, bound=[http://127.0.0.1:33951, http://[::1]:33401], name=v8.7.1-3, version=8.7.1, roles=data,data_cold,data_content,data_frozen,data_hot,data_warm,ingest,master,ml,remote_cluster_client,transform, attributes={testattr=[test], ml.allocated_processors_double=[32.0], ml.machine_memory=[101259100160], xpack.installed=[true], ml.max_jvm_size=[536870912], ml.allocated_processors=[32]}], [host=http://127.0.0.1:43941, bound=[http://[::1]:41921, http://127.0.0.1:43941], name=v8.7.1-2, version=8.7.1, roles=data,data_cold,data_content,data_frozen,data_hot,data_warm,ingest,master,ml,remote_cluster_client,transform, attributes={testattr=[test], ml.allocated_processors_double=[32.0], ml.machine_memory=[101259100160], xpack.installed=[true], ml.max_jvm_size=[536870912], ml.allocated_processors=[32]}]] and dead []

  at __randomizedtesting.SeedInfo.seed([DE9A2ABE4DB4F01:85BD9D714A2722F9]:0)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:549)
  at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:499)
  at jdk.internal.reflect.GeneratedMethodAccessor18.invoke(null:-1)
  at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
  at java.lang.reflect.Method.invoke(Method.java:568)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:833)

  Caused by: java.io.IOException: NodeSelector [version ranges [[8.8.0 - 8.8.0]]] rejected all nodes, living [[host=http://127.0.0.1:33951, bound=[http://127.0.0.1:33951, http://[::1]:33401], name=v8.7.1-3, version=8.7.1, roles=data,data_cold,data_content,data_frozen,data_hot,data_warm,ingest,master,ml,remote_cluster_client,transform, attributes={testattr=[test], ml.allocated_processors_double=[32.0], ml.machine_memory=[101259100160], xpack.installed=[true], ml.max_jvm_size=[536870912], ml.allocated_processors=[32]}], [host=http://127.0.0.1:43941, bound=[http://[::1]:41921, http://127.0.0.1:43941], name=v8.7.1-2, version=8.7.1, roles=data,data_cold,data_content,data_frozen,data_hot,data_warm,ingest,master,ml,remote_cluster_client,transform, attributes={testattr=[test], ml.allocated_processors_double=[32.0], ml.machine_memory=[101259100160], xpack.installed=[true], ml.max_jvm_size=[536870912], ml.allocated_processors=[32]}]] and dead []

    at org.elasticsearch.client.RestClient.selectNodes(RestClient.java:516)
    at org.elasticsearch.client.RestClient.nextNodes(RestClient.java:448)
    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:288)
    at org.elasticsearch.test.rest.yaml.ClientYamlTestClient.callApi(ClientYamlTestClient.java:204)
    at org.elasticsearch.test.rest.yaml.ClientYamlTestExecutionContext.callApiInternal(ClientYamlTestExecutionContext.java:186)
    at org.elasticsearch.test.rest.yaml.ClientYamlTestExecutionContext.callApi(ClientYamlTestExecutionContext.java:106)
    at org.elasticsearch.test.rest.yaml.section.DoSection.execute(DoSection.java:344)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:527)
    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:499)
    at jdk.internal.reflect.GeneratedMethodAccessor18.invoke(null:-1)
    at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:568)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
    at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
    at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
    at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
    at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
    at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
    at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
    at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
    at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
    at java.lang.Thread.run(Thread.java:833)

```",craigtaverner,closed,"[':Analytics/Aggregations', '>test-failure', 'Team:Analytics']",https://github.com/elastic/elasticsearch/issues/95013,2023-04-04T10:16:24Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95013,"{
  ""application_resource"": ""yes""
}"
286,95011,[CI] SearchWithMinCompatibleSearchNodeIT testMinVersionAsOldVersion failing,"Three tests failed:

* [testMinVersionAsOldVersion](https://gradle-enterprise.elastic.co/s/s5wd3ztjvyjpa/tests/:qa:mixed-cluster:v8.7.1%23mixedClusterTest/org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT/testMinVersionAsOldVersion?top-execution=1)
* [testCcsMinimizeRoundtripsIsFalse](https://gradle-enterprise.elastic.co/s/s5wd3ztjvyjpa/tests/:qa:mixed-cluster:v8.7.1%23mixedClusterTest/org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT/testCcsMinimizeRoundtripsIsFalse?top-execution=1)
* [testMinVersionAsNewVersion](https://gradle-enterprise.elastic.co/s/s5wd3ztjvyjpa/tests/:qa:mixed-cluster:v8.7.1%23mixedClusterTest/org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT/testMinVersionAsNewVersion?top-execution=1)

All with the same error:

```
java.lang.AssertionError: timed out waiting for green state for index [test_min_version] cluster state [{	
  ""cluster_name"" : ""v8.7.1"",
...
```

Could this be related to the recent release of 8.7.0, and version bump to 8.7.1?  But over a hundred failures in the last seven days indicates it is not fixed yet, while 8.7.0 was released almost a week ago, and the version bump was done on Friday.

**Build scan:**
https://gradle-enterprise.elastic.co/s/s5wd3ztjvyjpa/tests/:qa:mixed-cluster:v8.7.1%23mixedClusterTest/org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT/testMinVersionAsOldVersion

**Reproduction line:**
```
./gradlew ':qa:mixed-cluster:v8.7.1#mixedClusterTest' -Dtests.class=""org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT"" -Dtests.method=""testMinVersionAsOldVersion"" -Dtests.seed=C7C49D0A22620141 -Dtests.bwc=true -Dtests.locale=be -Dtests.timezone=Canada/Newfoundland -Druntime.java=20
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.backwards.SearchWithMinCompatibleSearchNodeIT&tests.test=testMinVersionAsOldVersion

**Failure excerpt:**
```
java.lang.AssertionError: timed out waiting for green state for index [test_min_version] cluster state [{
  ""cluster_name"" : ""v8.7.1"",
  ""cluster_uuid"" : ""3FOL5SbBSVCxP2S5lUX_ew"",
  ""version"" : 23714,
  ""state_uuid"" : ""DqDVjs99TKulXNGs_diSRA"",
  ""master_node"" : ""-1lTDD6CTyakDJSwzB0IHA"",
  ""blocks"" : { },
  ""nodes"" : {
    ""eOgyW9kxTnKaXHJQNLjiAA"" : {
      ""name"" : ""v8.7.1-2"",
      ""ephemeral_id"" : ""v4zeXIq5Rcy0wXR2GEK9Vg"",
      ""transport_address"" : ""127.0.0.1:39371"",
      ""external_id"" : ""v8.7.1-2"",
      ""attributes"" : {
        ""ml.machine_memory"" : ""133958402048"",
        ""testattr"" : ""test"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""ml.allocated_processors"" : ""32"",
        ""ml.allocated_processors_double"" : ""32.0"",
        ""xpack.installed"" : ""true""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ],
      ""version"" : ""8.7.1""
    },
    ""KrGExoP-R3iACq8jYiPH6w"" : {
      ""name"" : ""v8.7.1-0"",
      ""ephemeral_id"" : ""8Ky5nUoiQDS4FJ_7-KwGFw"",
      ""transport_address"" : ""127.0.0.1:37345"",
      ""external_id"" : ""v8.7.1-0"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""xpack.installed"" : ""true"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""ml.allocated_processors_double"" : ""32.0"",
        ""upgraded"" : ""true"",
        ""ml.allocated_processors"" : ""32"",
        ""ml.machine_memory"" : ""133958402048""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ],
      ""version"" : ""8.8.0""
    },
    ""-1lTDD6CTyakDJSwzB0IHA"" : {
      ""name"" : ""v8.7.1-3"",
      ""ephemeral_id"" : ""4z8vcMojQOOVRV_YW4p3eA"",
      ""transport_address"" : ""127.0.0.1:41765"",
      ""external_id"" : ""v8.7.1-3"",
      ""attributes"" : {
        ""ml.allocated_processors"" : ""32"",
        ""testattr"" : ""test"",
        ""xpack.installed"" : ""true"",
        ""ml.machine_memory"" : ""133958402048"",
        ""ml.allocated_processors_double"" : ""32.0"",
        ""ml.max_jvm_size"" : ""536870912""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ],
      ""version"" : ""8.7.1""
    }
  },
  ""metadata"" : {
    ""cluster_uuid"" : ""3FOL5SbBSVCxP2S5lUX_ew"",
    ""cluster_uuid_committed"" : true,
    ""cluster_coordination"" : {
      ""term"" : 3,
      ""last_committed_config"" : [
        ""-1lTDD6CTyakDJSwzB0IHA"",
        ""KrGExoP-R3iACq8jYiPH6w"",
        ""eOgyW9kxTnKaXHJQNLjiAA""
      ],
      ""last_accepted_config"" : [
        ""-1lTDD6CTyakDJSwzB0IHA"",
        ""KrGExoP-R3iACq8jYiPH6w"",
        ""eOgyW9kxTnKaXHJQNLjiAA""
      ],
      ""voting_config_exclusions"" : [ ]
    },
    ""templates"" : {
      "".monitoring-es"" : {
        ""order"" : 0,
        ""version"" : 8070099,
        ""index_patterns"" : [
          "".monitoring-es-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""date_detection"" : false,
            ""dynamic"" : false,
            ""properties"" : {
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""state_uuid"" : {
                ""type"" : ""keyword""
              },
              ""timestamp"" : {
                ""type"" : ""date"",
                ""format"" : ""date_time""
              },
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""type"" : ""date"",
                    ""format"" : ""date_time""
                  }
                }
              },
              ""indices_stats"" : {
                ""properties"" : {
                  ""_all"" : {
                    ""properties"" : {
                      ""primaries"" : {
                        ""properties"" : {
                          ""docs"" : {
                            ""properties"" : {
                              ""count"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""indexing"" : {
                            ""properties"" : {
                              ""index_total"" : {
                                ""type"" : ""long""
                              },
                              ""index_time_in_millis"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""search"" : {
                            ""properties"" : {
                              ""query_total"" : {
                                ""type"" : ""long""
                              },
                              ""query_time_in_millis"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""bulk"" : {
                            ""properties"" : {
                              ""total_operations"" : {
                                ""type"" : ""long""
                              },
                              ""total_time_in_millis"" : {
                                ""type"" : ""long""
                              },
                              ""total_size_in_bytes"" : {
                                ""type"" : ""long""
                              },
                              ""avg_time_in_millis"" : {
                                ""type"" : ""long""
                              },
                              ""avg_size_in_bytes"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      },
                      ""total"" : {
                        ""properties"" : {
                          ""docs"" : {
                            ""properties"" : {
                              ""count"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""indexing"" : {
                            ""properties"" : {
                              ""index_total"" : {
                                ""type"" : ""long""
                              },
                              ""index_time_in_millis"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""search"" : {
                            ""properties"" : {
                              ""query_total"" : {
                                ""type"" : ""long""
                              },
                              ""query_time_in_millis"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""bulk"" : {
                            ""properties"" : {
                              ""total_operations"" : {
                                ""type"" : ""long""
                              },
                              ""total_time_in_millis"" : {
                                ""type"" : ""long""
                              },
                              ""total_size_in_bytes"" : {
                                ""type"" : ""long""
                              },
                              ""avg_time_in_millis"" : {
                                ""type"" : ""long""
                              },
                              ""avg_size_in_bytes"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              ""index_stats"" : {
                ""properties"" : {
                  ""index"" : {
                    ""type"" : ""keyword""
                  },
                  ""primaries"" : {
                    ""properties"" : {
                      ""docs"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""fielddata"" : {
                        ""properties"" : {
                          ""memory_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""evictions"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""store"" : {
                        ""properties"" : {
                          ""size_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""indexing"" : {
                        ""properties"" : {
                          ""index_total"" : {
                            ""type"" : ""long""
                          },
                          ""index_time_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""throttle_time_in_millis"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""merges"" : {
                        ""properties"" : {
                          ""total_size_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""query_cache"" : {
                        ""properties"" : {
                          ""memory_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""evictions"" : {
                            ""type"" : ""long""
                          },
                          ""hit_count"" : {
                            ""type"" : ""long""
                          },
                          ""miss_count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""request_cache"" : {
                        ""properties"" : {
                          ""memory_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""evictions"" : {
                            ""type"" : ""long""
                          },
                          ""hit_count"" : {
                            ""type"" : ""long""
                          },
                          ""miss_count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""search"" : {
                        ""properties"" : {
                          ""query_total"" : {
                            ""type"" : ""long""
                          },
                          ""query_time_in_millis"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""segments"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""integer""
                          },
                          ""memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""terms_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""points_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""stored_fields_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""term_vectors_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""norms_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""doc_values_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""index_writer_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""version_map_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""fixed_bit_set_memory_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""refresh"" : {
                        ""properties"" : {
                          ""total_time_in_millis"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""bulk"" : {
                        ""properties"" : {
                          ""total_operations"" : {
                            ""type"" : ""long""
                          },
                          ""total_time_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""total_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""avg_time_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""avg_size_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""total"" : {
                    ""properties"" : {
                      ""docs"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""fielddata"" : {
                        ""properties"" : {
                          ""memory_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""evictions"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""store"" : {
                        ""properties"" : {
                          ""size_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""indexing"" : {
                        ""properties"" : {
                          ""index_total"" : {
                            ""type"" : ""long""
                          },
                          ""index_time_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""throttle_time_in_millis"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""merges"" : {
                        ""properties"" : {
                          ""total_size_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""query_cache"" : {
                        ""properties"" : {
                          ""memory_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""evictions"" : {
                            ""type"" : ""long""
                          },
                          ""hit_count"" : {
                            ""type"" : ""long""
                          },
                          ""miss_count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""request_cache"" : {
                        ""properties"" : {
                          ""memory_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""evictions"" : {
                            ""type"" : ""long""
                          },
                          ""hit_count"" : {
                            ""type"" : ""long""
                          },
                          ""miss_count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""search"" : {
                        ""properties"" : {
                          ""query_total"" : {
                            ""type"" : ""long""
                          },
                          ""query_time_in_millis"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""segments"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""integer""
                          },
                          ""memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""terms_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""points_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""stored_fields_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""term_vectors_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""norms_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""doc_values_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""index_writer_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""version_map_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""fixed_bit_set_memory_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""refresh"" : {
                        ""properties"" : {
                          ""total_time_in_millis"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""bulk"" : {
                        ""properties"" : {
                          ""total_operations"" : {
                            ""type"" : ""long""
                          },
                          ""total_time_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""total_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""avg_time_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""avg_size_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  }
                }
              },
              ""cluster_stats"" : {
                ""properties"" : {
                  ""nodes"" : {
                    ""type"" : ""object""
                  },
                  ""indices"" : {
                    ""type"" : ""object""
                  }
                }
              },
              ""cluster_state"" : {
                ""properties"" : {
                  ""version"" : {
                    ""type"" : ""long""
                  },
                  ""nodes_hash"" : {
                    ""type"" : ""integer""
                  },
                  ""master_node"" : {
                    ""type"" : ""keyword""
                  },
                  ""state_uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""status"" : {
                    ""type"" : ""keyword""
                  },
                  ""nodes"" : {
                    ""type"" : ""object""
                  },
                  ""shards"" : {
                    ""type"" : ""object""
                  }
                }
              },
              ""node_stats"" : {
                ""properties"" : {
                  ""node_id"" : {
                    ""type"" : ""keyword""
                  },
                  ""node_master"" : {
                    ""type"" : ""boolean""
                  },
                  ""mlockall"" : {
                    ""type"" : ""boolean""
                  },
                  ""indices"" : {
                    ""properties"" : {
                      ""docs"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""fielddata"" : {
                        ""properties"" : {
                          ""memory_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""evictions"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""indexing"" : {
                        ""properties"" : {
                          ""index_time_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""index_total"" : {
                            ""type"" : ""long""
                          },
                          ""throttle_time_in_millis"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""query_cache"" : {
                        ""properties"" : {
                          ""memory_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""evictions"" : {
                            ""type"" : ""long""
                          },
                          ""hit_count"" : {
                            ""type"" : ""long""
                          },
                          ""miss_count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""request_cache"" : {
                        ""properties"" : {
                          ""memory_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""evictions"" : {
                            ""type"" : ""long""
                          },
                          ""hit_count"" : {
                            ""type"" : ""long""
                          },
                          ""miss_count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""search"" : {
                        ""properties"" : {
                          ""query_time_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""query_total"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""segments"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""integer""
                          },
                          ""memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""terms_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""points_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""stored_fields_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""term_vectors_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""norms_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""doc_values_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""index_writer_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""version_map_memory_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""fixed_bit_set_memory_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""store"" : {
                        ""properties"" : {
                          ""size_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""bulk"" : {
                        ""properties"" : {
                          ""total_operations"" : {
                            ""type"" : ""long""
                          },
                          ""total_time_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""total_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""avg_time_in_millis"" : {
                            ""type"" : ""long""
                          },
                          ""avg_size_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  },
                  ""fs"" : {
                    ""properties"" : {
                      ""total"" : {
                        ""properties"" : {
                          ""total_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""free_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""available_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""data"" : {
                        ""properties"" : {
                          ""spins"" : {
                            ""type"" : ""boolean""
                          }
                        }
                      },
                      ""io_stats"" : {
                        ""properties"" : {
                          ""total"" : {
                            ""properties"" : {
                              ""operations"" : {
                                ""type"" : ""long""
                              },
                              ""read_operations"" : {
                                ""type"" : ""long""
                              },
                              ""write_operations"" : {
                                ""type"" : ""long""
                              },
                              ""read_kilobytes"" : {
                                ""type"" : ""long""
                              },
                              ""write_kilobytes"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  ""os"" : {
                    ""properties"" : {
                      ""cgroup"" : {
                        ""properties"" : {
                          ""cpuacct"" : {
                            ""properties"" : {
                              ""control_group"" : {
                                ""type"" : ""keyword""
                              },
                              ""usage_nanos"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""cpu"" : {
                            ""properties"" : {
                              ""cfs_quota_micros"" : {
                                ""type"" : ""long""
                              },
                              ""control_group"" : {
                                ""type"" : ""keyword""
                              },
                              ""stat"" : {
                                ""properties"" : {
                                  ""number_of_elapsed_periods"" : {
                                    ""type"" : ""long""
                                  },
                                  ""number_of_times_throttled"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time_throttled_nanos"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""memory"" : {
                            ""properties"" : {
                              ""control_group"" : {
                                ""type"" : ""keyword""
                              },
                              ""limit_in_bytes"" : {
                                ""type"" : ""keyword""
                              },
                              ""usage_in_bytes"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          }
                        }
                      },
                      ""cpu"" : {
                        ""properties"" : {
                          ""load_average"" : {
                            ""properties"" : {
                              ""1m"" : {
                                ""type"" : ""half_float""
                              },
                              ""5m"" : {
                                ""type"" : ""half_float""
                              },
                              ""15m"" : {
                                ""type"" : ""half_float""
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  ""process"" : {
                    ""properties"" : {
                      ""open_file_descriptors"" : {
                        ""type"" : ""long""
                      },
                      ""max_file_descriptors"" : {
                        ""type"" : ""long""
                      },
                      ""cpu"" : {
                        ""properties"" : {
                          ""percent"" : {
                            ""type"" : ""half_float""
                          }
                        }
                      }
                    }
                  },
                  ""jvm"" : {
                    ""properties"" : {
                      ""mem"" : {
                        ""properties"" : {
                          ""heap_used_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""heap_used_percent"" : {
                            ""type"" : ""half_float""
                          },
                          ""heap_max_in_bytes"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""gc"" : {
                        ""properties"" : {
                          ""collectors"" : {
                            ""properties"" : {
                              ""young"" : {
                                ""properties"" : {
                                  ""collection_count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""collection_time_in_millis"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""old"" : {
                                ""properties"" : {
                                  ""collection_count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""collection_time_in_millis"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  ""thread_pool"" : {
                    ""properties"" : {
                      ""bulk"" : {
                        ""properties"" : {
                          ""threads"" : {
                            ""type"" : ""integer""
                          },
                          ""queue"" : {
                            ""type"" : ""integer""
                          },
                          ""rejected"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""generic"" : {
                        ""properties"" : {
                          ""threads"" : {
                            ""type"" : ""integer""
                          },
                          ""queue"" : {
                            ""type"" : ""integer""
                          },
                          ""rejected"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""get"" : {
                        ""properties"" : {
                          ""threads"" : {
                            ""type"" : ""integer""
                          },
                          ""queue"" : {
                            ""type"" : ""integer""
                          },
                          ""rejected"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""index"" : {
                        ""properties"" : {
                          ""threads"" : {
                            ""type"" : ""integer""
                          },
                          ""queue"" : {
                            ""type"" : ""integer""
                          },
                          ""rejected"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""management"" : {
                        ""properties"" : {
                          ""threads"" : {
                            ""type"" : ""integer""
                          },
                          ""queue"" : {
                            ""type"" : ""integer""
                          },
                          ""rejected"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""search"" : {
                        ""properties"" : {
                          ""threads"" : {
                            ""type"" : ""integer""
                          },
                          ""queue"" : {
                            ""type"" : ""integer""
                          },
                          ""rejected"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""watcher"" : {
                        ""properties"" : {
                          ""threads"" : {
                            ""type"" : ""integer""
                          },
                          ""queue"" : {
                            ""type"" : ""integer""
                          },
                          ""rejected"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""write"" : {
                        ""properties"" : {
                          ""queue"" : {
                            ""type"" : ""integer""
                          },
                          ""rejected"" : {
                            ""type"" : ""long""
                          }
                        }
                      }
                    }
                  }
                }
              },
              ""index_recovery"" : {
                ""type"" : ""object""
              },
              ""shard"" : {
                ""properties"" : {
                  ""state"" : {
                    ""type"" : ""keyword""
                  },
                  ""primary"" : {
                    ""type"" : ""boolean""
                  },
                  ""index"" : {
                    ""type"" : ""keyword""
                  },
                  ""relocating_node"" : {
                    ""type"" : ""keyword""
                  },
                  ""shard"" : {
                    ""type"" : ""long""
                  },
                  ""node"" : {
                    ""type"" : ""keyword""
                  }
                }
              },
              ""job_stats"" : {
                ""properties"" : {
                  ""job_id"" : {
                    ""type"" : ""keyword""
                  },
                  ""state"" : {
                    ""type"" : ""keyword""
                  },
                  ""data_counts"" : {
                    ""properties"" : {
                      ""input_bytes"" : {
                        ""type"" : ""long""
                      },
                      ""processed_record_count"" : {
                        ""type"" : ""long""
                      },
                      ""empty_bucket_count"" : {
                        ""type"" : ""long""
                      },
                      ""sparse_bucket_count"" : {
                        ""type"" : ""long""
                      },
                      ""bucket_count"" : {
                        ""type"" : ""long""
                      },
                      ""earliest_record_timestamp"" : {
                        ""type"" : ""date""
                      },
                      ""latest_record_timestamp"" : {
                        ""type"" : ""date""
                      }
                    }
                  },
                  ""model_size_stats"" : {
                    ""properties"" : {
                      ""model_bytes"" : {
                        ""type"" : ""long""
                      },
                      ""bucket_allocation_failures_count"" : {
                        ""type"" : ""long""
                      }
                    }
                  },
                  ""node"" : {
                    ""properties"" : {
                      ""id"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  }
                }
              },
              ""ccr_stats"" : {
                ""properties"" : {
                  ""remote_cluster"" : {
                    ""type"" : ""keyword""
                  },
                  ""leader_index"" : {
                    ""type"" : ""keyword""
                  },
                  ""follower_index"" : {
                    ""type"" : ""keyword""
                  },
                  ""shard_id"" : {
                    ""type"" : ""integer""
                  },
                  ""leader_global_checkpoint"" : {
                    ""type"" : ""long""
                  },
                  ""leader_max_seq_no"" : {
                    ""type"" : ""long""
                  },
                  ""follower_global_checkpoint"" : {
                    ""type"" : ""long""
                  },
                  ""follower_max_seq_no"" : {
                    ""type"" : ""long""
                  },
                  ""last_requested_seq_no"" : {
                    ""type"" : ""long""
                  },
                  ""outstanding_read_requests"" : {
                    ""type"" : ""long""
                  },
                  ""outstanding_write_requests"" : {
                    ""type"" : ""long""
                  },
                  ""write_buffer_operation_count"" : {
                    ""type"" : ""long""
                  },
                  ""write_buffer_size_in_bytes"" : {
                    ""type"" : ""long""
                  },
                  ""follower_mapping_version"" : {
                    ""type"" : ""long""
                  },
                  ""follower_settings_version"" : {
                    ""type"" : ""long""
                  },
                  ""follower_aliases_version"" : {
                    ""type"" : ""long""
                  },
                  ""total_read_time_millis"" : {
                    ""type"" : ""long""
                  },
                  ""total_read_remote_exec_time_millis"" : {
                    ""type"" : ""long""
                  },
                  ""successful_read_requests"" : {
                    ""type"" : ""long""
                  },
                  ""failed_read_requests"" : {
                    ""type"" : ""long""
                  },
                  ""operations_read"" : {
                    ""type"" : ""long""
                  },
                  ""bytes_read"" : {
                    ""type"" : ""long""
                  },
                  ""total_write_time_millis"" : {
                    ""type"" : ""long""
                  },
                  ""successful_write_requests"" : {
                    ""type"" : ""long""
                  },
                  ""failed_write_requests"" : {
                    ""type"" : ""long""
                  },
                  ""operations_written"" : {
                    ""type"" : ""long""
                  },
                  ""read_exceptions"" : {
                    ""type"" : ""nested"",
                    ""properties"" : {
                      ""from_seq_no"" : {
                        ""type"" : ""long""
                      },
                      ""retries"" : {
                        ""type"" : ""integer""
                      },
                      ""exception"" : {
                        ""type"" : ""object"",
                        ""properties"" : {
                          ""type"" : {
                            ""type"" : ""keyword""
                          },
                          ""reason"" : {
                            ""type"" : ""text""
                          }
                        }
                      }
                    }
                  },
                  ""time_since_last_read_millis"" : {
                    ""type"" : ""long""
                  },
                  ""fatal_exception"" : {
                    ""type"" : ""object"",
                    ""properties"" : {
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""reason"" : {
                        ""type"" : ""text""
                      }
                    }
                  }
                }
              },
              ""ccr_auto_follow_stats"" : {
                ""properties"" : {
                  ""number_of_failed_follow_indices"" : {
                    ""type"" : ""long""
                  },
                  ""number_of_failed_remote_cluster_state_requests"" : {
                    ""type"" : ""long""
                  },
                  ""number_of_successful_follow_indices"" : {
                    ""type"" : ""long""
                  },
                  ""recent_auto_follow_errors"" : {
                    ""type"" : ""nested"",
                    ""properties"" : {
                      ""leader_index"" : {
                        ""type"" : ""keyword""
                      },
                      ""timestamp"" : {
                        ""type"" : ""long""
                      },
                      ""auto_follow_exception"" : {
                        ""type"" : ""object"",
                        ""properties"" : {
                          ""type"" : {
                            ""type"" : ""keyword""
                          },
                          ""reason"" : {
                            ""type"" : ""text""
                          }
                        }
                      }
                    }
                  },
                  ""auto_followed_clusters"" : {
                    ""type"" : ""nested"",
                    ""properties"" : {
                      ""cluster_name"" : {
                        ""type"" : ""keyword""
                      },
                      ""time_since_last_check_millis"" : {
                        ""type"" : ""long""
                      },
                      ""last_seen_metadata_version"" : {
                        ""type"" : ""long""
                      }
                    }
                  }
                }
              },
              ""enrich_coordinator_stats"" : {
                ""properties"" : {
                  ""node_id"" : {
                    ""type"" : ""keyword""
                  },
                  ""queue_size"" : {
                    ""type"" : ""integer""
                  },
                  ""remote_requests_current"" : {
                    ""type"" : ""long""
                  },
                  ""remote_requests_total"" : {
                    ""type"" : ""long""
                  },
                  ""executed_searches_total"" : {
                    ""type"" : ""long""
                  }
                }
              },
              ""enrich_executing_policy_stats"" : {
                ""properties"" : {
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""task"" : {
                    ""type"" : ""object"",
                    ""properties"" : {
                      ""node"" : {
                        ""type"" : ""keyword""
                      },
                      ""id"" : {
                        ""type"" : ""long""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""action"" : {
                        ""type"" : ""keyword""
                      },
                      ""description"" : {
                        ""type"" : ""keyword""
                      },
                      ""start_time_in_millis"" : {
                        ""type"" : ""date"",
                        ""format"" : ""epoch_millis""
                      },
                      ""running_time_in_nanos"" : {
                        ""type"" : ""long""
                      },
                      ""cancellable"" : {
                        ""type"" : ""boolean""
                      }
                    }
                  }
                }
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-kibana"" : {
        ""order"" : 0,
        ""version"" : 8070099,
        ""index_patterns"" : [
          "".monitoring-kibana-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""timestamp"" : {
                ""type"" : ""date"",
                ""format"" : ""date_time""
              },
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
    ...
```",craigtaverner,closed,"[':Search/Search', '>test-failure', 'Team:Search']",https://github.com/elastic/elasticsearch/issues/95011,2023-04-04T10:01:33Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95011,"{
  ""application_resource"": ""yes""
}"
287,95005,[CI] MlMappingsUpgradeIT testMappingsUpgrade failing,"Server-side log shows:

```
[2023-04-02T20:41:20,292][WARN ][o.e.x.m.j.p.a.o.AutodetectResultProcessor] [v8.8.0-2] [ml-mappings-upgrade-job] some results not processed due to the termination of autodetect
[2023-04-02T20:41:20,304][ERROR][o.e.x.m.p.l.CppLogMessageHandler] [v8.8.0-2] [controller/8335] [CDetachedProcessSpawner.cc@193] Child process with PID 24509 was terminated by signal 9
```

This suggests the process was killed by the OOM killer, i.e. the CI worker ran out of memory.

**Build scan:**
https://gradle-enterprise.elastic.co/s/tzqdjt6bv3hb6/tests/:x-pack:qa:rolling-upgrade:v8.8.0%23upgradedClusterTest/org.elasticsearch.upgrades.MlMappingsUpgradeIT/testMappingsUpgrade

**Reproduction line:**
```
./gradlew ':x-pack:qa:rolling-upgrade:v8.8.0#upgradedClusterTest' -Dtests.class=""org.elasticsearch.upgrades.MlMappingsUpgradeIT"" -Dtests.method=""testMappingsUpgrade"" -Dtests.seed=DEF8F0A60F580BEE -Dtests.bwc=true -Dtests.locale=is -Dtests.timezone=Japan -Druntime.java=19
```

**Applicable branches:**
main

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.upgrades.MlMappingsUpgradeIT&tests.test=testMappingsUpgrade

**Failure excerpt:**
```
org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:38593], URI [_ml/anomaly_detectors/ml-mappings-upgrade-job/_close], status line [HTTP/1.1 409 Conflict]
{""error"":{""root_cause"":[{""type"":""status_exception"",""reason"":""cannot close job [ml-mappings-upgrade-job] because it failed, use force close""}],""type"":""status_exception"",""reason"":""cannot close job [ml-mappings-upgrade-job] because it failed, use force close""},""status"":409}

  at __randomizedtesting.SeedInfo.seed([DEF8F0A60F580BEE:F38314F186C7708A]:0)
  at org.elasticsearch.client.RestClient.convertResponse(RestClient.java:347)
  at org.elasticsearch.client.RestClient.performRequest(RestClient.java:313)
  at org.elasticsearch.client.RestClient.performRequest(RestClient.java:288)
  at org.elasticsearch.upgrades.MlMappingsUpgradeIT.closeAndReopenTestJob(MlMappingsUpgradeIT.java:102)
  at org.elasticsearch.upgrades.MlMappingsUpgradeIT.testMappingsUpgrade(MlMappingsUpgradeIT.java:63)
  at jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
  at java.lang.reflect.Method.invoke(Method.java:578)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:48)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:45)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:843)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:490)
  at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:955)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:840)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:891)
  at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:902)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at org.apache.lucene.tests.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
  at org.apache.lucene.tests.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:43)
  at org.apache.lucene.tests.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:44)
  at org.apache.lucene.tests.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:60)
  at org.apache.lucene.tests.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:47)
  at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:390)
  at com.carrotsearch.randomizedtesting.ThreadLeakControl.lambda$forkTimeoutingTask$0(ThreadLeakControl.java:850)
  at java.lang.Thread.run(Thread.java:1589)

```",droberts195,closed,"['>test-failure', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/95005,2023-04-04T09:09:06Z,6,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/95005,"{
  ""application_resource"": ""yes""
}"
288,94966,ECK Faild To Pull Image,"### Elasticsearch Version

8.7.0

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

default Elasticsearch artifact

### Problem Description

trying to deploy Elasticsearch on minikube by following this instruction https://www.elastic.co/downloads/elastic-cloud-kubernetes my artifact after installing crds
```
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: es-cluster
  namespace: monitoring
spec:
  version: 8.7.0
  image: docker.elastic.co/elasticsearch/elasticsearch:8.7.0
  nodeSets:
  - name: default
    count: 1
    config:
      node.store.allow_mmap: false
```

### Steps to Reproduce

1. install minikube 
2. run `kubectl create -f https://download.elastic.co/downloads/eck/2.7.0/crds.yaml`
3. run `kubectl apply -f https://download.elastic.co/downloads/eck/2.7.0/operator.yaml`
4. copy apply above es artifact on your minikube cluster 
5. wait for pod to be initialized and created, it will fail with error `Failed to pull image ""docker.elastic.co/elasticsearch/elasticsearch:8.7.0"": rpc error: code = Unknown desc = context deadline exceeded` after about 2min and 2 seconds  

### Logs (if relevant)

Name:             es-cluster-es-default-0
Namespace:        monitoring
Priority:         0
Service Account:  default
Node:             minikube/{ip}
Start Time:       Sat, 01 Apr 2023 04:24:34 +0200
Labels:           common.k8s.elastic.co/type=elasticsearch
                  controller-revision-hash=es-cluster-es-default-57d66b5598
                  elasticsearch.k8s.elastic.co/cluster-name=es-cluster
                  elasticsearch.k8s.elastic.co/http-scheme=https
                  elasticsearch.k8s.elastic.co/node-data=true
                  elasticsearch.k8s.elastic.co/node-data_cold=true
                  elasticsearch.k8s.elastic.co/node-data_content=true
                  elasticsearch.k8s.elastic.co/node-data_frozen=true
                  elasticsearch.k8s.elastic.co/node-data_hot=true
                  elasticsearch.k8s.elastic.co/node-data_warm=true
                  elasticsearch.k8s.elastic.co/node-ingest=true
                  elasticsearch.k8s.elastic.co/node-master=true
                  elasticsearch.k8s.elastic.co/node-ml=true
                  elasticsearch.k8s.elastic.co/node-remote_cluster_client=true
                  elasticsearch.k8s.elastic.co/node-transform=true
                  elasticsearch.k8s.elastic.co/node-voting_only=false
                  elasticsearch.k8s.elastic.co/statefulset-name=es-cluster-es-default
                  elasticsearch.k8s.elastic.co/version=8.7.0
                  statefulset.kubernetes.io/pod-name=es-cluster-es-default-0
Annotations:      co.elastic.logs/module: elasticsearch
                  elasticsearch.k8s.elastic.co/config-hash: 2921960909
                  kubectl.kubernetes.io/restartedAt: 2023-04-01T04:10:11+02:00
                  update.k8s.elastic.co/timestamp: 2023-04-01T02:26:37.526262873Z
Status:           Pending
IP:               ip
IPs:
  IP:           ip
Controlled By:  StatefulSet/es-cluster-es-default
Init Containers:
  elastic-internal-init-filesystem:
    Container ID:
    Image:         docker.elastic.co/elasticsearch/elasticsearch:8.7.0
    Image ID:
    Port:          <none>
    Host Port:     <none>
    Command:
      bash
      -c
      /mnt/elastic-internal/scripts/prepare-fs.sh
    State:          Waiting
      Reason:       ImagePullBackOff
    Ready:          False
    Restart Count:  0
    Limits:
      cpu:     100m
      memory:  50Mi
    Requests:
      cpu:     100m
      memory:  50Mi
    Environment:
      POD_IP:                     (v1:status.podIP)
      POD_NAME:                  es-cluster-es-default-0 (v1:metadata.name)
      NODE_NAME:                  (v1:spec.nodeName)
      NAMESPACE:                 monitoring (v1:metadata.namespace)
      PROBE_PASSWORD_PATH:       /mnt/elastic-internal/probe-user/elastic-internal-probe
      PROBE_USERNAME:            elastic-internal-probe
      READINESS_PROBE_PROTOCOL:  https
      HEADLESS_SERVICE_NAME:     es-cluster-es-default
      NSS_SDB_USE_CACHE:         no
    Mounts:
      /mnt/elastic-internal/downward-api from downward-api (ro)
      /mnt/elastic-internal/elasticsearch-bin-local from elastic-internal-elasticsearch-bin-local (rw)
      /mnt/elastic-internal/elasticsearch-config from elastic-internal-elasticsearch-config (ro)
      /mnt/elastic-internal/elasticsearch-config-local from elastic-internal-elasticsearch-config-local (rw)
      /mnt/elastic-internal/elasticsearch-plugins-local from elastic-internal-elasticsearch-plugins-local (rw)
      /mnt/elastic-internal/probe-user from elastic-internal-probe-user (ro)
      /mnt/elastic-internal/scripts from elastic-internal-scripts (ro)
      /mnt/elastic-internal/transport-certificates from elastic-internal-transport-certificates (ro)
      /mnt/elastic-internal/unicast-hosts from elastic-internal-unicast-hosts (ro)
      /mnt/elastic-internal/xpack-file-realm from elastic-internal-xpack-file-realm (ro)
      /usr/share/elasticsearch/config/http-certs from elastic-internal-http-certificates (ro)
      /usr/share/elasticsearch/config/operator from file-settings (ro)
      /usr/share/elasticsearch/config/transport-remote-certs/ from elastic-internal-remote-certificate-authorities (ro)
      /usr/share/elasticsearch/data from elasticsearch-data (rw)
      /usr/share/elasticsearch/logs from elasticsearch-logs (rw)
  elastic-internal-suspend:
    Container ID:
    Image:         docker.elastic.co/elasticsearch/elasticsearch:8.7.0
    Image ID:
    Port:          <none>
    Host Port:     <none>
    Command:
      bash
      -c
      /mnt/elastic-internal/scripts/suspend.sh
    State:          Waiting
      Reason:       PodInitializing
    Ready:          False
    Restart Count:  0
    Limits:
      memory:  2Gi
    Requests:
      memory:  2Gi
    Environment:
      POD_IP:                     (v1:status.podIP)
      POD_NAME:                  es-cluster-es-default-0 (v1:metadata.name)
      NODE_NAME:                  (v1:spec.nodeName)
      NAMESPACE:                 monitoring (v1:metadata.namespace)
      PROBE_PASSWORD_PATH:       /mnt/elastic-internal/probe-user/elastic-internal-probe
      PROBE_USERNAME:            elastic-internal-probe
      READINESS_PROBE_PROTOCOL:  https
      HEADLESS_SERVICE_NAME:     es-cluster-es-default
      NSS_SDB_USE_CACHE:         no
    Mounts:
      /mnt/elastic-internal/downward-api from downward-api (ro)
      /mnt/elastic-internal/elasticsearch-config from elastic-internal-elasticsearch-config (ro)
      /mnt/elastic-internal/probe-user from elastic-internal-probe-user (ro)
      /mnt/elastic-internal/scripts from elastic-internal-scripts (ro)
      /mnt/elastic-internal/unicast-hosts from elastic-internal-unicast-hosts (ro)
      /mnt/elastic-internal/xpack-file-realm from elastic-internal-xpack-file-realm (ro)
      /usr/share/elasticsearch/bin from elastic-internal-elasticsearch-bin-local (rw)
      /usr/share/elasticsearch/config from elastic-internal-elasticsearch-config-local (rw)
      /usr/share/elasticsearch/config/http-certs from elastic-internal-http-certificates (ro)
      /usr/share/elasticsearch/config/operator from file-settings (ro)
      /usr/share/elasticsearch/config/transport-certs from elastic-internal-transport-certificates (ro)
      /usr/share/elasticsearch/config/transport-remote-certs/ from elastic-internal-remote-certificate-authorities (ro)
      /usr/share/elasticsearch/data from elasticsearch-data (rw)
      /usr/share/elasticsearch/logs from elasticsearch-logs (rw)
      /usr/share/elasticsearch/plugins from elastic-internal-elasticsearch-plugins-local (rw)
Containers:
  elasticsearch:
    Container ID:
    Image:          docker.elastic.co/elasticsearch/elasticsearch:8.7.0
    Image ID:
    Ports:          9200/TCP, 9300/TCP
    Host Ports:     0/TCP, 0/TCP
    State:          Waiting
      Reason:       PodInitializing
    Ready:          False
    Restart Count:  0
    Limits:
      memory:  2Gi
    Requests:
      memory:   2Gi
    Readiness:  exec [bash -c /mnt/elastic-internal/scripts/readiness-probe-script.sh] delay=10s timeout=900s period=5s #success=1 #failure=3
    Environment:
      POD_IP:                     (v1:status.podIP)
      POD_NAME:                  es-cluster-es-default-0 (v1:metadata.name)
      NODE_NAME:                  (v1:spec.nodeName)
      NAMESPACE:                 monitoring (v1:metadata.namespace)
      PROBE_PASSWORD_PATH:       /mnt/elastic-internal/probe-user/elastic-internal-probe
      PROBE_USERNAME:            elastic-internal-probe
      READINESS_PROBE_PROTOCOL:  https
      HEADLESS_SERVICE_NAME:     es-cluster-es-default
      NSS_SDB_USE_CACHE:         no
    Mounts:
      /mnt/elastic-internal/downward-api from downward-api (ro)
      /mnt/elastic-internal/elasticsearch-config from elastic-internal-elasticsearch-config (ro)
      /mnt/elastic-internal/probe-user from elastic-internal-probe-user (ro)
      /mnt/elastic-internal/scripts from elastic-internal-scripts (ro)
      /mnt/elastic-internal/unicast-hosts from elastic-internal-unicast-hosts (ro)
      /mnt/elastic-internal/xpack-file-realm from elastic-internal-xpack-file-realm (ro)
      /usr/share/elasticsearch/bin from elastic-internal-elasticsearch-bin-local (rw)
      /usr/share/elasticsearch/config from elastic-internal-elasticsearch-config-local (rw)
      /usr/share/elasticsearch/config/http-certs from elastic-internal-http-certificates (ro)
      /usr/share/elasticsearch/config/operator from file-settings (ro)
      /usr/share/elasticsearch/config/transport-certs from elastic-internal-transport-certificates (ro)
      /usr/share/elasticsearch/config/transport-remote-certs/ from elastic-internal-remote-certificate-authorities (ro)
      /usr/share/elasticsearch/data from elasticsearch-data (rw)
      /usr/share/elasticsearch/logs from elasticsearch-logs (rw)
      /usr/share/elasticsearch/plugins from elastic-internal-elasticsearch-plugins-local (rw)
Conditions:
  Type              Status
  Initialized       False
  Ready             False
  ContainersReady   False
  PodScheduled      True
Volumes:
  elasticsearch-data:
    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)
    ClaimName:  elasticsearch-data-es-cluster-es-default-0
    ReadOnly:   false
  downward-api:
    Type:  DownwardAPI (a volume populated by information about the pod)
    Items:
      metadata.labels -> labels
  elastic-internal-elasticsearch-bin-local:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:  <unset>
  elastic-internal-elasticsearch-config:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  es-cluster-es-default-es-config
    Optional:    false
  elastic-internal-elasticsearch-config-local:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:  <unset>
  elastic-internal-elasticsearch-plugins-local:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:  <unset>
  elastic-internal-http-certificates:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  es-cluster-es-http-certs-internal
    Optional:    false
  elastic-internal-probe-user:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  es-cluster-es-internal-users
    Optional:    false
  elastic-internal-remote-certificate-authorities:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  es-cluster-es-remote-ca
    Optional:    false
  elastic-internal-scripts:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      es-cluster-es-scripts
    Optional:  false
  elastic-internal-transport-certificates:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  es-cluster-es-default-es-transport-certs
    Optional:    false
  elastic-internal-unicast-hosts:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      es-cluster-es-unicast-hosts
    Optional:  false
  elastic-internal-xpack-file-realm:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  es-cluster-es-xpack-file-realm
    Optional:    false
  elasticsearch-logs:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:
    SizeLimit:  <unset>
  file-settings:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  es-cluster-es-file-settings
    Optional:    false
QoS Class:       Burstable
Node-Selectors:  <none>
Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type     Reason     Age                From               Message
  ----     ------     ----               ----               -------
  Normal   Scheduled  4m3s               default-scheduler  Successfully assigned monitoring/es-cluster-es-default-0 to minikube
  Warning  Failed     2m1s               kubelet            Failed to pull image ""docker.elastic.co/elasticsearch/elasticsearch:8.7.0"": rpc error: code = Unknown desc = context deadline exceeded
  Warning  Failed     2m1s               kubelet            Error: ErrImagePull
  Normal   BackOff    118s (x3 over 2m)  kubelet            Back-off pulling image ""docker.elastic.co/elasticsearch/elasticsearch:8.7.0""
  Warning  Failed     118s (x3 over 2m)  kubelet            Error: ImagePullBackOff
  Normal   Pulling    107s (x2 over 4m)  kubelet            Pulling image ""docker.elastic.co/elasticsearch/elasticsearch:8.7.0""",Ibrahimogod,closed,"['>bug', 'Team:Delivery', ':Delivery/Cloud']",https://github.com/elastic/elasticsearch/issues/94966,2023-04-01T02:51:49Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/94966,"{
  ""application_resource"": ""no""
}"
289,94728,[CI] NodeShutdownShardsIT testNodeReplacementOnlyToTarget failing,"Doesn't look related to the specific test so much as something fairly fundamental wrong with JDK stats collection:

```
Caused by: java.lang.InternalError: Memory Pool not found	
at __randomizedtesting.SeedInfo.seed([6ED1C68BAF8AACC1]:0)	
at sun.management.MemoryPoolImpl.getPeakUsage0(Native Method)	
at sun.management.MemoryPoolImpl.getPeakUsage(MemoryPoolImpl.java:98)	
at org.elasticsearch.monitor.jvm.JvmStats.jvmStats(JvmStats.java:63)	
at org.elasticsearch.monitor.jvm.JvmGcMonitorService$JvmMonitor.jvmStats(JvmGcMonitorService.java:522)
```

**Build scan:**
https://gradle-enterprise.elastic.co/s/fimkttzyvl7no/tests/:x-pack:plugin:shutdown:internalClusterTest/org.elasticsearch.xpack.shutdown.NodeShutdownShardsIT/testNodeReplacementOnlyToTarget

**Reproduction line:**
```
./gradlew ':x-pack:plugin:shutdown:internalClusterTest' --tests ""org.elasticsearch.xpack.shutdown.NodeShutdownShardsIT.testNodeReplacementOnlyToTarget"" -Dtests.seed=6ED1C68BAF8AACC1 -Dtests.locale=sk -Dtests.timezone=Australia/Adelaide -Druntime.java=20
```

**Applicable branches:**
main

**Reproduces locally?:**
Didn't try

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.xpack.shutdown.NodeShutdownShardsIT&tests.test=testNodeReplacementOnlyToTarget

**Failure excerpt:**
```
com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=409, name=test_TEST-TEST_WORKER_VM=[370]-CLUSTER_SEED=[3842257269405316757]-HASH=[B137CBE5C9]-cluster[T#1], state=RUNNABLE, group=TGRP-NodeShutdownShardsIT]

  at __randomizedtesting.SeedInfo.seed([6ED1C68BAF8AACC1:F3546514071033F8]:0)

  Caused by: java.lang.InternalError: Memory Pool not found

    at __randomizedtesting.SeedInfo.seed([6ED1C68BAF8AACC1]:0)
    at sun.management.MemoryPoolImpl.getPeakUsage0(MemoryPoolImpl.java:-2)
    at sun.management.MemoryPoolImpl.getPeakUsage(MemoryPoolImpl.java:98)
    at org.elasticsearch.monitor.jvm.JvmStats.jvmStats(JvmStats.java:63)
    at org.elasticsearch.monitor.jvm.JvmGcMonitorService$JvmMonitor.jvmStats(JvmGcMonitorService.java:522)
    at org.elasticsearch.monitor.jvm.JvmGcMonitorService$JvmMonitor.<init>(JvmGcMonitorService.java:413)
    at org.elasticsearch.monitor.jvm.JvmGcMonitorService$1.<init>(JvmGcMonitorService.java:212)
    at org.elasticsearch.monitor.jvm.JvmGcMonitorService.doStart(JvmGcMonitorService.java:212)
    at org.elasticsearch.common.component.AbstractLifecycleComponent.start(AbstractLifecycleComponent.java:43)
    at org.elasticsearch.monitor.MonitorService.doStart(MonitorService.java:57)
    at org.elasticsearch.common.component.AbstractLifecycleComponent.start(AbstractLifecycleComponent.java:43)
    at org.elasticsearch.node.Node.start(Node.java:1371)
    at org.elasticsearch.test.InternalTestCluster$NodeAndClient.startNode(InternalTestCluster.java:988)
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:577)
    at java.util.concurrent.FutureTask.run(FutureTask.java:317)
    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:891)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
    at java.lang.Thread.run(Thread.java:1623)

```",DaveCTurner,closed,"[':Data Management/Stats', '>test-failure', 'Team:Data Management']",https://github.com/elastic/elasticsearch/issues/94728,2023-03-24T13:13:42Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/94728,"{
  ""application_resource"": ""yes""
}"
290,94657,"Docker starts elasticsearch, using a user with a uid of 1000 by default, but the uid of the elasticsearch user I created on the host computer is not 1000. What should I do in this case?","### Elasticsearch Version

6.8.2

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

CenstOS8

### Problem Description

Docker starts elasticsearch, using a user with a uid of 1000 by default, but the uid of the elasticsearch user I created on the host computer is not 1000. What should I do in this case?

### Steps to Reproduce

elasticsearch:
  image: elasticsearch:6.8.2
  container_name: elasticsearch
  environment:
    - cluster.name=elasticsearch
    - bootstrap.memory_lock=true
    - xpack.security.enabled=false
    - discovery.type=single-node
  ulimits:
    memlock:
      soft: -1
      hard: -1
  volumes:
    - /home/data/elasticsearch/data:/usr/share/elasticsearch/data
    - /home/data/elasticsearch/plugins:/usr/share/elasticsearch/plugins
  ports:
    - 9200:9200
    - 9300:9300

### Logs (if relevant)

elasticsearch    | OpenJDK 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.
elasticsearch    | [2023-03-23T08:02:29,718][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [unknown] uncaught exception in thread [main]
elasticsearch    | org.elasticsearch.bootstrap.StartupException: java.lang.IllegalStateException: Failed to create node environment
elasticsearch    | 	at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:163) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:150) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[elasticsearch-cli-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-cli-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:116) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | Caused by: java.lang.IllegalStateException: Failed to create node environment
elasticsearch    | 	at org.elasticsearch.node.Node.<init>(Node.java:299) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.node.Node.<init>(Node.java:266) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:212) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:212) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:333) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	... 6 more
elasticsearch    | Caused by: java.nio.file.AccessDeniedException: /usr/share/elasticsearch/data/nodes
elasticsearch    | 	at sun.nio.fs.UnixException.translateToIOException(UnixException.java:90) ~[?:?]
elasticsearch    | 	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111) ~[?:?]
elasticsearch    | 	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:116) ~[?:?]
elasticsearch    | 	at sun.nio.fs.UnixFileSystemProvider.createDirectory(UnixFileSystemProvider.java:389) ~[?:?]
elasticsearch    | 	at java.nio.file.Files.createDirectory(Files.java:692) ~[?:?]
elasticsearch    | 	at java.nio.file.Files.createAndCheckIsDirectory(Files.java:799) ~[?:?]
elasticsearch    | 	at java.nio.file.Files.createDirectories(Files.java:785) ~[?:?]
elasticsearch    | 	at org.elasticsearch.env.NodeEnvironment.lambda$new$0(NodeEnvironment.java:273) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.env.NodeEnvironment$NodeLock.<init>(NodeEnvironment.java:206) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.env.NodeEnvironment.<init>(NodeEnvironment.java:270) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.node.Node.<init>(Node.java:296) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.node.Node.<init>(Node.java:266) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:212) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:212) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:333) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159) ~[elasticsearch-6.8.2.jar:6.8.2]
elasticsearch    | 	... 6 more",liunancun,closed,"['>bug', 'needs:triage']",https://github.com/elastic/elasticsearch/issues/94657,2023-03-23T08:02:43Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/94657,"{
  ""application_resource"": ""yes""
}"
291,94431,Add support for Shenandoah GC,"### Description

Shenandoah GC is no longer experimental. 
Shenandoah GC is a mostly concurrent GC that does more work concurrently than G1C1 and should scale to TBs of memory more effectively. 

AFAIK there is no Shenandoah support and the default is to use G1C1. Shenandoah should require less tuning and allow more throughput with smaller pauses for a similar memory size compared to G1C1.",Matthew-Jenkins,closed,"['>enhancement', ':Core/Infra/Core', 'Team:Core/Infra']",https://github.com/elastic/elasticsearch/issues/94431,2023-03-09T15:50:31Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/94431,"{
  ""application_resource"": ""yes""
}"
292,94342,[DOCS] Incorrect figure numbering,"On the [Near real-time search page](https://www.elastic.co/guide/en/elasticsearch/reference/current/near-real-time.html) , the initial figure is labeled as ""Figure 4"". 
![Screenshot 2023-03-06 at 2 30 42 PM](https://user-images.githubusercontent.com/41695641/223212747-336beeac-733a-41c1-afee-d3632326d50b.png)


In the [associated source file](https://github.com/elastic/elasticsearch/blob/main/docs/reference/search/search-your-data/near-real-time.asciidoc), that first graphic appears to be coded correctly, so there would seem to be an issue with the automated numbering.

```
[[img-pre-refresh]]
.A Lucene index with new documents in the in-memory buffer
image::images/lucene-in-memory-buffer.png[""A Lucene index with new documents in the in-memory buffer""]
```

Rel: https://github.com/elastic/built-docs/pull/21#issuecomment-1456724388


",kilfoyle,closed,"['>docs', 'Team:Docs']",https://github.com/elastic/elasticsearch/issues/94342,2023-03-06T19:33:16Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/94342,"{
  ""application_resource"": ""no""
}"
293,94149,[CI] SnapshotBasedRecoveryIT testSnapshotBasedRecovery failing,"**Build scan:**
https://gradle-enterprise.elastic.co/s/h233lk33zmlue/tests/:qa:rolling-upgrade:v8.6.1%23oneThirdUpgradedTest/org.elasticsearch.upgrades.SnapshotBasedRecoveryIT/testSnapshotBasedRecovery

**Reproduction line:**
```
./gradlew ':qa:rolling-upgrade:v8.6.1#oneThirdUpgradedTest' -Dtests.class=""org.elasticsearch.upgrades.SnapshotBasedRecoveryIT"" -Dtests.method=""testSnapshotBasedRecovery"" -Dtests.seed=F47E24CAEB3AB7B9 -Dtests.bwc=true -Dtests.locale=mt-MT -Dtests.timezone=America/Anguilla -Druntime.java=17
```

**Applicable branches:**
8.7

**Reproduces locally?:**
No

**Failure history:**
https://gradle-enterprise.elastic.co/scans/tests?tests.container=org.elasticsearch.upgrades.SnapshotBasedRecoveryIT&tests.test=testSnapshotBasedRecovery

**Failure excerpt:**
```
java.lang.AssertionError: timed out waiting for green state for index [snapshot_based_recovery] cluster state [{
  ""cluster_name"" : ""v8.6.1"",
  ""cluster_uuid"" : ""ugxLuWX_QlCtYqzBBM3BGg"",
  ""version"" : 389,
  ""state_uuid"" : ""8XTThkQlT9-kVnNSeX5a5g"",
  ""master_node"" : ""rj4Z-6_aSvujKUNPDG63rw"",
  ""blocks"" : {
    ""indices"" : {
      ""index_mixed_8060199"" : {
        ""4"" : {
          ""description"" : ""index closed"",
          ""retryable"" : false,
          ""levels"" : [
            ""read"",
            ""write""
          ]
        }
      },
      ""closed_index_replica_allocation"" : {
        ""4"" : {
          ""description"" : ""index closed"",
          ""retryable"" : false,
          ""levels"" : [
            ""read"",
            ""write""
          ]
        }
      },
      ""closed_index_created_on_old"" : {
        ""4"" : {
          ""description"" : ""index closed"",
          ""retryable"" : false,
          ""levels"" : [
            ""read"",
            ""write""
          ]
        }
      },
      ""index_old_8060199"" : {
        ""4"" : {
          ""description"" : ""index closed"",
          ""retryable"" : false,
          ""levels"" : [
            ""read"",
            ""write""
          ]
        }
      }
    }
  },
  ""nodes"" : {
    ""rj4Z-6_aSvujKUNPDG63rw"" : {
      ""name"" : ""v8.6.1-1"",
      ""ephemeral_id"" : ""QXiNUys5SZKDsntTdINOBw"",
      ""transport_address"" : ""127.0.0.1:35745"",
      ""external_id"" : ""v8.6.1-1"",
      ""attributes"" : {
        ""ml.allocated_processors_double"" : ""32.0"",
        ""ml.machine_memory"" : ""101372157952"",
        ""xpack.installed"" : ""true"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""ml.allocated_processors"" : ""32"",
        ""testattr"" : ""test""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    },
    ""BMTGfwK3TMeWsco_JGUhRA"" : {
      ""name"" : ""v8.6.1-0"",
      ""ephemeral_id"" : ""SHTb8G0ARPuwfA1T4MRiRg"",
      ""transport_address"" : ""127.0.0.1:45731"",
      ""external_id"" : ""v8.6.1-0"",
      ""attributes"" : {
        ""testattr"" : ""test"",
        ""ml.machine_memory"" : ""101372157952"",
        ""upgraded"" : ""true"",
        ""ml.allocated_processors"" : ""32"",
        ""ml.allocated_processors_double"" : ""32.0"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""xpack.installed"" : ""true""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    },
    ""aJ2aZXGzQTatm5lqTzehMg"" : {
      ""name"" : ""v8.6.1-2"",
      ""ephemeral_id"" : ""mc2QN4RBTMGXvVzX_VGqJw"",
      ""transport_address"" : ""127.0.0.1:40883"",
      ""external_id"" : ""v8.6.1-2"",
      ""attributes"" : {
        ""ml.allocated_processors_double"" : ""32.0"",
        ""ml.machine_memory"" : ""101372157952"",
        ""xpack.installed"" : ""true"",
        ""ml.max_jvm_size"" : ""536870912"",
        ""ml.allocated_processors"" : ""32"",
        ""testattr"" : ""test""
      },
      ""roles"" : [
        ""data"",
        ""data_cold"",
        ""data_content"",
        ""data_frozen"",
        ""data_hot"",
        ""data_warm"",
        ""ingest"",
        ""master"",
        ""ml"",
        ""remote_cluster_client"",
        ""transform""
      ]
    }
  },
  ""metadata"" : {
    ""cluster_uuid"" : ""ugxLuWX_QlCtYqzBBM3BGg"",
    ""cluster_uuid_committed"" : true,
    ""cluster_coordination"" : {
      ""term"" : 2,
      ""last_committed_config"" : [
        ""aJ2aZXGzQTatm5lqTzehMg"",
        ""BMTGfwK3TMeWsco_JGUhRA"",
        ""rj4Z-6_aSvujKUNPDG63rw""
      ],
      ""last_accepted_config"" : [
        ""aJ2aZXGzQTatm5lqTzehMg"",
        ""BMTGfwK3TMeWsco_JGUhRA"",
        ""rj4Z-6_aSvujKUNPDG63rw""
      ],
      ""voting_config_exclusions"" : [ ]
    },
    ""templates"" : {
      "".monitoring-beats"" : {
        ""order"" : 0,
        ""version"" : 8010099,
        ""index_patterns"" : [
          "".monitoring-beats-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""dynamic"" : false,
            ""properties"" : {
              ""beats_state"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""state"" : {
                    ""properties"" : {
                      ""beat"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""host"" : {
                        ""properties"" : {
                          ""architecture"" : {
                            ""type"" : ""keyword""
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""hostname"" : {
                            ""type"" : ""keyword""
                          },
                          ""os"" : {
                            ""properties"" : {
                              ""build"" : {
                                ""type"" : ""keyword""
                              },
                              ""family"" : {
                                ""type"" : ""keyword""
                              },
                              ""platform"" : {
                                ""type"" : ""keyword""
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          }
                        }
                      },
                      ""input"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          },
                          ""names"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""module"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          },
                          ""names"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""output"" : {
                        ""properties"" : {
                          ""name"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      },
                      ""service"" : {
                        ""properties"" : {
                          ""id"" : {
                            ""type"" : ""keyword""
                          },
                          ""name"" : {
                            ""type"" : ""keyword""
                          },
                          ""version"" : {
                            ""type"" : ""keyword""
                          }
                        }
                      }
                    }
                  },
                  ""timestamp"" : {
                    ""format"" : ""date_time"",
                    ""type"" : ""date""
                  }
                }
              },
              ""beats_stats"" : {
                ""properties"" : {
                  ""beat"" : {
                    ""properties"" : {
                      ""host"" : {
                        ""type"" : ""keyword""
                      },
                      ""name"" : {
                        ""type"" : ""keyword""
                      },
                      ""type"" : {
                        ""type"" : ""keyword""
                      },
                      ""uuid"" : {
                        ""type"" : ""keyword""
                      },
                      ""version"" : {
                        ""type"" : ""keyword""
                      }
                    }
                  },
                  ""metrics"" : {
                    ""properties"" : {
                      ""beat"" : {
                        ""properties"" : {
                          ""cgroup"" : {
                            ""properties"" : {
                              ""cpu"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""cfs"" : {
                                    ""properties"" : {
                                      ""period"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""quota"" : {
                                        ""properties"" : {
                                          ""us"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  },
                                  ""stats"" : {
                                    ""properties"" : {
                                      ""periods"" : {
                                        ""type"" : ""long""
                                      },
                                      ""throttled"" : {
                                        ""properties"" : {
                                          ""periods"" : {
                                            ""type"" : ""long""
                                          },
                                          ""ns"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              ""cpuacct"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""total"" : {
                                    ""properties"" : {
                                      ""ns"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""memory"" : {
                                ""properties"" : {
                                  ""id"" : {
                                    ""type"" : ""keyword""
                                  },
                                  ""mem"" : {
                                    ""properties"" : {
                                      ""limit"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      },
                                      ""usage"" : {
                                        ""properties"" : {
                                          ""bytes"" : {
                                            ""type"" : ""long""
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""cpu"" : {
                            ""properties"" : {
                              ""system"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""total"" : {
                                ""properties"" : {
                                  ""value"" : {
                                    ""type"" : ""long""
                                  },
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""user"" : {
                                ""properties"" : {
                                  ""ticks"" : {
                                    ""type"" : ""long""
                                  },
                                  ""time"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""info"" : {
                            ""properties"" : {
                              ""ephemeral_id"" : {
                                ""type"" : ""keyword""
                              },
                              ""uptime"" : {
                                ""properties"" : {
                                  ""ms"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""version"" : {
                                ""type"" : ""keyword""
                              }
                            }
                          },
                          ""memstats"" : {
                            ""properties"" : {
                              ""gc_next"" : {
                                ""type"" : ""long""
                              },
                              ""memory_alloc"" : {
                                ""type"" : ""long""
                              },
                              ""memory_total"" : {
                                ""type"" : ""long""
                              },
                              ""rss"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""handles"" : {
                            ""properties"" : {
                              ""open"" : {
                                ""type"" : ""long""
                              },
                              ""limit"" : {
                                ""properties"" : {
                                  ""hard"" : {
                                    ""type"" : ""long""
                                  },
                                  ""soft"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""apm-server"" : {
                        ""properties"" : {
                          ""acm"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unavailable"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      },
                                      ""notfound"" : {
                                        ""type"" : ""long""
                                      },
                                      ""invalidquery"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""notmodified"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""unset"" : {
                                    ""type"" : ""long""
                                  },
                                  ""request"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""server"" : {
                            ""properties"" : {
                              ""request"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""concurrent"" : {
                                ""properties"" : {
                                  ""wait"" : {
                                    ""properties"" : {
                                      ""ms"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""response"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""properties"" : {
                                      ""count"" : {
                                        ""type"" : ""long""
                                      },
                                      ""toolarge"" : {
                                        ""type"" : ""long""
                                      },
                                      ""validate"" : {
                                        ""type"" : ""long""
                                      },
                                      ""ratelimit"" : {
                                        ""type"" : ""long""
                                      },
                                      ""queue"" : {
                                        ""type"" : ""long""
                                      },
                                      ""closed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""forbidden"" : {
                                        ""type"" : ""long""
                                      },
                                      ""concurrency"" : {
                                        ""type"" : ""long""
                                      },
                                      ""unauthorized"" : {
                                        ""type"" : ""long""
                                      },
                                      ""internal"" : {
                                        ""type"" : ""long""
                                      },
                                      ""decode"" : {
                                        ""type"" : ""long""
                                      },
                                      ""method"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""valid"" : {
                                    ""properties"" : {
                                      ""ok"" : {
                                        ""type"" : ""long""
                                      },
                                      ""accepted"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          ""decoder"" : {
                            ""properties"" : {
                              ""deflate"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""gzip"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""uncompressed"" : {
                                ""properties"" : {
                                  ""content-length"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reader"" : {
                                ""properties"" : {
                                  ""size"" : {
                                    ""type"" : ""long""
                                  },
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""missing-content-length"" : {
                                ""properties"" : {
                                  ""count"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""processor"" : {
                            ""properties"" : {
                              ""metric"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""sourcemap"" : {
                                ""properties"" : {
                                  ""counter"" : {
                                    ""type"" : ""long""
                                  },
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              },
                              ""transaction"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""transactions"" : {
                                    ""type"" : ""long""
                                  },
                                  ""spans"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stacktraces"" : {
                                    ""type"" : ""long""
                                  },
                                  ""frames"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""error"" : {
                                ""properties"" : {
                                  ""decoding"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""validation"" : {
                                    ""properties"" : {
                                      ""errors"" : {
                                        ""type"" : ""long""
                                      },
                                      ""count"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stacktraces"" : {
                                    ""type"" : ""long""
                                  },
                                  ""frames"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""span"" : {
                                ""properties"" : {
                                  ""transformations"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""sampling"" : {
                            ""properties"" : {
                              ""transactions_dropped"" : {
                                ""type"" : ""long""
                              },
                              ""tail"" : {
                                ""properties"" : {
                                  ""dynamic_service_groups"" : {
                                    ""type"" : ""long""
                                  },
                                  ""storage"" : {
                                    ""properties"" : {
                                      ""lsm_size"" : {
                                        ""type"" : ""long""
                                      },
                                      ""value_log_size"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  },
                                  ""events"" : {
                                    ""properties"" : {
                                      ""processed"" : {
                                        ""type"" : ""long""
                                      },
                                      ""dropped"" : {
                                        ""type"" : ""long""
                                      },
                                      ""stored"" : {
                                        ""type"" : ""long""
                                      },
                                      ""sampled"" : {
                                        ""type"" : ""long""
                                      },
                                      ""head_unsampled"" : {
                                        ""type"" : ""long""
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""libbeat"" : {
                        ""properties"" : {
                          ""config"" : {
                            ""properties"" : {
                              ""module"" : {
                                ""properties"" : {
                                  ""running"" : {
                                    ""type"" : ""long""
                                  },
                                  ""starts"" : {
                                    ""type"" : ""long""
                                  },
                                  ""stops"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""reloads"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""output"" : {
                            ""properties"" : {
                              ""events"" : {
                                ""properties"" : {
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  },
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""batches"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""duplicates"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""total"" : {
                                    ""type"" : ""long""
                                  },
                                  ""toomany"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""read"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""type"" : {
                                ""type"" : ""keyword""
                              },
                              ""write"" : {
                                ""properties"" : {
                                  ""bytes"" : {
                                    ""type"" : ""long""
                                  },
                                  ""errors"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          },
                          ""pipeline"" : {
                            ""properties"" : {
                              ""clients"" : {
                                ""type"" : ""long""
                              },
                              ""events"" : {
                                ""properties"" : {
                                  ""active"" : {
                                    ""type"" : ""long""
                                  },
                                  ""dropped"" : {
                                    ""type"" : ""long""
                                  },
                                  ""failed"" : {
                                    ""type"" : ""long""
                                  },
                                  ""filtered"" : {
                                    ""type"" : ""long""
                                  },
                                  ""published"" : {
                                    ""type"" : ""long""
                                  },
                                  ""retry"" : {
                                    ""type"" : ""long""
                                  },
                                  ""total"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              },
                              ""queue"" : {
                                ""properties"" : {
                                  ""acked"" : {
                                    ""type"" : ""long""
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      ""system"" : {
                        ""properties"" : {
                          ""load"" : {
                            ""properties"" : {
                              ""1"" : {
                                ""type"" : ""double""
                              },
                              ""15"" : {
                                ""type"" : ""double""
                              },
                              ""5"" : {
                                ""type"" : ""double""
                              },
                              ""norm"" : {
                                ""properties"" : {
                                  ""1"" : {
                                    ""type"" : ""double""
                                  },
                                  ""15"" : {
                                    ""type"" : ""double""
                                  },
                                  ""5"" : {
                                    ""type"" : ""double""
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  ""tags"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""format"" : ""date_time"",
                    ""type"" : ""date""
                  }
                }
              },
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  }
                }
              },
              ""timestamp"" : {
                ""format"" : ""date_time"",
                ""type"" : ""date""
              },
              ""type"" : {
                ""type"" : ""keyword""
              }
            }
          }
        },
        ""aliases"" : { }
      },
      "".monitoring-es"" : {
        ""order"" : 0,
        ""version"" : 8010099,
        ""index_patterns"" : [
          "".monitoring-es-7-*""
        ],
        ""settings"" : {
          ""index"" : {
            ""format"" : ""7"",
            ""codec"" : ""best_compression"",
            ""number_of_shards"" : ""1"",
            ""auto_expand_replicas"" : ""0-1"",
            ""number_of_replicas"" : ""0""
          }
        },
        ""mappings"" : {
          ""_doc"" : {
            ""date_detection"" : false,
            ""dynamic"" : false,
            ""properties"" : {
              ""cluster_uuid"" : {
                ""type"" : ""keyword""
              },
              ""state_uuid"" : {
                ""type"" : ""keyword""
              },
              ""timestamp"" : {
                ""type"" : ""date"",
                ""format"" : ""date_time""
              },
              ""interval_ms"" : {
                ""type"" : ""long""
              },
              ""type"" : {
                ""type"" : ""keyword""
              },
              ""source_node"" : {
                ""properties"" : {
                  ""uuid"" : {
                    ""type"" : ""keyword""
                  },
                  ""host"" : {
                    ""type"" : ""keyword""
                  },
                  ""transport_address"" : {
                    ""type"" : ""keyword""
                  },
                  ""ip"" : {
                    ""type"" : ""keyword""
                  },
                  ""name"" : {
                    ""type"" : ""keyword""
                  },
                  ""timestamp"" : {
                    ""type"" : ""date"",
                    ""format"" : ""date_time""
                  }
                }
              },
              ""indices_stats"" : {
                ""properties"" : {
                  ""_all"" : {
                    ""properties"" : {
                      ""primaries"" : {
                        ""properties"" : {
                          ""docs"" : {
                            ""properties"" : {
                              ""count"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""indexing"" : {
                            ""properties"" : {
                              ""index_total"" : {
                                ""type"" : ""long""
                              },
                              ""index_time_in_millis"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""search"" : {
                            ""properties"" : {
                              ""query_total"" : {
                                ""type"" : ""long""
                              },
                              ""query_time_in_millis"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""bulk"" : {
                            ""properties"" : {
                              ""total_operations"" : {
                                ""type"" : ""long""
                              },
                              ""total_time_in_millis"" : {
                                ""type"" : ""long""
                              },
                              ""total_size_in_bytes"" : {
                                ""type"" : ""long""
                              },
                              ""avg_time_in_millis"" : {
                                ""type"" : ""long""
                              },
                              ""avg_size_in_bytes"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      },
                      ""total"" : {
                        ""properties"" : {
                          ""docs"" : {
                            ""properties"" : {
                              ""count"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""indexing"" : {
                            ""properties"" : {
                              ""index_total"" : {
                                ""type"" : ""long""
                              },
                              ""index_time_in_millis"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""search"" : {
                            ""properties"" : {
                              ""query_total"" : {
                                ""type"" : ""long""
                              },
                              ""query_time_in_millis"" : {
                                ""type"" : ""long""
                              }
                            }
                          },
                          ""bulk"" : {
                            ""properties"" : {
                              ""total_operations"" : {
                                ""type"" : ""long""
                              },
                              ""total_time_in_millis"" : {
                                ""type"" : ""long""
                              },
                              ""total_size_in_bytes"" : {
                                ""type"" : ""long""
                              },
                              ""avg_time_in_millis"" : {
                                ""type"" : ""long""
                              },
                              ""avg_size_in_bytes"" : {
                                ""type"" : ""long""
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              ""index_stats"" : {
                ""properties"" : {
                  ""index"" : {
                    ""type"" : ""keyword""
                  },
                  ""primaries"" : {
                    ""properties"" : {
                      ""docs"" : {
                        ""properties"" : {
                          ""count"" : {
                            ""type"" : ""long""
                          }
                        }
                      },
                      ""fielddata"" : {
                        ""properties"" : {
                          ""memory_size_in_bytes"" : {
                            ""type"" : ""long""
                          },
                          ""evictions"" : {
                           ...
```",cbuescher,closed,"[':Distributed Coordination/Snapshot/Restore', '>test-failure', 'Team:Distributed (Obsolete)']",https://github.com/elastic/elasticsearch/issues/94149,2023-02-27T13:08:47Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/94149,"{
  ""application_resource"": ""yes""
}"
294,94113,[TSDB] Enablement of TSDB fails for package with fields having flattened type,"If there exist a field of type `flattened` in the field mapping of a datastream, on TSDB enablement of the package in Kibana, the below error is displayed in kibana. 

```
illegal_argument_exception Caused by: illegal_argument_exception: invalid composite mappings for [metrics-mysql.performance] Root causes: illegal_argument_exception: composable template [metrics-mysql.performance] template after composition with component templates [metrics-mysql.performance@package, metrics-mysql.performance@custom, .fleet_globals-1, .fleet_agent_id_verification-1] is invalid

```
In this case, none of the `flattened` field type is annotated with `dimension: true`.  

Impact: 

Many integration packages have `flattened` field type , TSDB enablement will fail unless this issue is fixed. ",agithomas,closed,"['>bug', 'Team:Analytics', ':StorageEngine/TSDB']",https://github.com/elastic/elasticsearch/issues/94113,2023-02-24T13:25:30Z,15,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/94113,"{
  ""application_resource"": ""no""
}"
295,94028,Highlighting: `encoder` and `tags_schema` are not accepted on a field level ,"### Elasticsearch Version

8.6.2

### Installed Plugins

_No response_

### Java Version

_bundled_

### OS Version

Linux fedora 6.1.11-200.fc37.x86_64 #1 SMP PREEMPT_DYNAMIC Thu Feb  9 19:20:24 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux

### Problem Description

When specifying either `encoder` or `tags_schema` configurations at a field level in a highlighting query leads to an exception in the response:
```json
""root_cause"": [
      {
        ""type"": ""x_content_parse_exception"",
        ""reason"": ""[12:9] [highlight_field] unknown field [encoder]""
      }
    ],
```
Also, looking at the documentation - https://www.elastic.co/guide/en/elasticsearch/reference/8.6/highlighting.html doesn't specify any of the settings being as global only and the override section tells that any settings can be overridden at a field level.

### Steps to Reproduce

1. Create an index with an analyzed property:
```http
PUT http://localhost:9200/highlight-test-000001
Content-Type: application/json

{
  ""mappings"": {
    ""dynamic"": ""strict"",
    ""properties"": {
      ""string"": {
        ""type"": ""text"",
        ""analyzer"": ""custom-analyzer""
      }
    }
  },
  ""settings"": {
    ""analysis"": {
      ""analyzer"": {
        ""custom-analyzer"": {
          ""type"": ""standard"",
          ""stopwords"": ""_english_""
        }
      }
    }
  }
}
```
2. Add some documents:
```http
PUT http://localhost:9200/highlight-test-000001/_doc/1
Content-Type: application/json

{
  ""string"": ""some text goes here""
}
```
```http
PUT http://localhost:9200/highlight-test-000001/_doc/2
Content-Type: application/json

{
  ""string"": ""<!DOCTYPE html><html><head><title>Page Title</title></head><body><h1>This is a Heading</h1><p>This is a text.</p></body></html>""
}
```
3. Try to execute a search query with highlighting and specifying settings on a field level:
```http
POST http://localhost:9200/highlight-test-000001/_search
Content-Type: application/json

{
  ""query"": {
    ""match"": {
      ""string"": {
        ""query"": ""text""
      }
    }
  },
  ""highlight"": {
    ""fields"": {
      ""string"": {
        ""encoder"": ""html""
      }
    }
  }
}
```

leads to:
```json
{
  ""error"": {
    ""root_cause"": [
      {
        ""type"": ""x_content_parse_exception"",
        ""reason"": ""[12:9] [highlight_field] unknown field [encoder]""
      }
    ],
    ""type"": ""x_content_parse_exception"",
    ""reason"": ""[12:20] [highlight] failed to parse field [fields]"",
    ""caused_by"": {
      ""type"": ""x_content_parse_exception"",
      ""reason"": ""[12:20] [fields] failed to parse field [string]"",
      ""caused_by"": {
        ""type"": ""x_content_parse_exception"",
        ""reason"": ""[12:9] [highlight_field] unknown field [encoder]""
      }
    }
  },
  ""status"": 400
}
```

Similarly using the `tags_schema` :
```http
POST http://localhost:9200/highlight-test-000001/_search
Content-Type: application/json

{
  ""query"": {
    ""match"": {
      ""string"": {
        ""query"": ""text""
      }
    }
  },
  ""highlight"": {
    ""fields"": {
      ""string"": {
        ""tags_schema"": ""styled""
      }
    }
  }
}
```
leads to the same error:
```json
{
  ""error"": {
    ""root_cause"": [
      {
        ""type"": ""x_content_parse_exception"",
        ""reason"": ""[12:9] [highlight_field] unknown field [tags_schema]""
      }
    ],
    ""type"": ""x_content_parse_exception"",
    ""reason"": ""[12:24] [highlight] failed to parse field [fields]"",
    ""caused_by"": {
      ""type"": ""x_content_parse_exception"",
      ""reason"": ""[12:24] [fields] failed to parse field [string]"",
      ""caused_by"": {
        ""type"": ""x_content_parse_exception"",
        ""reason"": ""[12:9] [highlight_field] unknown field [tags_schema]""
      }
    }
  },
  ""status"": 400
}
```

Specifying any of these settings at a global level works fine. With for example a query like:
```http
POST http://localhost:9200/highlight-test-000001/_search
Content-Type: application/json

{
  ""query"": {
    ""match"": {
      ""string"": {
        ""query"": ""text""
      }
    }
  },
  ""highlight"": {
    ""fields"": {
      ""string"": {}
    },
    ""tags_schema"": ""styled"",
    ""encoder"": ""html""
  }
}
```
the result on the sample data set is:
```json
{
  ""took"": 1,
  ""timed_out"": false,
  ""_shards"": {
    ""total"": 1,
    ""successful"": 1,
    ""skipped"": 0,
    ""failed"": 0
  },
  ""hits"": {
    ""total"": {
      ""value"": 2,
      ""relation"": ""eq""
    },
    ""max_score"": 0.24649063,
    ""hits"": [
      {
        ""_index"": ""highlight-test-000001"",
        ""_id"": ""1"",
        ""_score"": 0.24649063,
        ""_source"": {
          ""string"": ""some text goes here""
        },
        ""highlight"": {
          ""string"": [
            ""some <em class=\""hlt1\"">text</em> goes here""
          ]
        }
      },
      {
        ""_index"": ""highlight-test-000001"",
        ""_id"": ""2"",
        ""_score"": 0.1446617,
        ""_source"": {
          ""string"": ""<!DOCTYPE html><html><head><title>Page Title</title></head><body><h1>This is a Heading</h1><p>This is a text.</p></body></html>""
        },
        ""highlight"": {
          ""string"": [
            ""DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Page Title&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;&lt;body&gt;&lt;h1&gt;This is a Heading&lt;&#x2F;h1&gt;&lt;p&gt;This is a <em class=\""hlt1\"">text</em>""
          ]
        }
      }
    ]
  }
}
```


Elasticsearch is running in docker using:
```bash
docker run --rm -ti -p 9200:9200 -p 9300:9300 --ulimit memlock=-1:-1 --memory-swappiness=0  --name es-8.6-it -e ""discovery.type=single-node"" -e ""xpack.security.enabled=false"" -e ""ES_JAVA_OPTS=-Xms1g -Xmx1g"" -e ""cluster.routing.allocation.disk.threshold_enabled=false"" elastic/elasticsearch:8.6.2

```


### Logs (if relevant)

_No response_",marko-bekhta,closed,"['>bug', 'good first issue', ':Search Relevance/Highlighting', 'Team:Search Relevance']",https://github.com/elastic/elasticsearch/issues/94028,2023-02-22T17:40:02Z,5,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/94028,"{
  ""application_resource"": ""no""
}"
296,93947,[ML] Dual model deployment for Search and Ingest,"### Description

When using NLP models for search such as the [text embedding query](https://github.com/elastic/elasticsearch/pull/93531) it is critical to use the same model at both ingest and search. If ingest is a continuous process with searches running simultaneously then there is competition to access that model. Model deployments buffer work requests, during periods of heavy ingest this queue could be full of requests originating from ingest leaving new search requests _stuck in traffic_. For this reason search requests are prioritised over ingest requests and go to the front of the queue. See #93769

An alternative is to deploy the same model twice, once for ingest and again for search. Dedicated deployments have a number of advantages:
- The ingest deployment can be tuned for purpose. Increase throughput (more allocations) for ingest and tune a search deployment tuned for speed (more threads per allocations)
- Ingest will not effect search speed and vice versa
- Search is usually asymmetric- the query text is typically shorter than the document search against. The performance profile compared to ingest is different and the deployment settings can reflect that.

The downside is that twice the memory is required as the model is deployed twice.

### Multiple deployments of the same model.
To employ the dedicated deployment strategy there must be multiple installs of the model with different model Ids. If using the `eland_import_hub_model` script to upload the model use specific values for the `--es-model-id` argument. 

Here 2 instances of the same model are created: `for-search` and `for-ingest`. 

```
eland_import_hub_model
    --es-model-id=""for-search""
    --cloud-id <cloud-id> \  
    -u <username> -p <password> \ 
    --hub-model-id elastic/distilbert-base-cased-finetuned-conll03-english 
```

```
eland_import_hub_model
    --es-model-id=""for-ingest""
    --cloud-id <cloud-id> \  
    -u <username> -p <password> \ 
    --hub-model-id elastic/distilbert-base-cased-finetuned-conll03-english 
```

Reference the `for-ingest` model in ingest pipelines and `for-search` in the text embedding query. Then in the Trained Model Management UI start a the deployment for each model with the number of threads and allocations tuned for purpose. 


",davidkyle,closed,"['>enhancement', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/93947,2023-02-20T18:02:28Z,2,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/93947,"{
  ""application_resource"": ""yes""
}"
297,93670,Investigate and update memory recomendation formula for HNWS vectors with Lucene 9.5+,"### Description

Currently on our [public tuning docs](https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-knn-search.html#_ensure_data_nodes_have_enough_memory) we have the following formula to help estimate page cache memory requirements for HNSW vectors when using kNN search:
`num_vectors * 4 * (num_dimensions + 32) `

When Lucene 9.5 is adopted into elasticsearch this formula will need to be reevaluated. [Nightly benchmark tests](https://elasticsearch-benchmarks.elastic.co/index.html#tracks/dense_vector/nightly/default/30d) have shown a reduction is memory requirements. 

An additional nice to have would be to include a recommendation when using byte vectors which elasticsearch began supporting in es 8.6",jeffvestal,closed,"['>enhancement', ':Search Relevance/Vectors', 'Team:Search Relevance']",https://github.com/elastic/elasticsearch/issues/93670,2023-02-09T18:46:47Z,1,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/93670,"{
  ""application_resource"": ""yes""
}"
298,93539,Certain Aggregation functions not supported when TSDB datastream is used.,"**ElasticSearch Version :** elasticsearch:8.7.0-SNAPSHOT (Snapshot downloaded on 6th Feb 2023)

**Problem:** 

The below error occur when using datastream having TSDB enabled. 

**Imapact**

This breaks the Lens visualisation that are having aggregation function on data streams that are TSDB enabled. This is validated using the Oracle Integration TSDB migration activity.  

When a problem is seen, visualisation appear as below

<img width=""826"" alt=""image"" src=""https://user-images.githubusercontent.com/101976829/217166508-4bf64445-1fd1-4f1f-acdf-b2f2da0bbfdf.png"">






**Details of error is mentioned below.**

<img width=""768"" alt=""image"" src=""https://user-images.githubusercontent.com/101976829/217188490-97fb6486-42ed-4218-b6b7-a9b4a14dbe58.png"">

**Related PR** : 
When this problem was initially reported, below mentioned PR was created to resolve the problem.
https://github.com/elastic/elasticsearch/pull/93311

**Initial Impression**:

It appears that some of the aggregation functions works with TSDB (Max Value, Last Value) but certain functions do not such as 

- Count
- Percentile 


**Mapping Details**

```
{
  ""mappings"": {
    ""_meta"": {
      ""managed_by"": ""fleet"",
      ""managed"": true,
      ""package"": {
        ""name"": ""oracle""
      }
    },
    ""_data_stream_timestamp"": {
      ""enabled"": true
    },
    ""dynamic_templates"": [
      {
        ""strings_as_keyword"": {
          ""match_mapping_type"": ""string"",
          ""mapping"": {
            ""ignore_above"": 1024,
            ""type"": ""keyword""
          }
        }
      }
    ],
    ""date_detection"": false,
    ""properties"": {
      ""@timestamp"": {
        ""type"": ""date""
      },
      ""agent"": {
        ""properties"": {
          ""ephemeral_id"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""id"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""name"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""type"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""version"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          }
        }
      },
      ""cloud"": {
        ""properties"": {
          ""account"": {
            ""properties"": {
              ""id"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""availability_zone"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""instance"": {
            ""properties"": {
              ""id"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""name"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""machine"": {
            ""properties"": {
              ""type"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""project"": {
            ""properties"": {
              ""id"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          },
          ""provider"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""service"": {
            ""properties"": {
              ""name"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          }
        }
      },
      ""data_stream"": {
        ""properties"": {
          ""dataset"": {
            ""type"": ""constant_keyword"",
            ""value"": ""oracle.system_statistics""
          },
          ""namespace"": {
            ""type"": ""constant_keyword"",
            ""value"": ""default""
          },
          ""type"": {
            ""type"": ""constant_keyword"",
            ""value"": ""metrics""
          }
        }
      },
      ""ecs"": {
        ""properties"": {
          ""version"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          }
        }
      },
      ""elastic_agent"": {
        ""properties"": {
          ""id"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""snapshot"": {
            ""type"": ""boolean""
          },
          ""version"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          }
        }
      },
      ""event"": {
        ""properties"": {
          ""agent_id_status"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""dataset"": {
            ""type"": ""constant_keyword"",
            ""value"": ""oracle.system_statistics""
          },
          ""duration"": {
            ""type"": ""long""
          },
          ""ingested"": {
            ""type"": ""date"",
            ""format"": ""strict_date_time_no_millis||strict_date_optional_time||epoch_millis""
          },
          ""module"": {
            ""type"": ""constant_keyword"",
            ""value"": ""sql""
          }
        }
      },
      ""host"": {
        ""properties"": {
          ""architecture"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""containerized"": {
            ""type"": ""boolean""
          },
          ""hostname"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""id"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""ip"": {
            ""type"": ""ip""
          },
          ""mac"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""name"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""os"": {
            ""properties"": {
              ""codename"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""family"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""kernel"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""name"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""platform"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""type"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              },
              ""version"": {
                ""type"": ""keyword"",
                ""ignore_above"": 1024
              }
            }
          }
        }
      },
      ""metricset"": {
        ""properties"": {
          ""name"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          },
          ""period"": {
            ""type"": ""long""
          }
        }
      },
      ""oracle"": {
        ""properties"": {
          ""system_statistics"": {
            ""properties"": {
              ""bytes_received_via_sqlnet_from_client"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""byte""
                },
                ""time_series_metric"": ""counter""
              },
              ""bytes_received_via_sqlnet_from_dblink"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""byte""
                },
                ""time_series_metric"": ""counter""
              },
              ""bytes_sent_via_sqlnet_to_client"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""byte""
                },
                ""time_series_metric"": ""counter""
              },
              ""bytes_sent_via_sqlnet_to_dblink"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""byte""
                },
                ""time_series_metric"": ""counter""
              },
              ""cpu_used_by_this_session"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""ms""
                },
                ""time_series_metric"": ""counter""
              },
              ""db_block_changes"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""db_block_gets_from_cache"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""db_time"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""dbwr_checkpoint_buffers_written"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""dbwr_checkpoints"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""dml_statements_parallelized"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""enqueue_conversions"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""enqueue_deadlocks"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""enqueue_releases"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""enqueue_requests"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""enqueue_timeouts"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""enqueue_waits"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""exchange_deadlocks"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""execute_count"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""gc_current_block_receive_time"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""index_fast_full_scans_direct_read"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""index_fast_full_scans_full"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""index_fast_full_scans_rowid_ranges"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""java_call_heap_live_size"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""java_call_heap_total_size"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""byte""
                },
                ""time_series_metric"": ""counter""
              },
              ""java_call_heap_used_size"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""lob_reads"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""lob_writes"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""logons_current"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""opened_cursors_current"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""os_system_time_used"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""os_user_time_used"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""parallel_operations_not_downgraded"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""parse_count_hard"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""parse_count_total"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""parse_time_cpu"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""ms""
                },
                ""time_series_metric"": ""counter""
              },
              ""parse_time_elapsed"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""ms""
                },
                ""time_series_metric"": ""counter""
              },
              ""physical_read_bytes"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""byte""
                },
                ""time_series_metric"": ""counter""
              },
              ""physical_read_io_requests"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""physical_read_total_bytes"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""byte""
                },
                ""time_series_metric"": ""counter""
              },
              ""physical_read_total_io_requests"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""physical_reads"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""physical_write_bytes"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""byte""
                },
                ""time_series_metric"": ""counter""
              },
              ""physical_write_io_requests"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""physical_write_total_bytes"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""byte""
                },
                ""time_series_metric"": ""counter""
              },
              ""physical_write_total_io_requests"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""physical_writes"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""physical_writes_direct"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""physical_writes_from_cache"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""process_last_non_idle_time"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""queries_parallelized"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""recovery_blocks_read"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""recursive_calls"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""recursive_cpu_usage"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""redo_blocks_written"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""redo_buffer_allocation_retries"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""redo_log_space_requests"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""redo_log_space_wait_time"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""redo_size"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""byte""
                },
                ""time_series_metric"": ""counter""
              },
              ""redo_synch_time"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""ms""
                },
                ""time_series_metric"": ""counter""
              },
              ""redo_write_time"": {
                ""type"": ""double"",
                ""meta"": {
                  ""unit"": ""micros""
                },
                ""time_series_metric"": ""counter""
              },
              ""redo_writes"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""session_cursor_cache_count"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""session_cursor_cache_hits"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""session_logical_reads"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""session_stored_procedure_space"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""smon_posted_for_instance_recovery"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""smon_posted_for_txn_recovery_for_other_instances"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""sorts_disk"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""sorts_memory"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""sorts_rows"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""table_scan_rows_gotten"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""table_scans_direct_read"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""table_scans_long_tables"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""table_scans_rowid_ranges"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""transaction_rollbacks"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""user_calls"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""user_commits"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              },
              ""user_rollbacks"": {
                ""type"": ""double"",
                ""time_series_metric"": ""counter""
              }
            }
          }
        }
      },
      ""service"": {
        ""properties"": {
          ""address"": {
            ""type"": ""keyword"",
            ""time_series_dimension"": true
          },
          ""type"": {
            ""type"": ""keyword"",
            ""ignore_above"": 1024
          }
        }
      }
    }
  }
}
```
**Stack Trace**

**Request** 

```
GET .ds-metrics-oracle.system_statistics-default-2023.02.06-000001/_search?error_trace=true
{
  ""aggs"": {
    ""0"": {
      ""date_histogram"": {
        ""field"": ""@timestamp"",
        ""calendar_interval"": ""1m"",
        ""time_zone"": ""Asia/Calcutta"",
        ""extended_bounds"": {
          ""min"": 1675753854979,
          ""max"": 1675757454979
        }
      },
      ""aggs"": {
        ""1"": {
          ""value_count"": {
            ""field"": ""oracle.system_statistics.sorts_memory""
          }
        }
      }
    }
  },
  ""size"": 0,
  ""fields"": [
    {
      ""field"": ""@timestamp"",
      ""format"": ""date_time""
    },
    {
      ""field"": ""event.ingested"",
      ""format"": ""date_time""
    },
    {
      ""field"": ""process.cpu.start_time"",
      ""format"": ""date_time""
    },
    {
      ""field"": ""system.process.cpu.start_time"",
      ""format"": ""date_time""
    }
  ],
  ""script_fields"": {},
  ""stored_fields"": [
    ""*""
  ],
  ""runtime_mappings"": {},
  ""_source"": {
    ""excludes"": []
  },
  ""query"": {
    ""bool"": {
      ""must"": [],
      ""filter"": [
        {
          ""match_phrase"": {
            ""data_stream.dataset"": ""oracle.system_statistics""
          }
        },
        {
          ""range"": {
            ""@timestamp"": {
              ""format"": ""strict_date_optional_time"",
              ""gte"": ""2023-02-07T07:10:54.979Z"",
              ""lte"": ""2023-02-07T08:10:54.979Z""
            }
          }
        }
      ],
      ""should"": [],
      ""must_not"": []
    }
  }
}
```
**Response**
```
{
  ""error"": {
    ""root_cause"": [
      {
        ""type"": ""illegal_argument_exception"",
        ""reason"": ""Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]"",
        ""stack_trace"": """"""org.elasticsearch.ElasticsearchException$1: Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:640)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.SearchPhaseExecutionException.guessRootCauses(SearchPhaseExecutionException.java:150)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:622)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.ElasticsearchException.generateFailureXContent(ElasticsearchException.java:568)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.rest.RestResponse.build(RestResponse.java:175)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.rest.RestResponse.<init>(RestResponse.java:123)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.rest.RestResponse.<init>(RestResponse.java:102)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.rest.action.RestActionListener.onFailure(RestActionListener.java:55)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.rest.action.RestCancellableNodeClient$1.onFailure(RestCancellableNodeClient.java:96)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.client.internal.node.NodeClient$SafelyWrappedActionListener.onFailure(NodeClient.java:170)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.tasks.TaskManager$1.onFailure(TaskManager.java:220)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.support.ContextPreservingActionListener.onFailure(ContextPreservingActionListener.java:38)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionListener$Delegating.onFailure(ActionListener.java:97)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionListener$Delegating.onFailure(ActionListener.java:97)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionListener$RunAfterActionListener.onFailure(ActionListener.java:401)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.raisePhaseFailure(AbstractSearchAsyncAction.java:751)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:728)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:418)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:760)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.onShardFailure(AbstractSearchAsyncAction.java:512)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction$1.onFailure(AbstractSearchAsyncAction.java:349)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionListener$Delegating.onFailure(ActionListener.java:97)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:48)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:644)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$UnregisterChildTransportResponseHandler.handleException(TransportService.java:1651)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1377)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1513)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1488)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:50)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.support.ChannelActionListener.onFailure(ChannelActionListener.java:44)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable.onFailure(ActionRunnable.java:92)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:28)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:958)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1589)
Caused by: java.lang.IllegalArgumentException: Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceType.getUnregisteredException(ValuesSourceType.java:103)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceRegistry.getAggregator(ValuesSourceRegistry.java:173)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:100)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:29)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder$LeafOnly.doBuild(ValuesSourceAggregationBuilder.java:112)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactory.<init>(AggregatorFactory.java:46)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregatorFactory.<init>(ValuesSourceAggregatorFactory.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregatorFactory.<init>(DateHistogramAggregatorFactory.java:110)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregationBuilder.innerBuild(DateHistogramAggregationBuilder.java:483)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.parseSource(SearchService.java:1243)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.createContext(SearchService.java:986)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:630)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.lambda$executeQueryPhase$2(SearchService.java:495)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:50)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:47)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:72)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	... 6 more
""""""
      }
    ],
    ""type"": ""search_phase_execution_exception"",
    ""reason"": ""all shards failed"",
    ""phase"": ""query"",
    ""grouped"": true,
    ""failed_shards"": [
      {
        ""shard"": 0,
        ""index"": "".ds-metrics-oracle.system_statistics-default-2023.02.06-000001"",
        ""node"": ""kAAlBPtHSTekb4p2okauAQ"",
        ""reason"": {
          ""type"": ""illegal_argument_exception"",
          ""reason"": ""Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]"",
          ""stack_trace"": """"""java.lang.IllegalArgumentException: Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceType.getUnregisteredException(ValuesSourceType.java:103)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceRegistry.getAggregator(ValuesSourceRegistry.java:173)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:100)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:29)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder$LeafOnly.doBuild(ValuesSourceAggregationBuilder.java:112)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactory.<init>(AggregatorFactory.java:46)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregatorFactory.<init>(ValuesSourceAggregatorFactory.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregatorFactory.<init>(DateHistogramAggregatorFactory.java:110)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregationBuilder.innerBuild(DateHistogramAggregationBuilder.java:483)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.parseSource(SearchService.java:1243)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.createContext(SearchService.java:986)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:630)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.lambda$executeQueryPhase$2(SearchService.java:495)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:50)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:47)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:72)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:958)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1589)
""""""
        }
      }
    ],
    ""caused_by"": {
      ""type"": ""illegal_argument_exception"",
      ""reason"": ""Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]"",
      ""caused_by"": {
        ""type"": ""illegal_argument_exception"",
        ""reason"": ""Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]"",
        ""stack_trace"": """"""java.lang.IllegalArgumentException: Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceType.getUnregisteredException(ValuesSourceType.java:103)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceRegistry.getAggregator(ValuesSourceRegistry.java:173)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:100)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:29)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder$LeafOnly.doBuild(ValuesSourceAggregationBuilder.java:112)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactory.<init>(AggregatorFactory.java:46)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregatorFactory.<init>(ValuesSourceAggregatorFactory.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregatorFactory.<init>(DateHistogramAggregatorFactory.java:110)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregationBuilder.innerBuild(DateHistogramAggregationBuilder.java:483)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.parseSource(SearchService.java:1243)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.createContext(SearchService.java:986)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:630)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.lambda$executeQueryPhase$2(SearchService.java:495)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:50)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:47)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:72)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:958)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1589)
""""""
      },
      ""stack_trace"": """"""org.elasticsearch.ElasticsearchException$1: Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:640)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:416)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:760)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.onShardFailure(AbstractSearchAsyncAction.java:512)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction$1.onFailure(AbstractSearchAsyncAction.java:349)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionListener$Delegating.onFailure(ActionListener.java:97)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:48)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:644)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$UnregisterChildTransportResponseHandler.handleException(TransportService.java:1651)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1377)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1513)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1488)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:50)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.support.ChannelActionListener.onFailure(ChannelActionListener.java:44)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable.onFailure(ActionRunnable.java:92)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:28)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:958)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1589)
Caused by: java.lang.IllegalArgumentException: Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceType.getUnregisteredException(ValuesSourceType.java:103)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceRegistry.getAggregator(ValuesSourceRegistry.java:173)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:100)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:29)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder$LeafOnly.doBuild(ValuesSourceAggregationBuilder.java:112)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactory.<init>(AggregatorFactory.java:46)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregatorFactory.<init>(ValuesSourceAggregatorFactory.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregatorFactory.<init>(DateHistogramAggregatorFactory.java:110)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregationBuilder.innerBuild(DateHistogramAggregationBuilder.java:483)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.parseSource(SearchService.java:1243)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.createContext(SearchService.java:986)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:630)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.lambda$executeQueryPhase$2(SearchService.java:495)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:50)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:47)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:72)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	... 6 more
""""""
    },
    ""stack_trace"": """"""Failed to execute phase [query], all shards failed; shardFailures {[kAAlBPtHSTekb4p2okauAQ][.ds-metrics-oracle.system_statistics-default-2023.02.06-000001][0]: org.elasticsearch.transport.RemoteTransportException: [d6b078442dc7][127.0.0.1:9300][indices:data/read/search[phase/query]]
Caused by: java.lang.IllegalArgumentException: Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceType.getUnregisteredException(ValuesSourceType.java:103)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceRegistry.getAggregator(ValuesSourceRegistry.java:173)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:100)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:29)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder$LeafOnly.doBuild(ValuesSourceAggregationBuilder.java:112)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactory.<init>(AggregatorFactory.java:46)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregatorFactory.<init>(ValuesSourceAggregatorFactory.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregatorFactory.<init>(DateHistogramAggregatorFactory.java:110)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregationBuilder.innerBuild(DateHistogramAggregationBuilder.java:483)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.parseSource(SearchService.java:1243)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.createContext(SearchService.java:986)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:630)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.lambda$executeQueryPhase$2(SearchService.java:495)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:50)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:47)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:72)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:958)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1589)
}
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:728)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:418)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:760)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.onShardFailure(AbstractSearchAsyncAction.java:512)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction$1.onFailure(AbstractSearchAsyncAction.java:349)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionListener$Delegating.onFailure(ActionListener.java:97)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:48)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:644)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$UnregisterChildTransportResponseHandler.handleException(TransportService.java:1651)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1377)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1513)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1488)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:50)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.support.ChannelActionListener.onFailure(ChannelActionListener.java:44)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable.onFailure(ActionRunnable.java:92)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:28)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:33)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:958)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1589)
Caused by: org.elasticsearch.ElasticsearchException$1: Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:640)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:416)
	... 20 more
Caused by: java.lang.IllegalArgumentException: Field [oracle.system_statistics.sorts_memory] of type [double] is not supported for aggregation [value_count]
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceType.getUnregisteredException(ValuesSourceType.java:103)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceRegistry.getAggregator(ValuesSourceRegistry.java:173)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:100)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder.innerBuild(ValueCountAggregationBuilder.java:29)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder$LeafOnly.doBuild(ValuesSourceAggregationBuilder.java:112)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactory.<init>(AggregatorFactory.java:46)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregatorFactory.<init>(ValuesSourceAggregatorFactory.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregatorFactory.<init>(DateHistogramAggregatorFactory.java:110)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramAggregationBuilder.innerBuild(DateHistogramAggregationBuilder.java:483)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:419)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.support.ValuesSourceAggregationBuilder.doBuild(ValuesSourceAggregationBuilder.java:31)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AbstractAggregationBuilder.build(AbstractAggregationBuilder.java:129)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:397)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.parseSource(SearchService.java:1243)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.createContext(SearchService.java:986)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:630)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.search.SearchService.lambda$executeQueryPhase$2(SearchService.java:495)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:50)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$2.accept(ActionRunnable.java:47)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.action.ActionRunnable$3.doRun(ActionRunnable.java:72)
	at org.elasticsearch.server@8.7.0-SNAPSHOT/org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
	... 6 more
""""""
  },
  ""status"": 400
}
```",agithomas,closed,"['Team:Analytics', ':StorageEngine/TSDB']",https://github.com/elastic/elasticsearch/issues/93539,2023-02-07T04:48:37Z,13,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/93539,"{
  ""application_resource"": ""no""
}"
299,93529,[CI] MLModelDeploymentFullClusterRestartIT.testDeploymentSurvivesRestart failing,"### CI Link

https://gradle-enterprise.elastic.co/s/kxbmgd2hfgn5c

### Repro line

 ./gradlew ':x-pack:qa:full-cluster-restart:v8.4.0#bwcTest' -Dtests.class=""org.elasticsearch.xpack.restart.MLModelDeploymentFullClusterRestartIT"" -Dtests.method=""testDeploymentSurvivesRestart {cluster=UPGRADED}"" -Dtests.seed=D0279276514CA6ED -Dtests.bwc=true -Dtests.locale=ru -Dtests.timezone=America/Belize -Druntime.java=17

### Does it reproduce?

Didn't try

### Applicable branches

main 8.6

### Failure history

[Gradle Enterprise](https://gradle-enterprise.elastic.co/scans/tests?search.timeZoneId=Europe/Berlin&tests.container=org.elasticsearch.xpack.restart.MLModelDeploymentFullClusterRestartIT&tests.test=testDeploymentSurvivesRestart%20%7Bcluster%3DUPGRADED%7D)
### Failure excerpt

[2023-02-05T15:06:16,211][ERROR][o.e.i.g.GeoIpDownloader  ] [test-cluster-1] error downloading geoip database [GeoLite2-City.mmdb] org.elasticsearch.node.NodeClosedException: node closed {test-cluster-1}{77gZQnAFQiSWY92948d6Ng}{wxxdHNpCT6GWif-Y3FJkgA}{test-cluster-1}{127.0.0.1}{127.0.0.1:36535}{cdfhilmrstw}{ml.machine_memory=101250146304, testattr=test, xpack.installed=true, ml.max_jvm_size=536870912, ml.allocated_processors=32}
	at org.elasticsearch.server@8.4.3/org.elasticsearch.action.support.replication.TransportReplicationAction$ReroutePhase$2.onClusterServiceClose(TransportReplicationAction.java:1026)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.cluster.ClusterStateObserver$ContextPreservingListener.onClusterServiceClose(ClusterStateObserver.java:338)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.cluster.ClusterStateObserver$ObserverClusterStateListener.onClose(ClusterStateObserver.java:245)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.cluster.service.ClusterApplierService.addTimeoutListener(ClusterApplierService.java:254)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.cluster.ClusterStateObserver.waitForNextChange(ClusterStateObserver.java:177)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.cluster.ClusterStateObserver.waitForNextChange(ClusterStateObserver.java:118)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.cluster.ClusterStateObserver.waitForNextChange(ClusterStateObserver.java:110)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.action.support.replication.TransportReplicationAction$ReroutePhase.retry(TransportReplicationAction.java:1018)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.action.support.replication.TransportReplicationAction$ReroutePhase$1.handleException(TransportReplicationAction.java:997)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1390)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.transport.TransportService.doStop(TransportService.java:364)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.common.component.AbstractLifecycleComponent.stop(AbstractLifecycleComponent.java:63)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.node.Node.stop(Node.java:1383)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.node.Node.close(Node.java:1402)
	at org.elasticsearch.base@8.4.3/org.elasticsearch.core.IOUtils.close(IOUtils.java:71)
	at org.elasticsearch.base@8.4.3/org.elasticsearch.core.IOUtils.close(IOUtils.java:87)
	at org.elasticsearch.base@8.4.3/org.elasticsearch.core.IOUtils.close(IOUtils.java:63)
	at org.elasticsearch.server@8.4.3/org.elasticsearch.bootstrap.Elasticsearch.shutdown(Elasticsearch.java:446)
	at java.base/java.lang.Thread.run(Thread.java:833)
",valeriy42,closed,"['>test-failure', ':ml', 'Team:ML']",https://github.com/elastic/elasticsearch/issues/93529,2023-02-06T16:08:10Z,3,https://api.github.com/repos/elastic/elasticsearch,https://github.com/elastic/elasticsearch/issues/93529,"{
  ""application_resource"": ""yes""
}"
